<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 15.0.3"/>
    <title>routes API documentation</title>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;z-index:999;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent; z-index:1}nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{cursor:pointer;display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:.75rem center;margin-bottom:1rem;}.pdoc .alert > em{display:none;}.pdoc .alert > *:last-child{margin-bottom:0;}.pdoc .alert.note{color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .alert.tip{color:#0a3622;background-color:#d1e7dd;border-color:#a3cfbb;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%230a3622%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M2%206a6%206%200%201%201%2010.174%204.31c-.203.196-.359.4-.453.619l-.762%201.769A.5.5%200%200%201%2010.5%2013a.5.5%200%200%201%200%201%20.5.5%200%200%201%200%201l-.224.447a1%201%200%200%201-.894.553H6.618a1%201%200%200%201-.894-.553L5.5%2015a.5.5%200%200%201%200-1%20.5.5%200%200%201%200-1%20.5.5%200%200%201-.46-.302l-.761-1.77a2%202%200%200%200-.453-.618A5.98%205.98%200%200%201%202%206m6-5a5%205%200%200%200-3.479%208.592c.263.254.514.564.676.941L5.83%2012h4.342l.632-1.467c.162-.377.413-.687.676-.941A5%205%200%200%200%208%201%22/%3E%3C/svg%3E");}.pdoc .alert.important{color:#055160;background-color:#cff4fc;border-color:#9eeaf9;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23055160%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M2%200a2%202%200%200%200-2%202v12a2%202%200%200%200%202%202h12a2%202%200%200%200%202-2V2a2%202%200%200%200-2-2zm6%204c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%204.995A.905.905%200%200%201%208%204m.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2%22/%3E%3C/svg%3E");}.pdoc .alert.warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .alert.caution{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M11.46.146A.5.5%200%200%200%2011.107%200H4.893a.5.5%200%200%200-.353.146L.146%204.54A.5.5%200%200%200%200%204.893v6.214a.5.5%200%200%200%20.146.353l4.394%204.394a.5.5%200%200%200%20.353.146h6.214a.5.5%200%200%200%20.353-.146l4.394-4.394a.5.5%200%200%200%20.146-.353V4.893a.5.5%200%200%200-.146-.353zM8%204c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%204.995A.905.905%200%200%201%208%204m.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2%22/%3E%3C/svg%3E");}.pdoc .alert.danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--accent);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .decorator-deprecated{color:#842029;}.pdoc .decorator-deprecated ~ span{filter:grayscale(1) opacity(0.8);}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .view-value-toggle-state,.pdoc .view-value-toggle-state ~ .default_value{display:none;}.pdoc .view-value-toggle-state:checked ~ .default_value{display:inherit;}.pdoc .view-value-button{font-size:.5rem;vertical-align:middle;border-style:dashed;margin-top:-0.1rem;}.pdoc .view-value-button:hover{background:white;}.pdoc .view-value-button::before{content:"show";text-align:center;width:2.2em;display:inline-block;}.pdoc .view-value-toggle-state:checked ~ .view-value-button::before{content:"hide";}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>




            <h2>API Documentation</h2>
                <ul class="memberlist">
            <li>
                    <a class="class" href="#Mapper">Mapper</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#Mapper.__init__">Mapper</a>
                        </li>
                        <li>
                                <a class="variable" href="#Mapper.matchlist">matchlist</a>
                        </li>
                        <li>
                                <a class="variable" href="#Mapper.maxkeys">maxkeys</a>
                        </li>
                        <li>
                                <a class="variable" href="#Mapper.minkeys">minkeys</a>
                        </li>
                        <li>
                                <a class="variable" href="#Mapper.urlcache">urlcache</a>
                        </li>
                        <li>
                                <a class="variable" href="#Mapper.prefix">prefix</a>
                        </li>
                        <li>
                                <a class="variable" href="#Mapper.req_data">req_data</a>
                        </li>
                        <li>
                                <a class="variable" href="#Mapper.directory">directory</a>
                        </li>
                        <li>
                                <a class="variable" href="#Mapper.always_scan">always_scan</a>
                        </li>
                        <li>
                                <a class="variable" href="#Mapper.controller_scan">controller_scan</a>
                        </li>
                        <li>
                                <a class="variable" href="#Mapper.debug">debug</a>
                        </li>
                        <li>
                                <a class="variable" href="#Mapper.append_slash">append_slash</a>
                        </li>
                        <li>
                                <a class="variable" href="#Mapper.sub_domains">sub_domains</a>
                        </li>
                        <li>
                                <a class="variable" href="#Mapper.sub_domains_ignore">sub_domains_ignore</a>
                        </li>
                        <li>
                                <a class="variable" href="#Mapper.domain_match">domain_match</a>
                        </li>
                        <li>
                                <a class="variable" href="#Mapper.explicit">explicit</a>
                        </li>
                        <li>
                                <a class="variable" href="#Mapper.encoding">encoding</a>
                        </li>
                        <li>
                                <a class="variable" href="#Mapper.decode_errors">decode_errors</a>
                        </li>
                        <li>
                                <a class="variable" href="#Mapper.hardcode_names">hardcode_names</a>
                        </li>
                        <li>
                                <a class="variable" href="#Mapper.minimization">minimization</a>
                        </li>
                        <li>
                                <a class="variable" href="#Mapper.create_regs_lock">create_regs_lock</a>
                        </li>
                        <li>
                                <a class="variable" href="#Mapper.environ">environ</a>
                        </li>
                        <li>
                                <a class="function" href="#Mapper.extend">extend</a>
                        </li>
                        <li>
                                <a class="function" href="#Mapper.make_route">make_route</a>
                        </li>
                        <li>
                                <a class="function" href="#Mapper.connect">connect</a>
                        </li>
                        <li>
                                <a class="function" href="#Mapper.create_regs">create_regs</a>
                        </li>
                        <li>
                                <a class="function" href="#Mapper.match">match</a>
                        </li>
                        <li>
                                <a class="function" href="#Mapper.routematch">routematch</a>
                        </li>
                        <li>
                                <a class="function" href="#Mapper.generate">generate</a>
                        </li>
                        <li>
                                <a class="function" href="#Mapper.resource">resource</a>
                        </li>
                        <li>
                                <a class="function" href="#Mapper.redirect">redirect</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="function" href="#url_for">url_for</a>
            </li>
            <li>
                    <a class="class" href="#URLGenerator">URLGenerator</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#URLGenerator.__init__">URLGenerator</a>
                        </li>
                        <li>
                                <a class="variable" href="#URLGenerator.mapper">mapper</a>
                        </li>
                        <li>
                                <a class="variable" href="#URLGenerator.environ">environ</a>
                        </li>
                        <li>
                                <a class="function" href="#URLGenerator.current">current</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="function" href="#redirect_to">redirect_to</a>
            </li>
            <li>
                    <a class="function" href="#request_config">request_config</a>
            </li>
    </ul>



        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                    <h1 class="modulename">
routes    </h1>

                        <div class="docstring"><p>Provides common classes and functions most users will want access to.</p>
</div>

                        <input id="mod-routes-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="mod-routes-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos">  1</span></a><span class="sd">&quot;&quot;&quot;Provides common classes and functions most users will want access to.&quot;&quot;&quot;</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos">  2</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">threading</span>
</span><span id="L-3"><a href="#L-3"><span class="linenos">  3</span></a>
</span><span id="L-4"><a href="#L-4"><span class="linenos">  4</span></a>
</span><span id="L-5"><a href="#L-5"><span class="linenos">  5</span></a><span class="k">class</span><span class="w"> </span><span class="nc">_RequestConfig</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
</span><span id="L-6"><a href="#L-6"><span class="linenos">  6</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-7"><a href="#L-7"><span class="linenos">  7</span></a><span class="sd">    RequestConfig thread-local singleton</span>
</span><span id="L-8"><a href="#L-8"><span class="linenos">  8</span></a>
</span><span id="L-9"><a href="#L-9"><span class="linenos">  9</span></a><span class="sd">    The Routes RequestConfig object is a thread-local singleton that should</span>
</span><span id="L-10"><a href="#L-10"><span class="linenos"> 10</span></a><span class="sd">    be initialized by the web framework that is utilizing Routes.</span>
</span><span id="L-11"><a href="#L-11"><span class="linenos"> 11</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-12"><a href="#L-12"><span class="linenos"> 12</span></a>    <span class="n">__shared_state</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">local</span><span class="p">()</span>
</span><span id="L-13"><a href="#L-13"><span class="linenos"> 13</span></a>
</span><span id="L-14"><a href="#L-14"><span class="linenos"> 14</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
</span><span id="L-15"><a href="#L-15"><span class="linenos"> 15</span></a>        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__shared_state</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
</span><span id="L-16"><a href="#L-16"><span class="linenos"> 16</span></a>
</span><span id="L-17"><a href="#L-17"><span class="linenos"> 17</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
</span><span id="L-18"><a href="#L-18"><span class="linenos"> 18</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-19"><a href="#L-19"><span class="linenos"> 19</span></a><span class="sd">        If the name is environ, load the wsgi envion with load_wsgi_environ</span>
</span><span id="L-20"><a href="#L-20"><span class="linenos"> 20</span></a><span class="sd">        and set the environ</span>
</span><span id="L-21"><a href="#L-21"><span class="linenos"> 21</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-22"><a href="#L-22"><span class="linenos"> 22</span></a>        <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;environ&#39;</span><span class="p">:</span>
</span><span id="L-23"><a href="#L-23"><span class="linenos"> 23</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">load_wsgi_environ</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</span><span id="L-24"><a href="#L-24"><span class="linenos"> 24</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__shared_state</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
</span><span id="L-25"><a href="#L-25"><span class="linenos"> 25</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__shared_state</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
</span><span id="L-26"><a href="#L-26"><span class="linenos"> 26</span></a>
</span><span id="L-27"><a href="#L-27"><span class="linenos"> 27</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__delattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
</span><span id="L-28"><a href="#L-28"><span class="linenos"> 28</span></a>        <span class="nb">delattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__shared_state</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
</span><span id="L-29"><a href="#L-29"><span class="linenos"> 29</span></a>
</span><span id="L-30"><a href="#L-30"><span class="linenos"> 30</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">load_wsgi_environ</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">environ</span><span class="p">):</span>
</span><span id="L-31"><a href="#L-31"><span class="linenos"> 31</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-32"><a href="#L-32"><span class="linenos"> 32</span></a><span class="sd">        Load the protocol/server info from the environ and store it.</span>
</span><span id="L-33"><a href="#L-33"><span class="linenos"> 33</span></a><span class="sd">        Also, match the incoming URL if there&#39;s already a mapper, and</span>
</span><span id="L-34"><a href="#L-34"><span class="linenos"> 34</span></a><span class="sd">        store the resulting match dict in mapper_dict.</span>
</span><span id="L-35"><a href="#L-35"><span class="linenos"> 35</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-36"><a href="#L-36"><span class="linenos"> 36</span></a>        <span class="k">if</span> <span class="s1">&#39;HTTPS&#39;</span> <span class="ow">in</span> <span class="n">environ</span> <span class="ow">or</span> <span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;wsgi.url_scheme&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;https&#39;</span> \
</span><span id="L-37"><a href="#L-37"><span class="linenos"> 37</span></a>           <span class="ow">or</span> <span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;HTTP_X_FORWARDED_PROTO&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;https&#39;</span><span class="p">:</span>
</span><span id="L-38"><a href="#L-38"><span class="linenos"> 38</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">__shared_state</span><span class="o">.</span><span class="n">protocol</span> <span class="o">=</span> <span class="s1">&#39;https&#39;</span>
</span><span id="L-39"><a href="#L-39"><span class="linenos"> 39</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-40"><a href="#L-40"><span class="linenos"> 40</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">__shared_state</span><span class="o">.</span><span class="n">protocol</span> <span class="o">=</span> <span class="s1">&#39;http&#39;</span>
</span><span id="L-41"><a href="#L-41"><span class="linenos"> 41</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="L-42"><a href="#L-42"><span class="linenos"> 42</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">environ</span> <span class="o">=</span> <span class="n">environ</span>
</span><span id="L-43"><a href="#L-43"><span class="linenos"> 43</span></a>        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
</span><span id="L-44"><a href="#L-44"><span class="linenos"> 44</span></a>            <span class="k">pass</span>
</span><span id="L-45"><a href="#L-45"><span class="linenos"> 45</span></a>
</span><span id="L-46"><a href="#L-46"><span class="linenos"> 46</span></a>        <span class="c1"># Wrap in try/except as common case is that there is a mapper</span>
</span><span id="L-47"><a href="#L-47"><span class="linenos"> 47</span></a>        <span class="c1"># attached to self</span>
</span><span id="L-48"><a href="#L-48"><span class="linenos"> 48</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="L-49"><a href="#L-49"><span class="linenos"> 49</span></a>            <span class="k">if</span> <span class="s1">&#39;PATH_INFO&#39;</span> <span class="ow">in</span> <span class="n">environ</span><span class="p">:</span>
</span><span id="L-50"><a href="#L-50"><span class="linenos"> 50</span></a>                <span class="n">mapper</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapper</span>
</span><span id="L-51"><a href="#L-51"><span class="linenos"> 51</span></a>                <span class="n">path</span> <span class="o">=</span> <span class="n">environ</span><span class="p">[</span><span class="s1">&#39;PATH_INFO&#39;</span><span class="p">]</span>
</span><span id="L-52"><a href="#L-52"><span class="linenos"> 52</span></a>                <span class="n">result</span> <span class="o">=</span> <span class="n">mapper</span><span class="o">.</span><span class="n">routematch</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</span><span id="L-53"><a href="#L-53"><span class="linenos"> 53</span></a>                <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-54"><a href="#L-54"><span class="linenos"> 54</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">__shared_state</span><span class="o">.</span><span class="n">mapper_dict</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-55"><a href="#L-55"><span class="linenos"> 55</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">__shared_state</span><span class="o">.</span><span class="n">route</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-56"><a href="#L-56"><span class="linenos"> 56</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-57"><a href="#L-57"><span class="linenos"> 57</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">__shared_state</span><span class="o">.</span><span class="n">mapper_dict</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-58"><a href="#L-58"><span class="linenos"> 58</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">__shared_state</span><span class="o">.</span><span class="n">route</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-59"><a href="#L-59"><span class="linenos"> 59</span></a>        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
</span><span id="L-60"><a href="#L-60"><span class="linenos"> 60</span></a>            <span class="k">pass</span>
</span><span id="L-61"><a href="#L-61"><span class="linenos"> 61</span></a>
</span><span id="L-62"><a href="#L-62"><span class="linenos"> 62</span></a>        <span class="k">if</span> <span class="s1">&#39;HTTP_X_FORWARDED_HOST&#39;</span> <span class="ow">in</span> <span class="n">environ</span><span class="p">:</span>
</span><span id="L-63"><a href="#L-63"><span class="linenos"> 63</span></a>            <span class="c1"># Apache will add multiple comma separated values to</span>
</span><span id="L-64"><a href="#L-64"><span class="linenos"> 64</span></a>            <span class="c1"># X-Forwarded-Host if there are multiple reverse proxies</span>
</span><span id="L-65"><a href="#L-65"><span class="linenos"> 65</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">__shared_state</span><span class="o">.</span><span class="n">host</span> <span class="o">=</span> \
</span><span id="L-66"><a href="#L-66"><span class="linenos"> 66</span></a>                <span class="n">environ</span><span class="p">[</span><span class="s1">&#39;HTTP_X_FORWARDED_HOST&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;, &#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-67"><a href="#L-67"><span class="linenos"> 67</span></a>        <span class="k">elif</span> <span class="s1">&#39;HTTP_HOST&#39;</span> <span class="ow">in</span> <span class="n">environ</span><span class="p">:</span>
</span><span id="L-68"><a href="#L-68"><span class="linenos"> 68</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">__shared_state</span><span class="o">.</span><span class="n">host</span> <span class="o">=</span> <span class="n">environ</span><span class="p">[</span><span class="s1">&#39;HTTP_HOST&#39;</span><span class="p">]</span>
</span><span id="L-69"><a href="#L-69"><span class="linenos"> 69</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-70"><a href="#L-70"><span class="linenos"> 70</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">__shared_state</span><span class="o">.</span><span class="n">host</span> <span class="o">=</span> <span class="n">environ</span><span class="p">[</span><span class="s1">&#39;SERVER_NAME&#39;</span><span class="p">]</span>
</span><span id="L-71"><a href="#L-71"><span class="linenos"> 71</span></a>            <span class="k">if</span> <span class="n">environ</span><span class="p">[</span><span class="s1">&#39;wsgi.url_scheme&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;https&#39;</span><span class="p">:</span>
</span><span id="L-72"><a href="#L-72"><span class="linenos"> 72</span></a>                <span class="k">if</span> <span class="n">environ</span><span class="p">[</span><span class="s1">&#39;SERVER_PORT&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;443&#39;</span><span class="p">:</span>
</span><span id="L-73"><a href="#L-73"><span class="linenos"> 73</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">__shared_state</span><span class="o">.</span><span class="n">host</span> <span class="o">+=</span> <span class="s1">&#39;:&#39;</span> <span class="o">+</span> <span class="n">environ</span><span class="p">[</span><span class="s1">&#39;SERVER_PORT&#39;</span><span class="p">]</span>
</span><span id="L-74"><a href="#L-74"><span class="linenos"> 74</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-75"><a href="#L-75"><span class="linenos"> 75</span></a>                <span class="k">if</span> <span class="n">environ</span><span class="p">[</span><span class="s1">&#39;SERVER_PORT&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;80&#39;</span><span class="p">:</span>
</span><span id="L-76"><a href="#L-76"><span class="linenos"> 76</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">__shared_state</span><span class="o">.</span><span class="n">host</span> <span class="o">+=</span> <span class="s1">&#39;:&#39;</span> <span class="o">+</span> <span class="n">environ</span><span class="p">[</span><span class="s1">&#39;SERVER_PORT&#39;</span><span class="p">]</span>
</span><span id="L-77"><a href="#L-77"><span class="linenos"> 77</span></a>
</span><span id="L-78"><a href="#L-78"><span class="linenos"> 78</span></a>
</span><span id="L-79"><a href="#L-79"><span class="linenos"> 79</span></a><span class="k">def</span><span class="w"> </span><span class="nf">request_config</span><span class="p">(</span><span class="n">original</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="L-80"><a href="#L-80"><span class="linenos"> 80</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-81"><a href="#L-81"><span class="linenos"> 81</span></a><span class="sd">    Returns the Routes RequestConfig object.</span>
</span><span id="L-82"><a href="#L-82"><span class="linenos"> 82</span></a>
</span><span id="L-83"><a href="#L-83"><span class="linenos"> 83</span></a><span class="sd">    To get the Routes RequestConfig:</span>
</span><span id="L-84"><a href="#L-84"><span class="linenos"> 84</span></a>
</span><span id="L-85"><a href="#L-85"><span class="linenos"> 85</span></a><span class="sd">    &gt;&gt;&gt; from routes import *</span>
</span><span id="L-86"><a href="#L-86"><span class="linenos"> 86</span></a><span class="sd">    &gt;&gt;&gt; config = request_config()</span>
</span><span id="L-87"><a href="#L-87"><span class="linenos"> 87</span></a>
</span><span id="L-88"><a href="#L-88"><span class="linenos"> 88</span></a><span class="sd">    The following attributes must be set on the config object every request:</span>
</span><span id="L-89"><a href="#L-89"><span class="linenos"> 89</span></a>
</span><span id="L-90"><a href="#L-90"><span class="linenos"> 90</span></a><span class="sd">    mapper</span>
</span><span id="L-91"><a href="#L-91"><span class="linenos"> 91</span></a><span class="sd">        mapper should be a Mapper instance thats ready for use</span>
</span><span id="L-92"><a href="#L-92"><span class="linenos"> 92</span></a><span class="sd">    host</span>
</span><span id="L-93"><a href="#L-93"><span class="linenos"> 93</span></a><span class="sd">        host is the hostname of the webapp</span>
</span><span id="L-94"><a href="#L-94"><span class="linenos"> 94</span></a><span class="sd">    protocol</span>
</span><span id="L-95"><a href="#L-95"><span class="linenos"> 95</span></a><span class="sd">        protocol is the protocol of the current request</span>
</span><span id="L-96"><a href="#L-96"><span class="linenos"> 96</span></a><span class="sd">    mapper_dict</span>
</span><span id="L-97"><a href="#L-97"><span class="linenos"> 97</span></a><span class="sd">        mapper_dict should be the dict returned by mapper.match()</span>
</span><span id="L-98"><a href="#L-98"><span class="linenos"> 98</span></a><span class="sd">    redirect</span>
</span><span id="L-99"><a href="#L-99"><span class="linenos"> 99</span></a><span class="sd">        redirect should be a function that issues a redirect,</span>
</span><span id="L-100"><a href="#L-100"><span class="linenos">100</span></a><span class="sd">        and takes a url as the sole argument</span>
</span><span id="L-101"><a href="#L-101"><span class="linenos">101</span></a><span class="sd">    prefix (optional)</span>
</span><span id="L-102"><a href="#L-102"><span class="linenos">102</span></a><span class="sd">        Set if the application is moved under a URL prefix. Prefix</span>
</span><span id="L-103"><a href="#L-103"><span class="linenos">103</span></a><span class="sd">        will be stripped before matching, and prepended on generation</span>
</span><span id="L-104"><a href="#L-104"><span class="linenos">104</span></a><span class="sd">    environ (optional)</span>
</span><span id="L-105"><a href="#L-105"><span class="linenos">105</span></a><span class="sd">        Set to the WSGI environ for automatic prefix support if the</span>
</span><span id="L-106"><a href="#L-106"><span class="linenos">106</span></a><span class="sd">        webapp is underneath a &#39;SCRIPT_NAME&#39;</span>
</span><span id="L-107"><a href="#L-107"><span class="linenos">107</span></a>
</span><span id="L-108"><a href="#L-108"><span class="linenos">108</span></a><span class="sd">        Setting the environ will use information in environ to try and</span>
</span><span id="L-109"><a href="#L-109"><span class="linenos">109</span></a><span class="sd">        populate the host/protocol/mapper_dict options if you&#39;ve already</span>
</span><span id="L-110"><a href="#L-110"><span class="linenos">110</span></a><span class="sd">        set a mapper.</span>
</span><span id="L-111"><a href="#L-111"><span class="linenos">111</span></a>
</span><span id="L-112"><a href="#L-112"><span class="linenos">112</span></a><span class="sd">    **Using your own requst local**</span>
</span><span id="L-113"><a href="#L-113"><span class="linenos">113</span></a>
</span><span id="L-114"><a href="#L-114"><span class="linenos">114</span></a><span class="sd">    If you have your own request local object that you&#39;d like to use instead</span>
</span><span id="L-115"><a href="#L-115"><span class="linenos">115</span></a><span class="sd">    of the default thread local provided by Routes, you can configure Routes</span>
</span><span id="L-116"><a href="#L-116"><span class="linenos">116</span></a><span class="sd">    to use it::</span>
</span><span id="L-117"><a href="#L-117"><span class="linenos">117</span></a>
</span><span id="L-118"><a href="#L-118"><span class="linenos">118</span></a><span class="sd">        from routes import request_config()</span>
</span><span id="L-119"><a href="#L-119"><span class="linenos">119</span></a><span class="sd">        config = request_config()</span>
</span><span id="L-120"><a href="#L-120"><span class="linenos">120</span></a><span class="sd">        if hasattr(config, &#39;using_request_local&#39;):</span>
</span><span id="L-121"><a href="#L-121"><span class="linenos">121</span></a><span class="sd">            config.request_local = YourLocalCallable</span>
</span><span id="L-122"><a href="#L-122"><span class="linenos">122</span></a><span class="sd">            config = request_config()</span>
</span><span id="L-123"><a href="#L-123"><span class="linenos">123</span></a>
</span><span id="L-124"><a href="#L-124"><span class="linenos">124</span></a><span class="sd">    Once you have configured request_config, its advisable you retrieve it</span>
</span><span id="L-125"><a href="#L-125"><span class="linenos">125</span></a><span class="sd">    again to get the object you wanted. The variable you assign to</span>
</span><span id="L-126"><a href="#L-126"><span class="linenos">126</span></a><span class="sd">    request_local is assumed to be a callable that will get the local config</span>
</span><span id="L-127"><a href="#L-127"><span class="linenos">127</span></a><span class="sd">    object you wish.</span>
</span><span id="L-128"><a href="#L-128"><span class="linenos">128</span></a>
</span><span id="L-129"><a href="#L-129"><span class="linenos">129</span></a><span class="sd">    This example tests for the presence of the &#39;using_request_local&#39; attribute</span>
</span><span id="L-130"><a href="#L-130"><span class="linenos">130</span></a><span class="sd">    which will be present if you haven&#39;t assigned it yet. This way you can</span>
</span><span id="L-131"><a href="#L-131"><span class="linenos">131</span></a><span class="sd">    avoid repeat assignments of the request specific callable.</span>
</span><span id="L-132"><a href="#L-132"><span class="linenos">132</span></a>
</span><span id="L-133"><a href="#L-133"><span class="linenos">133</span></a><span class="sd">    Should you want the original object, perhaps to change the callable its</span>
</span><span id="L-134"><a href="#L-134"><span class="linenos">134</span></a><span class="sd">    using or stop this behavior, call request_config(original=True).</span>
</span><span id="L-135"><a href="#L-135"><span class="linenos">135</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-136"><a href="#L-136"><span class="linenos">136</span></a>    <span class="n">obj</span> <span class="o">=</span> <span class="n">_RequestConfig</span><span class="p">()</span>
</span><span id="L-137"><a href="#L-137"><span class="linenos">137</span></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="L-138"><a href="#L-138"><span class="linenos">138</span></a>        <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">request_local</span> <span class="ow">and</span> <span class="n">original</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
</span><span id="L-139"><a href="#L-139"><span class="linenos">139</span></a>            <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="s1">&#39;request_local&#39;</span><span class="p">)()</span>
</span><span id="L-140"><a href="#L-140"><span class="linenos">140</span></a>    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
</span><span id="L-141"><a href="#L-141"><span class="linenos">141</span></a>        <span class="n">obj</span><span class="o">.</span><span class="n">request_local</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-142"><a href="#L-142"><span class="linenos">142</span></a>        <span class="n">obj</span><span class="o">.</span><span class="n">using_request_local</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-143"><a href="#L-143"><span class="linenos">143</span></a>    <span class="k">return</span> <span class="n">_RequestConfig</span><span class="p">()</span>
</span><span id="L-144"><a href="#L-144"><span class="linenos">144</span></a>
</span><span id="L-145"><a href="#L-145"><span class="linenos">145</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">routes.mapper</span><span class="w"> </span><span class="kn">import</span> <span class="n">Mapper</span>
</span><span id="L-146"><a href="#L-146"><span class="linenos">146</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">routes.util</span><span class="w"> </span><span class="kn">import</span> <span class="n">redirect_to</span><span class="p">,</span> <span class="n">url_for</span><span class="p">,</span> <span class="n">URLGenerator</span>
</span><span id="L-147"><a href="#L-147"><span class="linenos">147</span></a>
</span><span id="L-148"><a href="#L-148"><span class="linenos">148</span></a><span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Mapper&#39;</span><span class="p">,</span> <span class="s1">&#39;url_for&#39;</span><span class="p">,</span> <span class="s1">&#39;URLGenerator&#39;</span><span class="p">,</span> <span class="s1">&#39;redirect_to&#39;</span><span class="p">,</span> <span class="s1">&#39;request_config&#39;</span><span class="p">]</span>
</span></pre></div>


            </section>
                <section id="Mapper">
                            <input id="Mapper-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">Mapper</span><wbr>(<span class="base">routes.mapper.SubMapperParent</span>):

                <label class="view-source-button" for="Mapper-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Mapper"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Mapper-316"><a href="#Mapper-316"><span class="linenos"> 316</span></a><span class="k">class</span><span class="w"> </span><span class="nc">Mapper</span><span class="p">(</span><span class="n">SubMapperParent</span><span class="p">):</span>
</span><span id="Mapper-317"><a href="#Mapper-317"><span class="linenos"> 317</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Mapper handles URL generation and URL recognition in a web</span>
</span><span id="Mapper-318"><a href="#Mapper-318"><span class="linenos"> 318</span></a><span class="sd">    application.</span>
</span><span id="Mapper-319"><a href="#Mapper-319"><span class="linenos"> 319</span></a>
</span><span id="Mapper-320"><a href="#Mapper-320"><span class="linenos"> 320</span></a><span class="sd">    Mapper is built handling dictionary&#39;s. It is assumed that the web</span>
</span><span id="Mapper-321"><a href="#Mapper-321"><span class="linenos"> 321</span></a><span class="sd">    application will handle the dictionary returned by URL recognition</span>
</span><span id="Mapper-322"><a href="#Mapper-322"><span class="linenos"> 322</span></a><span class="sd">    to dispatch appropriately.</span>
</span><span id="Mapper-323"><a href="#Mapper-323"><span class="linenos"> 323</span></a>
</span><span id="Mapper-324"><a href="#Mapper-324"><span class="linenos"> 324</span></a><span class="sd">    URL generation is done by passing keyword parameters into the</span>
</span><span id="Mapper-325"><a href="#Mapper-325"><span class="linenos"> 325</span></a><span class="sd">    generate function, a URL is then returned.</span>
</span><span id="Mapper-326"><a href="#Mapper-326"><span class="linenos"> 326</span></a>
</span><span id="Mapper-327"><a href="#Mapper-327"><span class="linenos"> 327</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="Mapper-328"><a href="#Mapper-328"><span class="linenos"> 328</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">controller_scan</span><span class="o">=</span><span class="n">controller_scan</span><span class="p">,</span> <span class="n">directory</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="Mapper-329"><a href="#Mapper-329"><span class="linenos"> 329</span></a>                 <span class="n">always_scan</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">register</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">explicit</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span id="Mapper-330"><a href="#Mapper-330"><span class="linenos"> 330</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a new Mapper instance</span>
</span><span id="Mapper-331"><a href="#Mapper-331"><span class="linenos"> 331</span></a>
</span><span id="Mapper-332"><a href="#Mapper-332"><span class="linenos"> 332</span></a><span class="sd">        All keyword arguments are optional.</span>
</span><span id="Mapper-333"><a href="#Mapper-333"><span class="linenos"> 333</span></a>
</span><span id="Mapper-334"><a href="#Mapper-334"><span class="linenos"> 334</span></a><span class="sd">        ``controller_scan``</span>
</span><span id="Mapper-335"><a href="#Mapper-335"><span class="linenos"> 335</span></a><span class="sd">            Function reference that will be used to return a list of</span>
</span><span id="Mapper-336"><a href="#Mapper-336"><span class="linenos"> 336</span></a><span class="sd">            valid controllers used during URL matching. If</span>
</span><span id="Mapper-337"><a href="#Mapper-337"><span class="linenos"> 337</span></a><span class="sd">            ``directory`` keyword arg is present, it will be passed</span>
</span><span id="Mapper-338"><a href="#Mapper-338"><span class="linenos"> 338</span></a><span class="sd">            into the function during its call. This option defaults to</span>
</span><span id="Mapper-339"><a href="#Mapper-339"><span class="linenos"> 339</span></a><span class="sd">            a function that will scan a directory for controllers.</span>
</span><span id="Mapper-340"><a href="#Mapper-340"><span class="linenos"> 340</span></a>
</span><span id="Mapper-341"><a href="#Mapper-341"><span class="linenos"> 341</span></a><span class="sd">            Alternatively, a list of controllers or None can be passed</span>
</span><span id="Mapper-342"><a href="#Mapper-342"><span class="linenos"> 342</span></a><span class="sd">            in which are assumed to be the definitive list of</span>
</span><span id="Mapper-343"><a href="#Mapper-343"><span class="linenos"> 343</span></a><span class="sd">            controller names valid when matching &#39;controller&#39;.</span>
</span><span id="Mapper-344"><a href="#Mapper-344"><span class="linenos"> 344</span></a>
</span><span id="Mapper-345"><a href="#Mapper-345"><span class="linenos"> 345</span></a><span class="sd">        ``directory``</span>
</span><span id="Mapper-346"><a href="#Mapper-346"><span class="linenos"> 346</span></a><span class="sd">            Passed into controller_scan for the directory to scan. It</span>
</span><span id="Mapper-347"><a href="#Mapper-347"><span class="linenos"> 347</span></a><span class="sd">            should be an absolute path if using the default</span>
</span><span id="Mapper-348"><a href="#Mapper-348"><span class="linenos"> 348</span></a><span class="sd">            ``controller_scan`` function.</span>
</span><span id="Mapper-349"><a href="#Mapper-349"><span class="linenos"> 349</span></a>
</span><span id="Mapper-350"><a href="#Mapper-350"><span class="linenos"> 350</span></a><span class="sd">        ``always_scan``</span>
</span><span id="Mapper-351"><a href="#Mapper-351"><span class="linenos"> 351</span></a><span class="sd">            Whether or not the ``controller_scan`` function should be</span>
</span><span id="Mapper-352"><a href="#Mapper-352"><span class="linenos"> 352</span></a><span class="sd">            run during every URL match. This is typically a good idea</span>
</span><span id="Mapper-353"><a href="#Mapper-353"><span class="linenos"> 353</span></a><span class="sd">            during development so the server won&#39;t need to be restarted</span>
</span><span id="Mapper-354"><a href="#Mapper-354"><span class="linenos"> 354</span></a><span class="sd">            anytime a controller is added.</span>
</span><span id="Mapper-355"><a href="#Mapper-355"><span class="linenos"> 355</span></a>
</span><span id="Mapper-356"><a href="#Mapper-356"><span class="linenos"> 356</span></a><span class="sd">        ``register``</span>
</span><span id="Mapper-357"><a href="#Mapper-357"><span class="linenos"> 357</span></a><span class="sd">            Boolean used to determine if the Mapper should use</span>
</span><span id="Mapper-358"><a href="#Mapper-358"><span class="linenos"> 358</span></a><span class="sd">            ``request_config`` to register itself as the mapper. Since</span>
</span><span id="Mapper-359"><a href="#Mapper-359"><span class="linenos"> 359</span></a><span class="sd">            it&#39;s done on a thread-local basis, this is typically best</span>
</span><span id="Mapper-360"><a href="#Mapper-360"><span class="linenos"> 360</span></a><span class="sd">            used during testing though it won&#39;t hurt in other cases.</span>
</span><span id="Mapper-361"><a href="#Mapper-361"><span class="linenos"> 361</span></a>
</span><span id="Mapper-362"><a href="#Mapper-362"><span class="linenos"> 362</span></a><span class="sd">        ``explicit``</span>
</span><span id="Mapper-363"><a href="#Mapper-363"><span class="linenos"> 363</span></a><span class="sd">            Boolean used to determine if routes should be connected</span>
</span><span id="Mapper-364"><a href="#Mapper-364"><span class="linenos"> 364</span></a><span class="sd">            with implicit defaults of::</span>
</span><span id="Mapper-365"><a href="#Mapper-365"><span class="linenos"> 365</span></a>
</span><span id="Mapper-366"><a href="#Mapper-366"><span class="linenos"> 366</span></a><span class="sd">                {&#39;controller&#39;:&#39;content&#39;,&#39;action&#39;:&#39;index&#39;,&#39;id&#39;:None}</span>
</span><span id="Mapper-367"><a href="#Mapper-367"><span class="linenos"> 367</span></a>
</span><span id="Mapper-368"><a href="#Mapper-368"><span class="linenos"> 368</span></a><span class="sd">            When set to True, these defaults will not be added to route</span>
</span><span id="Mapper-369"><a href="#Mapper-369"><span class="linenos"> 369</span></a><span class="sd">            connections and ``url_for`` will not use Route memory.</span>
</span><span id="Mapper-370"><a href="#Mapper-370"><span class="linenos"> 370</span></a>
</span><span id="Mapper-371"><a href="#Mapper-371"><span class="linenos"> 371</span></a><span class="sd">        Additional attributes that may be set after mapper</span>
</span><span id="Mapper-372"><a href="#Mapper-372"><span class="linenos"> 372</span></a><span class="sd">        initialization (ie, map.ATTRIBUTE = &#39;something&#39;):</span>
</span><span id="Mapper-373"><a href="#Mapper-373"><span class="linenos"> 373</span></a>
</span><span id="Mapper-374"><a href="#Mapper-374"><span class="linenos"> 374</span></a><span class="sd">        ``encoding``</span>
</span><span id="Mapper-375"><a href="#Mapper-375"><span class="linenos"> 375</span></a><span class="sd">            Used to indicate alternative encoding/decoding systems to</span>
</span><span id="Mapper-376"><a href="#Mapper-376"><span class="linenos"> 376</span></a><span class="sd">            use with both incoming URL&#39;s, and during Route generation</span>
</span><span id="Mapper-377"><a href="#Mapper-377"><span class="linenos"> 377</span></a><span class="sd">            when passed a Unicode string. Defaults to &#39;utf-8&#39;.</span>
</span><span id="Mapper-378"><a href="#Mapper-378"><span class="linenos"> 378</span></a>
</span><span id="Mapper-379"><a href="#Mapper-379"><span class="linenos"> 379</span></a><span class="sd">        ``decode_errors``</span>
</span><span id="Mapper-380"><a href="#Mapper-380"><span class="linenos"> 380</span></a><span class="sd">            How to handle errors in the encoding, generally ignoring</span>
</span><span id="Mapper-381"><a href="#Mapper-381"><span class="linenos"> 381</span></a><span class="sd">            any chars that don&#39;t convert should be sufficient. Defaults</span>
</span><span id="Mapper-382"><a href="#Mapper-382"><span class="linenos"> 382</span></a><span class="sd">            to &#39;ignore&#39;.</span>
</span><span id="Mapper-383"><a href="#Mapper-383"><span class="linenos"> 383</span></a>
</span><span id="Mapper-384"><a href="#Mapper-384"><span class="linenos"> 384</span></a><span class="sd">        ``minimization``</span>
</span><span id="Mapper-385"><a href="#Mapper-385"><span class="linenos"> 385</span></a><span class="sd">            Boolean used to indicate whether or not Routes should</span>
</span><span id="Mapper-386"><a href="#Mapper-386"><span class="linenos"> 386</span></a><span class="sd">            minimize URL&#39;s and the generated URL&#39;s, or require every</span>
</span><span id="Mapper-387"><a href="#Mapper-387"><span class="linenos"> 387</span></a><span class="sd">            part where it appears in the path. Defaults to False.</span>
</span><span id="Mapper-388"><a href="#Mapper-388"><span class="linenos"> 388</span></a>
</span><span id="Mapper-389"><a href="#Mapper-389"><span class="linenos"> 389</span></a><span class="sd">        ``hardcode_names``</span>
</span><span id="Mapper-390"><a href="#Mapper-390"><span class="linenos"> 390</span></a><span class="sd">            Whether or not Named Routes result in the default options</span>
</span><span id="Mapper-391"><a href="#Mapper-391"><span class="linenos"> 391</span></a><span class="sd">            for the route being used *or* if they actually force url</span>
</span><span id="Mapper-392"><a href="#Mapper-392"><span class="linenos"> 392</span></a><span class="sd">            generation to use the route. Defaults to False.</span>
</span><span id="Mapper-393"><a href="#Mapper-393"><span class="linenos"> 393</span></a>
</span><span id="Mapper-394"><a href="#Mapper-394"><span class="linenos"> 394</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Mapper-395"><a href="#Mapper-395"><span class="linenos"> 395</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">matchlist</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Mapper-396"><a href="#Mapper-396"><span class="linenos"> 396</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">maxkeys</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="Mapper-397"><a href="#Mapper-397"><span class="linenos"> 397</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">minkeys</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="Mapper-398"><a href="#Mapper-398"><span class="linenos"> 398</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">urlcache</span> <span class="o">=</span> <span class="n">LRUCache</span><span class="p">(</span><span class="mi">1600</span><span class="p">)</span>
</span><span id="Mapper-399"><a href="#Mapper-399"><span class="linenos"> 399</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_created_regs</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="Mapper-400"><a href="#Mapper-400"><span class="linenos"> 400</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_created_gens</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="Mapper-401"><a href="#Mapper-401"><span class="linenos"> 401</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_master_regexp</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Mapper-402"><a href="#Mapper-402"><span class="linenos"> 402</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">prefix</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Mapper-403"><a href="#Mapper-403"><span class="linenos"> 403</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">req_data</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">local</span><span class="p">()</span>
</span><span id="Mapper-404"><a href="#Mapper-404"><span class="linenos"> 404</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">directory</span> <span class="o">=</span> <span class="n">directory</span>
</span><span id="Mapper-405"><a href="#Mapper-405"><span class="linenos"> 405</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">always_scan</span> <span class="o">=</span> <span class="n">always_scan</span>
</span><span id="Mapper-406"><a href="#Mapper-406"><span class="linenos"> 406</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">controller_scan</span> <span class="o">=</span> <span class="n">controller_scan</span>
</span><span id="Mapper-407"><a href="#Mapper-407"><span class="linenos"> 407</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_regprefix</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Mapper-408"><a href="#Mapper-408"><span class="linenos"> 408</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_routenames</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="Mapper-409"><a href="#Mapper-409"><span class="linenos"> 409</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">debug</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="Mapper-410"><a href="#Mapper-410"><span class="linenos"> 410</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">append_slash</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="Mapper-411"><a href="#Mapper-411"><span class="linenos"> 411</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">sub_domains</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="Mapper-412"><a href="#Mapper-412"><span class="linenos"> 412</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">sub_domains_ignore</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Mapper-413"><a href="#Mapper-413"><span class="linenos"> 413</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">domain_match</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;[^\.\/]+?\.[^\.\/]+&#39;</span>
</span><span id="Mapper-414"><a href="#Mapper-414"><span class="linenos"> 414</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">explicit</span> <span class="o">=</span> <span class="n">explicit</span>
</span><span id="Mapper-415"><a href="#Mapper-415"><span class="linenos"> 415</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">encoding</span> <span class="o">=</span> <span class="s1">&#39;utf-8&#39;</span>
</span><span id="Mapper-416"><a href="#Mapper-416"><span class="linenos"> 416</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">decode_errors</span> <span class="o">=</span> <span class="s1">&#39;ignore&#39;</span>
</span><span id="Mapper-417"><a href="#Mapper-417"><span class="linenos"> 417</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">hardcode_names</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="Mapper-418"><a href="#Mapper-418"><span class="linenos"> 418</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">minimization</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="Mapper-419"><a href="#Mapper-419"><span class="linenos"> 419</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">create_regs_lock</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Lock</span><span class="p">()</span>
</span><span id="Mapper-420"><a href="#Mapper-420"><span class="linenos"> 420</span></a>        <span class="k">if</span> <span class="n">register</span><span class="p">:</span>
</span><span id="Mapper-421"><a href="#Mapper-421"><span class="linenos"> 421</span></a>            <span class="n">config</span> <span class="o">=</span> <span class="n">request_config</span><span class="p">()</span>
</span><span id="Mapper-422"><a href="#Mapper-422"><span class="linenos"> 422</span></a>            <span class="n">config</span><span class="o">.</span><span class="n">mapper</span> <span class="o">=</span> <span class="bp">self</span>
</span><span id="Mapper-423"><a href="#Mapper-423"><span class="linenos"> 423</span></a>
</span><span id="Mapper-424"><a href="#Mapper-424"><span class="linenos"> 424</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Mapper-425"><a href="#Mapper-425"><span class="linenos"> 425</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Generates a tabular string representation.&quot;&quot;&quot;</span>
</span><span id="Mapper-426"><a href="#Mapper-426"><span class="linenos"> 426</span></a>        <span class="k">def</span><span class="w"> </span><span class="nf">format_methods</span><span class="p">(</span><span class="n">r</span><span class="p">):</span>
</span><span id="Mapper-427"><a href="#Mapper-427"><span class="linenos"> 427</span></a>            <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">conditions</span><span class="p">:</span>
</span><span id="Mapper-428"><a href="#Mapper-428"><span class="linenos"> 428</span></a>                <span class="n">method</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">conditions</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;method&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
</span><span id="Mapper-429"><a href="#Mapper-429"><span class="linenos"> 429</span></a>                <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="n">method</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span> <span class="ow">and</span> <span class="n">method</span> <span class="ow">or</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">method</span><span class="p">)</span>
</span><span id="Mapper-430"><a href="#Mapper-430"><span class="linenos"> 430</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Mapper-431"><a href="#Mapper-431"><span class="linenos"> 431</span></a>                <span class="k">return</span> <span class="s1">&#39;&#39;</span>
</span><span id="Mapper-432"><a href="#Mapper-432"><span class="linenos"> 432</span></a>
</span><span id="Mapper-433"><a href="#Mapper-433"><span class="linenos"> 433</span></a>        <span class="n">table</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;Route name&#39;</span><span class="p">,</span> <span class="s1">&#39;Methods&#39;</span><span class="p">,</span> <span class="s1">&#39;Path&#39;</span><span class="p">,</span> <span class="s1">&#39;Controller&#39;</span><span class="p">,</span> <span class="s1">&#39;action&#39;</span><span class="p">)]</span> <span class="o">+</span> \
</span><span id="Mapper-434"><a href="#Mapper-434"><span class="linenos"> 434</span></a>                <span class="p">[(</span><span class="n">r</span><span class="o">.</span><span class="n">name</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">format_methods</span><span class="p">(</span><span class="n">r</span><span class="p">),</span> <span class="n">r</span><span class="o">.</span><span class="n">routepath</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
</span><span id="Mapper-435"><a href="#Mapper-435"><span class="linenos"> 435</span></a>                  <span class="n">r</span><span class="o">.</span><span class="n">defaults</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;controller&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">),</span> <span class="n">r</span><span class="o">.</span><span class="n">defaults</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;action&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">))</span>
</span><span id="Mapper-436"><a href="#Mapper-436"><span class="linenos"> 436</span></a>                 <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">matchlist</span><span class="p">]</span>
</span><span id="Mapper-437"><a href="#Mapper-437"><span class="linenos"> 437</span></a>
</span><span id="Mapper-438"><a href="#Mapper-438"><span class="linenos"> 438</span></a>        <span class="n">widths</span> <span class="o">=</span> <span class="p">[</span><span class="nb">max</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="n">col</span><span class="p">])</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">table</span><span class="p">)</span>
</span><span id="Mapper-439"><a href="#Mapper-439"><span class="linenos"> 439</span></a>                  <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">table</span><span class="p">[</span><span class="mi">0</span><span class="p">]))]</span>
</span><span id="Mapper-440"><a href="#Mapper-440"><span class="linenos"> 440</span></a>
</span><span id="Mapper-441"><a href="#Mapper-441"><span class="linenos"> 441</span></a>        <span class="k">return</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="Mapper-442"><a href="#Mapper-442"><span class="linenos"> 442</span></a>            <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="n">widths</span><span class="p">[</span><span class="n">col</span><span class="p">])</span>
</span><span id="Mapper-443"><a href="#Mapper-443"><span class="linenos"> 443</span></a>                     <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">widths</span><span class="p">)))</span>
</span><span id="Mapper-444"><a href="#Mapper-444"><span class="linenos"> 444</span></a>            <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">table</span><span class="p">)</span>
</span><span id="Mapper-445"><a href="#Mapper-445"><span class="linenos"> 445</span></a>
</span><span id="Mapper-446"><a href="#Mapper-446"><span class="linenos"> 446</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_envget</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Mapper-447"><a href="#Mapper-447"><span class="linenos"> 447</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="Mapper-448"><a href="#Mapper-448"><span class="linenos"> 448</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">req_data</span><span class="o">.</span><span class="n">environ</span>
</span><span id="Mapper-449"><a href="#Mapper-449"><span class="linenos"> 449</span></a>        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
</span><span id="Mapper-450"><a href="#Mapper-450"><span class="linenos"> 450</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="Mapper-451"><a href="#Mapper-451"><span class="linenos"> 451</span></a>
</span><span id="Mapper-452"><a href="#Mapper-452"><span class="linenos"> 452</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_envset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">env</span><span class="p">):</span>
</span><span id="Mapper-453"><a href="#Mapper-453"><span class="linenos"> 453</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">req_data</span><span class="o">.</span><span class="n">environ</span> <span class="o">=</span> <span class="n">env</span>
</span><span id="Mapper-454"><a href="#Mapper-454"><span class="linenos"> 454</span></a>
</span><span id="Mapper-455"><a href="#Mapper-455"><span class="linenos"> 455</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_envdel</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Mapper-456"><a href="#Mapper-456"><span class="linenos"> 456</span></a>        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">req_data</span><span class="o">.</span><span class="n">environ</span>
</span><span id="Mapper-457"><a href="#Mapper-457"><span class="linenos"> 457</span></a>    <span class="n">environ</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_envget</span><span class="p">,</span> <span class="n">_envset</span><span class="p">,</span> <span class="n">_envdel</span><span class="p">)</span>
</span><span id="Mapper-458"><a href="#Mapper-458"><span class="linenos"> 458</span></a>
</span><span id="Mapper-459"><a href="#Mapper-459"><span class="linenos"> 459</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">extend</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">routes</span><span class="p">,</span> <span class="n">path_prefix</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
</span><span id="Mapper-460"><a href="#Mapper-460"><span class="linenos"> 460</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Extends the mapper routes with a list of Route objects</span>
</span><span id="Mapper-461"><a href="#Mapper-461"><span class="linenos"> 461</span></a>
</span><span id="Mapper-462"><a href="#Mapper-462"><span class="linenos"> 462</span></a><span class="sd">        If a path_prefix is provided, all the routes will have their</span>
</span><span id="Mapper-463"><a href="#Mapper-463"><span class="linenos"> 463</span></a><span class="sd">        path prepended with the path_prefix.</span>
</span><span id="Mapper-464"><a href="#Mapper-464"><span class="linenos"> 464</span></a>
</span><span id="Mapper-465"><a href="#Mapper-465"><span class="linenos"> 465</span></a><span class="sd">        Example::</span>
</span><span id="Mapper-466"><a href="#Mapper-466"><span class="linenos"> 466</span></a>
</span><span id="Mapper-467"><a href="#Mapper-467"><span class="linenos"> 467</span></a><span class="sd">            &gt;&gt;&gt; map = Mapper(controller_scan=None)</span>
</span><span id="Mapper-468"><a href="#Mapper-468"><span class="linenos"> 468</span></a><span class="sd">            &gt;&gt;&gt; map.connect(&#39;home&#39;, &#39;/&#39;, controller=&#39;home&#39;, action=&#39;splash&#39;)</span>
</span><span id="Mapper-469"><a href="#Mapper-469"><span class="linenos"> 469</span></a><span class="sd">            &gt;&gt;&gt; map.matchlist[0].name == &#39;home&#39;</span>
</span><span id="Mapper-470"><a href="#Mapper-470"><span class="linenos"> 470</span></a><span class="sd">            True</span>
</span><span id="Mapper-471"><a href="#Mapper-471"><span class="linenos"> 471</span></a><span class="sd">            &gt;&gt;&gt; routes = [Route(&#39;index&#39;, &#39;/index.htm&#39;, controller=&#39;home&#39;,</span>
</span><span id="Mapper-472"><a href="#Mapper-472"><span class="linenos"> 472</span></a><span class="sd">            ...                 action=&#39;index&#39;)]</span>
</span><span id="Mapper-473"><a href="#Mapper-473"><span class="linenos"> 473</span></a><span class="sd">            &gt;&gt;&gt; map.extend(routes)</span>
</span><span id="Mapper-474"><a href="#Mapper-474"><span class="linenos"> 474</span></a><span class="sd">            &gt;&gt;&gt; len(map.matchlist) == 2</span>
</span><span id="Mapper-475"><a href="#Mapper-475"><span class="linenos"> 475</span></a><span class="sd">            True</span>
</span><span id="Mapper-476"><a href="#Mapper-476"><span class="linenos"> 476</span></a><span class="sd">            &gt;&gt;&gt; map.extend(routes, path_prefix=&#39;/subapp&#39;)</span>
</span><span id="Mapper-477"><a href="#Mapper-477"><span class="linenos"> 477</span></a><span class="sd">            &gt;&gt;&gt; len(map.matchlist) == 3</span>
</span><span id="Mapper-478"><a href="#Mapper-478"><span class="linenos"> 478</span></a><span class="sd">            True</span>
</span><span id="Mapper-479"><a href="#Mapper-479"><span class="linenos"> 479</span></a><span class="sd">            &gt;&gt;&gt; map.matchlist[2].routepath == &#39;/subapp/index.htm&#39;</span>
</span><span id="Mapper-480"><a href="#Mapper-480"><span class="linenos"> 480</span></a><span class="sd">            True</span>
</span><span id="Mapper-481"><a href="#Mapper-481"><span class="linenos"> 481</span></a>
</span><span id="Mapper-482"><a href="#Mapper-482"><span class="linenos"> 482</span></a><span class="sd">        .. note::</span>
</span><span id="Mapper-483"><a href="#Mapper-483"><span class="linenos"> 483</span></a>
</span><span id="Mapper-484"><a href="#Mapper-484"><span class="linenos"> 484</span></a><span class="sd">            This function does not merely extend the mapper with the</span>
</span><span id="Mapper-485"><a href="#Mapper-485"><span class="linenos"> 485</span></a><span class="sd">            given list of routes, it actually creates new routes with</span>
</span><span id="Mapper-486"><a href="#Mapper-486"><span class="linenos"> 486</span></a><span class="sd">            identical calling arguments.</span>
</span><span id="Mapper-487"><a href="#Mapper-487"><span class="linenos"> 487</span></a>
</span><span id="Mapper-488"><a href="#Mapper-488"><span class="linenos"> 488</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Mapper-489"><a href="#Mapper-489"><span class="linenos"> 489</span></a>        <span class="k">for</span> <span class="n">route</span> <span class="ow">in</span> <span class="n">routes</span><span class="p">:</span>
</span><span id="Mapper-490"><a href="#Mapper-490"><span class="linenos"> 490</span></a>            <span class="k">if</span> <span class="n">path_prefix</span> <span class="ow">and</span> <span class="n">route</span><span class="o">.</span><span class="n">minimization</span><span class="p">:</span>
</span><span id="Mapper-491"><a href="#Mapper-491"><span class="linenos"> 491</span></a>                <span class="n">routepath</span> <span class="o">=</span> <span class="s1">&#39;/&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">path_prefix</span><span class="p">,</span> <span class="n">route</span><span class="o">.</span><span class="n">routepath</span><span class="p">])</span>
</span><span id="Mapper-492"><a href="#Mapper-492"><span class="linenos"> 492</span></a>            <span class="k">elif</span> <span class="n">path_prefix</span><span class="p">:</span>
</span><span id="Mapper-493"><a href="#Mapper-493"><span class="linenos"> 493</span></a>                <span class="n">routepath</span> <span class="o">=</span> <span class="n">path_prefix</span> <span class="o">+</span> <span class="n">route</span><span class="o">.</span><span class="n">routepath</span>
</span><span id="Mapper-494"><a href="#Mapper-494"><span class="linenos"> 494</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Mapper-495"><a href="#Mapper-495"><span class="linenos"> 495</span></a>                <span class="n">routepath</span> <span class="o">=</span> <span class="n">route</span><span class="o">.</span><span class="n">routepath</span>
</span><span id="Mapper-496"><a href="#Mapper-496"><span class="linenos"> 496</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">route</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
</span><span id="Mapper-497"><a href="#Mapper-497"><span class="linenos"> 497</span></a>                         <span class="n">routepath</span><span class="p">,</span>
</span><span id="Mapper-498"><a href="#Mapper-498"><span class="linenos"> 498</span></a>                         <span class="n">conditions</span><span class="o">=</span><span class="n">route</span><span class="o">.</span><span class="n">conditions</span><span class="p">,</span>
</span><span id="Mapper-499"><a href="#Mapper-499"><span class="linenos"> 499</span></a>                         <span class="o">**</span><span class="n">route</span><span class="o">.</span><span class="n">_kargs</span>
</span><span id="Mapper-500"><a href="#Mapper-500"><span class="linenos"> 500</span></a>                         <span class="p">)</span>
</span><span id="Mapper-501"><a href="#Mapper-501"><span class="linenos"> 501</span></a>
</span><span id="Mapper-502"><a href="#Mapper-502"><span class="linenos"> 502</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">make_route</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">):</span>
</span><span id="Mapper-503"><a href="#Mapper-503"><span class="linenos"> 503</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Make a new Route object</span>
</span><span id="Mapper-504"><a href="#Mapper-504"><span class="linenos"> 504</span></a>
</span><span id="Mapper-505"><a href="#Mapper-505"><span class="linenos"> 505</span></a><span class="sd">        A subclass can override this method to use a custom Route class.</span>
</span><span id="Mapper-506"><a href="#Mapper-506"><span class="linenos"> 506</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Mapper-507"><a href="#Mapper-507"><span class="linenos"> 507</span></a>        <span class="k">return</span> <span class="n">Route</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">)</span>
</span><span id="Mapper-508"><a href="#Mapper-508"><span class="linenos"> 508</span></a>
</span><span id="Mapper-509"><a href="#Mapper-509"><span class="linenos"> 509</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">connect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">):</span>
</span><span id="Mapper-510"><a href="#Mapper-510"><span class="linenos"> 510</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create and connect a new Route to the Mapper.</span>
</span><span id="Mapper-511"><a href="#Mapper-511"><span class="linenos"> 511</span></a>
</span><span id="Mapper-512"><a href="#Mapper-512"><span class="linenos"> 512</span></a><span class="sd">        Usage:</span>
</span><span id="Mapper-513"><a href="#Mapper-513"><span class="linenos"> 513</span></a>
</span><span id="Mapper-514"><a href="#Mapper-514"><span class="linenos"> 514</span></a><span class="sd">        .. code-block:: python</span>
</span><span id="Mapper-515"><a href="#Mapper-515"><span class="linenos"> 515</span></a>
</span><span id="Mapper-516"><a href="#Mapper-516"><span class="linenos"> 516</span></a><span class="sd">            m = Mapper()</span>
</span><span id="Mapper-517"><a href="#Mapper-517"><span class="linenos"> 517</span></a><span class="sd">            m.connect(&#39;:controller/:action/:id&#39;)</span>
</span><span id="Mapper-518"><a href="#Mapper-518"><span class="linenos"> 518</span></a><span class="sd">            m.connect(&#39;date/:year/:month/:day&#39;, controller=&quot;blog&quot;,</span>
</span><span id="Mapper-519"><a href="#Mapper-519"><span class="linenos"> 519</span></a><span class="sd">                      action=&quot;view&quot;)</span>
</span><span id="Mapper-520"><a href="#Mapper-520"><span class="linenos"> 520</span></a><span class="sd">            m.connect(&#39;archives/:page&#39;, controller=&quot;blog&quot;, action=&quot;by_page&quot;,</span>
</span><span id="Mapper-521"><a href="#Mapper-521"><span class="linenos"> 521</span></a><span class="sd">            requirements = { &#39;page&#39;:&#39;\\d{1,2}&#39; })</span>
</span><span id="Mapper-522"><a href="#Mapper-522"><span class="linenos"> 522</span></a><span class="sd">            m.connect(&#39;category_list&#39;, &#39;archives/category/:section&#39;,</span>
</span><span id="Mapper-523"><a href="#Mapper-523"><span class="linenos"> 523</span></a><span class="sd">                      controller=&#39;blog&#39;, action=&#39;category&#39;,</span>
</span><span id="Mapper-524"><a href="#Mapper-524"><span class="linenos"> 524</span></a><span class="sd">                      section=&#39;home&#39;, type=&#39;list&#39;)</span>
</span><span id="Mapper-525"><a href="#Mapper-525"><span class="linenos"> 525</span></a><span class="sd">            m.connect(&#39;home&#39;, &#39;&#39;, controller=&#39;blog&#39;, action=&#39;view&#39;,</span>
</span><span id="Mapper-526"><a href="#Mapper-526"><span class="linenos"> 526</span></a><span class="sd">                      section=&#39;home&#39;)</span>
</span><span id="Mapper-527"><a href="#Mapper-527"><span class="linenos"> 527</span></a>
</span><span id="Mapper-528"><a href="#Mapper-528"><span class="linenos"> 528</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Mapper-529"><a href="#Mapper-529"><span class="linenos"> 529</span></a>        <span class="n">routename</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Mapper-530"><a href="#Mapper-530"><span class="linenos"> 530</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="Mapper-531"><a href="#Mapper-531"><span class="linenos"> 531</span></a>            <span class="n">routename</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Mapper-532"><a href="#Mapper-532"><span class="linenos"> 532</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Mapper-533"><a href="#Mapper-533"><span class="linenos"> 533</span></a>            <span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="kc">None</span><span class="p">,)</span> <span class="o">+</span> <span class="n">args</span>
</span><span id="Mapper-534"><a href="#Mapper-534"><span class="linenos"> 534</span></a>        <span class="k">if</span> <span class="s1">&#39;_explicit&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kargs</span><span class="p">:</span>
</span><span id="Mapper-535"><a href="#Mapper-535"><span class="linenos"> 535</span></a>            <span class="n">kargs</span><span class="p">[</span><span class="s1">&#39;_explicit&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">explicit</span>
</span><span id="Mapper-536"><a href="#Mapper-536"><span class="linenos"> 536</span></a>        <span class="k">if</span> <span class="s1">&#39;_minimize&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kargs</span><span class="p">:</span>
</span><span id="Mapper-537"><a href="#Mapper-537"><span class="linenos"> 537</span></a>            <span class="n">kargs</span><span class="p">[</span><span class="s1">&#39;_minimize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">minimization</span>
</span><span id="Mapper-538"><a href="#Mapper-538"><span class="linenos"> 538</span></a>        <span class="n">route</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_route</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">)</span>
</span><span id="Mapper-539"><a href="#Mapper-539"><span class="linenos"> 539</span></a>
</span><span id="Mapper-540"><a href="#Mapper-540"><span class="linenos"> 540</span></a>        <span class="c1"># Apply encoding and errors if its not the defaults and the route</span>
</span><span id="Mapper-541"><a href="#Mapper-541"><span class="linenos"> 541</span></a>        <span class="c1"># didn&#39;t have one passed in.</span>
</span><span id="Mapper-542"><a href="#Mapper-542"><span class="linenos"> 542</span></a>        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">encoding</span> <span class="o">!=</span> <span class="s1">&#39;utf-8&#39;</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">decode_errors</span> <span class="o">!=</span> <span class="s1">&#39;ignore&#39;</span><span class="p">)</span> <span class="ow">and</span> \
</span><span id="Mapper-543"><a href="#Mapper-543"><span class="linenos"> 543</span></a>           <span class="s1">&#39;_encoding&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kargs</span><span class="p">:</span>
</span><span id="Mapper-544"><a href="#Mapper-544"><span class="linenos"> 544</span></a>            <span class="n">route</span><span class="o">.</span><span class="n">encoding</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">encoding</span>
</span><span id="Mapper-545"><a href="#Mapper-545"><span class="linenos"> 545</span></a>            <span class="n">route</span><span class="o">.</span><span class="n">decode_errors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">decode_errors</span>
</span><span id="Mapper-546"><a href="#Mapper-546"><span class="linenos"> 546</span></a>
</span><span id="Mapper-547"><a href="#Mapper-547"><span class="linenos"> 547</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">route</span><span class="o">.</span><span class="n">static</span><span class="p">:</span>
</span><span id="Mapper-548"><a href="#Mapper-548"><span class="linenos"> 548</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">matchlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">route</span><span class="p">)</span>
</span><span id="Mapper-549"><a href="#Mapper-549"><span class="linenos"> 549</span></a>
</span><span id="Mapper-550"><a href="#Mapper-550"><span class="linenos"> 550</span></a>        <span class="k">if</span> <span class="n">routename</span><span class="p">:</span>
</span><span id="Mapper-551"><a href="#Mapper-551"><span class="linenos"> 551</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_routenames</span><span class="p">[</span><span class="n">routename</span><span class="p">]</span> <span class="o">=</span> <span class="n">route</span>
</span><span id="Mapper-552"><a href="#Mapper-552"><span class="linenos"> 552</span></a>            <span class="n">route</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">routename</span>
</span><span id="Mapper-553"><a href="#Mapper-553"><span class="linenos"> 553</span></a>        <span class="k">if</span> <span class="n">route</span><span class="o">.</span><span class="n">static</span><span class="p">:</span>
</span><span id="Mapper-554"><a href="#Mapper-554"><span class="linenos"> 554</span></a>            <span class="k">return</span>
</span><span id="Mapper-555"><a href="#Mapper-555"><span class="linenos"> 555</span></a>        <span class="n">exists</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="Mapper-556"><a href="#Mapper-556"><span class="linenos"> 556</span></a>        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">maxkeys</span><span class="p">:</span>
</span><span id="Mapper-557"><a href="#Mapper-557"><span class="linenos"> 557</span></a>            <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="n">route</span><span class="o">.</span><span class="n">maxkeys</span><span class="p">:</span>
</span><span id="Mapper-558"><a href="#Mapper-558"><span class="linenos"> 558</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">maxkeys</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">route</span><span class="p">)</span>
</span><span id="Mapper-559"><a href="#Mapper-559"><span class="linenos"> 559</span></a>                <span class="n">exists</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="Mapper-560"><a href="#Mapper-560"><span class="linenos"> 560</span></a>                <span class="k">break</span>
</span><span id="Mapper-561"><a href="#Mapper-561"><span class="linenos"> 561</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">exists</span><span class="p">:</span>
</span><span id="Mapper-562"><a href="#Mapper-562"><span class="linenos"> 562</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">maxkeys</span><span class="p">[</span><span class="n">route</span><span class="o">.</span><span class="n">maxkeys</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">route</span><span class="p">]</span>
</span><span id="Mapper-563"><a href="#Mapper-563"><span class="linenos"> 563</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_created_gens</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="Mapper-564"><a href="#Mapper-564"><span class="linenos"> 564</span></a>
</span><span id="Mapper-565"><a href="#Mapper-565"><span class="linenos"> 565</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_create_gens</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Mapper-566"><a href="#Mapper-566"><span class="linenos"> 566</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create the generation hashes for route lookups&quot;&quot;&quot;</span>
</span><span id="Mapper-567"><a href="#Mapper-567"><span class="linenos"> 567</span></a>        <span class="c1"># Use keys temporailly to assemble the list to avoid excessive</span>
</span><span id="Mapper-568"><a href="#Mapper-568"><span class="linenos"> 568</span></a>        <span class="c1"># list iteration testing with &quot;in&quot;</span>
</span><span id="Mapper-569"><a href="#Mapper-569"><span class="linenos"> 569</span></a>        <span class="n">controllerlist</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="Mapper-570"><a href="#Mapper-570"><span class="linenos"> 570</span></a>        <span class="n">actionlist</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="Mapper-571"><a href="#Mapper-571"><span class="linenos"> 571</span></a>
</span><span id="Mapper-572"><a href="#Mapper-572"><span class="linenos"> 572</span></a>        <span class="c1"># Assemble all the hardcoded/defaulted actions/controllers used</span>
</span><span id="Mapper-573"><a href="#Mapper-573"><span class="linenos"> 573</span></a>        <span class="k">for</span> <span class="n">route</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">matchlist</span><span class="p">:</span>
</span><span id="Mapper-574"><a href="#Mapper-574"><span class="linenos"> 574</span></a>            <span class="k">if</span> <span class="n">route</span><span class="o">.</span><span class="n">static</span><span class="p">:</span>
</span><span id="Mapper-575"><a href="#Mapper-575"><span class="linenos"> 575</span></a>                <span class="k">continue</span>
</span><span id="Mapper-576"><a href="#Mapper-576"><span class="linenos"> 576</span></a>            <span class="k">if</span> <span class="s1">&#39;controller&#39;</span> <span class="ow">in</span> <span class="n">route</span><span class="o">.</span><span class="n">defaults</span><span class="p">:</span>
</span><span id="Mapper-577"><a href="#Mapper-577"><span class="linenos"> 577</span></a>                <span class="n">controllerlist</span><span class="p">[</span><span class="n">route</span><span class="o">.</span><span class="n">defaults</span><span class="p">[</span><span class="s1">&#39;controller&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="Mapper-578"><a href="#Mapper-578"><span class="linenos"> 578</span></a>            <span class="k">if</span> <span class="s1">&#39;action&#39;</span> <span class="ow">in</span> <span class="n">route</span><span class="o">.</span><span class="n">defaults</span><span class="p">:</span>
</span><span id="Mapper-579"><a href="#Mapper-579"><span class="linenos"> 579</span></a>                <span class="n">actionlist</span><span class="p">[</span><span class="n">route</span><span class="o">.</span><span class="n">defaults</span><span class="p">[</span><span class="s1">&#39;action&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="Mapper-580"><a href="#Mapper-580"><span class="linenos"> 580</span></a>
</span><span id="Mapper-581"><a href="#Mapper-581"><span class="linenos"> 581</span></a>        <span class="c1"># Setup the lists of all controllers/actions we&#39;ll add each route</span>
</span><span id="Mapper-582"><a href="#Mapper-582"><span class="linenos"> 582</span></a>        <span class="c1"># to. We include the &#39;*&#39; in the case that a generate contains a</span>
</span><span id="Mapper-583"><a href="#Mapper-583"><span class="linenos"> 583</span></a>        <span class="c1"># controller/action that has no hardcodes</span>
</span><span id="Mapper-584"><a href="#Mapper-584"><span class="linenos"> 584</span></a>        <span class="n">controllerlist</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">controllerlist</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;*&#39;</span><span class="p">]</span>
</span><span id="Mapper-585"><a href="#Mapper-585"><span class="linenos"> 585</span></a>        <span class="n">actionlist</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">actionlist</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;*&#39;</span><span class="p">]</span>
</span><span id="Mapper-586"><a href="#Mapper-586"><span class="linenos"> 586</span></a>
</span><span id="Mapper-587"><a href="#Mapper-587"><span class="linenos"> 587</span></a>        <span class="c1"># Go through our list again, assemble the controllers/actions we&#39;ll</span>
</span><span id="Mapper-588"><a href="#Mapper-588"><span class="linenos"> 588</span></a>        <span class="c1"># add each route to. If its hardcoded, we only add it to that dict key.</span>
</span><span id="Mapper-589"><a href="#Mapper-589"><span class="linenos"> 589</span></a>        <span class="c1"># Otherwise we add it to every hardcode since it can be changed.</span>
</span><span id="Mapper-590"><a href="#Mapper-590"><span class="linenos"> 590</span></a>        <span class="n">gendict</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># Our generated two-deep hash</span>
</span><span id="Mapper-591"><a href="#Mapper-591"><span class="linenos"> 591</span></a>        <span class="k">for</span> <span class="n">route</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">matchlist</span><span class="p">:</span>
</span><span id="Mapper-592"><a href="#Mapper-592"><span class="linenos"> 592</span></a>            <span class="k">if</span> <span class="n">route</span><span class="o">.</span><span class="n">static</span><span class="p">:</span>
</span><span id="Mapper-593"><a href="#Mapper-593"><span class="linenos"> 593</span></a>                <span class="k">continue</span>
</span><span id="Mapper-594"><a href="#Mapper-594"><span class="linenos"> 594</span></a>            <span class="n">clist</span> <span class="o">=</span> <span class="n">controllerlist</span>
</span><span id="Mapper-595"><a href="#Mapper-595"><span class="linenos"> 595</span></a>            <span class="n">alist</span> <span class="o">=</span> <span class="n">actionlist</span>
</span><span id="Mapper-596"><a href="#Mapper-596"><span class="linenos"> 596</span></a>            <span class="k">if</span> <span class="s1">&#39;controller&#39;</span> <span class="ow">in</span> <span class="n">route</span><span class="o">.</span><span class="n">hardcoded</span><span class="p">:</span>
</span><span id="Mapper-597"><a href="#Mapper-597"><span class="linenos"> 597</span></a>                <span class="n">clist</span> <span class="o">=</span> <span class="p">[</span><span class="n">route</span><span class="o">.</span><span class="n">defaults</span><span class="p">[</span><span class="s1">&#39;controller&#39;</span><span class="p">]]</span>
</span><span id="Mapper-598"><a href="#Mapper-598"><span class="linenos"> 598</span></a>            <span class="k">if</span> <span class="s1">&#39;action&#39;</span> <span class="ow">in</span> <span class="n">route</span><span class="o">.</span><span class="n">hardcoded</span><span class="p">:</span>
</span><span id="Mapper-599"><a href="#Mapper-599"><span class="linenos"> 599</span></a>                <span class="n">alist</span> <span class="o">=</span> <span class="p">[</span><span class="n">six</span><span class="o">.</span><span class="n">text_type</span><span class="p">(</span><span class="n">route</span><span class="o">.</span><span class="n">defaults</span><span class="p">[</span><span class="s1">&#39;action&#39;</span><span class="p">])]</span>
</span><span id="Mapper-600"><a href="#Mapper-600"><span class="linenos"> 600</span></a>            <span class="k">for</span> <span class="n">controller</span> <span class="ow">in</span> <span class="n">clist</span><span class="p">:</span>
</span><span id="Mapper-601"><a href="#Mapper-601"><span class="linenos"> 601</span></a>                <span class="k">for</span> <span class="n">action</span> <span class="ow">in</span> <span class="n">alist</span><span class="p">:</span>
</span><span id="Mapper-602"><a href="#Mapper-602"><span class="linenos"> 602</span></a>                    <span class="n">actiondict</span> <span class="o">=</span> <span class="n">gendict</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">controller</span><span class="p">,</span> <span class="p">{})</span>
</span><span id="Mapper-603"><a href="#Mapper-603"><span class="linenos"> 603</span></a>                    <span class="n">actiondict</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">action</span><span class="p">,</span> <span class="p">([],</span> <span class="p">{}))[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">route</span><span class="p">)</span>
</span><span id="Mapper-604"><a href="#Mapper-604"><span class="linenos"> 604</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_gendict</span> <span class="o">=</span> <span class="n">gendict</span>
</span><span id="Mapper-605"><a href="#Mapper-605"><span class="linenos"> 605</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_created_gens</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="Mapper-606"><a href="#Mapper-606"><span class="linenos"> 606</span></a>
</span><span id="Mapper-607"><a href="#Mapper-607"><span class="linenos"> 607</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">create_regs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="Mapper-608"><a href="#Mapper-608"><span class="linenos"> 608</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Atomically creates regular expressions for all connected</span>
</span><span id="Mapper-609"><a href="#Mapper-609"><span class="linenos"> 609</span></a><span class="sd">        routes</span>
</span><span id="Mapper-610"><a href="#Mapper-610"><span class="linenos"> 610</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Mapper-611"><a href="#Mapper-611"><span class="linenos"> 611</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">create_regs_lock</span><span class="o">.</span><span class="n">acquire</span><span class="p">()</span>
</span><span id="Mapper-612"><a href="#Mapper-612"><span class="linenos"> 612</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="Mapper-613"><a href="#Mapper-613"><span class="linenos"> 613</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_create_regs</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="Mapper-614"><a href="#Mapper-614"><span class="linenos"> 614</span></a>        <span class="k">finally</span><span class="p">:</span>
</span><span id="Mapper-615"><a href="#Mapper-615"><span class="linenos"> 615</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">create_regs_lock</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>
</span><span id="Mapper-616"><a href="#Mapper-616"><span class="linenos"> 616</span></a>
</span><span id="Mapper-617"><a href="#Mapper-617"><span class="linenos"> 617</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_create_regs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">clist</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="Mapper-618"><a href="#Mapper-618"><span class="linenos"> 618</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Creates regular expressions for all connected routes&quot;&quot;&quot;</span>
</span><span id="Mapper-619"><a href="#Mapper-619"><span class="linenos"> 619</span></a>        <span class="k">if</span> <span class="n">clist</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Mapper-620"><a href="#Mapper-620"><span class="linenos"> 620</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">directory</span><span class="p">:</span>
</span><span id="Mapper-621"><a href="#Mapper-621"><span class="linenos"> 621</span></a>                <span class="n">clist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller_scan</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">directory</span><span class="p">)</span>
</span><span id="Mapper-622"><a href="#Mapper-622"><span class="linenos"> 622</span></a>            <span class="k">elif</span> <span class="nb">callable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">controller_scan</span><span class="p">):</span>
</span><span id="Mapper-623"><a href="#Mapper-623"><span class="linenos"> 623</span></a>                <span class="n">clist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller_scan</span><span class="p">()</span>
</span><span id="Mapper-624"><a href="#Mapper-624"><span class="linenos"> 624</span></a>            <span class="k">elif</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller_scan</span><span class="p">:</span>
</span><span id="Mapper-625"><a href="#Mapper-625"><span class="linenos"> 625</span></a>                <span class="n">clist</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Mapper-626"><a href="#Mapper-626"><span class="linenos"> 626</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Mapper-627"><a href="#Mapper-627"><span class="linenos"> 627</span></a>                <span class="n">clist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller_scan</span>
</span><span id="Mapper-628"><a href="#Mapper-628"><span class="linenos"> 628</span></a>
</span><span id="Mapper-629"><a href="#Mapper-629"><span class="linenos"> 629</span></a>        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">six</span><span class="o">.</span><span class="n">iteritems</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">maxkeys</span><span class="p">):</span>
</span><span id="Mapper-630"><a href="#Mapper-630"><span class="linenos"> 630</span></a>            <span class="k">for</span> <span class="n">route</span> <span class="ow">in</span> <span class="n">val</span><span class="p">:</span>
</span><span id="Mapper-631"><a href="#Mapper-631"><span class="linenos"> 631</span></a>                <span class="n">route</span><span class="o">.</span><span class="n">makeregexp</span><span class="p">(</span><span class="n">clist</span><span class="p">)</span>
</span><span id="Mapper-632"><a href="#Mapper-632"><span class="linenos"> 632</span></a>
</span><span id="Mapper-633"><a href="#Mapper-633"><span class="linenos"> 633</span></a>        <span class="n">regexps</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Mapper-634"><a href="#Mapper-634"><span class="linenos"> 634</span></a>        <span class="n">prefix2routes</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
</span><span id="Mapper-635"><a href="#Mapper-635"><span class="linenos"> 635</span></a>        <span class="k">for</span> <span class="n">route</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">matchlist</span><span class="p">:</span>
</span><span id="Mapper-636"><a href="#Mapper-636"><span class="linenos"> 636</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">route</span><span class="o">.</span><span class="n">static</span><span class="p">:</span>
</span><span id="Mapper-637"><a href="#Mapper-637"><span class="linenos"> 637</span></a>                <span class="n">regexps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">route</span><span class="o">.</span><span class="n">makeregexp</span><span class="p">(</span><span class="n">clist</span><span class="p">,</span> <span class="n">include_names</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
</span><span id="Mapper-638"><a href="#Mapper-638"><span class="linenos"> 638</span></a>                <span class="c1"># Group the routes by static prefix</span>
</span><span id="Mapper-639"><a href="#Mapper-639"><span class="linenos"> 639</span></a>                <span class="n">prefix</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">it</span><span class="o">.</span><span class="n">takewhile</span><span class="p">(</span><span class="k">lambda</span> <span class="n">p</span><span class="p">:</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="nb">str</span><span class="p">),</span>
</span><span id="Mapper-640"><a href="#Mapper-640"><span class="linenos"> 640</span></a>                                              <span class="n">route</span><span class="o">.</span><span class="n">routelist</span><span class="p">))</span>
</span><span id="Mapper-641"><a href="#Mapper-641"><span class="linenos"> 641</span></a>                <span class="k">if</span> <span class="n">route</span><span class="o">.</span><span class="n">minimization</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">prefix</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">):</span>
</span><span id="Mapper-642"><a href="#Mapper-642"><span class="linenos"> 642</span></a>                    <span class="n">prefix</span> <span class="o">=</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="n">prefix</span>
</span><span id="Mapper-643"><a href="#Mapper-643"><span class="linenos"> 643</span></a>                <span class="n">prefix2routes</span><span class="p">[</span><span class="n">prefix</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">route</span><span class="p">)</span>
</span><span id="Mapper-644"><a href="#Mapper-644"><span class="linenos"> 644</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_prefix2routes</span> <span class="o">=</span> <span class="n">prefix2routes</span>
</span><span id="Mapper-645"><a href="#Mapper-645"><span class="linenos"> 645</span></a>        <span class="c1"># Keep track of all possible prefix lengths in decreasing order</span>
</span><span id="Mapper-646"><a href="#Mapper-646"><span class="linenos"> 646</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_prefix_lens</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">prefix2routes</span><span class="p">),</span>
</span><span id="Mapper-647"><a href="#Mapper-647"><span class="linenos"> 647</span></a>                                   <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="Mapper-648"><a href="#Mapper-648"><span class="linenos"> 648</span></a>
</span><span id="Mapper-649"><a href="#Mapper-649"><span class="linenos"> 649</span></a>        <span class="c1"># Create our regexp to strip the prefix</span>
</span><span id="Mapper-650"><a href="#Mapper-650"><span class="linenos"> 650</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prefix</span><span class="p">:</span>
</span><span id="Mapper-651"><a href="#Mapper-651"><span class="linenos"> 651</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_regprefix</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prefix</span> <span class="o">+</span> <span class="s1">&#39;(.*)&#39;</span><span class="p">)</span>
</span><span id="Mapper-652"><a href="#Mapper-652"><span class="linenos"> 652</span></a>
</span><span id="Mapper-653"><a href="#Mapper-653"><span class="linenos"> 653</span></a>        <span class="c1"># Save the master regexp</span>
</span><span id="Mapper-654"><a href="#Mapper-654"><span class="linenos"> 654</span></a>        <span class="n">regexp</span> <span class="o">=</span> <span class="s1">&#39;|&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;(?:</span><span class="si">%s</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">regexps</span><span class="p">])</span>
</span><span id="Mapper-655"><a href="#Mapper-655"><span class="linenos"> 655</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_master_reg</span> <span class="o">=</span> <span class="n">regexp</span>
</span><span id="Mapper-656"><a href="#Mapper-656"><span class="linenos"> 656</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="Mapper-657"><a href="#Mapper-657"><span class="linenos"> 657</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_master_regexp</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">regexp</span><span class="p">)</span>
</span><span id="Mapper-658"><a href="#Mapper-658"><span class="linenos"> 658</span></a>        <span class="k">except</span> <span class="ne">OverflowError</span><span class="p">:</span>
</span><span id="Mapper-659"><a href="#Mapper-659"><span class="linenos"> 659</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_master_regexp</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Mapper-660"><a href="#Mapper-660"><span class="linenos"> 660</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_created_regs</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="Mapper-661"><a href="#Mapper-661"><span class="linenos"> 661</span></a>
</span><span id="Mapper-662"><a href="#Mapper-662"><span class="linenos"> 662</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_match</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">environ</span><span class="p">):</span>
</span><span id="Mapper-663"><a href="#Mapper-663"><span class="linenos"> 663</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Internal Route matcher</span>
</span><span id="Mapper-664"><a href="#Mapper-664"><span class="linenos"> 664</span></a>
</span><span id="Mapper-665"><a href="#Mapper-665"><span class="linenos"> 665</span></a><span class="sd">        Matches a URL against a route, and returns a tuple of the match</span>
</span><span id="Mapper-666"><a href="#Mapper-666"><span class="linenos"> 666</span></a><span class="sd">        dict and the route object if a match is successfull, otherwise</span>
</span><span id="Mapper-667"><a href="#Mapper-667"><span class="linenos"> 667</span></a><span class="sd">        it returns empty.</span>
</span><span id="Mapper-668"><a href="#Mapper-668"><span class="linenos"> 668</span></a>
</span><span id="Mapper-669"><a href="#Mapper-669"><span class="linenos"> 669</span></a><span class="sd">        For internal use only.</span>
</span><span id="Mapper-670"><a href="#Mapper-670"><span class="linenos"> 670</span></a>
</span><span id="Mapper-671"><a href="#Mapper-671"><span class="linenos"> 671</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Mapper-672"><a href="#Mapper-672"><span class="linenos"> 672</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_created_regs</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller_scan</span><span class="p">:</span>
</span><span id="Mapper-673"><a href="#Mapper-673"><span class="linenos"> 673</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">create_regs</span><span class="p">()</span>
</span><span id="Mapper-674"><a href="#Mapper-674"><span class="linenos"> 674</span></a>        <span class="k">elif</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_created_regs</span><span class="p">:</span>
</span><span id="Mapper-675"><a href="#Mapper-675"><span class="linenos"> 675</span></a>            <span class="k">raise</span> <span class="n">RoutesException</span><span class="p">(</span><span class="s2">&quot;You must generate the regular expressions&quot;</span>
</span><span id="Mapper-676"><a href="#Mapper-676"><span class="linenos"> 676</span></a>                                  <span class="s2">&quot; before matching.&quot;</span><span class="p">)</span>
</span><span id="Mapper-677"><a href="#Mapper-677"><span class="linenos"> 677</span></a>
</span><span id="Mapper-678"><a href="#Mapper-678"><span class="linenos"> 678</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">always_scan</span><span class="p">:</span>
</span><span id="Mapper-679"><a href="#Mapper-679"><span class="linenos"> 679</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">create_regs</span><span class="p">()</span>
</span><span id="Mapper-680"><a href="#Mapper-680"><span class="linenos"> 680</span></a>
</span><span id="Mapper-681"><a href="#Mapper-681"><span class="linenos"> 681</span></a>        <span class="n">matchlog</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Mapper-682"><a href="#Mapper-682"><span class="linenos"> 682</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prefix</span><span class="p">:</span>
</span><span id="Mapper-683"><a href="#Mapper-683"><span class="linenos"> 683</span></a>            <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_regprefix</span><span class="p">,</span> <span class="n">url</span><span class="p">):</span>
</span><span id="Mapper-684"><a href="#Mapper-684"><span class="linenos"> 684</span></a>                <span class="n">url</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_regprefix</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;\1&#39;</span><span class="p">,</span> <span class="n">url</span><span class="p">)</span>
</span><span id="Mapper-685"><a href="#Mapper-685"><span class="linenos"> 685</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">url</span><span class="p">:</span>
</span><span id="Mapper-686"><a href="#Mapper-686"><span class="linenos"> 686</span></a>                    <span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;/&#39;</span>
</span><span id="Mapper-687"><a href="#Mapper-687"><span class="linenos"> 687</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Mapper-688"><a href="#Mapper-688"><span class="linenos"> 688</span></a>                <span class="k">return</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">matchlog</span><span class="p">)</span>
</span><span id="Mapper-689"><a href="#Mapper-689"><span class="linenos"> 689</span></a>
</span><span id="Mapper-690"><a href="#Mapper-690"><span class="linenos"> 690</span></a>        <span class="n">environ</span> <span class="o">=</span> <span class="n">environ</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">environ</span>
</span><span id="Mapper-691"><a href="#Mapper-691"><span class="linenos"> 691</span></a>        <span class="n">sub_domains</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sub_domains</span>
</span><span id="Mapper-692"><a href="#Mapper-692"><span class="linenos"> 692</span></a>        <span class="n">sub_domains_ignore</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sub_domains_ignore</span>
</span><span id="Mapper-693"><a href="#Mapper-693"><span class="linenos"> 693</span></a>        <span class="n">domain_match</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">domain_match</span>
</span><span id="Mapper-694"><a href="#Mapper-694"><span class="linenos"> 694</span></a>        <span class="n">debug</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span>
</span><span id="Mapper-695"><a href="#Mapper-695"><span class="linenos"> 695</span></a>
</span><span id="Mapper-696"><a href="#Mapper-696"><span class="linenos"> 696</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_master_regexp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Mapper-697"><a href="#Mapper-697"><span class="linenos"> 697</span></a>            <span class="c1"># Check to see if its a valid url against the main regexp</span>
</span><span id="Mapper-698"><a href="#Mapper-698"><span class="linenos"> 698</span></a>            <span class="c1"># Done for faster invalid URL elimination</span>
</span><span id="Mapper-699"><a href="#Mapper-699"><span class="linenos"> 699</span></a>            <span class="n">valid_url</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_master_regexp</span><span class="p">,</span> <span class="n">url</span><span class="p">)</span>
</span><span id="Mapper-700"><a href="#Mapper-700"><span class="linenos"> 700</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Mapper-701"><a href="#Mapper-701"><span class="linenos"> 701</span></a>            <span class="c1"># Regex is None due to OverflowError caused by too many routes.</span>
</span><span id="Mapper-702"><a href="#Mapper-702"><span class="linenos"> 702</span></a>            <span class="c1"># This will allow larger projects to work but might increase time</span>
</span><span id="Mapper-703"><a href="#Mapper-703"><span class="linenos"> 703</span></a>            <span class="c1"># spent invalidating URLs in the loop below.</span>
</span><span id="Mapper-704"><a href="#Mapper-704"><span class="linenos"> 704</span></a>            <span class="n">valid_url</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="Mapper-705"><a href="#Mapper-705"><span class="linenos"> 705</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">valid_url</span><span class="p">:</span>
</span><span id="Mapper-706"><a href="#Mapper-706"><span class="linenos"> 706</span></a>            <span class="k">return</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">matchlog</span><span class="p">)</span>
</span><span id="Mapper-707"><a href="#Mapper-707"><span class="linenos"> 707</span></a>
</span><span id="Mapper-708"><a href="#Mapper-708"><span class="linenos"> 708</span></a>        <span class="n">matchlist</span> <span class="o">=</span> <span class="n">it</span><span class="o">.</span><span class="n">chain</span><span class="o">.</span><span class="n">from_iterable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_prefix2routes</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">[:</span><span class="n">prefix_len</span><span class="p">],</span> <span class="p">())</span>
</span><span id="Mapper-709"><a href="#Mapper-709"><span class="linenos"> 709</span></a>                                           <span class="k">for</span> <span class="n">prefix_len</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prefix_lens</span><span class="p">)</span>
</span><span id="Mapper-710"><a href="#Mapper-710"><span class="linenos"> 710</span></a>        <span class="k">for</span> <span class="n">route</span> <span class="ow">in</span> <span class="n">matchlist</span><span class="p">:</span>
</span><span id="Mapper-711"><a href="#Mapper-711"><span class="linenos"> 711</span></a>            <span class="k">if</span> <span class="n">route</span><span class="o">.</span><span class="n">static</span><span class="p">:</span>
</span><span id="Mapper-712"><a href="#Mapper-712"><span class="linenos"> 712</span></a>                <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="Mapper-713"><a href="#Mapper-713"><span class="linenos"> 713</span></a>                    <span class="n">matchlog</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">route</span><span class="o">=</span><span class="n">route</span><span class="p">,</span> <span class="n">static</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
</span><span id="Mapper-714"><a href="#Mapper-714"><span class="linenos"> 714</span></a>                <span class="k">continue</span>
</span><span id="Mapper-715"><a href="#Mapper-715"><span class="linenos"> 715</span></a>            <span class="n">match</span> <span class="o">=</span> <span class="n">route</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">environ</span><span class="p">,</span> <span class="n">sub_domains</span><span class="p">,</span> <span class="n">sub_domains_ignore</span><span class="p">,</span>
</span><span id="Mapper-716"><a href="#Mapper-716"><span class="linenos"> 716</span></a>                                <span class="n">domain_match</span><span class="p">)</span>
</span><span id="Mapper-717"><a href="#Mapper-717"><span class="linenos"> 717</span></a>            <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="Mapper-718"><a href="#Mapper-718"><span class="linenos"> 718</span></a>                <span class="n">matchlog</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">route</span><span class="o">=</span><span class="n">route</span><span class="p">,</span> <span class="n">regexp</span><span class="o">=</span><span class="nb">bool</span><span class="p">(</span><span class="n">match</span><span class="p">)))</span>
</span><span id="Mapper-719"><a href="#Mapper-719"><span class="linenos"> 719</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">match</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">or</span> <span class="n">match</span><span class="p">:</span>
</span><span id="Mapper-720"><a href="#Mapper-720"><span class="linenos"> 720</span></a>                <span class="k">return</span> <span class="p">(</span><span class="n">match</span><span class="p">,</span> <span class="n">route</span><span class="p">,</span> <span class="n">matchlog</span><span class="p">)</span>
</span><span id="Mapper-721"><a href="#Mapper-721"><span class="linenos"> 721</span></a>        <span class="k">return</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">matchlog</span><span class="p">)</span>
</span><span id="Mapper-722"><a href="#Mapper-722"><span class="linenos"> 722</span></a>
</span><span id="Mapper-723"><a href="#Mapper-723"><span class="linenos"> 723</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">match</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">environ</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="Mapper-724"><a href="#Mapper-724"><span class="linenos"> 724</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Match a URL against against one of the routes contained.</span>
</span><span id="Mapper-725"><a href="#Mapper-725"><span class="linenos"> 725</span></a>
</span><span id="Mapper-726"><a href="#Mapper-726"><span class="linenos"> 726</span></a><span class="sd">        Will return None if no valid match is found.</span>
</span><span id="Mapper-727"><a href="#Mapper-727"><span class="linenos"> 727</span></a>
</span><span id="Mapper-728"><a href="#Mapper-728"><span class="linenos"> 728</span></a><span class="sd">        .. code-block:: python</span>
</span><span id="Mapper-729"><a href="#Mapper-729"><span class="linenos"> 729</span></a>
</span><span id="Mapper-730"><a href="#Mapper-730"><span class="linenos"> 730</span></a><span class="sd">            resultdict = m.match(&#39;/joe/sixpack&#39;)</span>
</span><span id="Mapper-731"><a href="#Mapper-731"><span class="linenos"> 731</span></a>
</span><span id="Mapper-732"><a href="#Mapper-732"><span class="linenos"> 732</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Mapper-733"><a href="#Mapper-733"><span class="linenos"> 733</span></a>        <span class="k">if</span> <span class="n">url</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">environ</span><span class="p">:</span>
</span><span id="Mapper-734"><a href="#Mapper-734"><span class="linenos"> 734</span></a>            <span class="k">raise</span> <span class="n">RoutesException</span><span class="p">(</span><span class="s1">&#39;URL or environ must be provided&#39;</span><span class="p">)</span>
</span><span id="Mapper-735"><a href="#Mapper-735"><span class="linenos"> 735</span></a>
</span><span id="Mapper-736"><a href="#Mapper-736"><span class="linenos"> 736</span></a>        <span class="k">if</span> <span class="n">url</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Mapper-737"><a href="#Mapper-737"><span class="linenos"> 737</span></a>            <span class="n">url</span> <span class="o">=</span> <span class="n">environ</span><span class="p">[</span><span class="s1">&#39;PATH_INFO&#39;</span><span class="p">]</span>
</span><span id="Mapper-738"><a href="#Mapper-738"><span class="linenos"> 738</span></a>
</span><span id="Mapper-739"><a href="#Mapper-739"><span class="linenos"> 739</span></a>        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_match</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">environ</span><span class="p">)</span>
</span><span id="Mapper-740"><a href="#Mapper-740"><span class="linenos"> 740</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
</span><span id="Mapper-741"><a href="#Mapper-741"><span class="linenos"> 741</span></a>            <span class="k">return</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">result</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">result</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
</span><span id="Mapper-742"><a href="#Mapper-742"><span class="linenos"> 742</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">or</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
</span><span id="Mapper-743"><a href="#Mapper-743"><span class="linenos"> 743</span></a>            <span class="k">return</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Mapper-744"><a href="#Mapper-744"><span class="linenos"> 744</span></a>        <span class="k">return</span> <span class="kc">None</span>
</span><span id="Mapper-745"><a href="#Mapper-745"><span class="linenos"> 745</span></a>
</span><span id="Mapper-746"><a href="#Mapper-746"><span class="linenos"> 746</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">routematch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">environ</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="Mapper-747"><a href="#Mapper-747"><span class="linenos"> 747</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Match a URL against against one of the routes contained.</span>
</span><span id="Mapper-748"><a href="#Mapper-748"><span class="linenos"> 748</span></a>
</span><span id="Mapper-749"><a href="#Mapper-749"><span class="linenos"> 749</span></a><span class="sd">        Will return None if no valid match is found, otherwise a</span>
</span><span id="Mapper-750"><a href="#Mapper-750"><span class="linenos"> 750</span></a><span class="sd">        result dict and a route object is returned.</span>
</span><span id="Mapper-751"><a href="#Mapper-751"><span class="linenos"> 751</span></a>
</span><span id="Mapper-752"><a href="#Mapper-752"><span class="linenos"> 752</span></a><span class="sd">        .. code-block:: python</span>
</span><span id="Mapper-753"><a href="#Mapper-753"><span class="linenos"> 753</span></a>
</span><span id="Mapper-754"><a href="#Mapper-754"><span class="linenos"> 754</span></a><span class="sd">            resultdict, route_obj = m.match(&#39;/joe/sixpack&#39;)</span>
</span><span id="Mapper-755"><a href="#Mapper-755"><span class="linenos"> 755</span></a>
</span><span id="Mapper-756"><a href="#Mapper-756"><span class="linenos"> 756</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Mapper-757"><a href="#Mapper-757"><span class="linenos"> 757</span></a>        <span class="k">if</span> <span class="n">url</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">environ</span><span class="p">:</span>
</span><span id="Mapper-758"><a href="#Mapper-758"><span class="linenos"> 758</span></a>            <span class="k">raise</span> <span class="n">RoutesException</span><span class="p">(</span><span class="s1">&#39;URL or environ must be provided&#39;</span><span class="p">)</span>
</span><span id="Mapper-759"><a href="#Mapper-759"><span class="linenos"> 759</span></a>
</span><span id="Mapper-760"><a href="#Mapper-760"><span class="linenos"> 760</span></a>        <span class="k">if</span> <span class="n">url</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Mapper-761"><a href="#Mapper-761"><span class="linenos"> 761</span></a>            <span class="n">url</span> <span class="o">=</span> <span class="n">environ</span><span class="p">[</span><span class="s1">&#39;PATH_INFO&#39;</span><span class="p">]</span>
</span><span id="Mapper-762"><a href="#Mapper-762"><span class="linenos"> 762</span></a>        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_match</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">environ</span><span class="p">)</span>
</span><span id="Mapper-763"><a href="#Mapper-763"><span class="linenos"> 763</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
</span><span id="Mapper-764"><a href="#Mapper-764"><span class="linenos"> 764</span></a>            <span class="k">return</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">result</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">result</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
</span><span id="Mapper-765"><a href="#Mapper-765"><span class="linenos"> 765</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">or</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
</span><span id="Mapper-766"><a href="#Mapper-766"><span class="linenos"> 766</span></a>            <span class="k">return</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">result</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="Mapper-767"><a href="#Mapper-767"><span class="linenos"> 767</span></a>        <span class="k">return</span> <span class="kc">None</span>
</span><span id="Mapper-768"><a href="#Mapper-768"><span class="linenos"> 768</span></a>
</span><span id="Mapper-769"><a href="#Mapper-769"><span class="linenos"> 769</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">generate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">):</span>
</span><span id="Mapper-770"><a href="#Mapper-770"><span class="linenos"> 770</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate a route from a set of keywords</span>
</span><span id="Mapper-771"><a href="#Mapper-771"><span class="linenos"> 771</span></a>
</span><span id="Mapper-772"><a href="#Mapper-772"><span class="linenos"> 772</span></a><span class="sd">        Returns the url text, or None if no URL could be generated.</span>
</span><span id="Mapper-773"><a href="#Mapper-773"><span class="linenos"> 773</span></a>
</span><span id="Mapper-774"><a href="#Mapper-774"><span class="linenos"> 774</span></a><span class="sd">        .. code-block:: python</span>
</span><span id="Mapper-775"><a href="#Mapper-775"><span class="linenos"> 775</span></a>
</span><span id="Mapper-776"><a href="#Mapper-776"><span class="linenos"> 776</span></a><span class="sd">            m.generate(controller=&#39;content&#39;,action=&#39;view&#39;,id=10)</span>
</span><span id="Mapper-777"><a href="#Mapper-777"><span class="linenos"> 777</span></a>
</span><span id="Mapper-778"><a href="#Mapper-778"><span class="linenos"> 778</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Mapper-779"><a href="#Mapper-779"><span class="linenos"> 779</span></a>        <span class="c1"># Generate ourself if we haven&#39;t already</span>
</span><span id="Mapper-780"><a href="#Mapper-780"><span class="linenos"> 780</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_created_gens</span><span class="p">:</span>
</span><span id="Mapper-781"><a href="#Mapper-781"><span class="linenos"> 781</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_create_gens</span><span class="p">()</span>
</span><span id="Mapper-782"><a href="#Mapper-782"><span class="linenos"> 782</span></a>
</span><span id="Mapper-783"><a href="#Mapper-783"><span class="linenos"> 783</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">append_slash</span><span class="p">:</span>
</span><span id="Mapper-784"><a href="#Mapper-784"><span class="linenos"> 784</span></a>            <span class="n">kargs</span><span class="p">[</span><span class="s1">&#39;_append_slash&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="Mapper-785"><a href="#Mapper-785"><span class="linenos"> 785</span></a>
</span><span id="Mapper-786"><a href="#Mapper-786"><span class="linenos"> 786</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">explicit</span><span class="p">:</span>
</span><span id="Mapper-787"><a href="#Mapper-787"><span class="linenos"> 787</span></a>            <span class="k">if</span> <span class="s1">&#39;controller&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kargs</span><span class="p">:</span>
</span><span id="Mapper-788"><a href="#Mapper-788"><span class="linenos"> 788</span></a>                <span class="n">kargs</span><span class="p">[</span><span class="s1">&#39;controller&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;content&#39;</span>
</span><span id="Mapper-789"><a href="#Mapper-789"><span class="linenos"> 789</span></a>            <span class="k">if</span> <span class="s1">&#39;action&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kargs</span><span class="p">:</span>
</span><span id="Mapper-790"><a href="#Mapper-790"><span class="linenos"> 790</span></a>                <span class="n">kargs</span><span class="p">[</span><span class="s1">&#39;action&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;index&#39;</span>
</span><span id="Mapper-791"><a href="#Mapper-791"><span class="linenos"> 791</span></a>
</span><span id="Mapper-792"><a href="#Mapper-792"><span class="linenos"> 792</span></a>        <span class="n">environ</span> <span class="o">=</span> <span class="n">kargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;_environ&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">environ</span><span class="p">)</span> <span class="ow">or</span> <span class="p">{}</span>
</span><span id="Mapper-793"><a href="#Mapper-793"><span class="linenos"> 793</span></a>        <span class="k">if</span> <span class="s1">&#39;SCRIPT_NAME&#39;</span> <span class="ow">in</span> <span class="n">environ</span><span class="p">:</span>
</span><span id="Mapper-794"><a href="#Mapper-794"><span class="linenos"> 794</span></a>            <span class="n">script_name</span> <span class="o">=</span> <span class="n">environ</span><span class="p">[</span><span class="s1">&#39;SCRIPT_NAME&#39;</span><span class="p">]</span>
</span><span id="Mapper-795"><a href="#Mapper-795"><span class="linenos"> 795</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">environ</span> <span class="ow">and</span> <span class="s1">&#39;SCRIPT_NAME&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">environ</span><span class="p">:</span>
</span><span id="Mapper-796"><a href="#Mapper-796"><span class="linenos"> 796</span></a>            <span class="n">script_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;SCRIPT_NAME&#39;</span><span class="p">]</span>
</span><span id="Mapper-797"><a href="#Mapper-797"><span class="linenos"> 797</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Mapper-798"><a href="#Mapper-798"><span class="linenos"> 798</span></a>            <span class="n">script_name</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="Mapper-799"><a href="#Mapper-799"><span class="linenos"> 799</span></a>        <span class="n">controller</span> <span class="o">=</span> <span class="n">kargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;controller&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="Mapper-800"><a href="#Mapper-800"><span class="linenos"> 800</span></a>        <span class="n">action</span> <span class="o">=</span> <span class="n">kargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;action&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="Mapper-801"><a href="#Mapper-801"><span class="linenos"> 801</span></a>
</span><span id="Mapper-802"><a href="#Mapper-802"><span class="linenos"> 802</span></a>        <span class="c1"># If the URL didn&#39;t depend on the SCRIPT_NAME, we&#39;ll cache it</span>
</span><span id="Mapper-803"><a href="#Mapper-803"><span class="linenos"> 803</span></a>        <span class="c1"># keyed by just by kargs; otherwise we need to cache it with</span>
</span><span id="Mapper-804"><a href="#Mapper-804"><span class="linenos"> 804</span></a>        <span class="c1"># both SCRIPT_NAME and kargs:</span>
</span><span id="Mapper-805"><a href="#Mapper-805"><span class="linenos"> 805</span></a>        <span class="n">cache_key</span> <span class="o">=</span> <span class="n">six</span><span class="o">.</span><span class="n">text_type</span><span class="p">(</span><span class="n">args</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf8&#39;</span><span class="p">)</span> <span class="o">+</span> \
</span><span id="Mapper-806"><a href="#Mapper-806"><span class="linenos"> 806</span></a>            <span class="n">six</span><span class="o">.</span><span class="n">text_type</span><span class="p">(</span><span class="n">kargs</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf8&#39;</span><span class="p">)</span>
</span><span id="Mapper-807"><a href="#Mapper-807"><span class="linenos"> 807</span></a>
</span><span id="Mapper-808"><a href="#Mapper-808"><span class="linenos"> 808</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">urlcache</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Mapper-809"><a href="#Mapper-809"><span class="linenos"> 809</span></a>            <span class="k">if</span> <span class="n">six</span><span class="o">.</span><span class="n">PY3</span><span class="p">:</span>
</span><span id="Mapper-810"><a href="#Mapper-810"><span class="linenos"> 810</span></a>                <span class="n">cache_key_script_name</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;:&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">((</span><span class="n">script_name</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">),</span>
</span><span id="Mapper-811"><a href="#Mapper-811"><span class="linenos"> 811</span></a>                                                   <span class="n">cache_key</span><span class="p">))</span>
</span><span id="Mapper-812"><a href="#Mapper-812"><span class="linenos"> 812</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Mapper-813"><a href="#Mapper-813"><span class="linenos"> 813</span></a>                <span class="n">cache_key_script_name</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">:</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">script_name</span><span class="p">,</span> <span class="n">cache_key</span><span class="p">)</span>
</span><span id="Mapper-814"><a href="#Mapper-814"><span class="linenos"> 814</span></a>
</span><span id="Mapper-815"><a href="#Mapper-815"><span class="linenos"> 815</span></a>            <span class="c1"># Check the url cache to see if it exists, use it if it does</span>
</span><span id="Mapper-816"><a href="#Mapper-816"><span class="linenos"> 816</span></a>            <span class="n">val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">urlcache</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">cache_key_script_name</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
</span><span id="Mapper-817"><a href="#Mapper-817"><span class="linenos"> 817</span></a>            <span class="k">if</span> <span class="n">val</span> <span class="o">!=</span> <span class="bp">self</span><span class="p">:</span>
</span><span id="Mapper-818"><a href="#Mapper-818"><span class="linenos"> 818</span></a>                <span class="k">return</span> <span class="n">val</span>
</span><span id="Mapper-819"><a href="#Mapper-819"><span class="linenos"> 819</span></a>
</span><span id="Mapper-820"><a href="#Mapper-820"><span class="linenos"> 820</span></a>        <span class="n">controller</span> <span class="o">=</span> <span class="n">as_unicode</span><span class="p">(</span><span class="n">controller</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">encoding</span><span class="p">)</span>
</span><span id="Mapper-821"><a href="#Mapper-821"><span class="linenos"> 821</span></a>        <span class="n">action</span> <span class="o">=</span> <span class="n">as_unicode</span><span class="p">(</span><span class="n">action</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">encoding</span><span class="p">)</span>
</span><span id="Mapper-822"><a href="#Mapper-822"><span class="linenos"> 822</span></a>
</span><span id="Mapper-823"><a href="#Mapper-823"><span class="linenos"> 823</span></a>        <span class="n">actionlist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_gendict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">controller</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_gendict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="p">{})</span>
</span><span id="Mapper-824"><a href="#Mapper-824"><span class="linenos"> 824</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">actionlist</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">args</span><span class="p">:</span>
</span><span id="Mapper-825"><a href="#Mapper-825"><span class="linenos"> 825</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="Mapper-826"><a href="#Mapper-826"><span class="linenos"> 826</span></a>        <span class="p">(</span><span class="n">keylist</span><span class="p">,</span> <span class="n">sortcache</span><span class="p">)</span> <span class="o">=</span> <span class="n">actionlist</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">action</span><span class="p">)</span> <span class="ow">or</span> \
</span><span id="Mapper-827"><a href="#Mapper-827"><span class="linenos"> 827</span></a>            <span class="n">actionlist</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="p">{}))</span>
</span><span id="Mapper-828"><a href="#Mapper-828"><span class="linenos"> 828</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">keylist</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">args</span><span class="p">:</span>
</span><span id="Mapper-829"><a href="#Mapper-829"><span class="linenos"> 829</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="Mapper-830"><a href="#Mapper-830"><span class="linenos"> 830</span></a>
</span><span id="Mapper-831"><a href="#Mapper-831"><span class="linenos"> 831</span></a>        <span class="n">keys</span> <span class="o">=</span> <span class="nb">frozenset</span><span class="p">(</span><span class="n">kargs</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</span><span id="Mapper-832"><a href="#Mapper-832"><span class="linenos"> 832</span></a>        <span class="n">cacheset</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="Mapper-833"><a href="#Mapper-833"><span class="linenos"> 833</span></a>        <span class="n">cachekey</span> <span class="o">=</span> <span class="n">six</span><span class="o">.</span><span class="n">text_type</span><span class="p">(</span><span class="n">keys</span><span class="p">)</span>
</span><span id="Mapper-834"><a href="#Mapper-834"><span class="linenos"> 834</span></a>        <span class="n">cachelist</span> <span class="o">=</span> <span class="n">sortcache</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">cachekey</span><span class="p">)</span>
</span><span id="Mapper-835"><a href="#Mapper-835"><span class="linenos"> 835</span></a>        <span class="k">if</span> <span class="n">args</span><span class="p">:</span>
</span><span id="Mapper-836"><a href="#Mapper-836"><span class="linenos"> 836</span></a>            <span class="n">keylist</span> <span class="o">=</span> <span class="n">args</span>
</span><span id="Mapper-837"><a href="#Mapper-837"><span class="linenos"> 837</span></a>        <span class="k">elif</span> <span class="n">cachelist</span><span class="p">:</span>
</span><span id="Mapper-838"><a href="#Mapper-838"><span class="linenos"> 838</span></a>            <span class="n">keylist</span> <span class="o">=</span> <span class="n">cachelist</span>
</span><span id="Mapper-839"><a href="#Mapper-839"><span class="linenos"> 839</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Mapper-840"><a href="#Mapper-840"><span class="linenos"> 840</span></a>            <span class="n">cacheset</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="Mapper-841"><a href="#Mapper-841"><span class="linenos"> 841</span></a>            <span class="n">newlist</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Mapper-842"><a href="#Mapper-842"><span class="linenos"> 842</span></a>            <span class="k">for</span> <span class="n">route</span> <span class="ow">in</span> <span class="n">keylist</span><span class="p">:</span>
</span><span id="Mapper-843"><a href="#Mapper-843"><span class="linenos"> 843</span></a>                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">route</span><span class="o">.</span><span class="n">minkeys</span> <span class="o">-</span> <span class="n">route</span><span class="o">.</span><span class="n">dotkeys</span> <span class="o">-</span> <span class="n">keys</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Mapper-844"><a href="#Mapper-844"><span class="linenos"> 844</span></a>                    <span class="n">newlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">route</span><span class="p">)</span>
</span><span id="Mapper-845"><a href="#Mapper-845"><span class="linenos"> 845</span></a>            <span class="n">keylist</span> <span class="o">=</span> <span class="n">newlist</span>
</span><span id="Mapper-846"><a href="#Mapper-846"><span class="linenos"> 846</span></a>
</span><span id="Mapper-847"><a href="#Mapper-847"><span class="linenos"> 847</span></a>            <span class="k">class</span><span class="w"> </span><span class="nc">KeySorter</span><span class="p">:</span>
</span><span id="Mapper-848"><a href="#Mapper-848"><span class="linenos"> 848</span></a>
</span><span id="Mapper-849"><a href="#Mapper-849"><span class="linenos"> 849</span></a>                <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
</span><span id="Mapper-850"><a href="#Mapper-850"><span class="linenos"> 850</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">obj</span> <span class="o">=</span> <span class="n">obj</span>
</span><span id="Mapper-851"><a href="#Mapper-851"><span class="linenos"> 851</span></a>
</span><span id="Mapper-852"><a href="#Mapper-852"><span class="linenos"> 852</span></a>                <span class="k">def</span><span class="w"> </span><span class="fm">__lt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
</span><span id="Mapper-853"><a href="#Mapper-853"><span class="linenos"> 853</span></a>                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_keysort</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">obj</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">obj</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span>
</span><span id="Mapper-854"><a href="#Mapper-854"><span class="linenos"> 854</span></a>
</span><span id="Mapper-855"><a href="#Mapper-855"><span class="linenos"> 855</span></a>                <span class="k">def</span><span class="w"> </span><span class="nf">_keysort</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
</span><span id="Mapper-856"><a href="#Mapper-856"><span class="linenos"> 856</span></a><span class="w">                    </span><span class="sd">&quot;&quot;&quot;Sorts two sets of sets, to order them ideally for</span>
</span><span id="Mapper-857"><a href="#Mapper-857"><span class="linenos"> 857</span></a><span class="sd">                    matching.&quot;&quot;&quot;</span>
</span><span id="Mapper-858"><a href="#Mapper-858"><span class="linenos"> 858</span></a>                    <span class="n">a</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">maxkeys</span>
</span><span id="Mapper-859"><a href="#Mapper-859"><span class="linenos"> 859</span></a>                    <span class="n">b</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">maxkeys</span>
</span><span id="Mapper-860"><a href="#Mapper-860"><span class="linenos"> 860</span></a>
</span><span id="Mapper-861"><a href="#Mapper-861"><span class="linenos"> 861</span></a>                    <span class="n">lendiffa</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">keys</span> <span class="o">^</span> <span class="n">a</span><span class="p">)</span>
</span><span id="Mapper-862"><a href="#Mapper-862"><span class="linenos"> 862</span></a>                    <span class="n">lendiffb</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">keys</span> <span class="o">^</span> <span class="n">b</span><span class="p">)</span>
</span><span id="Mapper-863"><a href="#Mapper-863"><span class="linenos"> 863</span></a>                    <span class="c1"># If they both match, don&#39;t switch them</span>
</span><span id="Mapper-864"><a href="#Mapper-864"><span class="linenos"> 864</span></a>                    <span class="k">if</span> <span class="n">lendiffa</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">lendiffb</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Mapper-865"><a href="#Mapper-865"><span class="linenos"> 865</span></a>                        <span class="k">return</span> <span class="mi">0</span>
</span><span id="Mapper-866"><a href="#Mapper-866"><span class="linenos"> 866</span></a>
</span><span id="Mapper-867"><a href="#Mapper-867"><span class="linenos"> 867</span></a>                    <span class="c1"># First, if a matches exactly, use it</span>
</span><span id="Mapper-868"><a href="#Mapper-868"><span class="linenos"> 868</span></a>                    <span class="k">if</span> <span class="n">lendiffa</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Mapper-869"><a href="#Mapper-869"><span class="linenos"> 869</span></a>                        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>
</span><span id="Mapper-870"><a href="#Mapper-870"><span class="linenos"> 870</span></a>
</span><span id="Mapper-871"><a href="#Mapper-871"><span class="linenos"> 871</span></a>                    <span class="c1"># Or b matches exactly, use it</span>
</span><span id="Mapper-872"><a href="#Mapper-872"><span class="linenos"> 872</span></a>                    <span class="k">if</span> <span class="n">lendiffb</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Mapper-873"><a href="#Mapper-873"><span class="linenos"> 873</span></a>                        <span class="k">return</span> <span class="mi">1</span>
</span><span id="Mapper-874"><a href="#Mapper-874"><span class="linenos"> 874</span></a>
</span><span id="Mapper-875"><a href="#Mapper-875"><span class="linenos"> 875</span></a>                    <span class="c1"># Neither matches exactly, return the one with the most in</span>
</span><span id="Mapper-876"><a href="#Mapper-876"><span class="linenos"> 876</span></a>                    <span class="c1"># common</span>
</span><span id="Mapper-877"><a href="#Mapper-877"><span class="linenos"> 877</span></a>                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compare</span><span class="p">(</span><span class="n">lendiffa</span><span class="p">,</span> <span class="n">lendiffb</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Mapper-878"><a href="#Mapper-878"><span class="linenos"> 878</span></a>                        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compare</span><span class="p">(</span><span class="n">lendiffa</span><span class="p">,</span> <span class="n">lendiffb</span><span class="p">)</span>
</span><span id="Mapper-879"><a href="#Mapper-879"><span class="linenos"> 879</span></a>
</span><span id="Mapper-880"><a href="#Mapper-880"><span class="linenos"> 880</span></a>                    <span class="c1"># Neither matches exactly, but if they both have just as</span>
</span><span id="Mapper-881"><a href="#Mapper-881"><span class="linenos"> 881</span></a>                    <span class="c1"># much in common</span>
</span><span id="Mapper-882"><a href="#Mapper-882"><span class="linenos"> 882</span></a>                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">keys</span> <span class="o">&amp;</span> <span class="n">b</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">keys</span> <span class="o">&amp;</span> <span class="n">a</span><span class="p">):</span>
</span><span id="Mapper-883"><a href="#Mapper-883"><span class="linenos"> 883</span></a>                        <span class="c1"># Then we return the shortest of the two</span>
</span><span id="Mapper-884"><a href="#Mapper-884"><span class="linenos"> 884</span></a>                        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compare</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">b</span><span class="p">))</span>
</span><span id="Mapper-885"><a href="#Mapper-885"><span class="linenos"> 885</span></a>
</span><span id="Mapper-886"><a href="#Mapper-886"><span class="linenos"> 886</span></a>                    <span class="c1"># Otherwise, we return the one that has the most in common</span>
</span><span id="Mapper-887"><a href="#Mapper-887"><span class="linenos"> 887</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="Mapper-888"><a href="#Mapper-888"><span class="linenos"> 888</span></a>                        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compare</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">keys</span> <span class="o">&amp;</span> <span class="n">b</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">keys</span> <span class="o">&amp;</span> <span class="n">a</span><span class="p">))</span>
</span><span id="Mapper-889"><a href="#Mapper-889"><span class="linenos"> 889</span></a>
</span><span id="Mapper-890"><a href="#Mapper-890"><span class="linenos"> 890</span></a>                <span class="k">def</span><span class="w"> </span><span class="nf">_compare</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj1</span><span class="p">,</span> <span class="n">obj2</span><span class="p">):</span>
</span><span id="Mapper-891"><a href="#Mapper-891"><span class="linenos"> 891</span></a>                    <span class="k">if</span> <span class="n">obj1</span> <span class="o">&lt;</span> <span class="n">obj2</span><span class="p">:</span>
</span><span id="Mapper-892"><a href="#Mapper-892"><span class="linenos"> 892</span></a>                        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>
</span><span id="Mapper-893"><a href="#Mapper-893"><span class="linenos"> 893</span></a>                    <span class="k">elif</span> <span class="n">obj1</span> <span class="o">&lt;</span> <span class="n">obj2</span><span class="p">:</span>
</span><span id="Mapper-894"><a href="#Mapper-894"><span class="linenos"> 894</span></a>                        <span class="k">return</span> <span class="mi">1</span>
</span><span id="Mapper-895"><a href="#Mapper-895"><span class="linenos"> 895</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="Mapper-896"><a href="#Mapper-896"><span class="linenos"> 896</span></a>                        <span class="k">return</span> <span class="mi">0</span>
</span><span id="Mapper-897"><a href="#Mapper-897"><span class="linenos"> 897</span></a>
</span><span id="Mapper-898"><a href="#Mapper-898"><span class="linenos"> 898</span></a>            <span class="n">keylist</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="n">KeySorter</span><span class="p">)</span>
</span><span id="Mapper-899"><a href="#Mapper-899"><span class="linenos"> 899</span></a>            <span class="k">if</span> <span class="n">cacheset</span><span class="p">:</span>
</span><span id="Mapper-900"><a href="#Mapper-900"><span class="linenos"> 900</span></a>                <span class="n">sortcache</span><span class="p">[</span><span class="n">cachekey</span><span class="p">]</span> <span class="o">=</span> <span class="n">keylist</span>
</span><span id="Mapper-901"><a href="#Mapper-901"><span class="linenos"> 901</span></a>
</span><span id="Mapper-902"><a href="#Mapper-902"><span class="linenos"> 902</span></a>        <span class="c1"># Iterate through the keylist of sorted routes (or a single route if</span>
</span><span id="Mapper-903"><a href="#Mapper-903"><span class="linenos"> 903</span></a>        <span class="c1"># it was passed in explicitly for hardcoded named routes)</span>
</span><span id="Mapper-904"><a href="#Mapper-904"><span class="linenos"> 904</span></a>        <span class="k">for</span> <span class="n">route</span> <span class="ow">in</span> <span class="n">keylist</span><span class="p">:</span>
</span><span id="Mapper-905"><a href="#Mapper-905"><span class="linenos"> 905</span></a>            <span class="n">fail</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="Mapper-906"><a href="#Mapper-906"><span class="linenos"> 906</span></a>            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">route</span><span class="o">.</span><span class="n">hardcoded</span><span class="p">:</span>
</span><span id="Mapper-907"><a href="#Mapper-907"><span class="linenos"> 907</span></a>                <span class="n">kval</span> <span class="o">=</span> <span class="n">kargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
</span><span id="Mapper-908"><a href="#Mapper-908"><span class="linenos"> 908</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">kval</span><span class="p">:</span>
</span><span id="Mapper-909"><a href="#Mapper-909"><span class="linenos"> 909</span></a>                    <span class="k">continue</span>
</span><span id="Mapper-910"><a href="#Mapper-910"><span class="linenos"> 910</span></a>                <span class="n">kval</span> <span class="o">=</span> <span class="n">as_unicode</span><span class="p">(</span><span class="n">kval</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">encoding</span><span class="p">)</span>
</span><span id="Mapper-911"><a href="#Mapper-911"><span class="linenos"> 911</span></a>                <span class="k">if</span> <span class="n">kval</span> <span class="o">!=</span> <span class="n">route</span><span class="o">.</span><span class="n">defaults</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="ow">and</span> \
</span><span id="Mapper-912"><a href="#Mapper-912"><span class="linenos"> 912</span></a>                        <span class="ow">not</span> <span class="nb">callable</span><span class="p">(</span><span class="n">route</span><span class="o">.</span><span class="n">defaults</span><span class="p">[</span><span class="n">key</span><span class="p">]):</span>
</span><span id="Mapper-913"><a href="#Mapper-913"><span class="linenos"> 913</span></a>                    <span class="n">fail</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="Mapper-914"><a href="#Mapper-914"><span class="linenos"> 914</span></a>                    <span class="k">break</span>
</span><span id="Mapper-915"><a href="#Mapper-915"><span class="linenos"> 915</span></a>            <span class="k">if</span> <span class="n">fail</span><span class="p">:</span>
</span><span id="Mapper-916"><a href="#Mapper-916"><span class="linenos"> 916</span></a>                <span class="k">continue</span>
</span><span id="Mapper-917"><a href="#Mapper-917"><span class="linenos"> 917</span></a>            <span class="n">path</span> <span class="o">=</span> <span class="n">route</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="o">**</span><span class="n">kargs</span><span class="p">)</span>
</span><span id="Mapper-918"><a href="#Mapper-918"><span class="linenos"> 918</span></a>            <span class="k">if</span> <span class="n">path</span><span class="p">:</span>
</span><span id="Mapper-919"><a href="#Mapper-919"><span class="linenos"> 919</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prefix</span><span class="p">:</span>
</span><span id="Mapper-920"><a href="#Mapper-920"><span class="linenos"> 920</span></a>                    <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prefix</span> <span class="o">+</span> <span class="n">path</span>
</span><span id="Mapper-921"><a href="#Mapper-921"><span class="linenos"> 921</span></a>                <span class="n">external_static</span> <span class="o">=</span> <span class="n">route</span><span class="o">.</span><span class="n">static</span> <span class="ow">and</span> <span class="n">route</span><span class="o">.</span><span class="n">external</span>
</span><span id="Mapper-922"><a href="#Mapper-922"><span class="linenos"> 922</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">route</span><span class="o">.</span><span class="n">absolute</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">external_static</span><span class="p">:</span>
</span><span id="Mapper-923"><a href="#Mapper-923"><span class="linenos"> 923</span></a>                    <span class="n">path</span> <span class="o">=</span> <span class="n">script_name</span> <span class="o">+</span> <span class="n">path</span>
</span><span id="Mapper-924"><a href="#Mapper-924"><span class="linenos"> 924</span></a>                    <span class="n">key</span> <span class="o">=</span> <span class="n">cache_key_script_name</span>
</span><span id="Mapper-925"><a href="#Mapper-925"><span class="linenos"> 925</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="Mapper-926"><a href="#Mapper-926"><span class="linenos"> 926</span></a>                    <span class="n">key</span> <span class="o">=</span> <span class="n">cache_key</span>
</span><span id="Mapper-927"><a href="#Mapper-927"><span class="linenos"> 927</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">urlcache</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Mapper-928"><a href="#Mapper-928"><span class="linenos"> 928</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">urlcache</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">path</span><span class="p">))</span>
</span><span id="Mapper-929"><a href="#Mapper-929"><span class="linenos"> 929</span></a>                <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</span><span id="Mapper-930"><a href="#Mapper-930"><span class="linenos"> 930</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Mapper-931"><a href="#Mapper-931"><span class="linenos"> 931</span></a>                <span class="k">continue</span>
</span><span id="Mapper-932"><a href="#Mapper-932"><span class="linenos"> 932</span></a>        <span class="k">return</span> <span class="kc">None</span>
</span><span id="Mapper-933"><a href="#Mapper-933"><span class="linenos"> 933</span></a>
</span><span id="Mapper-934"><a href="#Mapper-934"><span class="linenos"> 934</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">resource</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">member_name</span><span class="p">,</span> <span class="n">collection_name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="Mapper-935"><a href="#Mapper-935"><span class="linenos"> 935</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate routes for a controller resource</span>
</span><span id="Mapper-936"><a href="#Mapper-936"><span class="linenos"> 936</span></a>
</span><span id="Mapper-937"><a href="#Mapper-937"><span class="linenos"> 937</span></a><span class="sd">        The member_name name should be the appropriate singular version</span>
</span><span id="Mapper-938"><a href="#Mapper-938"><span class="linenos"> 938</span></a><span class="sd">        of the resource given your locale and used with members of the</span>
</span><span id="Mapper-939"><a href="#Mapper-939"><span class="linenos"> 939</span></a><span class="sd">        collection. The collection_name name will be used to refer to</span>
</span><span id="Mapper-940"><a href="#Mapper-940"><span class="linenos"> 940</span></a><span class="sd">        the resource collection methods and should be a plural version</span>
</span><span id="Mapper-941"><a href="#Mapper-941"><span class="linenos"> 941</span></a><span class="sd">        of the member_name argument. By default, the member_name name</span>
</span><span id="Mapper-942"><a href="#Mapper-942"><span class="linenos"> 942</span></a><span class="sd">        will also be assumed to map to a controller you create.</span>
</span><span id="Mapper-943"><a href="#Mapper-943"><span class="linenos"> 943</span></a>
</span><span id="Mapper-944"><a href="#Mapper-944"><span class="linenos"> 944</span></a><span class="sd">        The concept of a web resource maps somewhat directly to &#39;CRUD&#39;</span>
</span><span id="Mapper-945"><a href="#Mapper-945"><span class="linenos"> 945</span></a><span class="sd">        operations. The overlying things to keep in mind is that</span>
</span><span id="Mapper-946"><a href="#Mapper-946"><span class="linenos"> 946</span></a><span class="sd">        mapping a resource is about handling creating, viewing, and</span>
</span><span id="Mapper-947"><a href="#Mapper-947"><span class="linenos"> 947</span></a><span class="sd">        editing that resource.</span>
</span><span id="Mapper-948"><a href="#Mapper-948"><span class="linenos"> 948</span></a>
</span><span id="Mapper-949"><a href="#Mapper-949"><span class="linenos"> 949</span></a><span class="sd">        All keyword arguments are optional.</span>
</span><span id="Mapper-950"><a href="#Mapper-950"><span class="linenos"> 950</span></a>
</span><span id="Mapper-951"><a href="#Mapper-951"><span class="linenos"> 951</span></a><span class="sd">        ``controller``</span>
</span><span id="Mapper-952"><a href="#Mapper-952"><span class="linenos"> 952</span></a><span class="sd">            If specified in the keyword args, the controller will be</span>
</span><span id="Mapper-953"><a href="#Mapper-953"><span class="linenos"> 953</span></a><span class="sd">            the actual controller used, but the rest of the naming</span>
</span><span id="Mapper-954"><a href="#Mapper-954"><span class="linenos"> 954</span></a><span class="sd">            conventions used for the route names and URL paths are</span>
</span><span id="Mapper-955"><a href="#Mapper-955"><span class="linenos"> 955</span></a><span class="sd">            unchanged.</span>
</span><span id="Mapper-956"><a href="#Mapper-956"><span class="linenos"> 956</span></a>
</span><span id="Mapper-957"><a href="#Mapper-957"><span class="linenos"> 957</span></a><span class="sd">        ``collection``</span>
</span><span id="Mapper-958"><a href="#Mapper-958"><span class="linenos"> 958</span></a><span class="sd">            Additional action mappings used to manipulate/view the</span>
</span><span id="Mapper-959"><a href="#Mapper-959"><span class="linenos"> 959</span></a><span class="sd">            entire set of resources provided by the controller.</span>
</span><span id="Mapper-960"><a href="#Mapper-960"><span class="linenos"> 960</span></a>
</span><span id="Mapper-961"><a href="#Mapper-961"><span class="linenos"> 961</span></a><span class="sd">            Example::</span>
</span><span id="Mapper-962"><a href="#Mapper-962"><span class="linenos"> 962</span></a>
</span><span id="Mapper-963"><a href="#Mapper-963"><span class="linenos"> 963</span></a><span class="sd">                map.resource(&#39;message&#39;, &#39;messages&#39;, collection={&#39;rss&#39;:&#39;GET&#39;})</span>
</span><span id="Mapper-964"><a href="#Mapper-964"><span class="linenos"> 964</span></a><span class="sd">                # GET /message/rss (maps to the rss action)</span>
</span><span id="Mapper-965"><a href="#Mapper-965"><span class="linenos"> 965</span></a><span class="sd">                # also adds named route &quot;rss_message&quot;</span>
</span><span id="Mapper-966"><a href="#Mapper-966"><span class="linenos"> 966</span></a>
</span><span id="Mapper-967"><a href="#Mapper-967"><span class="linenos"> 967</span></a><span class="sd">        ``member``</span>
</span><span id="Mapper-968"><a href="#Mapper-968"><span class="linenos"> 968</span></a><span class="sd">            Additional action mappings used to access an individual</span>
</span><span id="Mapper-969"><a href="#Mapper-969"><span class="linenos"> 969</span></a><span class="sd">            &#39;member&#39; of this controllers resources.</span>
</span><span id="Mapper-970"><a href="#Mapper-970"><span class="linenos"> 970</span></a>
</span><span id="Mapper-971"><a href="#Mapper-971"><span class="linenos"> 971</span></a><span class="sd">            Example::</span>
</span><span id="Mapper-972"><a href="#Mapper-972"><span class="linenos"> 972</span></a>
</span><span id="Mapper-973"><a href="#Mapper-973"><span class="linenos"> 973</span></a><span class="sd">                map.resource(&#39;message&#39;, &#39;messages&#39;, member={&#39;mark&#39;:&#39;POST&#39;})</span>
</span><span id="Mapper-974"><a href="#Mapper-974"><span class="linenos"> 974</span></a><span class="sd">                # POST /message/1/mark (maps to the mark action)</span>
</span><span id="Mapper-975"><a href="#Mapper-975"><span class="linenos"> 975</span></a><span class="sd">                # also adds named route &quot;mark_message&quot;</span>
</span><span id="Mapper-976"><a href="#Mapper-976"><span class="linenos"> 976</span></a>
</span><span id="Mapper-977"><a href="#Mapper-977"><span class="linenos"> 977</span></a><span class="sd">        ``new``</span>
</span><span id="Mapper-978"><a href="#Mapper-978"><span class="linenos"> 978</span></a><span class="sd">            Action mappings that involve dealing with a new member in</span>
</span><span id="Mapper-979"><a href="#Mapper-979"><span class="linenos"> 979</span></a><span class="sd">            the controller resources.</span>
</span><span id="Mapper-980"><a href="#Mapper-980"><span class="linenos"> 980</span></a>
</span><span id="Mapper-981"><a href="#Mapper-981"><span class="linenos"> 981</span></a><span class="sd">            Example::</span>
</span><span id="Mapper-982"><a href="#Mapper-982"><span class="linenos"> 982</span></a>
</span><span id="Mapper-983"><a href="#Mapper-983"><span class="linenos"> 983</span></a><span class="sd">                map.resource(&#39;message&#39;, &#39;messages&#39;, new={&#39;preview&#39;:&#39;POST&#39;})</span>
</span><span id="Mapper-984"><a href="#Mapper-984"><span class="linenos"> 984</span></a><span class="sd">                # POST /message/new/preview (maps to the preview action)</span>
</span><span id="Mapper-985"><a href="#Mapper-985"><span class="linenos"> 985</span></a><span class="sd">                # also adds a url named &quot;preview_new_message&quot;</span>
</span><span id="Mapper-986"><a href="#Mapper-986"><span class="linenos"> 986</span></a>
</span><span id="Mapper-987"><a href="#Mapper-987"><span class="linenos"> 987</span></a><span class="sd">        ``path_prefix``</span>
</span><span id="Mapper-988"><a href="#Mapper-988"><span class="linenos"> 988</span></a><span class="sd">            Prepends the URL path for the Route with the path_prefix</span>
</span><span id="Mapper-989"><a href="#Mapper-989"><span class="linenos"> 989</span></a><span class="sd">            given. This is most useful for cases where you want to mix</span>
</span><span id="Mapper-990"><a href="#Mapper-990"><span class="linenos"> 990</span></a><span class="sd">            resources or relations between resources.</span>
</span><span id="Mapper-991"><a href="#Mapper-991"><span class="linenos"> 991</span></a>
</span><span id="Mapper-992"><a href="#Mapper-992"><span class="linenos"> 992</span></a><span class="sd">        ``name_prefix``</span>
</span><span id="Mapper-993"><a href="#Mapper-993"><span class="linenos"> 993</span></a><span class="sd">            Perpends the route names that are generated with the</span>
</span><span id="Mapper-994"><a href="#Mapper-994"><span class="linenos"> 994</span></a><span class="sd">            name_prefix given. Combined with the path_prefix option,</span>
</span><span id="Mapper-995"><a href="#Mapper-995"><span class="linenos"> 995</span></a><span class="sd">            it&#39;s easy to generate route names and paths that represent</span>
</span><span id="Mapper-996"><a href="#Mapper-996"><span class="linenos"> 996</span></a><span class="sd">            resources that are in relations.</span>
</span><span id="Mapper-997"><a href="#Mapper-997"><span class="linenos"> 997</span></a>
</span><span id="Mapper-998"><a href="#Mapper-998"><span class="linenos"> 998</span></a><span class="sd">            Example::</span>
</span><span id="Mapper-999"><a href="#Mapper-999"><span class="linenos"> 999</span></a>
</span><span id="Mapper-1000"><a href="#Mapper-1000"><span class="linenos">1000</span></a><span class="sd">                map.resource(&#39;message&#39;, &#39;messages&#39;, controller=&#39;categories&#39;,</span>
</span><span id="Mapper-1001"><a href="#Mapper-1001"><span class="linenos">1001</span></a><span class="sd">                    path_prefix=&#39;/category/:category_id&#39;,</span>
</span><span id="Mapper-1002"><a href="#Mapper-1002"><span class="linenos">1002</span></a><span class="sd">                    name_prefix=&quot;category_&quot;)</span>
</span><span id="Mapper-1003"><a href="#Mapper-1003"><span class="linenos">1003</span></a><span class="sd">                # GET /category/7/message/1</span>
</span><span id="Mapper-1004"><a href="#Mapper-1004"><span class="linenos">1004</span></a><span class="sd">                # has named route &quot;category_message&quot;</span>
</span><span id="Mapper-1005"><a href="#Mapper-1005"><span class="linenos">1005</span></a>
</span><span id="Mapper-1006"><a href="#Mapper-1006"><span class="linenos">1006</span></a><span class="sd">        ``requirements``</span>
</span><span id="Mapper-1007"><a href="#Mapper-1007"><span class="linenos">1007</span></a>
</span><span id="Mapper-1008"><a href="#Mapper-1008"><span class="linenos">1008</span></a><span class="sd">           A dictionary that restricts the matching of a</span>
</span><span id="Mapper-1009"><a href="#Mapper-1009"><span class="linenos">1009</span></a><span class="sd">           variable. Can be used when matching variables with path_prefix.</span>
</span><span id="Mapper-1010"><a href="#Mapper-1010"><span class="linenos">1010</span></a>
</span><span id="Mapper-1011"><a href="#Mapper-1011"><span class="linenos">1011</span></a><span class="sd">           Example::</span>
</span><span id="Mapper-1012"><a href="#Mapper-1012"><span class="linenos">1012</span></a>
</span><span id="Mapper-1013"><a href="#Mapper-1013"><span class="linenos">1013</span></a><span class="sd">                map.resource(&#39;message&#39;, &#39;messages&#39;,</span>
</span><span id="Mapper-1014"><a href="#Mapper-1014"><span class="linenos">1014</span></a><span class="sd">                     path_prefix=&#39;{project_id}/&#39;,</span>
</span><span id="Mapper-1015"><a href="#Mapper-1015"><span class="linenos">1015</span></a><span class="sd">                     requirements={&quot;project_id&quot;: R&quot;\\d+&quot;})</span>
</span><span id="Mapper-1016"><a href="#Mapper-1016"><span class="linenos">1016</span></a><span class="sd">                # POST /01234/message</span>
</span><span id="Mapper-1017"><a href="#Mapper-1017"><span class="linenos">1017</span></a><span class="sd">                #    success, project_id is set to &quot;01234&quot;</span>
</span><span id="Mapper-1018"><a href="#Mapper-1018"><span class="linenos">1018</span></a><span class="sd">                # POST /foo/message</span>
</span><span id="Mapper-1019"><a href="#Mapper-1019"><span class="linenos">1019</span></a><span class="sd">                #    404 not found, won&#39;t be matched by this route</span>
</span><span id="Mapper-1020"><a href="#Mapper-1020"><span class="linenos">1020</span></a>
</span><span id="Mapper-1021"><a href="#Mapper-1021"><span class="linenos">1021</span></a>
</span><span id="Mapper-1022"><a href="#Mapper-1022"><span class="linenos">1022</span></a><span class="sd">        ``parent_resource``</span>
</span><span id="Mapper-1023"><a href="#Mapper-1023"><span class="linenos">1023</span></a><span class="sd">            A ``dict`` containing information about the parent</span>
</span><span id="Mapper-1024"><a href="#Mapper-1024"><span class="linenos">1024</span></a><span class="sd">            resource, for creating a nested resource. It should contain</span>
</span><span id="Mapper-1025"><a href="#Mapper-1025"><span class="linenos">1025</span></a><span class="sd">            the ``member_name`` and ``collection_name`` of the parent</span>
</span><span id="Mapper-1026"><a href="#Mapper-1026"><span class="linenos">1026</span></a><span class="sd">            resource. This ``dict`` will</span>
</span><span id="Mapper-1027"><a href="#Mapper-1027"><span class="linenos">1027</span></a><span class="sd">            be available via the associated ``Route`` object which can</span>
</span><span id="Mapper-1028"><a href="#Mapper-1028"><span class="linenos">1028</span></a><span class="sd">            be accessed during a request via</span>
</span><span id="Mapper-1029"><a href="#Mapper-1029"><span class="linenos">1029</span></a><span class="sd">            ``request.environ[&#39;routes.route&#39;]``</span>
</span><span id="Mapper-1030"><a href="#Mapper-1030"><span class="linenos">1030</span></a>
</span><span id="Mapper-1031"><a href="#Mapper-1031"><span class="linenos">1031</span></a><span class="sd">            If ``parent_resource`` is supplied and ``path_prefix``</span>
</span><span id="Mapper-1032"><a href="#Mapper-1032"><span class="linenos">1032</span></a><span class="sd">            isn&#39;t, ``path_prefix`` will be generated from</span>
</span><span id="Mapper-1033"><a href="#Mapper-1033"><span class="linenos">1033</span></a><span class="sd">            ``parent_resource`` as</span>
</span><span id="Mapper-1034"><a href="#Mapper-1034"><span class="linenos">1034</span></a><span class="sd">            &quot;&lt;parent collection name&gt;/:&lt;parent member name&gt;_id&quot;.</span>
</span><span id="Mapper-1035"><a href="#Mapper-1035"><span class="linenos">1035</span></a>
</span><span id="Mapper-1036"><a href="#Mapper-1036"><span class="linenos">1036</span></a><span class="sd">            If ``parent_resource`` is supplied and ``name_prefix``</span>
</span><span id="Mapper-1037"><a href="#Mapper-1037"><span class="linenos">1037</span></a><span class="sd">            isn&#39;t, ``name_prefix`` will be generated from</span>
</span><span id="Mapper-1038"><a href="#Mapper-1038"><span class="linenos">1038</span></a><span class="sd">            ``parent_resource`` as  &quot;&lt;parent member name&gt;_&quot;.</span>
</span><span id="Mapper-1039"><a href="#Mapper-1039"><span class="linenos">1039</span></a>
</span><span id="Mapper-1040"><a href="#Mapper-1040"><span class="linenos">1040</span></a><span class="sd">            Example::</span>
</span><span id="Mapper-1041"><a href="#Mapper-1041"><span class="linenos">1041</span></a>
</span><span id="Mapper-1042"><a href="#Mapper-1042"><span class="linenos">1042</span></a><span class="sd">                &gt;&gt;&gt; from routes.util import url_for</span>
</span><span id="Mapper-1043"><a href="#Mapper-1043"><span class="linenos">1043</span></a><span class="sd">                &gt;&gt;&gt; m = Mapper()</span>
</span><span id="Mapper-1044"><a href="#Mapper-1044"><span class="linenos">1044</span></a><span class="sd">                &gt;&gt;&gt; m.resource(&#39;location&#39;, &#39;locations&#39;,</span>
</span><span id="Mapper-1045"><a href="#Mapper-1045"><span class="linenos">1045</span></a><span class="sd">                ...            parent_resource=dict(member_name=&#39;region&#39;,</span>
</span><span id="Mapper-1046"><a href="#Mapper-1046"><span class="linenos">1046</span></a><span class="sd">                ...                                 collection_name=&#39;regions&#39;))</span>
</span><span id="Mapper-1047"><a href="#Mapper-1047"><span class="linenos">1047</span></a><span class="sd">                &gt;&gt;&gt; # path_prefix is &quot;regions/:region_id&quot;</span>
</span><span id="Mapper-1048"><a href="#Mapper-1048"><span class="linenos">1048</span></a><span class="sd">                &gt;&gt;&gt; # name prefix is &quot;region_&quot;</span>
</span><span id="Mapper-1049"><a href="#Mapper-1049"><span class="linenos">1049</span></a><span class="sd">                &gt;&gt;&gt; url_for(&#39;region_locations&#39;, region_id=13)</span>
</span><span id="Mapper-1050"><a href="#Mapper-1050"><span class="linenos">1050</span></a><span class="sd">                &#39;/regions/13/locations&#39;</span>
</span><span id="Mapper-1051"><a href="#Mapper-1051"><span class="linenos">1051</span></a><span class="sd">                &gt;&gt;&gt; url_for(&#39;region_new_location&#39;, region_id=13)</span>
</span><span id="Mapper-1052"><a href="#Mapper-1052"><span class="linenos">1052</span></a><span class="sd">                &#39;/regions/13/locations/new&#39;</span>
</span><span id="Mapper-1053"><a href="#Mapper-1053"><span class="linenos">1053</span></a><span class="sd">                &gt;&gt;&gt; url_for(&#39;region_location&#39;, region_id=13, id=60)</span>
</span><span id="Mapper-1054"><a href="#Mapper-1054"><span class="linenos">1054</span></a><span class="sd">                &#39;/regions/13/locations/60&#39;</span>
</span><span id="Mapper-1055"><a href="#Mapper-1055"><span class="linenos">1055</span></a><span class="sd">                &gt;&gt;&gt; url_for(&#39;region_edit_location&#39;, region_id=13, id=60)</span>
</span><span id="Mapper-1056"><a href="#Mapper-1056"><span class="linenos">1056</span></a><span class="sd">                &#39;/regions/13/locations/60/edit&#39;</span>
</span><span id="Mapper-1057"><a href="#Mapper-1057"><span class="linenos">1057</span></a>
</span><span id="Mapper-1058"><a href="#Mapper-1058"><span class="linenos">1058</span></a><span class="sd">            Overriding generated ``path_prefix``::</span>
</span><span id="Mapper-1059"><a href="#Mapper-1059"><span class="linenos">1059</span></a>
</span><span id="Mapper-1060"><a href="#Mapper-1060"><span class="linenos">1060</span></a><span class="sd">                &gt;&gt;&gt; m = Mapper()</span>
</span><span id="Mapper-1061"><a href="#Mapper-1061"><span class="linenos">1061</span></a><span class="sd">                &gt;&gt;&gt; m.resource(&#39;location&#39;, &#39;locations&#39;,</span>
</span><span id="Mapper-1062"><a href="#Mapper-1062"><span class="linenos">1062</span></a><span class="sd">                ...            parent_resource=dict(member_name=&#39;region&#39;,</span>
</span><span id="Mapper-1063"><a href="#Mapper-1063"><span class="linenos">1063</span></a><span class="sd">                ...                                 collection_name=&#39;regions&#39;),</span>
</span><span id="Mapper-1064"><a href="#Mapper-1064"><span class="linenos">1064</span></a><span class="sd">                ...            path_prefix=&#39;areas/:area_id&#39;)</span>
</span><span id="Mapper-1065"><a href="#Mapper-1065"><span class="linenos">1065</span></a><span class="sd">                &gt;&gt;&gt; # name prefix is &quot;region_&quot;</span>
</span><span id="Mapper-1066"><a href="#Mapper-1066"><span class="linenos">1066</span></a><span class="sd">                &gt;&gt;&gt; url_for(&#39;region_locations&#39;, area_id=51)</span>
</span><span id="Mapper-1067"><a href="#Mapper-1067"><span class="linenos">1067</span></a><span class="sd">                &#39;/areas/51/locations&#39;</span>
</span><span id="Mapper-1068"><a href="#Mapper-1068"><span class="linenos">1068</span></a>
</span><span id="Mapper-1069"><a href="#Mapper-1069"><span class="linenos">1069</span></a><span class="sd">            Overriding generated ``name_prefix``::</span>
</span><span id="Mapper-1070"><a href="#Mapper-1070"><span class="linenos">1070</span></a>
</span><span id="Mapper-1071"><a href="#Mapper-1071"><span class="linenos">1071</span></a><span class="sd">                &gt;&gt;&gt; m = Mapper()</span>
</span><span id="Mapper-1072"><a href="#Mapper-1072"><span class="linenos">1072</span></a><span class="sd">                &gt;&gt;&gt; m.resource(&#39;location&#39;, &#39;locations&#39;,</span>
</span><span id="Mapper-1073"><a href="#Mapper-1073"><span class="linenos">1073</span></a><span class="sd">                ...            parent_resource=dict(member_name=&#39;region&#39;,</span>
</span><span id="Mapper-1074"><a href="#Mapper-1074"><span class="linenos">1074</span></a><span class="sd">                ...                                 collection_name=&#39;regions&#39;),</span>
</span><span id="Mapper-1075"><a href="#Mapper-1075"><span class="linenos">1075</span></a><span class="sd">                ...            name_prefix=&#39;&#39;)</span>
</span><span id="Mapper-1076"><a href="#Mapper-1076"><span class="linenos">1076</span></a><span class="sd">                &gt;&gt;&gt; # path_prefix is &quot;regions/:region_id&quot;</span>
</span><span id="Mapper-1077"><a href="#Mapper-1077"><span class="linenos">1077</span></a><span class="sd">                &gt;&gt;&gt; url_for(&#39;locations&#39;, region_id=51)</span>
</span><span id="Mapper-1078"><a href="#Mapper-1078"><span class="linenos">1078</span></a><span class="sd">                &#39;/regions/51/locations&#39;</span>
</span><span id="Mapper-1079"><a href="#Mapper-1079"><span class="linenos">1079</span></a>
</span><span id="Mapper-1080"><a href="#Mapper-1080"><span class="linenos">1080</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Mapper-1081"><a href="#Mapper-1081"><span class="linenos">1081</span></a>        <span class="n">collection</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;collection&#39;</span><span class="p">,</span> <span class="p">{})</span>
</span><span id="Mapper-1082"><a href="#Mapper-1082"><span class="linenos">1082</span></a>        <span class="n">member</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;member&#39;</span><span class="p">,</span> <span class="p">{})</span>
</span><span id="Mapper-1083"><a href="#Mapper-1083"><span class="linenos">1083</span></a>        <span class="n">new</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;new&#39;</span><span class="p">,</span> <span class="p">{})</span>
</span><span id="Mapper-1084"><a href="#Mapper-1084"><span class="linenos">1084</span></a>        <span class="n">path_prefix</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;path_prefix&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="Mapper-1085"><a href="#Mapper-1085"><span class="linenos">1085</span></a>        <span class="n">name_prefix</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;name_prefix&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="Mapper-1086"><a href="#Mapper-1086"><span class="linenos">1086</span></a>        <span class="n">parent_resource</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;parent_resource&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="Mapper-1087"><a href="#Mapper-1087"><span class="linenos">1087</span></a>
</span><span id="Mapper-1088"><a href="#Mapper-1088"><span class="linenos">1088</span></a>        <span class="c1"># Generate ``path_prefix`` if ``path_prefix`` wasn&#39;t specified and</span>
</span><span id="Mapper-1089"><a href="#Mapper-1089"><span class="linenos">1089</span></a>        <span class="c1"># ``parent_resource`` was. Likewise for ``name_prefix``. Make sure</span>
</span><span id="Mapper-1090"><a href="#Mapper-1090"><span class="linenos">1090</span></a>        <span class="c1"># that ``path_prefix`` and ``name_prefix`` *always* take precedence if</span>
</span><span id="Mapper-1091"><a href="#Mapper-1091"><span class="linenos">1091</span></a>        <span class="c1"># they are specified--in particular, we need to be careful when they</span>
</span><span id="Mapper-1092"><a href="#Mapper-1092"><span class="linenos">1092</span></a>        <span class="c1"># are explicitly set to &quot;&quot;.</span>
</span><span id="Mapper-1093"><a href="#Mapper-1093"><span class="linenos">1093</span></a>        <span class="k">if</span> <span class="n">parent_resource</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Mapper-1094"><a href="#Mapper-1094"><span class="linenos">1094</span></a>            <span class="k">if</span> <span class="n">path_prefix</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Mapper-1095"><a href="#Mapper-1095"><span class="linenos">1095</span></a>                <span class="n">path_prefix</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">/:</span><span class="si">%s</span><span class="s1">_id&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">parent_resource</span><span class="p">[</span><span class="s1">&#39;collection_name&#39;</span><span class="p">],</span>
</span><span id="Mapper-1096"><a href="#Mapper-1096"><span class="linenos">1096</span></a>                                             <span class="n">parent_resource</span><span class="p">[</span><span class="s1">&#39;member_name&#39;</span><span class="p">])</span>
</span><span id="Mapper-1097"><a href="#Mapper-1097"><span class="linenos">1097</span></a>            <span class="k">if</span> <span class="n">name_prefix</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Mapper-1098"><a href="#Mapper-1098"><span class="linenos">1098</span></a>                <span class="n">name_prefix</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">_&#39;</span> <span class="o">%</span> <span class="n">parent_resource</span><span class="p">[</span><span class="s1">&#39;member_name&#39;</span><span class="p">]</span>
</span><span id="Mapper-1099"><a href="#Mapper-1099"><span class="linenos">1099</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Mapper-1100"><a href="#Mapper-1100"><span class="linenos">1100</span></a>            <span class="k">if</span> <span class="n">path_prefix</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Mapper-1101"><a href="#Mapper-1101"><span class="linenos">1101</span></a>                <span class="n">path_prefix</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
</span><span id="Mapper-1102"><a href="#Mapper-1102"><span class="linenos">1102</span></a>            <span class="k">if</span> <span class="n">name_prefix</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Mapper-1103"><a href="#Mapper-1103"><span class="linenos">1103</span></a>                <span class="n">name_prefix</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
</span><span id="Mapper-1104"><a href="#Mapper-1104"><span class="linenos">1104</span></a>
</span><span id="Mapper-1105"><a href="#Mapper-1105"><span class="linenos">1105</span></a>        <span class="c1"># Ensure the edit and new actions are in and GET</span>
</span><span id="Mapper-1106"><a href="#Mapper-1106"><span class="linenos">1106</span></a>        <span class="n">member</span><span class="p">[</span><span class="s1">&#39;edit&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;GET&#39;</span>
</span><span id="Mapper-1107"><a href="#Mapper-1107"><span class="linenos">1107</span></a>        <span class="n">new</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;new&#39;</span><span class="p">:</span> <span class="s1">&#39;GET&#39;</span><span class="p">})</span>
</span><span id="Mapper-1108"><a href="#Mapper-1108"><span class="linenos">1108</span></a>
</span><span id="Mapper-1109"><a href="#Mapper-1109"><span class="linenos">1109</span></a>        <span class="c1"># Make new dict&#39;s based off the old, except the old values become keys,</span>
</span><span id="Mapper-1110"><a href="#Mapper-1110"><span class="linenos">1110</span></a>        <span class="c1"># and the old keys become items in a list as the value</span>
</span><span id="Mapper-1111"><a href="#Mapper-1111"><span class="linenos">1111</span></a>        <span class="k">def</span><span class="w"> </span><span class="nf">swap</span><span class="p">(</span><span class="n">dct</span><span class="p">,</span> <span class="n">newdct</span><span class="p">):</span>
</span><span id="Mapper-1112"><a href="#Mapper-1112"><span class="linenos">1112</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;Swap the keys and values in the dict, and uppercase the values</span>
</span><span id="Mapper-1113"><a href="#Mapper-1113"><span class="linenos">1113</span></a><span class="sd">            from the dict during the swap.&quot;&quot;&quot;</span>
</span><span id="Mapper-1114"><a href="#Mapper-1114"><span class="linenos">1114</span></a>            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">six</span><span class="o">.</span><span class="n">iteritems</span><span class="p">(</span><span class="n">dct</span><span class="p">):</span>
</span><span id="Mapper-1115"><a href="#Mapper-1115"><span class="linenos">1115</span></a>                <span class="n">newdct</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">val</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span> <span class="p">[])</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
</span><span id="Mapper-1116"><a href="#Mapper-1116"><span class="linenos">1116</span></a>            <span class="k">return</span> <span class="n">newdct</span>
</span><span id="Mapper-1117"><a href="#Mapper-1117"><span class="linenos">1117</span></a>        <span class="n">collection_methods</span> <span class="o">=</span> <span class="n">swap</span><span class="p">(</span><span class="n">collection</span><span class="p">,</span> <span class="p">{})</span>
</span><span id="Mapper-1118"><a href="#Mapper-1118"><span class="linenos">1118</span></a>        <span class="n">member_methods</span> <span class="o">=</span> <span class="n">swap</span><span class="p">(</span><span class="n">member</span><span class="p">,</span> <span class="p">{})</span>
</span><span id="Mapper-1119"><a href="#Mapper-1119"><span class="linenos">1119</span></a>        <span class="n">new_methods</span> <span class="o">=</span> <span class="n">swap</span><span class="p">(</span><span class="n">new</span><span class="p">,</span> <span class="p">{})</span>
</span><span id="Mapper-1120"><a href="#Mapper-1120"><span class="linenos">1120</span></a>
</span><span id="Mapper-1121"><a href="#Mapper-1121"><span class="linenos">1121</span></a>        <span class="c1"># Insert create, update, and destroy methods</span>
</span><span id="Mapper-1122"><a href="#Mapper-1122"><span class="linenos">1122</span></a>        <span class="n">collection_methods</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;POST&#39;</span><span class="p">,</span> <span class="p">[])</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;create&#39;</span><span class="p">)</span>
</span><span id="Mapper-1123"><a href="#Mapper-1123"><span class="linenos">1123</span></a>        <span class="n">member_methods</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;PUT&#39;</span><span class="p">,</span> <span class="p">[])</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;update&#39;</span><span class="p">)</span>
</span><span id="Mapper-1124"><a href="#Mapper-1124"><span class="linenos">1124</span></a>        <span class="n">member_methods</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;DELETE&#39;</span><span class="p">,</span> <span class="p">[])</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;delete&#39;</span><span class="p">)</span>
</span><span id="Mapper-1125"><a href="#Mapper-1125"><span class="linenos">1125</span></a>
</span><span id="Mapper-1126"><a href="#Mapper-1126"><span class="linenos">1126</span></a>        <span class="c1"># If there&#39;s a path prefix option, use it with the controller</span>
</span><span id="Mapper-1127"><a href="#Mapper-1127"><span class="linenos">1127</span></a>        <span class="n">controller</span> <span class="o">=</span> <span class="n">strip_slashes</span><span class="p">(</span><span class="n">collection_name</span><span class="p">)</span>
</span><span id="Mapper-1128"><a href="#Mapper-1128"><span class="linenos">1128</span></a>        <span class="n">path_prefix</span> <span class="o">=</span> <span class="n">strip_slashes</span><span class="p">(</span><span class="n">path_prefix</span><span class="p">)</span>
</span><span id="Mapper-1129"><a href="#Mapper-1129"><span class="linenos">1129</span></a>        <span class="n">path_prefix</span> <span class="o">=</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="n">path_prefix</span>
</span><span id="Mapper-1130"><a href="#Mapper-1130"><span class="linenos">1130</span></a>        <span class="k">if</span> <span class="n">path_prefix</span> <span class="ow">and</span> <span class="n">path_prefix</span> <span class="o">!=</span> <span class="s1">&#39;/&#39;</span><span class="p">:</span>
</span><span id="Mapper-1131"><a href="#Mapper-1131"><span class="linenos">1131</span></a>            <span class="n">path</span> <span class="o">=</span> <span class="n">path_prefix</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="n">controller</span>
</span><span id="Mapper-1132"><a href="#Mapper-1132"><span class="linenos">1132</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Mapper-1133"><a href="#Mapper-1133"><span class="linenos">1133</span></a>            <span class="n">path</span> <span class="o">=</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="n">controller</span>
</span><span id="Mapper-1134"><a href="#Mapper-1134"><span class="linenos">1134</span></a>        <span class="n">collection_path</span> <span class="o">=</span> <span class="n">path</span>
</span><span id="Mapper-1135"><a href="#Mapper-1135"><span class="linenos">1135</span></a>        <span class="n">new_path</span> <span class="o">=</span> <span class="n">path</span> <span class="o">+</span> <span class="s2">&quot;/new&quot;</span>
</span><span id="Mapper-1136"><a href="#Mapper-1136"><span class="linenos">1136</span></a>        <span class="n">member_path</span> <span class="o">=</span> <span class="n">path</span> <span class="o">+</span> <span class="s2">&quot;/:(id)&quot;</span>
</span><span id="Mapper-1137"><a href="#Mapper-1137"><span class="linenos">1137</span></a>
</span><span id="Mapper-1138"><a href="#Mapper-1138"><span class="linenos">1138</span></a>        <span class="n">options</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="Mapper-1139"><a href="#Mapper-1139"><span class="linenos">1139</span></a>            <span class="s1">&#39;controller&#39;</span><span class="p">:</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;controller&#39;</span><span class="p">,</span> <span class="n">controller</span><span class="p">),</span>
</span><span id="Mapper-1140"><a href="#Mapper-1140"><span class="linenos">1140</span></a>            <span class="s1">&#39;_member_name&#39;</span><span class="p">:</span> <span class="n">member_name</span><span class="p">,</span>
</span><span id="Mapper-1141"><a href="#Mapper-1141"><span class="linenos">1141</span></a>            <span class="s1">&#39;_collection_name&#39;</span><span class="p">:</span> <span class="n">collection_name</span><span class="p">,</span>
</span><span id="Mapper-1142"><a href="#Mapper-1142"><span class="linenos">1142</span></a>            <span class="s1">&#39;_parent_resource&#39;</span><span class="p">:</span> <span class="n">parent_resource</span><span class="p">,</span>
</span><span id="Mapper-1143"><a href="#Mapper-1143"><span class="linenos">1143</span></a>            <span class="s1">&#39;_filter&#39;</span><span class="p">:</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;_filter&#39;</span><span class="p">)</span>
</span><span id="Mapper-1144"><a href="#Mapper-1144"><span class="linenos">1144</span></a>        <span class="p">}</span>
</span><span id="Mapper-1145"><a href="#Mapper-1145"><span class="linenos">1145</span></a>        <span class="k">if</span> <span class="s1">&#39;requirements&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
</span><span id="Mapper-1146"><a href="#Mapper-1146"><span class="linenos">1146</span></a>            <span class="n">options</span><span class="p">[</span><span class="s1">&#39;requirements&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;requirements&#39;</span><span class="p">]</span>
</span><span id="Mapper-1147"><a href="#Mapper-1147"><span class="linenos">1147</span></a>
</span><span id="Mapper-1148"><a href="#Mapper-1148"><span class="linenos">1148</span></a>        <span class="k">def</span><span class="w"> </span><span class="nf">requirements_for</span><span class="p">(</span><span class="n">meth</span><span class="p">):</span>
</span><span id="Mapper-1149"><a href="#Mapper-1149"><span class="linenos">1149</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;Returns a new dict to be used for all route creation as the</span>
</span><span id="Mapper-1150"><a href="#Mapper-1150"><span class="linenos">1150</span></a><span class="sd">            route options&quot;&quot;&quot;</span>
</span><span id="Mapper-1151"><a href="#Mapper-1151"><span class="linenos">1151</span></a>            <span class="n">opts</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Mapper-1152"><a href="#Mapper-1152"><span class="linenos">1152</span></a>            <span class="k">if</span> <span class="n">method</span> <span class="o">!=</span> <span class="s1">&#39;any&#39;</span><span class="p">:</span>
</span><span id="Mapper-1153"><a href="#Mapper-1153"><span class="linenos">1153</span></a>                <span class="n">opts</span><span class="p">[</span><span class="s1">&#39;conditions&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;method&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">meth</span><span class="o">.</span><span class="n">upper</span><span class="p">()]}</span>
</span><span id="Mapper-1154"><a href="#Mapper-1154"><span class="linenos">1154</span></a>            <span class="k">return</span> <span class="n">opts</span>
</span><span id="Mapper-1155"><a href="#Mapper-1155"><span class="linenos">1155</span></a>
</span><span id="Mapper-1156"><a href="#Mapper-1156"><span class="linenos">1156</span></a>        <span class="c1"># Add the routes for handling collection methods</span>
</span><span id="Mapper-1157"><a href="#Mapper-1157"><span class="linenos">1157</span></a>        <span class="k">for</span> <span class="n">method</span><span class="p">,</span> <span class="n">lst</span> <span class="ow">in</span> <span class="n">six</span><span class="o">.</span><span class="n">iteritems</span><span class="p">(</span><span class="n">collection_methods</span><span class="p">):</span>
</span><span id="Mapper-1158"><a href="#Mapper-1158"><span class="linenos">1158</span></a>            <span class="n">primary</span> <span class="o">=</span> <span class="p">(</span><span class="n">method</span> <span class="o">!=</span> <span class="s1">&#39;GET&#39;</span> <span class="ow">and</span> <span class="n">lst</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span> <span class="ow">or</span> <span class="kc">None</span>
</span><span id="Mapper-1159"><a href="#Mapper-1159"><span class="linenos">1159</span></a>            <span class="n">route_options</span> <span class="o">=</span> <span class="n">requirements_for</span><span class="p">(</span><span class="n">method</span><span class="p">)</span>
</span><span id="Mapper-1160"><a href="#Mapper-1160"><span class="linenos">1160</span></a>            <span class="k">for</span> <span class="n">action</span> <span class="ow">in</span> <span class="n">lst</span><span class="p">:</span>
</span><span id="Mapper-1161"><a href="#Mapper-1161"><span class="linenos">1161</span></a>                <span class="n">route_options</span><span class="p">[</span><span class="s1">&#39;action&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">action</span>
</span><span id="Mapper-1162"><a href="#Mapper-1162"><span class="linenos">1162</span></a>                <span class="n">route_name</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s%s</span><span class="s2">_</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">name_prefix</span><span class="p">,</span> <span class="n">action</span><span class="p">,</span> <span class="n">collection_name</span><span class="p">)</span>
</span><span id="Mapper-1163"><a href="#Mapper-1163"><span class="linenos">1163</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;formatted_&quot;</span> <span class="o">+</span> <span class="n">route_name</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">/</span><span class="si">%s</span><span class="s2">.:(format)&quot;</span> <span class="o">%</span>
</span><span id="Mapper-1164"><a href="#Mapper-1164"><span class="linenos">1164</span></a>                             <span class="p">(</span><span class="n">collection_path</span><span class="p">,</span> <span class="n">action</span><span class="p">),</span> <span class="o">**</span><span class="n">route_options</span><span class="p">)</span>
</span><span id="Mapper-1165"><a href="#Mapper-1165"><span class="linenos">1165</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">route_name</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">/</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">collection_path</span><span class="p">,</span> <span class="n">action</span><span class="p">),</span>
</span><span id="Mapper-1166"><a href="#Mapper-1166"><span class="linenos">1166</span></a>                             <span class="o">**</span><span class="n">route_options</span><span class="p">)</span>
</span><span id="Mapper-1167"><a href="#Mapper-1167"><span class="linenos">1167</span></a>            <span class="k">if</span> <span class="n">primary</span><span class="p">:</span>
</span><span id="Mapper-1168"><a href="#Mapper-1168"><span class="linenos">1168</span></a>                <span class="n">route_options</span><span class="p">[</span><span class="s1">&#39;action&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">primary</span>
</span><span id="Mapper-1169"><a href="#Mapper-1169"><span class="linenos">1169</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">.:(format)&quot;</span> <span class="o">%</span> <span class="n">collection_path</span><span class="p">,</span> <span class="o">**</span><span class="n">route_options</span><span class="p">)</span>
</span><span id="Mapper-1170"><a href="#Mapper-1170"><span class="linenos">1170</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">collection_path</span><span class="p">,</span> <span class="o">**</span><span class="n">route_options</span><span class="p">)</span>
</span><span id="Mapper-1171"><a href="#Mapper-1171"><span class="linenos">1171</span></a>
</span><span id="Mapper-1172"><a href="#Mapper-1172"><span class="linenos">1172</span></a>        <span class="c1"># Specifically add in the built-in &#39;index&#39; collection method and its</span>
</span><span id="Mapper-1173"><a href="#Mapper-1173"><span class="linenos">1173</span></a>        <span class="c1"># formatted version</span>
</span><span id="Mapper-1174"><a href="#Mapper-1174"><span class="linenos">1174</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;formatted_&quot;</span> <span class="o">+</span> <span class="n">name_prefix</span> <span class="o">+</span> <span class="n">collection_name</span><span class="p">,</span>
</span><span id="Mapper-1175"><a href="#Mapper-1175"><span class="linenos">1175</span></a>                     <span class="n">collection_path</span> <span class="o">+</span> <span class="s2">&quot;.:(format)&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;index&#39;</span><span class="p">,</span>
</span><span id="Mapper-1176"><a href="#Mapper-1176"><span class="linenos">1176</span></a>                     <span class="n">conditions</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;method&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">]},</span> <span class="o">**</span><span class="n">options</span><span class="p">)</span>
</span><span id="Mapper-1177"><a href="#Mapper-1177"><span class="linenos">1177</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">name_prefix</span> <span class="o">+</span> <span class="n">collection_name</span><span class="p">,</span> <span class="n">collection_path</span><span class="p">,</span>
</span><span id="Mapper-1178"><a href="#Mapper-1178"><span class="linenos">1178</span></a>                     <span class="n">action</span><span class="o">=</span><span class="s1">&#39;index&#39;</span><span class="p">,</span> <span class="n">conditions</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;method&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">]},</span> <span class="o">**</span><span class="n">options</span><span class="p">)</span>
</span><span id="Mapper-1179"><a href="#Mapper-1179"><span class="linenos">1179</span></a>
</span><span id="Mapper-1180"><a href="#Mapper-1180"><span class="linenos">1180</span></a>        <span class="c1"># Add the routes that deal with new resource methods</span>
</span><span id="Mapper-1181"><a href="#Mapper-1181"><span class="linenos">1181</span></a>        <span class="k">for</span> <span class="n">method</span><span class="p">,</span> <span class="n">lst</span> <span class="ow">in</span> <span class="n">six</span><span class="o">.</span><span class="n">iteritems</span><span class="p">(</span><span class="n">new_methods</span><span class="p">):</span>
</span><span id="Mapper-1182"><a href="#Mapper-1182"><span class="linenos">1182</span></a>            <span class="n">route_options</span> <span class="o">=</span> <span class="n">requirements_for</span><span class="p">(</span><span class="n">method</span><span class="p">)</span>
</span><span id="Mapper-1183"><a href="#Mapper-1183"><span class="linenos">1183</span></a>            <span class="k">for</span> <span class="n">action</span> <span class="ow">in</span> <span class="n">lst</span><span class="p">:</span>
</span><span id="Mapper-1184"><a href="#Mapper-1184"><span class="linenos">1184</span></a>                <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;new_&quot;</span> <span class="o">+</span> <span class="n">member_name</span>
</span><span id="Mapper-1185"><a href="#Mapper-1185"><span class="linenos">1185</span></a>                <span class="n">route_options</span><span class="p">[</span><span class="s1">&#39;action&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">action</span>
</span><span id="Mapper-1186"><a href="#Mapper-1186"><span class="linenos">1186</span></a>                <span class="k">if</span> <span class="n">action</span> <span class="o">==</span> <span class="s1">&#39;new&#39;</span><span class="p">:</span>
</span><span id="Mapper-1187"><a href="#Mapper-1187"><span class="linenos">1187</span></a>                    <span class="n">path</span> <span class="o">=</span> <span class="n">new_path</span>
</span><span id="Mapper-1188"><a href="#Mapper-1188"><span class="linenos">1188</span></a>                    <span class="n">formatted_path</span> <span class="o">=</span> <span class="n">new_path</span> <span class="o">+</span> <span class="s1">&#39;.:(format)&#39;</span>
</span><span id="Mapper-1189"><a href="#Mapper-1189"><span class="linenos">1189</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="Mapper-1190"><a href="#Mapper-1190"><span class="linenos">1190</span></a>                    <span class="n">path</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">/</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">new_path</span><span class="p">,</span> <span class="n">action</span><span class="p">)</span>
</span><span id="Mapper-1191"><a href="#Mapper-1191"><span class="linenos">1191</span></a>                    <span class="n">name</span> <span class="o">=</span> <span class="n">action</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">name</span>
</span><span id="Mapper-1192"><a href="#Mapper-1192"><span class="linenos">1192</span></a>                    <span class="n">formatted_path</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">/</span><span class="si">%s</span><span class="s2">.:(format)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">new_path</span><span class="p">,</span> <span class="n">action</span><span class="p">)</span>
</span><span id="Mapper-1193"><a href="#Mapper-1193"><span class="linenos">1193</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;formatted_&quot;</span> <span class="o">+</span> <span class="n">name_prefix</span> <span class="o">+</span> <span class="n">name</span><span class="p">,</span> <span class="n">formatted_path</span><span class="p">,</span>
</span><span id="Mapper-1194"><a href="#Mapper-1194"><span class="linenos">1194</span></a>                             <span class="o">**</span><span class="n">route_options</span><span class="p">)</span>
</span><span id="Mapper-1195"><a href="#Mapper-1195"><span class="linenos">1195</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">name_prefix</span> <span class="o">+</span> <span class="n">name</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="o">**</span><span class="n">route_options</span><span class="p">)</span>
</span><span id="Mapper-1196"><a href="#Mapper-1196"><span class="linenos">1196</span></a>
</span><span id="Mapper-1197"><a href="#Mapper-1197"><span class="linenos">1197</span></a>        <span class="n">requirements_regexp</span> <span class="o">=</span> <span class="s1">&#39;[^</span><span class="se">\\</span><span class="s1">/]+(?&lt;!</span><span class="se">\\\\</span><span class="s1">)&#39;</span>
</span><span id="Mapper-1198"><a href="#Mapper-1198"><span class="linenos">1198</span></a>
</span><span id="Mapper-1199"><a href="#Mapper-1199"><span class="linenos">1199</span></a>        <span class="c1"># Add the routes that deal with member methods of a resource</span>
</span><span id="Mapper-1200"><a href="#Mapper-1200"><span class="linenos">1200</span></a>        <span class="k">for</span> <span class="n">method</span><span class="p">,</span> <span class="n">lst</span> <span class="ow">in</span> <span class="n">six</span><span class="o">.</span><span class="n">iteritems</span><span class="p">(</span><span class="n">member_methods</span><span class="p">):</span>
</span><span id="Mapper-1201"><a href="#Mapper-1201"><span class="linenos">1201</span></a>            <span class="n">route_options</span> <span class="o">=</span> <span class="n">requirements_for</span><span class="p">(</span><span class="n">method</span><span class="p">)</span>
</span><span id="Mapper-1202"><a href="#Mapper-1202"><span class="linenos">1202</span></a>            <span class="n">route_options</span><span class="p">[</span><span class="s1">&#39;requirements&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="n">requirements_regexp</span><span class="p">}</span>
</span><span id="Mapper-1203"><a href="#Mapper-1203"><span class="linenos">1203</span></a>            <span class="k">if</span> <span class="n">method</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">,</span> <span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;any&#39;</span><span class="p">]:</span>
</span><span id="Mapper-1204"><a href="#Mapper-1204"><span class="linenos">1204</span></a>                <span class="n">primary</span> <span class="o">=</span> <span class="n">lst</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="Mapper-1205"><a href="#Mapper-1205"><span class="linenos">1205</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Mapper-1206"><a href="#Mapper-1206"><span class="linenos">1206</span></a>                <span class="n">primary</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Mapper-1207"><a href="#Mapper-1207"><span class="linenos">1207</span></a>            <span class="k">for</span> <span class="n">action</span> <span class="ow">in</span> <span class="n">lst</span><span class="p">:</span>
</span><span id="Mapper-1208"><a href="#Mapper-1208"><span class="linenos">1208</span></a>                <span class="n">route_options</span><span class="p">[</span><span class="s1">&#39;action&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">action</span>
</span><span id="Mapper-1209"><a href="#Mapper-1209"><span class="linenos">1209</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;formatted_</span><span class="si">%s%s</span><span class="s2">_</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">name_prefix</span><span class="p">,</span> <span class="n">action</span><span class="p">,</span>
</span><span id="Mapper-1210"><a href="#Mapper-1210"><span class="linenos">1210</span></a>                                                    <span class="n">member_name</span><span class="p">),</span>
</span><span id="Mapper-1211"><a href="#Mapper-1211"><span class="linenos">1211</span></a>                             <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">/</span><span class="si">%s</span><span class="s2">.:(format)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">member_path</span><span class="p">,</span> <span class="n">action</span><span class="p">),</span>
</span><span id="Mapper-1212"><a href="#Mapper-1212"><span class="linenos">1212</span></a>                             <span class="o">**</span><span class="n">route_options</span><span class="p">)</span>
</span><span id="Mapper-1213"><a href="#Mapper-1213"><span class="linenos">1213</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s%s</span><span class="s2">_</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">name_prefix</span><span class="p">,</span> <span class="n">action</span><span class="p">,</span> <span class="n">member_name</span><span class="p">),</span>
</span><span id="Mapper-1214"><a href="#Mapper-1214"><span class="linenos">1214</span></a>                             <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">/</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">member_path</span><span class="p">,</span> <span class="n">action</span><span class="p">),</span> <span class="o">**</span><span class="n">route_options</span><span class="p">)</span>
</span><span id="Mapper-1215"><a href="#Mapper-1215"><span class="linenos">1215</span></a>            <span class="k">if</span> <span class="n">primary</span><span class="p">:</span>
</span><span id="Mapper-1216"><a href="#Mapper-1216"><span class="linenos">1216</span></a>                <span class="n">route_options</span><span class="p">[</span><span class="s1">&#39;action&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">primary</span>
</span><span id="Mapper-1217"><a href="#Mapper-1217"><span class="linenos">1217</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">.:(format)&quot;</span> <span class="o">%</span> <span class="n">member_path</span><span class="p">,</span> <span class="o">**</span><span class="n">route_options</span><span class="p">)</span>
</span><span id="Mapper-1218"><a href="#Mapper-1218"><span class="linenos">1218</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">member_path</span><span class="p">,</span> <span class="o">**</span><span class="n">route_options</span><span class="p">)</span>
</span><span id="Mapper-1219"><a href="#Mapper-1219"><span class="linenos">1219</span></a>
</span><span id="Mapper-1220"><a href="#Mapper-1220"><span class="linenos">1220</span></a>        <span class="c1"># Specifically add the member &#39;show&#39; method</span>
</span><span id="Mapper-1221"><a href="#Mapper-1221"><span class="linenos">1221</span></a>        <span class="n">route_options</span> <span class="o">=</span> <span class="n">requirements_for</span><span class="p">(</span><span class="s1">&#39;GET&#39;</span><span class="p">)</span>
</span><span id="Mapper-1222"><a href="#Mapper-1222"><span class="linenos">1222</span></a>        <span class="n">route_options</span><span class="p">[</span><span class="s1">&#39;action&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;show&#39;</span>
</span><span id="Mapper-1223"><a href="#Mapper-1223"><span class="linenos">1223</span></a>        <span class="n">route_options</span><span class="p">[</span><span class="s1">&#39;requirements&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="n">requirements_regexp</span><span class="p">}</span>
</span><span id="Mapper-1224"><a href="#Mapper-1224"><span class="linenos">1224</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;formatted_&quot;</span> <span class="o">+</span> <span class="n">name_prefix</span> <span class="o">+</span> <span class="n">member_name</span><span class="p">,</span>
</span><span id="Mapper-1225"><a href="#Mapper-1225"><span class="linenos">1225</span></a>                     <span class="n">member_path</span> <span class="o">+</span> <span class="s2">&quot;.:(format)&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">route_options</span><span class="p">)</span>
</span><span id="Mapper-1226"><a href="#Mapper-1226"><span class="linenos">1226</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">name_prefix</span> <span class="o">+</span> <span class="n">member_name</span><span class="p">,</span> <span class="n">member_path</span><span class="p">,</span> <span class="o">**</span><span class="n">route_options</span><span class="p">)</span>
</span><span id="Mapper-1227"><a href="#Mapper-1227"><span class="linenos">1227</span></a>
</span><span id="Mapper-1228"><a href="#Mapper-1228"><span class="linenos">1228</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">redirect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">match_path</span><span class="p">,</span> <span class="n">destination_path</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="Mapper-1229"><a href="#Mapper-1229"><span class="linenos">1229</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Add a redirect route to the mapper</span>
</span><span id="Mapper-1230"><a href="#Mapper-1230"><span class="linenos">1230</span></a>
</span><span id="Mapper-1231"><a href="#Mapper-1231"><span class="linenos">1231</span></a><span class="sd">        Redirect routes bypass the wrapped WSGI application and instead</span>
</span><span id="Mapper-1232"><a href="#Mapper-1232"><span class="linenos">1232</span></a><span class="sd">        result in a redirect being issued by the RoutesMiddleware. As</span>
</span><span id="Mapper-1233"><a href="#Mapper-1233"><span class="linenos">1233</span></a><span class="sd">        such, this method is only meaningful when using</span>
</span><span id="Mapper-1234"><a href="#Mapper-1234"><span class="linenos">1234</span></a><span class="sd">        RoutesMiddleware.</span>
</span><span id="Mapper-1235"><a href="#Mapper-1235"><span class="linenos">1235</span></a>
</span><span id="Mapper-1236"><a href="#Mapper-1236"><span class="linenos">1236</span></a><span class="sd">        By default, a 302 Found status code is used, this can be</span>
</span><span id="Mapper-1237"><a href="#Mapper-1237"><span class="linenos">1237</span></a><span class="sd">        changed by providing a ``_redirect_code`` keyword argument</span>
</span><span id="Mapper-1238"><a href="#Mapper-1238"><span class="linenos">1238</span></a><span class="sd">        which will then be used instead. Note that the entire status</span>
</span><span id="Mapper-1239"><a href="#Mapper-1239"><span class="linenos">1239</span></a><span class="sd">        code string needs to be present.</span>
</span><span id="Mapper-1240"><a href="#Mapper-1240"><span class="linenos">1240</span></a>
</span><span id="Mapper-1241"><a href="#Mapper-1241"><span class="linenos">1241</span></a><span class="sd">        When using keyword arguments, all arguments that apply to</span>
</span><span id="Mapper-1242"><a href="#Mapper-1242"><span class="linenos">1242</span></a><span class="sd">        matching will be used for the match, while generation specific</span>
</span><span id="Mapper-1243"><a href="#Mapper-1243"><span class="linenos">1243</span></a><span class="sd">        options will be used during generation. Thus all options</span>
</span><span id="Mapper-1244"><a href="#Mapper-1244"><span class="linenos">1244</span></a><span class="sd">        normally available to connected Routes may be used with</span>
</span><span id="Mapper-1245"><a href="#Mapper-1245"><span class="linenos">1245</span></a><span class="sd">        redirect routes as well.</span>
</span><span id="Mapper-1246"><a href="#Mapper-1246"><span class="linenos">1246</span></a>
</span><span id="Mapper-1247"><a href="#Mapper-1247"><span class="linenos">1247</span></a><span class="sd">        Example::</span>
</span><span id="Mapper-1248"><a href="#Mapper-1248"><span class="linenos">1248</span></a>
</span><span id="Mapper-1249"><a href="#Mapper-1249"><span class="linenos">1249</span></a><span class="sd">            map = Mapper()</span>
</span><span id="Mapper-1250"><a href="#Mapper-1250"><span class="linenos">1250</span></a><span class="sd">            map.redirect(&#39;/legacyapp/archives/{url:.*}&#39;, &#39;/archives/{url}&#39;)</span>
</span><span id="Mapper-1251"><a href="#Mapper-1251"><span class="linenos">1251</span></a><span class="sd">            map.redirect(&#39;/home/index&#39;, &#39;/&#39;,</span>
</span><span id="Mapper-1252"><a href="#Mapper-1252"><span class="linenos">1252</span></a><span class="sd">                         _redirect_code=&#39;301 Moved Permanently&#39;)</span>
</span><span id="Mapper-1253"><a href="#Mapper-1253"><span class="linenos">1253</span></a>
</span><span id="Mapper-1254"><a href="#Mapper-1254"><span class="linenos">1254</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Mapper-1255"><a href="#Mapper-1255"><span class="linenos">1255</span></a>        <span class="n">both_args</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;_encoding&#39;</span><span class="p">,</span> <span class="s1">&#39;_explicit&#39;</span><span class="p">,</span> <span class="s1">&#39;_minimize&#39;</span><span class="p">]</span>
</span><span id="Mapper-1256"><a href="#Mapper-1256"><span class="linenos">1256</span></a>        <span class="n">gen_args</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;_filter&#39;</span><span class="p">]</span>
</span><span id="Mapper-1257"><a href="#Mapper-1257"><span class="linenos">1257</span></a>
</span><span id="Mapper-1258"><a href="#Mapper-1258"><span class="linenos">1258</span></a>        <span class="n">status_code</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;_redirect_code&#39;</span><span class="p">,</span> <span class="s1">&#39;302 Found&#39;</span><span class="p">)</span>
</span><span id="Mapper-1259"><a href="#Mapper-1259"><span class="linenos">1259</span></a>        <span class="n">gen_dict</span><span class="p">,</span> <span class="n">match_dict</span> <span class="o">=</span> <span class="p">{},</span> <span class="p">{}</span>
</span><span id="Mapper-1260"><a href="#Mapper-1260"><span class="linenos">1260</span></a>
</span><span id="Mapper-1261"><a href="#Mapper-1261"><span class="linenos">1261</span></a>        <span class="c1"># Create the dict of args for the generation route</span>
</span><span id="Mapper-1262"><a href="#Mapper-1262"><span class="linenos">1262</span></a>        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">both_args</span> <span class="o">+</span> <span class="n">gen_args</span><span class="p">:</span>
</span><span id="Mapper-1263"><a href="#Mapper-1263"><span class="linenos">1263</span></a>            <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
</span><span id="Mapper-1264"><a href="#Mapper-1264"><span class="linenos">1264</span></a>                <span class="n">gen_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
</span><span id="Mapper-1265"><a href="#Mapper-1265"><span class="linenos">1265</span></a>        <span class="n">gen_dict</span><span class="p">[</span><span class="s1">&#39;_static&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="Mapper-1266"><a href="#Mapper-1266"><span class="linenos">1266</span></a>
</span><span id="Mapper-1267"><a href="#Mapper-1267"><span class="linenos">1267</span></a>        <span class="c1"># Create the dict of args for the matching route</span>
</span><span id="Mapper-1268"><a href="#Mapper-1268"><span class="linenos">1268</span></a>        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
</span><span id="Mapper-1269"><a href="#Mapper-1269"><span class="linenos">1269</span></a>            <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">gen_args</span><span class="p">:</span>
</span><span id="Mapper-1270"><a href="#Mapper-1270"><span class="linenos">1270</span></a>                <span class="n">match_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
</span><span id="Mapper-1271"><a href="#Mapper-1271"><span class="linenos">1271</span></a>
</span><span id="Mapper-1272"><a href="#Mapper-1272"><span class="linenos">1272</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">match_path</span><span class="p">,</span> <span class="o">**</span><span class="n">match_dict</span><span class="p">)</span>
</span><span id="Mapper-1273"><a href="#Mapper-1273"><span class="linenos">1273</span></a>        <span class="n">match_route</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">matchlist</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="Mapper-1274"><a href="#Mapper-1274"><span class="linenos">1274</span></a>
</span><span id="Mapper-1275"><a href="#Mapper-1275"><span class="linenos">1275</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;_redirect_</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="nb">id</span><span class="p">(</span><span class="n">match_route</span><span class="p">),</span> <span class="n">destination_path</span><span class="p">,</span>
</span><span id="Mapper-1276"><a href="#Mapper-1276"><span class="linenos">1276</span></a>                     <span class="o">**</span><span class="n">gen_dict</span><span class="p">)</span>
</span><span id="Mapper-1277"><a href="#Mapper-1277"><span class="linenos">1277</span></a>        <span class="n">match_route</span><span class="o">.</span><span class="n">redirect</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="Mapper-1278"><a href="#Mapper-1278"><span class="linenos">1278</span></a>        <span class="n">match_route</span><span class="o">.</span><span class="n">redirect_status</span> <span class="o">=</span> <span class="n">status_code</span>
</span></pre></div>


            <div class="docstring"><p>Mapper handles URL generation and URL recognition in a web
application.</p>

<p>Mapper is built handling dictionary's. It is assumed that the web
application will handle the dictionary returned by URL recognition
to dispatch appropriately.</p>

<p>URL generation is done by passing keyword parameters into the
generate function, a URL is then returned.</p>
</div>


                            <div id="Mapper.__init__" class="classattr">
                                        <input id="Mapper.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">Mapper</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">controller_scan</span><span class="o">=&lt;</span><span class="n">function</span> <span class="n">controller_scan</span><span class="o">&gt;</span>,</span><span class="param">	<span class="n">directory</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">always_scan</span><span class="o">=</span><span class="kc">False</span>,</span><span class="param">	<span class="n">register</span><span class="o">=</span><span class="kc">True</span>,</span><span class="param">	<span class="n">explicit</span><span class="o">=</span><span class="kc">True</span></span>)</span>

                <label class="view-source-button" for="Mapper.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Mapper.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Mapper.__init__-328"><a href="#Mapper.__init__-328"><span class="linenos">328</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">controller_scan</span><span class="o">=</span><span class="n">controller_scan</span><span class="p">,</span> <span class="n">directory</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="Mapper.__init__-329"><a href="#Mapper.__init__-329"><span class="linenos">329</span></a>                 <span class="n">always_scan</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">register</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">explicit</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span id="Mapper.__init__-330"><a href="#Mapper.__init__-330"><span class="linenos">330</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a new Mapper instance</span>
</span><span id="Mapper.__init__-331"><a href="#Mapper.__init__-331"><span class="linenos">331</span></a>
</span><span id="Mapper.__init__-332"><a href="#Mapper.__init__-332"><span class="linenos">332</span></a><span class="sd">        All keyword arguments are optional.</span>
</span><span id="Mapper.__init__-333"><a href="#Mapper.__init__-333"><span class="linenos">333</span></a>
</span><span id="Mapper.__init__-334"><a href="#Mapper.__init__-334"><span class="linenos">334</span></a><span class="sd">        ``controller_scan``</span>
</span><span id="Mapper.__init__-335"><a href="#Mapper.__init__-335"><span class="linenos">335</span></a><span class="sd">            Function reference that will be used to return a list of</span>
</span><span id="Mapper.__init__-336"><a href="#Mapper.__init__-336"><span class="linenos">336</span></a><span class="sd">            valid controllers used during URL matching. If</span>
</span><span id="Mapper.__init__-337"><a href="#Mapper.__init__-337"><span class="linenos">337</span></a><span class="sd">            ``directory`` keyword arg is present, it will be passed</span>
</span><span id="Mapper.__init__-338"><a href="#Mapper.__init__-338"><span class="linenos">338</span></a><span class="sd">            into the function during its call. This option defaults to</span>
</span><span id="Mapper.__init__-339"><a href="#Mapper.__init__-339"><span class="linenos">339</span></a><span class="sd">            a function that will scan a directory for controllers.</span>
</span><span id="Mapper.__init__-340"><a href="#Mapper.__init__-340"><span class="linenos">340</span></a>
</span><span id="Mapper.__init__-341"><a href="#Mapper.__init__-341"><span class="linenos">341</span></a><span class="sd">            Alternatively, a list of controllers or None can be passed</span>
</span><span id="Mapper.__init__-342"><a href="#Mapper.__init__-342"><span class="linenos">342</span></a><span class="sd">            in which are assumed to be the definitive list of</span>
</span><span id="Mapper.__init__-343"><a href="#Mapper.__init__-343"><span class="linenos">343</span></a><span class="sd">            controller names valid when matching &#39;controller&#39;.</span>
</span><span id="Mapper.__init__-344"><a href="#Mapper.__init__-344"><span class="linenos">344</span></a>
</span><span id="Mapper.__init__-345"><a href="#Mapper.__init__-345"><span class="linenos">345</span></a><span class="sd">        ``directory``</span>
</span><span id="Mapper.__init__-346"><a href="#Mapper.__init__-346"><span class="linenos">346</span></a><span class="sd">            Passed into controller_scan for the directory to scan. It</span>
</span><span id="Mapper.__init__-347"><a href="#Mapper.__init__-347"><span class="linenos">347</span></a><span class="sd">            should be an absolute path if using the default</span>
</span><span id="Mapper.__init__-348"><a href="#Mapper.__init__-348"><span class="linenos">348</span></a><span class="sd">            ``controller_scan`` function.</span>
</span><span id="Mapper.__init__-349"><a href="#Mapper.__init__-349"><span class="linenos">349</span></a>
</span><span id="Mapper.__init__-350"><a href="#Mapper.__init__-350"><span class="linenos">350</span></a><span class="sd">        ``always_scan``</span>
</span><span id="Mapper.__init__-351"><a href="#Mapper.__init__-351"><span class="linenos">351</span></a><span class="sd">            Whether or not the ``controller_scan`` function should be</span>
</span><span id="Mapper.__init__-352"><a href="#Mapper.__init__-352"><span class="linenos">352</span></a><span class="sd">            run during every URL match. This is typically a good idea</span>
</span><span id="Mapper.__init__-353"><a href="#Mapper.__init__-353"><span class="linenos">353</span></a><span class="sd">            during development so the server won&#39;t need to be restarted</span>
</span><span id="Mapper.__init__-354"><a href="#Mapper.__init__-354"><span class="linenos">354</span></a><span class="sd">            anytime a controller is added.</span>
</span><span id="Mapper.__init__-355"><a href="#Mapper.__init__-355"><span class="linenos">355</span></a>
</span><span id="Mapper.__init__-356"><a href="#Mapper.__init__-356"><span class="linenos">356</span></a><span class="sd">        ``register``</span>
</span><span id="Mapper.__init__-357"><a href="#Mapper.__init__-357"><span class="linenos">357</span></a><span class="sd">            Boolean used to determine if the Mapper should use</span>
</span><span id="Mapper.__init__-358"><a href="#Mapper.__init__-358"><span class="linenos">358</span></a><span class="sd">            ``request_config`` to register itself as the mapper. Since</span>
</span><span id="Mapper.__init__-359"><a href="#Mapper.__init__-359"><span class="linenos">359</span></a><span class="sd">            it&#39;s done on a thread-local basis, this is typically best</span>
</span><span id="Mapper.__init__-360"><a href="#Mapper.__init__-360"><span class="linenos">360</span></a><span class="sd">            used during testing though it won&#39;t hurt in other cases.</span>
</span><span id="Mapper.__init__-361"><a href="#Mapper.__init__-361"><span class="linenos">361</span></a>
</span><span id="Mapper.__init__-362"><a href="#Mapper.__init__-362"><span class="linenos">362</span></a><span class="sd">        ``explicit``</span>
</span><span id="Mapper.__init__-363"><a href="#Mapper.__init__-363"><span class="linenos">363</span></a><span class="sd">            Boolean used to determine if routes should be connected</span>
</span><span id="Mapper.__init__-364"><a href="#Mapper.__init__-364"><span class="linenos">364</span></a><span class="sd">            with implicit defaults of::</span>
</span><span id="Mapper.__init__-365"><a href="#Mapper.__init__-365"><span class="linenos">365</span></a>
</span><span id="Mapper.__init__-366"><a href="#Mapper.__init__-366"><span class="linenos">366</span></a><span class="sd">                {&#39;controller&#39;:&#39;content&#39;,&#39;action&#39;:&#39;index&#39;,&#39;id&#39;:None}</span>
</span><span id="Mapper.__init__-367"><a href="#Mapper.__init__-367"><span class="linenos">367</span></a>
</span><span id="Mapper.__init__-368"><a href="#Mapper.__init__-368"><span class="linenos">368</span></a><span class="sd">            When set to True, these defaults will not be added to route</span>
</span><span id="Mapper.__init__-369"><a href="#Mapper.__init__-369"><span class="linenos">369</span></a><span class="sd">            connections and ``url_for`` will not use Route memory.</span>
</span><span id="Mapper.__init__-370"><a href="#Mapper.__init__-370"><span class="linenos">370</span></a>
</span><span id="Mapper.__init__-371"><a href="#Mapper.__init__-371"><span class="linenos">371</span></a><span class="sd">        Additional attributes that may be set after mapper</span>
</span><span id="Mapper.__init__-372"><a href="#Mapper.__init__-372"><span class="linenos">372</span></a><span class="sd">        initialization (ie, map.ATTRIBUTE = &#39;something&#39;):</span>
</span><span id="Mapper.__init__-373"><a href="#Mapper.__init__-373"><span class="linenos">373</span></a>
</span><span id="Mapper.__init__-374"><a href="#Mapper.__init__-374"><span class="linenos">374</span></a><span class="sd">        ``encoding``</span>
</span><span id="Mapper.__init__-375"><a href="#Mapper.__init__-375"><span class="linenos">375</span></a><span class="sd">            Used to indicate alternative encoding/decoding systems to</span>
</span><span id="Mapper.__init__-376"><a href="#Mapper.__init__-376"><span class="linenos">376</span></a><span class="sd">            use with both incoming URL&#39;s, and during Route generation</span>
</span><span id="Mapper.__init__-377"><a href="#Mapper.__init__-377"><span class="linenos">377</span></a><span class="sd">            when passed a Unicode string. Defaults to &#39;utf-8&#39;.</span>
</span><span id="Mapper.__init__-378"><a href="#Mapper.__init__-378"><span class="linenos">378</span></a>
</span><span id="Mapper.__init__-379"><a href="#Mapper.__init__-379"><span class="linenos">379</span></a><span class="sd">        ``decode_errors``</span>
</span><span id="Mapper.__init__-380"><a href="#Mapper.__init__-380"><span class="linenos">380</span></a><span class="sd">            How to handle errors in the encoding, generally ignoring</span>
</span><span id="Mapper.__init__-381"><a href="#Mapper.__init__-381"><span class="linenos">381</span></a><span class="sd">            any chars that don&#39;t convert should be sufficient. Defaults</span>
</span><span id="Mapper.__init__-382"><a href="#Mapper.__init__-382"><span class="linenos">382</span></a><span class="sd">            to &#39;ignore&#39;.</span>
</span><span id="Mapper.__init__-383"><a href="#Mapper.__init__-383"><span class="linenos">383</span></a>
</span><span id="Mapper.__init__-384"><a href="#Mapper.__init__-384"><span class="linenos">384</span></a><span class="sd">        ``minimization``</span>
</span><span id="Mapper.__init__-385"><a href="#Mapper.__init__-385"><span class="linenos">385</span></a><span class="sd">            Boolean used to indicate whether or not Routes should</span>
</span><span id="Mapper.__init__-386"><a href="#Mapper.__init__-386"><span class="linenos">386</span></a><span class="sd">            minimize URL&#39;s and the generated URL&#39;s, or require every</span>
</span><span id="Mapper.__init__-387"><a href="#Mapper.__init__-387"><span class="linenos">387</span></a><span class="sd">            part where it appears in the path. Defaults to False.</span>
</span><span id="Mapper.__init__-388"><a href="#Mapper.__init__-388"><span class="linenos">388</span></a>
</span><span id="Mapper.__init__-389"><a href="#Mapper.__init__-389"><span class="linenos">389</span></a><span class="sd">        ``hardcode_names``</span>
</span><span id="Mapper.__init__-390"><a href="#Mapper.__init__-390"><span class="linenos">390</span></a><span class="sd">            Whether or not Named Routes result in the default options</span>
</span><span id="Mapper.__init__-391"><a href="#Mapper.__init__-391"><span class="linenos">391</span></a><span class="sd">            for the route being used *or* if they actually force url</span>
</span><span id="Mapper.__init__-392"><a href="#Mapper.__init__-392"><span class="linenos">392</span></a><span class="sd">            generation to use the route. Defaults to False.</span>
</span><span id="Mapper.__init__-393"><a href="#Mapper.__init__-393"><span class="linenos">393</span></a>
</span><span id="Mapper.__init__-394"><a href="#Mapper.__init__-394"><span class="linenos">394</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Mapper.__init__-395"><a href="#Mapper.__init__-395"><span class="linenos">395</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">matchlist</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Mapper.__init__-396"><a href="#Mapper.__init__-396"><span class="linenos">396</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">maxkeys</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="Mapper.__init__-397"><a href="#Mapper.__init__-397"><span class="linenos">397</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">minkeys</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="Mapper.__init__-398"><a href="#Mapper.__init__-398"><span class="linenos">398</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">urlcache</span> <span class="o">=</span> <span class="n">LRUCache</span><span class="p">(</span><span class="mi">1600</span><span class="p">)</span>
</span><span id="Mapper.__init__-399"><a href="#Mapper.__init__-399"><span class="linenos">399</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_created_regs</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="Mapper.__init__-400"><a href="#Mapper.__init__-400"><span class="linenos">400</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_created_gens</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="Mapper.__init__-401"><a href="#Mapper.__init__-401"><span class="linenos">401</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_master_regexp</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Mapper.__init__-402"><a href="#Mapper.__init__-402"><span class="linenos">402</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">prefix</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Mapper.__init__-403"><a href="#Mapper.__init__-403"><span class="linenos">403</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">req_data</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">local</span><span class="p">()</span>
</span><span id="Mapper.__init__-404"><a href="#Mapper.__init__-404"><span class="linenos">404</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">directory</span> <span class="o">=</span> <span class="n">directory</span>
</span><span id="Mapper.__init__-405"><a href="#Mapper.__init__-405"><span class="linenos">405</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">always_scan</span> <span class="o">=</span> <span class="n">always_scan</span>
</span><span id="Mapper.__init__-406"><a href="#Mapper.__init__-406"><span class="linenos">406</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">controller_scan</span> <span class="o">=</span> <span class="n">controller_scan</span>
</span><span id="Mapper.__init__-407"><a href="#Mapper.__init__-407"><span class="linenos">407</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_regprefix</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Mapper.__init__-408"><a href="#Mapper.__init__-408"><span class="linenos">408</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_routenames</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="Mapper.__init__-409"><a href="#Mapper.__init__-409"><span class="linenos">409</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">debug</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="Mapper.__init__-410"><a href="#Mapper.__init__-410"><span class="linenos">410</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">append_slash</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="Mapper.__init__-411"><a href="#Mapper.__init__-411"><span class="linenos">411</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">sub_domains</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="Mapper.__init__-412"><a href="#Mapper.__init__-412"><span class="linenos">412</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">sub_domains_ignore</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Mapper.__init__-413"><a href="#Mapper.__init__-413"><span class="linenos">413</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">domain_match</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;[^\.\/]+?\.[^\.\/]+&#39;</span>
</span><span id="Mapper.__init__-414"><a href="#Mapper.__init__-414"><span class="linenos">414</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">explicit</span> <span class="o">=</span> <span class="n">explicit</span>
</span><span id="Mapper.__init__-415"><a href="#Mapper.__init__-415"><span class="linenos">415</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">encoding</span> <span class="o">=</span> <span class="s1">&#39;utf-8&#39;</span>
</span><span id="Mapper.__init__-416"><a href="#Mapper.__init__-416"><span class="linenos">416</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">decode_errors</span> <span class="o">=</span> <span class="s1">&#39;ignore&#39;</span>
</span><span id="Mapper.__init__-417"><a href="#Mapper.__init__-417"><span class="linenos">417</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">hardcode_names</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="Mapper.__init__-418"><a href="#Mapper.__init__-418"><span class="linenos">418</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">minimization</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="Mapper.__init__-419"><a href="#Mapper.__init__-419"><span class="linenos">419</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">create_regs_lock</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Lock</span><span class="p">()</span>
</span><span id="Mapper.__init__-420"><a href="#Mapper.__init__-420"><span class="linenos">420</span></a>        <span class="k">if</span> <span class="n">register</span><span class="p">:</span>
</span><span id="Mapper.__init__-421"><a href="#Mapper.__init__-421"><span class="linenos">421</span></a>            <span class="n">config</span> <span class="o">=</span> <span class="n">request_config</span><span class="p">()</span>
</span><span id="Mapper.__init__-422"><a href="#Mapper.__init__-422"><span class="linenos">422</span></a>            <span class="n">config</span><span class="o">.</span><span class="n">mapper</span> <span class="o">=</span> <span class="bp">self</span>
</span></pre></div>


            <div class="docstring"><p>Create a new Mapper instance</p>

<p>All keyword arguments are optional.</p>

<p><code><a href="#Mapper.controller_scan">controller_scan</a></code>
    Function reference that will be used to return a list of
    valid controllers used during URL matching. If
    <code><a href="#Mapper.directory">directory</a></code> keyword arg is present, it will be passed
    into the function during its call. This option defaults to
    a function that will scan a directory for controllers.</p>

<pre><code>Alternatively, a list of controllers or None can be passed
in which are assumed to be the definitive list of
controller names valid when matching 'controller'.
</code></pre>

<p><code><a href="#Mapper.directory">directory</a></code>
    Passed into controller_scan for the directory to scan. It
    should be an absolute path if using the default
    <code><a href="#Mapper.controller_scan">controller_scan</a></code> function.</p>

<p><code><a href="#Mapper.always_scan">always_scan</a></code>
    Whether or not the <code><a href="#Mapper.controller_scan">controller_scan</a></code> function should be
    run during every URL match. This is typically a good idea
    during development so the server won't need to be restarted
    anytime a controller is added.</p>

<p><code>register</code>
    Boolean used to determine if the Mapper should use
    <code><a href="#request_config">request_config</a></code> to register itself as the mapper. Since
    it's done on a thread-local basis, this is typically best
    used during testing though it won't hurt in other cases.</p>

<p><code><a href="#Mapper.explicit">explicit</a></code>
    Boolean used to determine if routes should be connected
    with implicit defaults of::</p>

<pre><code>    {'controller':'content','action':'index','id':None}

When set to True, these defaults will not be added to route
connections and ``url_for`` will not use Route memory.
</code></pre>

<p>Additional attributes that may be set after mapper
initialization (ie, map.ATTRIBUTE = 'something'):</p>

<p><code><a href="#Mapper.encoding">encoding</a></code>
    Used to indicate alternative encoding/decoding systems to
    use with both incoming URL's, and during Route generation
    when passed a Unicode string. Defaults to 'utf-8'.</p>

<p><code><a href="#Mapper.decode_errors">decode_errors</a></code>
    How to handle errors in the encoding, generally ignoring
    any chars that don't convert should be sufficient. Defaults
    to 'ignore'.</p>

<p><code><a href="#Mapper.minimization">minimization</a></code>
    Boolean used to indicate whether or not Routes should
    minimize URL's and the generated URL's, or require every
    part where it appears in the path. Defaults to False.</p>

<p><code><a href="#Mapper.hardcode_names">hardcode_names</a></code>
    Whether or not Named Routes result in the default options
    for the route being used <em>or</em> if they actually force url
    generation to use the route. Defaults to False.</p>
</div>


                            </div>
                            <div id="Mapper.matchlist" class="classattr">
                                <div class="attr variable">
            <span class="name">matchlist</span>

        
    </div>
    <a class="headerlink" href="#Mapper.matchlist"></a>
    
    

                            </div>
                            <div id="Mapper.maxkeys" class="classattr">
                                <div class="attr variable">
            <span class="name">maxkeys</span>

        
    </div>
    <a class="headerlink" href="#Mapper.maxkeys"></a>
    
    

                            </div>
                            <div id="Mapper.minkeys" class="classattr">
                                <div class="attr variable">
            <span class="name">minkeys</span>

        
    </div>
    <a class="headerlink" href="#Mapper.minkeys"></a>
    
    

                            </div>
                            <div id="Mapper.urlcache" class="classattr">
                                <div class="attr variable">
            <span class="name">urlcache</span>

        
    </div>
    <a class="headerlink" href="#Mapper.urlcache"></a>
    
    

                            </div>
                            <div id="Mapper.prefix" class="classattr">
                                <div class="attr variable">
            <span class="name">prefix</span>

        
    </div>
    <a class="headerlink" href="#Mapper.prefix"></a>
    
    

                            </div>
                            <div id="Mapper.req_data" class="classattr">
                                <div class="attr variable">
            <span class="name">req_data</span>

        
    </div>
    <a class="headerlink" href="#Mapper.req_data"></a>
    
    

                            </div>
                            <div id="Mapper.directory" class="classattr">
                                <div class="attr variable">
            <span class="name">directory</span>

        
    </div>
    <a class="headerlink" href="#Mapper.directory"></a>
    
    

                            </div>
                            <div id="Mapper.always_scan" class="classattr">
                                <div class="attr variable">
            <span class="name">always_scan</span>

        
    </div>
    <a class="headerlink" href="#Mapper.always_scan"></a>
    
    

                            </div>
                            <div id="Mapper.controller_scan" class="classattr">
                                <div class="attr variable">
            <span class="name">controller_scan</span>

        
    </div>
    <a class="headerlink" href="#Mapper.controller_scan"></a>
    
    

                            </div>
                            <div id="Mapper.debug" class="classattr">
                                <div class="attr variable">
            <span class="name">debug</span>

        
    </div>
    <a class="headerlink" href="#Mapper.debug"></a>
    
    

                            </div>
                            <div id="Mapper.append_slash" class="classattr">
                                <div class="attr variable">
            <span class="name">append_slash</span>

        
    </div>
    <a class="headerlink" href="#Mapper.append_slash"></a>
    
    

                            </div>
                            <div id="Mapper.sub_domains" class="classattr">
                                <div class="attr variable">
            <span class="name">sub_domains</span>

        
    </div>
    <a class="headerlink" href="#Mapper.sub_domains"></a>
    
    

                            </div>
                            <div id="Mapper.sub_domains_ignore" class="classattr">
                                <div class="attr variable">
            <span class="name">sub_domains_ignore</span>

        
    </div>
    <a class="headerlink" href="#Mapper.sub_domains_ignore"></a>
    
    

                            </div>
                            <div id="Mapper.domain_match" class="classattr">
                                <div class="attr variable">
            <span class="name">domain_match</span>

        
    </div>
    <a class="headerlink" href="#Mapper.domain_match"></a>
    
    

                            </div>
                            <div id="Mapper.explicit" class="classattr">
                                <div class="attr variable">
            <span class="name">explicit</span>

        
    </div>
    <a class="headerlink" href="#Mapper.explicit"></a>
    
    

                            </div>
                            <div id="Mapper.encoding" class="classattr">
                                <div class="attr variable">
            <span class="name">encoding</span>

        
    </div>
    <a class="headerlink" href="#Mapper.encoding"></a>
    
    

                            </div>
                            <div id="Mapper.decode_errors" class="classattr">
                                <div class="attr variable">
            <span class="name">decode_errors</span>

        
    </div>
    <a class="headerlink" href="#Mapper.decode_errors"></a>
    
    

                            </div>
                            <div id="Mapper.hardcode_names" class="classattr">
                                <div class="attr variable">
            <span class="name">hardcode_names</span>

        
    </div>
    <a class="headerlink" href="#Mapper.hardcode_names"></a>
    
    

                            </div>
                            <div id="Mapper.minimization" class="classattr">
                                <div class="attr variable">
            <span class="name">minimization</span>

        
    </div>
    <a class="headerlink" href="#Mapper.minimization"></a>
    
    

                            </div>
                            <div id="Mapper.create_regs_lock" class="classattr">
                                <div class="attr variable">
            <span class="name">create_regs_lock</span>

        
    </div>
    <a class="headerlink" href="#Mapper.create_regs_lock"></a>
    
    

                            </div>
                            <div id="Mapper.environ" class="classattr">
                                        <input id="Mapper.environ-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">environ</span>

                <label class="view-source-button" for="Mapper.environ-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Mapper.environ"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Mapper.environ-446"><a href="#Mapper.environ-446"><span class="linenos">446</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_envget</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Mapper.environ-447"><a href="#Mapper.environ-447"><span class="linenos">447</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="Mapper.environ-448"><a href="#Mapper.environ-448"><span class="linenos">448</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">req_data</span><span class="o">.</span><span class="n">environ</span>
</span><span id="Mapper.environ-449"><a href="#Mapper.environ-449"><span class="linenos">449</span></a>        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
</span><span id="Mapper.environ-450"><a href="#Mapper.environ-450"><span class="linenos">450</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span></pre></div>


    

                            </div>
                            <div id="Mapper.extend" class="classattr">
                                        <input id="Mapper.extend-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">extend</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">routes</span>, </span><span class="param"><span class="n">path_prefix</span><span class="o">=</span><span class="s1">&#39;&#39;</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Mapper.extend-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Mapper.extend"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Mapper.extend-459"><a href="#Mapper.extend-459"><span class="linenos">459</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">extend</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">routes</span><span class="p">,</span> <span class="n">path_prefix</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
</span><span id="Mapper.extend-460"><a href="#Mapper.extend-460"><span class="linenos">460</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Extends the mapper routes with a list of Route objects</span>
</span><span id="Mapper.extend-461"><a href="#Mapper.extend-461"><span class="linenos">461</span></a>
</span><span id="Mapper.extend-462"><a href="#Mapper.extend-462"><span class="linenos">462</span></a><span class="sd">        If a path_prefix is provided, all the routes will have their</span>
</span><span id="Mapper.extend-463"><a href="#Mapper.extend-463"><span class="linenos">463</span></a><span class="sd">        path prepended with the path_prefix.</span>
</span><span id="Mapper.extend-464"><a href="#Mapper.extend-464"><span class="linenos">464</span></a>
</span><span id="Mapper.extend-465"><a href="#Mapper.extend-465"><span class="linenos">465</span></a><span class="sd">        Example::</span>
</span><span id="Mapper.extend-466"><a href="#Mapper.extend-466"><span class="linenos">466</span></a>
</span><span id="Mapper.extend-467"><a href="#Mapper.extend-467"><span class="linenos">467</span></a><span class="sd">            &gt;&gt;&gt; map = Mapper(controller_scan=None)</span>
</span><span id="Mapper.extend-468"><a href="#Mapper.extend-468"><span class="linenos">468</span></a><span class="sd">            &gt;&gt;&gt; map.connect(&#39;home&#39;, &#39;/&#39;, controller=&#39;home&#39;, action=&#39;splash&#39;)</span>
</span><span id="Mapper.extend-469"><a href="#Mapper.extend-469"><span class="linenos">469</span></a><span class="sd">            &gt;&gt;&gt; map.matchlist[0].name == &#39;home&#39;</span>
</span><span id="Mapper.extend-470"><a href="#Mapper.extend-470"><span class="linenos">470</span></a><span class="sd">            True</span>
</span><span id="Mapper.extend-471"><a href="#Mapper.extend-471"><span class="linenos">471</span></a><span class="sd">            &gt;&gt;&gt; routes = [Route(&#39;index&#39;, &#39;/index.htm&#39;, controller=&#39;home&#39;,</span>
</span><span id="Mapper.extend-472"><a href="#Mapper.extend-472"><span class="linenos">472</span></a><span class="sd">            ...                 action=&#39;index&#39;)]</span>
</span><span id="Mapper.extend-473"><a href="#Mapper.extend-473"><span class="linenos">473</span></a><span class="sd">            &gt;&gt;&gt; map.extend(routes)</span>
</span><span id="Mapper.extend-474"><a href="#Mapper.extend-474"><span class="linenos">474</span></a><span class="sd">            &gt;&gt;&gt; len(map.matchlist) == 2</span>
</span><span id="Mapper.extend-475"><a href="#Mapper.extend-475"><span class="linenos">475</span></a><span class="sd">            True</span>
</span><span id="Mapper.extend-476"><a href="#Mapper.extend-476"><span class="linenos">476</span></a><span class="sd">            &gt;&gt;&gt; map.extend(routes, path_prefix=&#39;/subapp&#39;)</span>
</span><span id="Mapper.extend-477"><a href="#Mapper.extend-477"><span class="linenos">477</span></a><span class="sd">            &gt;&gt;&gt; len(map.matchlist) == 3</span>
</span><span id="Mapper.extend-478"><a href="#Mapper.extend-478"><span class="linenos">478</span></a><span class="sd">            True</span>
</span><span id="Mapper.extend-479"><a href="#Mapper.extend-479"><span class="linenos">479</span></a><span class="sd">            &gt;&gt;&gt; map.matchlist[2].routepath == &#39;/subapp/index.htm&#39;</span>
</span><span id="Mapper.extend-480"><a href="#Mapper.extend-480"><span class="linenos">480</span></a><span class="sd">            True</span>
</span><span id="Mapper.extend-481"><a href="#Mapper.extend-481"><span class="linenos">481</span></a>
</span><span id="Mapper.extend-482"><a href="#Mapper.extend-482"><span class="linenos">482</span></a><span class="sd">        .. note::</span>
</span><span id="Mapper.extend-483"><a href="#Mapper.extend-483"><span class="linenos">483</span></a>
</span><span id="Mapper.extend-484"><a href="#Mapper.extend-484"><span class="linenos">484</span></a><span class="sd">            This function does not merely extend the mapper with the</span>
</span><span id="Mapper.extend-485"><a href="#Mapper.extend-485"><span class="linenos">485</span></a><span class="sd">            given list of routes, it actually creates new routes with</span>
</span><span id="Mapper.extend-486"><a href="#Mapper.extend-486"><span class="linenos">486</span></a><span class="sd">            identical calling arguments.</span>
</span><span id="Mapper.extend-487"><a href="#Mapper.extend-487"><span class="linenos">487</span></a>
</span><span id="Mapper.extend-488"><a href="#Mapper.extend-488"><span class="linenos">488</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Mapper.extend-489"><a href="#Mapper.extend-489"><span class="linenos">489</span></a>        <span class="k">for</span> <span class="n">route</span> <span class="ow">in</span> <span class="n">routes</span><span class="p">:</span>
</span><span id="Mapper.extend-490"><a href="#Mapper.extend-490"><span class="linenos">490</span></a>            <span class="k">if</span> <span class="n">path_prefix</span> <span class="ow">and</span> <span class="n">route</span><span class="o">.</span><span class="n">minimization</span><span class="p">:</span>
</span><span id="Mapper.extend-491"><a href="#Mapper.extend-491"><span class="linenos">491</span></a>                <span class="n">routepath</span> <span class="o">=</span> <span class="s1">&#39;/&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">path_prefix</span><span class="p">,</span> <span class="n">route</span><span class="o">.</span><span class="n">routepath</span><span class="p">])</span>
</span><span id="Mapper.extend-492"><a href="#Mapper.extend-492"><span class="linenos">492</span></a>            <span class="k">elif</span> <span class="n">path_prefix</span><span class="p">:</span>
</span><span id="Mapper.extend-493"><a href="#Mapper.extend-493"><span class="linenos">493</span></a>                <span class="n">routepath</span> <span class="o">=</span> <span class="n">path_prefix</span> <span class="o">+</span> <span class="n">route</span><span class="o">.</span><span class="n">routepath</span>
</span><span id="Mapper.extend-494"><a href="#Mapper.extend-494"><span class="linenos">494</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Mapper.extend-495"><a href="#Mapper.extend-495"><span class="linenos">495</span></a>                <span class="n">routepath</span> <span class="o">=</span> <span class="n">route</span><span class="o">.</span><span class="n">routepath</span>
</span><span id="Mapper.extend-496"><a href="#Mapper.extend-496"><span class="linenos">496</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">route</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
</span><span id="Mapper.extend-497"><a href="#Mapper.extend-497"><span class="linenos">497</span></a>                         <span class="n">routepath</span><span class="p">,</span>
</span><span id="Mapper.extend-498"><a href="#Mapper.extend-498"><span class="linenos">498</span></a>                         <span class="n">conditions</span><span class="o">=</span><span class="n">route</span><span class="o">.</span><span class="n">conditions</span><span class="p">,</span>
</span><span id="Mapper.extend-499"><a href="#Mapper.extend-499"><span class="linenos">499</span></a>                         <span class="o">**</span><span class="n">route</span><span class="o">.</span><span class="n">_kargs</span>
</span><span id="Mapper.extend-500"><a href="#Mapper.extend-500"><span class="linenos">500</span></a>                         <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Extends the mapper routes with a list of Route objects</p>

<p>If a path_prefix is provided, all the routes will have their
path prepended with the path_prefix.</p>

<p>Example::</p>

<pre><code>&gt;&gt;&gt; map = Mapper(controller_scan=None)
&gt;&gt;&gt; map.connect('home', '/', controller='home', action='splash')
&gt;&gt;&gt; map.matchlist[0].name == 'home'
True
&gt;&gt;&gt; routes = [Route('index', '/index.htm', controller='home',
...                 action='index')]
&gt;&gt;&gt; map.extend(routes)
&gt;&gt;&gt; len(map.matchlist) == 2
True
&gt;&gt;&gt; map.extend(routes, path_prefix='/subapp')
&gt;&gt;&gt; len(map.matchlist) == 3
True
&gt;&gt;&gt; map.matchlist[2].routepath == '/subapp/index.htm'
True
</code></pre>

<div class="alert note">

<p>This function does not merely extend the mapper with the
given list of routes, it actually creates new routes with
identical calling arguments.</p>

</div>
</div>


                            </div>
                            <div id="Mapper.make_route" class="classattr">
                                        <input id="Mapper.make_route-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">make_route</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="o">*</span><span class="n">args</span>, </span><span class="param"><span class="o">**</span><span class="n">kargs</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Mapper.make_route-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Mapper.make_route"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Mapper.make_route-502"><a href="#Mapper.make_route-502"><span class="linenos">502</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">make_route</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">):</span>
</span><span id="Mapper.make_route-503"><a href="#Mapper.make_route-503"><span class="linenos">503</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Make a new Route object</span>
</span><span id="Mapper.make_route-504"><a href="#Mapper.make_route-504"><span class="linenos">504</span></a>
</span><span id="Mapper.make_route-505"><a href="#Mapper.make_route-505"><span class="linenos">505</span></a><span class="sd">        A subclass can override this method to use a custom Route class.</span>
</span><span id="Mapper.make_route-506"><a href="#Mapper.make_route-506"><span class="linenos">506</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Mapper.make_route-507"><a href="#Mapper.make_route-507"><span class="linenos">507</span></a>        <span class="k">return</span> <span class="n">Route</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Make a new Route object</p>

<p>A subclass can override this method to use a custom Route class.</p>
</div>


                            </div>
                            <div id="Mapper.connect" class="classattr">
                                        <input id="Mapper.connect-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">connect</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="o">*</span><span class="n">args</span>, </span><span class="param"><span class="o">**</span><span class="n">kargs</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Mapper.connect-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Mapper.connect"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Mapper.connect-509"><a href="#Mapper.connect-509"><span class="linenos">509</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">connect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">):</span>
</span><span id="Mapper.connect-510"><a href="#Mapper.connect-510"><span class="linenos">510</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create and connect a new Route to the Mapper.</span>
</span><span id="Mapper.connect-511"><a href="#Mapper.connect-511"><span class="linenos">511</span></a>
</span><span id="Mapper.connect-512"><a href="#Mapper.connect-512"><span class="linenos">512</span></a><span class="sd">        Usage:</span>
</span><span id="Mapper.connect-513"><a href="#Mapper.connect-513"><span class="linenos">513</span></a>
</span><span id="Mapper.connect-514"><a href="#Mapper.connect-514"><span class="linenos">514</span></a><span class="sd">        .. code-block:: python</span>
</span><span id="Mapper.connect-515"><a href="#Mapper.connect-515"><span class="linenos">515</span></a>
</span><span id="Mapper.connect-516"><a href="#Mapper.connect-516"><span class="linenos">516</span></a><span class="sd">            m = Mapper()</span>
</span><span id="Mapper.connect-517"><a href="#Mapper.connect-517"><span class="linenos">517</span></a><span class="sd">            m.connect(&#39;:controller/:action/:id&#39;)</span>
</span><span id="Mapper.connect-518"><a href="#Mapper.connect-518"><span class="linenos">518</span></a><span class="sd">            m.connect(&#39;date/:year/:month/:day&#39;, controller=&quot;blog&quot;,</span>
</span><span id="Mapper.connect-519"><a href="#Mapper.connect-519"><span class="linenos">519</span></a><span class="sd">                      action=&quot;view&quot;)</span>
</span><span id="Mapper.connect-520"><a href="#Mapper.connect-520"><span class="linenos">520</span></a><span class="sd">            m.connect(&#39;archives/:page&#39;, controller=&quot;blog&quot;, action=&quot;by_page&quot;,</span>
</span><span id="Mapper.connect-521"><a href="#Mapper.connect-521"><span class="linenos">521</span></a><span class="sd">            requirements = { &#39;page&#39;:&#39;\\d{1,2}&#39; })</span>
</span><span id="Mapper.connect-522"><a href="#Mapper.connect-522"><span class="linenos">522</span></a><span class="sd">            m.connect(&#39;category_list&#39;, &#39;archives/category/:section&#39;,</span>
</span><span id="Mapper.connect-523"><a href="#Mapper.connect-523"><span class="linenos">523</span></a><span class="sd">                      controller=&#39;blog&#39;, action=&#39;category&#39;,</span>
</span><span id="Mapper.connect-524"><a href="#Mapper.connect-524"><span class="linenos">524</span></a><span class="sd">                      section=&#39;home&#39;, type=&#39;list&#39;)</span>
</span><span id="Mapper.connect-525"><a href="#Mapper.connect-525"><span class="linenos">525</span></a><span class="sd">            m.connect(&#39;home&#39;, &#39;&#39;, controller=&#39;blog&#39;, action=&#39;view&#39;,</span>
</span><span id="Mapper.connect-526"><a href="#Mapper.connect-526"><span class="linenos">526</span></a><span class="sd">                      section=&#39;home&#39;)</span>
</span><span id="Mapper.connect-527"><a href="#Mapper.connect-527"><span class="linenos">527</span></a>
</span><span id="Mapper.connect-528"><a href="#Mapper.connect-528"><span class="linenos">528</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Mapper.connect-529"><a href="#Mapper.connect-529"><span class="linenos">529</span></a>        <span class="n">routename</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Mapper.connect-530"><a href="#Mapper.connect-530"><span class="linenos">530</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="Mapper.connect-531"><a href="#Mapper.connect-531"><span class="linenos">531</span></a>            <span class="n">routename</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Mapper.connect-532"><a href="#Mapper.connect-532"><span class="linenos">532</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Mapper.connect-533"><a href="#Mapper.connect-533"><span class="linenos">533</span></a>            <span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="kc">None</span><span class="p">,)</span> <span class="o">+</span> <span class="n">args</span>
</span><span id="Mapper.connect-534"><a href="#Mapper.connect-534"><span class="linenos">534</span></a>        <span class="k">if</span> <span class="s1">&#39;_explicit&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kargs</span><span class="p">:</span>
</span><span id="Mapper.connect-535"><a href="#Mapper.connect-535"><span class="linenos">535</span></a>            <span class="n">kargs</span><span class="p">[</span><span class="s1">&#39;_explicit&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">explicit</span>
</span><span id="Mapper.connect-536"><a href="#Mapper.connect-536"><span class="linenos">536</span></a>        <span class="k">if</span> <span class="s1">&#39;_minimize&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kargs</span><span class="p">:</span>
</span><span id="Mapper.connect-537"><a href="#Mapper.connect-537"><span class="linenos">537</span></a>            <span class="n">kargs</span><span class="p">[</span><span class="s1">&#39;_minimize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">minimization</span>
</span><span id="Mapper.connect-538"><a href="#Mapper.connect-538"><span class="linenos">538</span></a>        <span class="n">route</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_route</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">)</span>
</span><span id="Mapper.connect-539"><a href="#Mapper.connect-539"><span class="linenos">539</span></a>
</span><span id="Mapper.connect-540"><a href="#Mapper.connect-540"><span class="linenos">540</span></a>        <span class="c1"># Apply encoding and errors if its not the defaults and the route</span>
</span><span id="Mapper.connect-541"><a href="#Mapper.connect-541"><span class="linenos">541</span></a>        <span class="c1"># didn&#39;t have one passed in.</span>
</span><span id="Mapper.connect-542"><a href="#Mapper.connect-542"><span class="linenos">542</span></a>        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">encoding</span> <span class="o">!=</span> <span class="s1">&#39;utf-8&#39;</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">decode_errors</span> <span class="o">!=</span> <span class="s1">&#39;ignore&#39;</span><span class="p">)</span> <span class="ow">and</span> \
</span><span id="Mapper.connect-543"><a href="#Mapper.connect-543"><span class="linenos">543</span></a>           <span class="s1">&#39;_encoding&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kargs</span><span class="p">:</span>
</span><span id="Mapper.connect-544"><a href="#Mapper.connect-544"><span class="linenos">544</span></a>            <span class="n">route</span><span class="o">.</span><span class="n">encoding</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">encoding</span>
</span><span id="Mapper.connect-545"><a href="#Mapper.connect-545"><span class="linenos">545</span></a>            <span class="n">route</span><span class="o">.</span><span class="n">decode_errors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">decode_errors</span>
</span><span id="Mapper.connect-546"><a href="#Mapper.connect-546"><span class="linenos">546</span></a>
</span><span id="Mapper.connect-547"><a href="#Mapper.connect-547"><span class="linenos">547</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">route</span><span class="o">.</span><span class="n">static</span><span class="p">:</span>
</span><span id="Mapper.connect-548"><a href="#Mapper.connect-548"><span class="linenos">548</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">matchlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">route</span><span class="p">)</span>
</span><span id="Mapper.connect-549"><a href="#Mapper.connect-549"><span class="linenos">549</span></a>
</span><span id="Mapper.connect-550"><a href="#Mapper.connect-550"><span class="linenos">550</span></a>        <span class="k">if</span> <span class="n">routename</span><span class="p">:</span>
</span><span id="Mapper.connect-551"><a href="#Mapper.connect-551"><span class="linenos">551</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_routenames</span><span class="p">[</span><span class="n">routename</span><span class="p">]</span> <span class="o">=</span> <span class="n">route</span>
</span><span id="Mapper.connect-552"><a href="#Mapper.connect-552"><span class="linenos">552</span></a>            <span class="n">route</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">routename</span>
</span><span id="Mapper.connect-553"><a href="#Mapper.connect-553"><span class="linenos">553</span></a>        <span class="k">if</span> <span class="n">route</span><span class="o">.</span><span class="n">static</span><span class="p">:</span>
</span><span id="Mapper.connect-554"><a href="#Mapper.connect-554"><span class="linenos">554</span></a>            <span class="k">return</span>
</span><span id="Mapper.connect-555"><a href="#Mapper.connect-555"><span class="linenos">555</span></a>        <span class="n">exists</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="Mapper.connect-556"><a href="#Mapper.connect-556"><span class="linenos">556</span></a>        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">maxkeys</span><span class="p">:</span>
</span><span id="Mapper.connect-557"><a href="#Mapper.connect-557"><span class="linenos">557</span></a>            <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="n">route</span><span class="o">.</span><span class="n">maxkeys</span><span class="p">:</span>
</span><span id="Mapper.connect-558"><a href="#Mapper.connect-558"><span class="linenos">558</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">maxkeys</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">route</span><span class="p">)</span>
</span><span id="Mapper.connect-559"><a href="#Mapper.connect-559"><span class="linenos">559</span></a>                <span class="n">exists</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="Mapper.connect-560"><a href="#Mapper.connect-560"><span class="linenos">560</span></a>                <span class="k">break</span>
</span><span id="Mapper.connect-561"><a href="#Mapper.connect-561"><span class="linenos">561</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">exists</span><span class="p">:</span>
</span><span id="Mapper.connect-562"><a href="#Mapper.connect-562"><span class="linenos">562</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">maxkeys</span><span class="p">[</span><span class="n">route</span><span class="o">.</span><span class="n">maxkeys</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">route</span><span class="p">]</span>
</span><span id="Mapper.connect-563"><a href="#Mapper.connect-563"><span class="linenos">563</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_created_gens</span> <span class="o">=</span> <span class="kc">False</span>
</span></pre></div>


            <div class="docstring"><p>Create and connect a new Route to the Mapper.</p>

<p>Usage:</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="n">m</span> <span class="o">=</span> <span class="n">Mapper</span><span class="p">()</span>
<span class="n">m</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;:controller/:action/:id&#39;</span><span class="p">)</span>
<span class="n">m</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;date/:year/:month/:day&#39;</span><span class="p">,</span> <span class="n">controller</span><span class="o">=</span><span class="s2">&quot;blog&quot;</span><span class="p">,</span>
          <span class="n">action</span><span class="o">=</span><span class="s2">&quot;view&quot;</span><span class="p">)</span>
<span class="n">m</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;archives/:page&#39;</span><span class="p">,</span> <span class="n">controller</span><span class="o">=</span><span class="s2">&quot;blog&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;by_page&quot;</span><span class="p">,</span>
<span class="n">requirements</span> <span class="o">=</span> <span class="p">{</span> <span class="s1">&#39;page&#39;</span><span class="p">:</span><span class="s1">&#39;\d{1,2}&#39;</span> <span class="p">})</span>
<span class="n">m</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;category_list&#39;</span><span class="p">,</span> <span class="s1">&#39;archives/category/:section&#39;</span><span class="p">,</span>
          <span class="n">controller</span><span class="o">=</span><span class="s1">&#39;blog&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;category&#39;</span><span class="p">,</span>
          <span class="n">section</span><span class="o">=</span><span class="s1">&#39;home&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;list&#39;</span><span class="p">)</span>
<span class="n">m</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;home&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">controller</span><span class="o">=</span><span class="s1">&#39;blog&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;view&#39;</span><span class="p">,</span>
          <span class="n">section</span><span class="o">=</span><span class="s1">&#39;home&#39;</span><span class="p">)</span>
</code></pre>
</div>
</div>


                            </div>
                            <div id="Mapper.create_regs" class="classattr">
                                        <input id="Mapper.create_regs-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">create_regs</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="o">*</span><span class="n">args</span>, </span><span class="param"><span class="o">**</span><span class="n">kwargs</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Mapper.create_regs-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Mapper.create_regs"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Mapper.create_regs-607"><a href="#Mapper.create_regs-607"><span class="linenos">607</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">create_regs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="Mapper.create_regs-608"><a href="#Mapper.create_regs-608"><span class="linenos">608</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Atomically creates regular expressions for all connected</span>
</span><span id="Mapper.create_regs-609"><a href="#Mapper.create_regs-609"><span class="linenos">609</span></a><span class="sd">        routes</span>
</span><span id="Mapper.create_regs-610"><a href="#Mapper.create_regs-610"><span class="linenos">610</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Mapper.create_regs-611"><a href="#Mapper.create_regs-611"><span class="linenos">611</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">create_regs_lock</span><span class="o">.</span><span class="n">acquire</span><span class="p">()</span>
</span><span id="Mapper.create_regs-612"><a href="#Mapper.create_regs-612"><span class="linenos">612</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="Mapper.create_regs-613"><a href="#Mapper.create_regs-613"><span class="linenos">613</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_create_regs</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="Mapper.create_regs-614"><a href="#Mapper.create_regs-614"><span class="linenos">614</span></a>        <span class="k">finally</span><span class="p">:</span>
</span><span id="Mapper.create_regs-615"><a href="#Mapper.create_regs-615"><span class="linenos">615</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">create_regs_lock</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Atomically creates regular expressions for all connected
routes</p>
</div>


                            </div>
                            <div id="Mapper.match" class="classattr">
                                        <input id="Mapper.match-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">match</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">url</span><span class="o">=</span><span class="kc">None</span>, </span><span class="param"><span class="n">environ</span><span class="o">=</span><span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Mapper.match-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Mapper.match"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Mapper.match-723"><a href="#Mapper.match-723"><span class="linenos">723</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">match</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">environ</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="Mapper.match-724"><a href="#Mapper.match-724"><span class="linenos">724</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Match a URL against against one of the routes contained.</span>
</span><span id="Mapper.match-725"><a href="#Mapper.match-725"><span class="linenos">725</span></a>
</span><span id="Mapper.match-726"><a href="#Mapper.match-726"><span class="linenos">726</span></a><span class="sd">        Will return None if no valid match is found.</span>
</span><span id="Mapper.match-727"><a href="#Mapper.match-727"><span class="linenos">727</span></a>
</span><span id="Mapper.match-728"><a href="#Mapper.match-728"><span class="linenos">728</span></a><span class="sd">        .. code-block:: python</span>
</span><span id="Mapper.match-729"><a href="#Mapper.match-729"><span class="linenos">729</span></a>
</span><span id="Mapper.match-730"><a href="#Mapper.match-730"><span class="linenos">730</span></a><span class="sd">            resultdict = m.match(&#39;/joe/sixpack&#39;)</span>
</span><span id="Mapper.match-731"><a href="#Mapper.match-731"><span class="linenos">731</span></a>
</span><span id="Mapper.match-732"><a href="#Mapper.match-732"><span class="linenos">732</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Mapper.match-733"><a href="#Mapper.match-733"><span class="linenos">733</span></a>        <span class="k">if</span> <span class="n">url</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">environ</span><span class="p">:</span>
</span><span id="Mapper.match-734"><a href="#Mapper.match-734"><span class="linenos">734</span></a>            <span class="k">raise</span> <span class="n">RoutesException</span><span class="p">(</span><span class="s1">&#39;URL or environ must be provided&#39;</span><span class="p">)</span>
</span><span id="Mapper.match-735"><a href="#Mapper.match-735"><span class="linenos">735</span></a>
</span><span id="Mapper.match-736"><a href="#Mapper.match-736"><span class="linenos">736</span></a>        <span class="k">if</span> <span class="n">url</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Mapper.match-737"><a href="#Mapper.match-737"><span class="linenos">737</span></a>            <span class="n">url</span> <span class="o">=</span> <span class="n">environ</span><span class="p">[</span><span class="s1">&#39;PATH_INFO&#39;</span><span class="p">]</span>
</span><span id="Mapper.match-738"><a href="#Mapper.match-738"><span class="linenos">738</span></a>
</span><span id="Mapper.match-739"><a href="#Mapper.match-739"><span class="linenos">739</span></a>        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_match</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">environ</span><span class="p">)</span>
</span><span id="Mapper.match-740"><a href="#Mapper.match-740"><span class="linenos">740</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
</span><span id="Mapper.match-741"><a href="#Mapper.match-741"><span class="linenos">741</span></a>            <span class="k">return</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">result</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">result</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
</span><span id="Mapper.match-742"><a href="#Mapper.match-742"><span class="linenos">742</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">or</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
</span><span id="Mapper.match-743"><a href="#Mapper.match-743"><span class="linenos">743</span></a>            <span class="k">return</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Mapper.match-744"><a href="#Mapper.match-744"><span class="linenos">744</span></a>        <span class="k">return</span> <span class="kc">None</span>
</span></pre></div>


            <div class="docstring"><p>Match a URL against against one of the routes contained.</p>

<p>Will return None if no valid match is found.</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="n">resultdict</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s1">&#39;/joe/sixpack&#39;</span><span class="p">)</span>
</code></pre>
</div>
</div>


                            </div>
                            <div id="Mapper.routematch" class="classattr">
                                        <input id="Mapper.routematch-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">routematch</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">url</span><span class="o">=</span><span class="kc">None</span>, </span><span class="param"><span class="n">environ</span><span class="o">=</span><span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Mapper.routematch-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Mapper.routematch"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Mapper.routematch-746"><a href="#Mapper.routematch-746"><span class="linenos">746</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">routematch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">environ</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="Mapper.routematch-747"><a href="#Mapper.routematch-747"><span class="linenos">747</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Match a URL against against one of the routes contained.</span>
</span><span id="Mapper.routematch-748"><a href="#Mapper.routematch-748"><span class="linenos">748</span></a>
</span><span id="Mapper.routematch-749"><a href="#Mapper.routematch-749"><span class="linenos">749</span></a><span class="sd">        Will return None if no valid match is found, otherwise a</span>
</span><span id="Mapper.routematch-750"><a href="#Mapper.routematch-750"><span class="linenos">750</span></a><span class="sd">        result dict and a route object is returned.</span>
</span><span id="Mapper.routematch-751"><a href="#Mapper.routematch-751"><span class="linenos">751</span></a>
</span><span id="Mapper.routematch-752"><a href="#Mapper.routematch-752"><span class="linenos">752</span></a><span class="sd">        .. code-block:: python</span>
</span><span id="Mapper.routematch-753"><a href="#Mapper.routematch-753"><span class="linenos">753</span></a>
</span><span id="Mapper.routematch-754"><a href="#Mapper.routematch-754"><span class="linenos">754</span></a><span class="sd">            resultdict, route_obj = m.match(&#39;/joe/sixpack&#39;)</span>
</span><span id="Mapper.routematch-755"><a href="#Mapper.routematch-755"><span class="linenos">755</span></a>
</span><span id="Mapper.routematch-756"><a href="#Mapper.routematch-756"><span class="linenos">756</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Mapper.routematch-757"><a href="#Mapper.routematch-757"><span class="linenos">757</span></a>        <span class="k">if</span> <span class="n">url</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">environ</span><span class="p">:</span>
</span><span id="Mapper.routematch-758"><a href="#Mapper.routematch-758"><span class="linenos">758</span></a>            <span class="k">raise</span> <span class="n">RoutesException</span><span class="p">(</span><span class="s1">&#39;URL or environ must be provided&#39;</span><span class="p">)</span>
</span><span id="Mapper.routematch-759"><a href="#Mapper.routematch-759"><span class="linenos">759</span></a>
</span><span id="Mapper.routematch-760"><a href="#Mapper.routematch-760"><span class="linenos">760</span></a>        <span class="k">if</span> <span class="n">url</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Mapper.routematch-761"><a href="#Mapper.routematch-761"><span class="linenos">761</span></a>            <span class="n">url</span> <span class="o">=</span> <span class="n">environ</span><span class="p">[</span><span class="s1">&#39;PATH_INFO&#39;</span><span class="p">]</span>
</span><span id="Mapper.routematch-762"><a href="#Mapper.routematch-762"><span class="linenos">762</span></a>        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_match</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">environ</span><span class="p">)</span>
</span><span id="Mapper.routematch-763"><a href="#Mapper.routematch-763"><span class="linenos">763</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
</span><span id="Mapper.routematch-764"><a href="#Mapper.routematch-764"><span class="linenos">764</span></a>            <span class="k">return</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">result</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">result</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
</span><span id="Mapper.routematch-765"><a href="#Mapper.routematch-765"><span class="linenos">765</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">or</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
</span><span id="Mapper.routematch-766"><a href="#Mapper.routematch-766"><span class="linenos">766</span></a>            <span class="k">return</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">result</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="Mapper.routematch-767"><a href="#Mapper.routematch-767"><span class="linenos">767</span></a>        <span class="k">return</span> <span class="kc">None</span>
</span></pre></div>


            <div class="docstring"><p>Match a URL against against one of the routes contained.</p>

<p>Will return None if no valid match is found, otherwise a
result dict and a route object is returned.</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="n">resultdict</span><span class="p">,</span> <span class="n">route_obj</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s1">&#39;/joe/sixpack&#39;</span><span class="p">)</span>
</code></pre>
</div>
</div>


                            </div>
                            <div id="Mapper.generate" class="classattr">
                                        <input id="Mapper.generate-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">generate</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="o">*</span><span class="n">args</span>, </span><span class="param"><span class="o">**</span><span class="n">kargs</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Mapper.generate-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Mapper.generate"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Mapper.generate-769"><a href="#Mapper.generate-769"><span class="linenos">769</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">generate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">):</span>
</span><span id="Mapper.generate-770"><a href="#Mapper.generate-770"><span class="linenos">770</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate a route from a set of keywords</span>
</span><span id="Mapper.generate-771"><a href="#Mapper.generate-771"><span class="linenos">771</span></a>
</span><span id="Mapper.generate-772"><a href="#Mapper.generate-772"><span class="linenos">772</span></a><span class="sd">        Returns the url text, or None if no URL could be generated.</span>
</span><span id="Mapper.generate-773"><a href="#Mapper.generate-773"><span class="linenos">773</span></a>
</span><span id="Mapper.generate-774"><a href="#Mapper.generate-774"><span class="linenos">774</span></a><span class="sd">        .. code-block:: python</span>
</span><span id="Mapper.generate-775"><a href="#Mapper.generate-775"><span class="linenos">775</span></a>
</span><span id="Mapper.generate-776"><a href="#Mapper.generate-776"><span class="linenos">776</span></a><span class="sd">            m.generate(controller=&#39;content&#39;,action=&#39;view&#39;,id=10)</span>
</span><span id="Mapper.generate-777"><a href="#Mapper.generate-777"><span class="linenos">777</span></a>
</span><span id="Mapper.generate-778"><a href="#Mapper.generate-778"><span class="linenos">778</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Mapper.generate-779"><a href="#Mapper.generate-779"><span class="linenos">779</span></a>        <span class="c1"># Generate ourself if we haven&#39;t already</span>
</span><span id="Mapper.generate-780"><a href="#Mapper.generate-780"><span class="linenos">780</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_created_gens</span><span class="p">:</span>
</span><span id="Mapper.generate-781"><a href="#Mapper.generate-781"><span class="linenos">781</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_create_gens</span><span class="p">()</span>
</span><span id="Mapper.generate-782"><a href="#Mapper.generate-782"><span class="linenos">782</span></a>
</span><span id="Mapper.generate-783"><a href="#Mapper.generate-783"><span class="linenos">783</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">append_slash</span><span class="p">:</span>
</span><span id="Mapper.generate-784"><a href="#Mapper.generate-784"><span class="linenos">784</span></a>            <span class="n">kargs</span><span class="p">[</span><span class="s1">&#39;_append_slash&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="Mapper.generate-785"><a href="#Mapper.generate-785"><span class="linenos">785</span></a>
</span><span id="Mapper.generate-786"><a href="#Mapper.generate-786"><span class="linenos">786</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">explicit</span><span class="p">:</span>
</span><span id="Mapper.generate-787"><a href="#Mapper.generate-787"><span class="linenos">787</span></a>            <span class="k">if</span> <span class="s1">&#39;controller&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kargs</span><span class="p">:</span>
</span><span id="Mapper.generate-788"><a href="#Mapper.generate-788"><span class="linenos">788</span></a>                <span class="n">kargs</span><span class="p">[</span><span class="s1">&#39;controller&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;content&#39;</span>
</span><span id="Mapper.generate-789"><a href="#Mapper.generate-789"><span class="linenos">789</span></a>            <span class="k">if</span> <span class="s1">&#39;action&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kargs</span><span class="p">:</span>
</span><span id="Mapper.generate-790"><a href="#Mapper.generate-790"><span class="linenos">790</span></a>                <span class="n">kargs</span><span class="p">[</span><span class="s1">&#39;action&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;index&#39;</span>
</span><span id="Mapper.generate-791"><a href="#Mapper.generate-791"><span class="linenos">791</span></a>
</span><span id="Mapper.generate-792"><a href="#Mapper.generate-792"><span class="linenos">792</span></a>        <span class="n">environ</span> <span class="o">=</span> <span class="n">kargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;_environ&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">environ</span><span class="p">)</span> <span class="ow">or</span> <span class="p">{}</span>
</span><span id="Mapper.generate-793"><a href="#Mapper.generate-793"><span class="linenos">793</span></a>        <span class="k">if</span> <span class="s1">&#39;SCRIPT_NAME&#39;</span> <span class="ow">in</span> <span class="n">environ</span><span class="p">:</span>
</span><span id="Mapper.generate-794"><a href="#Mapper.generate-794"><span class="linenos">794</span></a>            <span class="n">script_name</span> <span class="o">=</span> <span class="n">environ</span><span class="p">[</span><span class="s1">&#39;SCRIPT_NAME&#39;</span><span class="p">]</span>
</span><span id="Mapper.generate-795"><a href="#Mapper.generate-795"><span class="linenos">795</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">environ</span> <span class="ow">and</span> <span class="s1">&#39;SCRIPT_NAME&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">environ</span><span class="p">:</span>
</span><span id="Mapper.generate-796"><a href="#Mapper.generate-796"><span class="linenos">796</span></a>            <span class="n">script_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;SCRIPT_NAME&#39;</span><span class="p">]</span>
</span><span id="Mapper.generate-797"><a href="#Mapper.generate-797"><span class="linenos">797</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Mapper.generate-798"><a href="#Mapper.generate-798"><span class="linenos">798</span></a>            <span class="n">script_name</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="Mapper.generate-799"><a href="#Mapper.generate-799"><span class="linenos">799</span></a>        <span class="n">controller</span> <span class="o">=</span> <span class="n">kargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;controller&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="Mapper.generate-800"><a href="#Mapper.generate-800"><span class="linenos">800</span></a>        <span class="n">action</span> <span class="o">=</span> <span class="n">kargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;action&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="Mapper.generate-801"><a href="#Mapper.generate-801"><span class="linenos">801</span></a>
</span><span id="Mapper.generate-802"><a href="#Mapper.generate-802"><span class="linenos">802</span></a>        <span class="c1"># If the URL didn&#39;t depend on the SCRIPT_NAME, we&#39;ll cache it</span>
</span><span id="Mapper.generate-803"><a href="#Mapper.generate-803"><span class="linenos">803</span></a>        <span class="c1"># keyed by just by kargs; otherwise we need to cache it with</span>
</span><span id="Mapper.generate-804"><a href="#Mapper.generate-804"><span class="linenos">804</span></a>        <span class="c1"># both SCRIPT_NAME and kargs:</span>
</span><span id="Mapper.generate-805"><a href="#Mapper.generate-805"><span class="linenos">805</span></a>        <span class="n">cache_key</span> <span class="o">=</span> <span class="n">six</span><span class="o">.</span><span class="n">text_type</span><span class="p">(</span><span class="n">args</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf8&#39;</span><span class="p">)</span> <span class="o">+</span> \
</span><span id="Mapper.generate-806"><a href="#Mapper.generate-806"><span class="linenos">806</span></a>            <span class="n">six</span><span class="o">.</span><span class="n">text_type</span><span class="p">(</span><span class="n">kargs</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf8&#39;</span><span class="p">)</span>
</span><span id="Mapper.generate-807"><a href="#Mapper.generate-807"><span class="linenos">807</span></a>
</span><span id="Mapper.generate-808"><a href="#Mapper.generate-808"><span class="linenos">808</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">urlcache</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Mapper.generate-809"><a href="#Mapper.generate-809"><span class="linenos">809</span></a>            <span class="k">if</span> <span class="n">six</span><span class="o">.</span><span class="n">PY3</span><span class="p">:</span>
</span><span id="Mapper.generate-810"><a href="#Mapper.generate-810"><span class="linenos">810</span></a>                <span class="n">cache_key_script_name</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;:&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">((</span><span class="n">script_name</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">),</span>
</span><span id="Mapper.generate-811"><a href="#Mapper.generate-811"><span class="linenos">811</span></a>                                                   <span class="n">cache_key</span><span class="p">))</span>
</span><span id="Mapper.generate-812"><a href="#Mapper.generate-812"><span class="linenos">812</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Mapper.generate-813"><a href="#Mapper.generate-813"><span class="linenos">813</span></a>                <span class="n">cache_key_script_name</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">:</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">script_name</span><span class="p">,</span> <span class="n">cache_key</span><span class="p">)</span>
</span><span id="Mapper.generate-814"><a href="#Mapper.generate-814"><span class="linenos">814</span></a>
</span><span id="Mapper.generate-815"><a href="#Mapper.generate-815"><span class="linenos">815</span></a>            <span class="c1"># Check the url cache to see if it exists, use it if it does</span>
</span><span id="Mapper.generate-816"><a href="#Mapper.generate-816"><span class="linenos">816</span></a>            <span class="n">val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">urlcache</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">cache_key_script_name</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
</span><span id="Mapper.generate-817"><a href="#Mapper.generate-817"><span class="linenos">817</span></a>            <span class="k">if</span> <span class="n">val</span> <span class="o">!=</span> <span class="bp">self</span><span class="p">:</span>
</span><span id="Mapper.generate-818"><a href="#Mapper.generate-818"><span class="linenos">818</span></a>                <span class="k">return</span> <span class="n">val</span>
</span><span id="Mapper.generate-819"><a href="#Mapper.generate-819"><span class="linenos">819</span></a>
</span><span id="Mapper.generate-820"><a href="#Mapper.generate-820"><span class="linenos">820</span></a>        <span class="n">controller</span> <span class="o">=</span> <span class="n">as_unicode</span><span class="p">(</span><span class="n">controller</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">encoding</span><span class="p">)</span>
</span><span id="Mapper.generate-821"><a href="#Mapper.generate-821"><span class="linenos">821</span></a>        <span class="n">action</span> <span class="o">=</span> <span class="n">as_unicode</span><span class="p">(</span><span class="n">action</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">encoding</span><span class="p">)</span>
</span><span id="Mapper.generate-822"><a href="#Mapper.generate-822"><span class="linenos">822</span></a>
</span><span id="Mapper.generate-823"><a href="#Mapper.generate-823"><span class="linenos">823</span></a>        <span class="n">actionlist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_gendict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">controller</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_gendict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="p">{})</span>
</span><span id="Mapper.generate-824"><a href="#Mapper.generate-824"><span class="linenos">824</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">actionlist</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">args</span><span class="p">:</span>
</span><span id="Mapper.generate-825"><a href="#Mapper.generate-825"><span class="linenos">825</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="Mapper.generate-826"><a href="#Mapper.generate-826"><span class="linenos">826</span></a>        <span class="p">(</span><span class="n">keylist</span><span class="p">,</span> <span class="n">sortcache</span><span class="p">)</span> <span class="o">=</span> <span class="n">actionlist</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">action</span><span class="p">)</span> <span class="ow">or</span> \
</span><span id="Mapper.generate-827"><a href="#Mapper.generate-827"><span class="linenos">827</span></a>            <span class="n">actionlist</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="p">{}))</span>
</span><span id="Mapper.generate-828"><a href="#Mapper.generate-828"><span class="linenos">828</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">keylist</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">args</span><span class="p">:</span>
</span><span id="Mapper.generate-829"><a href="#Mapper.generate-829"><span class="linenos">829</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="Mapper.generate-830"><a href="#Mapper.generate-830"><span class="linenos">830</span></a>
</span><span id="Mapper.generate-831"><a href="#Mapper.generate-831"><span class="linenos">831</span></a>        <span class="n">keys</span> <span class="o">=</span> <span class="nb">frozenset</span><span class="p">(</span><span class="n">kargs</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</span><span id="Mapper.generate-832"><a href="#Mapper.generate-832"><span class="linenos">832</span></a>        <span class="n">cacheset</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="Mapper.generate-833"><a href="#Mapper.generate-833"><span class="linenos">833</span></a>        <span class="n">cachekey</span> <span class="o">=</span> <span class="n">six</span><span class="o">.</span><span class="n">text_type</span><span class="p">(</span><span class="n">keys</span><span class="p">)</span>
</span><span id="Mapper.generate-834"><a href="#Mapper.generate-834"><span class="linenos">834</span></a>        <span class="n">cachelist</span> <span class="o">=</span> <span class="n">sortcache</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">cachekey</span><span class="p">)</span>
</span><span id="Mapper.generate-835"><a href="#Mapper.generate-835"><span class="linenos">835</span></a>        <span class="k">if</span> <span class="n">args</span><span class="p">:</span>
</span><span id="Mapper.generate-836"><a href="#Mapper.generate-836"><span class="linenos">836</span></a>            <span class="n">keylist</span> <span class="o">=</span> <span class="n">args</span>
</span><span id="Mapper.generate-837"><a href="#Mapper.generate-837"><span class="linenos">837</span></a>        <span class="k">elif</span> <span class="n">cachelist</span><span class="p">:</span>
</span><span id="Mapper.generate-838"><a href="#Mapper.generate-838"><span class="linenos">838</span></a>            <span class="n">keylist</span> <span class="o">=</span> <span class="n">cachelist</span>
</span><span id="Mapper.generate-839"><a href="#Mapper.generate-839"><span class="linenos">839</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Mapper.generate-840"><a href="#Mapper.generate-840"><span class="linenos">840</span></a>            <span class="n">cacheset</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="Mapper.generate-841"><a href="#Mapper.generate-841"><span class="linenos">841</span></a>            <span class="n">newlist</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Mapper.generate-842"><a href="#Mapper.generate-842"><span class="linenos">842</span></a>            <span class="k">for</span> <span class="n">route</span> <span class="ow">in</span> <span class="n">keylist</span><span class="p">:</span>
</span><span id="Mapper.generate-843"><a href="#Mapper.generate-843"><span class="linenos">843</span></a>                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">route</span><span class="o">.</span><span class="n">minkeys</span> <span class="o">-</span> <span class="n">route</span><span class="o">.</span><span class="n">dotkeys</span> <span class="o">-</span> <span class="n">keys</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Mapper.generate-844"><a href="#Mapper.generate-844"><span class="linenos">844</span></a>                    <span class="n">newlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">route</span><span class="p">)</span>
</span><span id="Mapper.generate-845"><a href="#Mapper.generate-845"><span class="linenos">845</span></a>            <span class="n">keylist</span> <span class="o">=</span> <span class="n">newlist</span>
</span><span id="Mapper.generate-846"><a href="#Mapper.generate-846"><span class="linenos">846</span></a>
</span><span id="Mapper.generate-847"><a href="#Mapper.generate-847"><span class="linenos">847</span></a>            <span class="k">class</span><span class="w"> </span><span class="nc">KeySorter</span><span class="p">:</span>
</span><span id="Mapper.generate-848"><a href="#Mapper.generate-848"><span class="linenos">848</span></a>
</span><span id="Mapper.generate-849"><a href="#Mapper.generate-849"><span class="linenos">849</span></a>                <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
</span><span id="Mapper.generate-850"><a href="#Mapper.generate-850"><span class="linenos">850</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">obj</span> <span class="o">=</span> <span class="n">obj</span>
</span><span id="Mapper.generate-851"><a href="#Mapper.generate-851"><span class="linenos">851</span></a>
</span><span id="Mapper.generate-852"><a href="#Mapper.generate-852"><span class="linenos">852</span></a>                <span class="k">def</span><span class="w"> </span><span class="fm">__lt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
</span><span id="Mapper.generate-853"><a href="#Mapper.generate-853"><span class="linenos">853</span></a>                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_keysort</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">obj</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">obj</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span>
</span><span id="Mapper.generate-854"><a href="#Mapper.generate-854"><span class="linenos">854</span></a>
</span><span id="Mapper.generate-855"><a href="#Mapper.generate-855"><span class="linenos">855</span></a>                <span class="k">def</span><span class="w"> </span><span class="nf">_keysort</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
</span><span id="Mapper.generate-856"><a href="#Mapper.generate-856"><span class="linenos">856</span></a><span class="w">                    </span><span class="sd">&quot;&quot;&quot;Sorts two sets of sets, to order them ideally for</span>
</span><span id="Mapper.generate-857"><a href="#Mapper.generate-857"><span class="linenos">857</span></a><span class="sd">                    matching.&quot;&quot;&quot;</span>
</span><span id="Mapper.generate-858"><a href="#Mapper.generate-858"><span class="linenos">858</span></a>                    <span class="n">a</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">maxkeys</span>
</span><span id="Mapper.generate-859"><a href="#Mapper.generate-859"><span class="linenos">859</span></a>                    <span class="n">b</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">maxkeys</span>
</span><span id="Mapper.generate-860"><a href="#Mapper.generate-860"><span class="linenos">860</span></a>
</span><span id="Mapper.generate-861"><a href="#Mapper.generate-861"><span class="linenos">861</span></a>                    <span class="n">lendiffa</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">keys</span> <span class="o">^</span> <span class="n">a</span><span class="p">)</span>
</span><span id="Mapper.generate-862"><a href="#Mapper.generate-862"><span class="linenos">862</span></a>                    <span class="n">lendiffb</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">keys</span> <span class="o">^</span> <span class="n">b</span><span class="p">)</span>
</span><span id="Mapper.generate-863"><a href="#Mapper.generate-863"><span class="linenos">863</span></a>                    <span class="c1"># If they both match, don&#39;t switch them</span>
</span><span id="Mapper.generate-864"><a href="#Mapper.generate-864"><span class="linenos">864</span></a>                    <span class="k">if</span> <span class="n">lendiffa</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">lendiffb</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Mapper.generate-865"><a href="#Mapper.generate-865"><span class="linenos">865</span></a>                        <span class="k">return</span> <span class="mi">0</span>
</span><span id="Mapper.generate-866"><a href="#Mapper.generate-866"><span class="linenos">866</span></a>
</span><span id="Mapper.generate-867"><a href="#Mapper.generate-867"><span class="linenos">867</span></a>                    <span class="c1"># First, if a matches exactly, use it</span>
</span><span id="Mapper.generate-868"><a href="#Mapper.generate-868"><span class="linenos">868</span></a>                    <span class="k">if</span> <span class="n">lendiffa</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Mapper.generate-869"><a href="#Mapper.generate-869"><span class="linenos">869</span></a>                        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>
</span><span id="Mapper.generate-870"><a href="#Mapper.generate-870"><span class="linenos">870</span></a>
</span><span id="Mapper.generate-871"><a href="#Mapper.generate-871"><span class="linenos">871</span></a>                    <span class="c1"># Or b matches exactly, use it</span>
</span><span id="Mapper.generate-872"><a href="#Mapper.generate-872"><span class="linenos">872</span></a>                    <span class="k">if</span> <span class="n">lendiffb</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Mapper.generate-873"><a href="#Mapper.generate-873"><span class="linenos">873</span></a>                        <span class="k">return</span> <span class="mi">1</span>
</span><span id="Mapper.generate-874"><a href="#Mapper.generate-874"><span class="linenos">874</span></a>
</span><span id="Mapper.generate-875"><a href="#Mapper.generate-875"><span class="linenos">875</span></a>                    <span class="c1"># Neither matches exactly, return the one with the most in</span>
</span><span id="Mapper.generate-876"><a href="#Mapper.generate-876"><span class="linenos">876</span></a>                    <span class="c1"># common</span>
</span><span id="Mapper.generate-877"><a href="#Mapper.generate-877"><span class="linenos">877</span></a>                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compare</span><span class="p">(</span><span class="n">lendiffa</span><span class="p">,</span> <span class="n">lendiffb</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Mapper.generate-878"><a href="#Mapper.generate-878"><span class="linenos">878</span></a>                        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compare</span><span class="p">(</span><span class="n">lendiffa</span><span class="p">,</span> <span class="n">lendiffb</span><span class="p">)</span>
</span><span id="Mapper.generate-879"><a href="#Mapper.generate-879"><span class="linenos">879</span></a>
</span><span id="Mapper.generate-880"><a href="#Mapper.generate-880"><span class="linenos">880</span></a>                    <span class="c1"># Neither matches exactly, but if they both have just as</span>
</span><span id="Mapper.generate-881"><a href="#Mapper.generate-881"><span class="linenos">881</span></a>                    <span class="c1"># much in common</span>
</span><span id="Mapper.generate-882"><a href="#Mapper.generate-882"><span class="linenos">882</span></a>                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">keys</span> <span class="o">&amp;</span> <span class="n">b</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">keys</span> <span class="o">&amp;</span> <span class="n">a</span><span class="p">):</span>
</span><span id="Mapper.generate-883"><a href="#Mapper.generate-883"><span class="linenos">883</span></a>                        <span class="c1"># Then we return the shortest of the two</span>
</span><span id="Mapper.generate-884"><a href="#Mapper.generate-884"><span class="linenos">884</span></a>                        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compare</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">b</span><span class="p">))</span>
</span><span id="Mapper.generate-885"><a href="#Mapper.generate-885"><span class="linenos">885</span></a>
</span><span id="Mapper.generate-886"><a href="#Mapper.generate-886"><span class="linenos">886</span></a>                    <span class="c1"># Otherwise, we return the one that has the most in common</span>
</span><span id="Mapper.generate-887"><a href="#Mapper.generate-887"><span class="linenos">887</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="Mapper.generate-888"><a href="#Mapper.generate-888"><span class="linenos">888</span></a>                        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compare</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">keys</span> <span class="o">&amp;</span> <span class="n">b</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">keys</span> <span class="o">&amp;</span> <span class="n">a</span><span class="p">))</span>
</span><span id="Mapper.generate-889"><a href="#Mapper.generate-889"><span class="linenos">889</span></a>
</span><span id="Mapper.generate-890"><a href="#Mapper.generate-890"><span class="linenos">890</span></a>                <span class="k">def</span><span class="w"> </span><span class="nf">_compare</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj1</span><span class="p">,</span> <span class="n">obj2</span><span class="p">):</span>
</span><span id="Mapper.generate-891"><a href="#Mapper.generate-891"><span class="linenos">891</span></a>                    <span class="k">if</span> <span class="n">obj1</span> <span class="o">&lt;</span> <span class="n">obj2</span><span class="p">:</span>
</span><span id="Mapper.generate-892"><a href="#Mapper.generate-892"><span class="linenos">892</span></a>                        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>
</span><span id="Mapper.generate-893"><a href="#Mapper.generate-893"><span class="linenos">893</span></a>                    <span class="k">elif</span> <span class="n">obj1</span> <span class="o">&lt;</span> <span class="n">obj2</span><span class="p">:</span>
</span><span id="Mapper.generate-894"><a href="#Mapper.generate-894"><span class="linenos">894</span></a>                        <span class="k">return</span> <span class="mi">1</span>
</span><span id="Mapper.generate-895"><a href="#Mapper.generate-895"><span class="linenos">895</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="Mapper.generate-896"><a href="#Mapper.generate-896"><span class="linenos">896</span></a>                        <span class="k">return</span> <span class="mi">0</span>
</span><span id="Mapper.generate-897"><a href="#Mapper.generate-897"><span class="linenos">897</span></a>
</span><span id="Mapper.generate-898"><a href="#Mapper.generate-898"><span class="linenos">898</span></a>            <span class="n">keylist</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="n">KeySorter</span><span class="p">)</span>
</span><span id="Mapper.generate-899"><a href="#Mapper.generate-899"><span class="linenos">899</span></a>            <span class="k">if</span> <span class="n">cacheset</span><span class="p">:</span>
</span><span id="Mapper.generate-900"><a href="#Mapper.generate-900"><span class="linenos">900</span></a>                <span class="n">sortcache</span><span class="p">[</span><span class="n">cachekey</span><span class="p">]</span> <span class="o">=</span> <span class="n">keylist</span>
</span><span id="Mapper.generate-901"><a href="#Mapper.generate-901"><span class="linenos">901</span></a>
</span><span id="Mapper.generate-902"><a href="#Mapper.generate-902"><span class="linenos">902</span></a>        <span class="c1"># Iterate through the keylist of sorted routes (or a single route if</span>
</span><span id="Mapper.generate-903"><a href="#Mapper.generate-903"><span class="linenos">903</span></a>        <span class="c1"># it was passed in explicitly for hardcoded named routes)</span>
</span><span id="Mapper.generate-904"><a href="#Mapper.generate-904"><span class="linenos">904</span></a>        <span class="k">for</span> <span class="n">route</span> <span class="ow">in</span> <span class="n">keylist</span><span class="p">:</span>
</span><span id="Mapper.generate-905"><a href="#Mapper.generate-905"><span class="linenos">905</span></a>            <span class="n">fail</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="Mapper.generate-906"><a href="#Mapper.generate-906"><span class="linenos">906</span></a>            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">route</span><span class="o">.</span><span class="n">hardcoded</span><span class="p">:</span>
</span><span id="Mapper.generate-907"><a href="#Mapper.generate-907"><span class="linenos">907</span></a>                <span class="n">kval</span> <span class="o">=</span> <span class="n">kargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
</span><span id="Mapper.generate-908"><a href="#Mapper.generate-908"><span class="linenos">908</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">kval</span><span class="p">:</span>
</span><span id="Mapper.generate-909"><a href="#Mapper.generate-909"><span class="linenos">909</span></a>                    <span class="k">continue</span>
</span><span id="Mapper.generate-910"><a href="#Mapper.generate-910"><span class="linenos">910</span></a>                <span class="n">kval</span> <span class="o">=</span> <span class="n">as_unicode</span><span class="p">(</span><span class="n">kval</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">encoding</span><span class="p">)</span>
</span><span id="Mapper.generate-911"><a href="#Mapper.generate-911"><span class="linenos">911</span></a>                <span class="k">if</span> <span class="n">kval</span> <span class="o">!=</span> <span class="n">route</span><span class="o">.</span><span class="n">defaults</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="ow">and</span> \
</span><span id="Mapper.generate-912"><a href="#Mapper.generate-912"><span class="linenos">912</span></a>                        <span class="ow">not</span> <span class="nb">callable</span><span class="p">(</span><span class="n">route</span><span class="o">.</span><span class="n">defaults</span><span class="p">[</span><span class="n">key</span><span class="p">]):</span>
</span><span id="Mapper.generate-913"><a href="#Mapper.generate-913"><span class="linenos">913</span></a>                    <span class="n">fail</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="Mapper.generate-914"><a href="#Mapper.generate-914"><span class="linenos">914</span></a>                    <span class="k">break</span>
</span><span id="Mapper.generate-915"><a href="#Mapper.generate-915"><span class="linenos">915</span></a>            <span class="k">if</span> <span class="n">fail</span><span class="p">:</span>
</span><span id="Mapper.generate-916"><a href="#Mapper.generate-916"><span class="linenos">916</span></a>                <span class="k">continue</span>
</span><span id="Mapper.generate-917"><a href="#Mapper.generate-917"><span class="linenos">917</span></a>            <span class="n">path</span> <span class="o">=</span> <span class="n">route</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="o">**</span><span class="n">kargs</span><span class="p">)</span>
</span><span id="Mapper.generate-918"><a href="#Mapper.generate-918"><span class="linenos">918</span></a>            <span class="k">if</span> <span class="n">path</span><span class="p">:</span>
</span><span id="Mapper.generate-919"><a href="#Mapper.generate-919"><span class="linenos">919</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prefix</span><span class="p">:</span>
</span><span id="Mapper.generate-920"><a href="#Mapper.generate-920"><span class="linenos">920</span></a>                    <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prefix</span> <span class="o">+</span> <span class="n">path</span>
</span><span id="Mapper.generate-921"><a href="#Mapper.generate-921"><span class="linenos">921</span></a>                <span class="n">external_static</span> <span class="o">=</span> <span class="n">route</span><span class="o">.</span><span class="n">static</span> <span class="ow">and</span> <span class="n">route</span><span class="o">.</span><span class="n">external</span>
</span><span id="Mapper.generate-922"><a href="#Mapper.generate-922"><span class="linenos">922</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">route</span><span class="o">.</span><span class="n">absolute</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">external_static</span><span class="p">:</span>
</span><span id="Mapper.generate-923"><a href="#Mapper.generate-923"><span class="linenos">923</span></a>                    <span class="n">path</span> <span class="o">=</span> <span class="n">script_name</span> <span class="o">+</span> <span class="n">path</span>
</span><span id="Mapper.generate-924"><a href="#Mapper.generate-924"><span class="linenos">924</span></a>                    <span class="n">key</span> <span class="o">=</span> <span class="n">cache_key_script_name</span>
</span><span id="Mapper.generate-925"><a href="#Mapper.generate-925"><span class="linenos">925</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="Mapper.generate-926"><a href="#Mapper.generate-926"><span class="linenos">926</span></a>                    <span class="n">key</span> <span class="o">=</span> <span class="n">cache_key</span>
</span><span id="Mapper.generate-927"><a href="#Mapper.generate-927"><span class="linenos">927</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">urlcache</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Mapper.generate-928"><a href="#Mapper.generate-928"><span class="linenos">928</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">urlcache</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">path</span><span class="p">))</span>
</span><span id="Mapper.generate-929"><a href="#Mapper.generate-929"><span class="linenos">929</span></a>                <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</span><span id="Mapper.generate-930"><a href="#Mapper.generate-930"><span class="linenos">930</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Mapper.generate-931"><a href="#Mapper.generate-931"><span class="linenos">931</span></a>                <span class="k">continue</span>
</span><span id="Mapper.generate-932"><a href="#Mapper.generate-932"><span class="linenos">932</span></a>        <span class="k">return</span> <span class="kc">None</span>
</span></pre></div>


            <div class="docstring"><p>Generate a route from a set of keywords</p>

<p>Returns the url text, or None if no URL could be generated.</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="n">m</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="n">controller</span><span class="o">=</span><span class="s1">&#39;content&#39;</span><span class="p">,</span><span class="n">action</span><span class="o">=</span><span class="s1">&#39;view&#39;</span><span class="p">,</span><span class="nb">id</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</code></pre>
</div>
</div>


                            </div>
                            <div id="Mapper.resource" class="classattr">
                                        <input id="Mapper.resource-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">resource</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">member_name</span>, </span><span class="param"><span class="n">collection_name</span>, </span><span class="param"><span class="o">**</span><span class="n">kwargs</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Mapper.resource-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Mapper.resource"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Mapper.resource-934"><a href="#Mapper.resource-934"><span class="linenos"> 934</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">resource</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">member_name</span><span class="p">,</span> <span class="n">collection_name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="Mapper.resource-935"><a href="#Mapper.resource-935"><span class="linenos"> 935</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate routes for a controller resource</span>
</span><span id="Mapper.resource-936"><a href="#Mapper.resource-936"><span class="linenos"> 936</span></a>
</span><span id="Mapper.resource-937"><a href="#Mapper.resource-937"><span class="linenos"> 937</span></a><span class="sd">        The member_name name should be the appropriate singular version</span>
</span><span id="Mapper.resource-938"><a href="#Mapper.resource-938"><span class="linenos"> 938</span></a><span class="sd">        of the resource given your locale and used with members of the</span>
</span><span id="Mapper.resource-939"><a href="#Mapper.resource-939"><span class="linenos"> 939</span></a><span class="sd">        collection. The collection_name name will be used to refer to</span>
</span><span id="Mapper.resource-940"><a href="#Mapper.resource-940"><span class="linenos"> 940</span></a><span class="sd">        the resource collection methods and should be a plural version</span>
</span><span id="Mapper.resource-941"><a href="#Mapper.resource-941"><span class="linenos"> 941</span></a><span class="sd">        of the member_name argument. By default, the member_name name</span>
</span><span id="Mapper.resource-942"><a href="#Mapper.resource-942"><span class="linenos"> 942</span></a><span class="sd">        will also be assumed to map to a controller you create.</span>
</span><span id="Mapper.resource-943"><a href="#Mapper.resource-943"><span class="linenos"> 943</span></a>
</span><span id="Mapper.resource-944"><a href="#Mapper.resource-944"><span class="linenos"> 944</span></a><span class="sd">        The concept of a web resource maps somewhat directly to &#39;CRUD&#39;</span>
</span><span id="Mapper.resource-945"><a href="#Mapper.resource-945"><span class="linenos"> 945</span></a><span class="sd">        operations. The overlying things to keep in mind is that</span>
</span><span id="Mapper.resource-946"><a href="#Mapper.resource-946"><span class="linenos"> 946</span></a><span class="sd">        mapping a resource is about handling creating, viewing, and</span>
</span><span id="Mapper.resource-947"><a href="#Mapper.resource-947"><span class="linenos"> 947</span></a><span class="sd">        editing that resource.</span>
</span><span id="Mapper.resource-948"><a href="#Mapper.resource-948"><span class="linenos"> 948</span></a>
</span><span id="Mapper.resource-949"><a href="#Mapper.resource-949"><span class="linenos"> 949</span></a><span class="sd">        All keyword arguments are optional.</span>
</span><span id="Mapper.resource-950"><a href="#Mapper.resource-950"><span class="linenos"> 950</span></a>
</span><span id="Mapper.resource-951"><a href="#Mapper.resource-951"><span class="linenos"> 951</span></a><span class="sd">        ``controller``</span>
</span><span id="Mapper.resource-952"><a href="#Mapper.resource-952"><span class="linenos"> 952</span></a><span class="sd">            If specified in the keyword args, the controller will be</span>
</span><span id="Mapper.resource-953"><a href="#Mapper.resource-953"><span class="linenos"> 953</span></a><span class="sd">            the actual controller used, but the rest of the naming</span>
</span><span id="Mapper.resource-954"><a href="#Mapper.resource-954"><span class="linenos"> 954</span></a><span class="sd">            conventions used for the route names and URL paths are</span>
</span><span id="Mapper.resource-955"><a href="#Mapper.resource-955"><span class="linenos"> 955</span></a><span class="sd">            unchanged.</span>
</span><span id="Mapper.resource-956"><a href="#Mapper.resource-956"><span class="linenos"> 956</span></a>
</span><span id="Mapper.resource-957"><a href="#Mapper.resource-957"><span class="linenos"> 957</span></a><span class="sd">        ``collection``</span>
</span><span id="Mapper.resource-958"><a href="#Mapper.resource-958"><span class="linenos"> 958</span></a><span class="sd">            Additional action mappings used to manipulate/view the</span>
</span><span id="Mapper.resource-959"><a href="#Mapper.resource-959"><span class="linenos"> 959</span></a><span class="sd">            entire set of resources provided by the controller.</span>
</span><span id="Mapper.resource-960"><a href="#Mapper.resource-960"><span class="linenos"> 960</span></a>
</span><span id="Mapper.resource-961"><a href="#Mapper.resource-961"><span class="linenos"> 961</span></a><span class="sd">            Example::</span>
</span><span id="Mapper.resource-962"><a href="#Mapper.resource-962"><span class="linenos"> 962</span></a>
</span><span id="Mapper.resource-963"><a href="#Mapper.resource-963"><span class="linenos"> 963</span></a><span class="sd">                map.resource(&#39;message&#39;, &#39;messages&#39;, collection={&#39;rss&#39;:&#39;GET&#39;})</span>
</span><span id="Mapper.resource-964"><a href="#Mapper.resource-964"><span class="linenos"> 964</span></a><span class="sd">                # GET /message/rss (maps to the rss action)</span>
</span><span id="Mapper.resource-965"><a href="#Mapper.resource-965"><span class="linenos"> 965</span></a><span class="sd">                # also adds named route &quot;rss_message&quot;</span>
</span><span id="Mapper.resource-966"><a href="#Mapper.resource-966"><span class="linenos"> 966</span></a>
</span><span id="Mapper.resource-967"><a href="#Mapper.resource-967"><span class="linenos"> 967</span></a><span class="sd">        ``member``</span>
</span><span id="Mapper.resource-968"><a href="#Mapper.resource-968"><span class="linenos"> 968</span></a><span class="sd">            Additional action mappings used to access an individual</span>
</span><span id="Mapper.resource-969"><a href="#Mapper.resource-969"><span class="linenos"> 969</span></a><span class="sd">            &#39;member&#39; of this controllers resources.</span>
</span><span id="Mapper.resource-970"><a href="#Mapper.resource-970"><span class="linenos"> 970</span></a>
</span><span id="Mapper.resource-971"><a href="#Mapper.resource-971"><span class="linenos"> 971</span></a><span class="sd">            Example::</span>
</span><span id="Mapper.resource-972"><a href="#Mapper.resource-972"><span class="linenos"> 972</span></a>
</span><span id="Mapper.resource-973"><a href="#Mapper.resource-973"><span class="linenos"> 973</span></a><span class="sd">                map.resource(&#39;message&#39;, &#39;messages&#39;, member={&#39;mark&#39;:&#39;POST&#39;})</span>
</span><span id="Mapper.resource-974"><a href="#Mapper.resource-974"><span class="linenos"> 974</span></a><span class="sd">                # POST /message/1/mark (maps to the mark action)</span>
</span><span id="Mapper.resource-975"><a href="#Mapper.resource-975"><span class="linenos"> 975</span></a><span class="sd">                # also adds named route &quot;mark_message&quot;</span>
</span><span id="Mapper.resource-976"><a href="#Mapper.resource-976"><span class="linenos"> 976</span></a>
</span><span id="Mapper.resource-977"><a href="#Mapper.resource-977"><span class="linenos"> 977</span></a><span class="sd">        ``new``</span>
</span><span id="Mapper.resource-978"><a href="#Mapper.resource-978"><span class="linenos"> 978</span></a><span class="sd">            Action mappings that involve dealing with a new member in</span>
</span><span id="Mapper.resource-979"><a href="#Mapper.resource-979"><span class="linenos"> 979</span></a><span class="sd">            the controller resources.</span>
</span><span id="Mapper.resource-980"><a href="#Mapper.resource-980"><span class="linenos"> 980</span></a>
</span><span id="Mapper.resource-981"><a href="#Mapper.resource-981"><span class="linenos"> 981</span></a><span class="sd">            Example::</span>
</span><span id="Mapper.resource-982"><a href="#Mapper.resource-982"><span class="linenos"> 982</span></a>
</span><span id="Mapper.resource-983"><a href="#Mapper.resource-983"><span class="linenos"> 983</span></a><span class="sd">                map.resource(&#39;message&#39;, &#39;messages&#39;, new={&#39;preview&#39;:&#39;POST&#39;})</span>
</span><span id="Mapper.resource-984"><a href="#Mapper.resource-984"><span class="linenos"> 984</span></a><span class="sd">                # POST /message/new/preview (maps to the preview action)</span>
</span><span id="Mapper.resource-985"><a href="#Mapper.resource-985"><span class="linenos"> 985</span></a><span class="sd">                # also adds a url named &quot;preview_new_message&quot;</span>
</span><span id="Mapper.resource-986"><a href="#Mapper.resource-986"><span class="linenos"> 986</span></a>
</span><span id="Mapper.resource-987"><a href="#Mapper.resource-987"><span class="linenos"> 987</span></a><span class="sd">        ``path_prefix``</span>
</span><span id="Mapper.resource-988"><a href="#Mapper.resource-988"><span class="linenos"> 988</span></a><span class="sd">            Prepends the URL path for the Route with the path_prefix</span>
</span><span id="Mapper.resource-989"><a href="#Mapper.resource-989"><span class="linenos"> 989</span></a><span class="sd">            given. This is most useful for cases where you want to mix</span>
</span><span id="Mapper.resource-990"><a href="#Mapper.resource-990"><span class="linenos"> 990</span></a><span class="sd">            resources or relations between resources.</span>
</span><span id="Mapper.resource-991"><a href="#Mapper.resource-991"><span class="linenos"> 991</span></a>
</span><span id="Mapper.resource-992"><a href="#Mapper.resource-992"><span class="linenos"> 992</span></a><span class="sd">        ``name_prefix``</span>
</span><span id="Mapper.resource-993"><a href="#Mapper.resource-993"><span class="linenos"> 993</span></a><span class="sd">            Perpends the route names that are generated with the</span>
</span><span id="Mapper.resource-994"><a href="#Mapper.resource-994"><span class="linenos"> 994</span></a><span class="sd">            name_prefix given. Combined with the path_prefix option,</span>
</span><span id="Mapper.resource-995"><a href="#Mapper.resource-995"><span class="linenos"> 995</span></a><span class="sd">            it&#39;s easy to generate route names and paths that represent</span>
</span><span id="Mapper.resource-996"><a href="#Mapper.resource-996"><span class="linenos"> 996</span></a><span class="sd">            resources that are in relations.</span>
</span><span id="Mapper.resource-997"><a href="#Mapper.resource-997"><span class="linenos"> 997</span></a>
</span><span id="Mapper.resource-998"><a href="#Mapper.resource-998"><span class="linenos"> 998</span></a><span class="sd">            Example::</span>
</span><span id="Mapper.resource-999"><a href="#Mapper.resource-999"><span class="linenos"> 999</span></a>
</span><span id="Mapper.resource-1000"><a href="#Mapper.resource-1000"><span class="linenos">1000</span></a><span class="sd">                map.resource(&#39;message&#39;, &#39;messages&#39;, controller=&#39;categories&#39;,</span>
</span><span id="Mapper.resource-1001"><a href="#Mapper.resource-1001"><span class="linenos">1001</span></a><span class="sd">                    path_prefix=&#39;/category/:category_id&#39;,</span>
</span><span id="Mapper.resource-1002"><a href="#Mapper.resource-1002"><span class="linenos">1002</span></a><span class="sd">                    name_prefix=&quot;category_&quot;)</span>
</span><span id="Mapper.resource-1003"><a href="#Mapper.resource-1003"><span class="linenos">1003</span></a><span class="sd">                # GET /category/7/message/1</span>
</span><span id="Mapper.resource-1004"><a href="#Mapper.resource-1004"><span class="linenos">1004</span></a><span class="sd">                # has named route &quot;category_message&quot;</span>
</span><span id="Mapper.resource-1005"><a href="#Mapper.resource-1005"><span class="linenos">1005</span></a>
</span><span id="Mapper.resource-1006"><a href="#Mapper.resource-1006"><span class="linenos">1006</span></a><span class="sd">        ``requirements``</span>
</span><span id="Mapper.resource-1007"><a href="#Mapper.resource-1007"><span class="linenos">1007</span></a>
</span><span id="Mapper.resource-1008"><a href="#Mapper.resource-1008"><span class="linenos">1008</span></a><span class="sd">           A dictionary that restricts the matching of a</span>
</span><span id="Mapper.resource-1009"><a href="#Mapper.resource-1009"><span class="linenos">1009</span></a><span class="sd">           variable. Can be used when matching variables with path_prefix.</span>
</span><span id="Mapper.resource-1010"><a href="#Mapper.resource-1010"><span class="linenos">1010</span></a>
</span><span id="Mapper.resource-1011"><a href="#Mapper.resource-1011"><span class="linenos">1011</span></a><span class="sd">           Example::</span>
</span><span id="Mapper.resource-1012"><a href="#Mapper.resource-1012"><span class="linenos">1012</span></a>
</span><span id="Mapper.resource-1013"><a href="#Mapper.resource-1013"><span class="linenos">1013</span></a><span class="sd">                map.resource(&#39;message&#39;, &#39;messages&#39;,</span>
</span><span id="Mapper.resource-1014"><a href="#Mapper.resource-1014"><span class="linenos">1014</span></a><span class="sd">                     path_prefix=&#39;{project_id}/&#39;,</span>
</span><span id="Mapper.resource-1015"><a href="#Mapper.resource-1015"><span class="linenos">1015</span></a><span class="sd">                     requirements={&quot;project_id&quot;: R&quot;\\d+&quot;})</span>
</span><span id="Mapper.resource-1016"><a href="#Mapper.resource-1016"><span class="linenos">1016</span></a><span class="sd">                # POST /01234/message</span>
</span><span id="Mapper.resource-1017"><a href="#Mapper.resource-1017"><span class="linenos">1017</span></a><span class="sd">                #    success, project_id is set to &quot;01234&quot;</span>
</span><span id="Mapper.resource-1018"><a href="#Mapper.resource-1018"><span class="linenos">1018</span></a><span class="sd">                # POST /foo/message</span>
</span><span id="Mapper.resource-1019"><a href="#Mapper.resource-1019"><span class="linenos">1019</span></a><span class="sd">                #    404 not found, won&#39;t be matched by this route</span>
</span><span id="Mapper.resource-1020"><a href="#Mapper.resource-1020"><span class="linenos">1020</span></a>
</span><span id="Mapper.resource-1021"><a href="#Mapper.resource-1021"><span class="linenos">1021</span></a>
</span><span id="Mapper.resource-1022"><a href="#Mapper.resource-1022"><span class="linenos">1022</span></a><span class="sd">        ``parent_resource``</span>
</span><span id="Mapper.resource-1023"><a href="#Mapper.resource-1023"><span class="linenos">1023</span></a><span class="sd">            A ``dict`` containing information about the parent</span>
</span><span id="Mapper.resource-1024"><a href="#Mapper.resource-1024"><span class="linenos">1024</span></a><span class="sd">            resource, for creating a nested resource. It should contain</span>
</span><span id="Mapper.resource-1025"><a href="#Mapper.resource-1025"><span class="linenos">1025</span></a><span class="sd">            the ``member_name`` and ``collection_name`` of the parent</span>
</span><span id="Mapper.resource-1026"><a href="#Mapper.resource-1026"><span class="linenos">1026</span></a><span class="sd">            resource. This ``dict`` will</span>
</span><span id="Mapper.resource-1027"><a href="#Mapper.resource-1027"><span class="linenos">1027</span></a><span class="sd">            be available via the associated ``Route`` object which can</span>
</span><span id="Mapper.resource-1028"><a href="#Mapper.resource-1028"><span class="linenos">1028</span></a><span class="sd">            be accessed during a request via</span>
</span><span id="Mapper.resource-1029"><a href="#Mapper.resource-1029"><span class="linenos">1029</span></a><span class="sd">            ``request.environ[&#39;routes.route&#39;]``</span>
</span><span id="Mapper.resource-1030"><a href="#Mapper.resource-1030"><span class="linenos">1030</span></a>
</span><span id="Mapper.resource-1031"><a href="#Mapper.resource-1031"><span class="linenos">1031</span></a><span class="sd">            If ``parent_resource`` is supplied and ``path_prefix``</span>
</span><span id="Mapper.resource-1032"><a href="#Mapper.resource-1032"><span class="linenos">1032</span></a><span class="sd">            isn&#39;t, ``path_prefix`` will be generated from</span>
</span><span id="Mapper.resource-1033"><a href="#Mapper.resource-1033"><span class="linenos">1033</span></a><span class="sd">            ``parent_resource`` as</span>
</span><span id="Mapper.resource-1034"><a href="#Mapper.resource-1034"><span class="linenos">1034</span></a><span class="sd">            &quot;&lt;parent collection name&gt;/:&lt;parent member name&gt;_id&quot;.</span>
</span><span id="Mapper.resource-1035"><a href="#Mapper.resource-1035"><span class="linenos">1035</span></a>
</span><span id="Mapper.resource-1036"><a href="#Mapper.resource-1036"><span class="linenos">1036</span></a><span class="sd">            If ``parent_resource`` is supplied and ``name_prefix``</span>
</span><span id="Mapper.resource-1037"><a href="#Mapper.resource-1037"><span class="linenos">1037</span></a><span class="sd">            isn&#39;t, ``name_prefix`` will be generated from</span>
</span><span id="Mapper.resource-1038"><a href="#Mapper.resource-1038"><span class="linenos">1038</span></a><span class="sd">            ``parent_resource`` as  &quot;&lt;parent member name&gt;_&quot;.</span>
</span><span id="Mapper.resource-1039"><a href="#Mapper.resource-1039"><span class="linenos">1039</span></a>
</span><span id="Mapper.resource-1040"><a href="#Mapper.resource-1040"><span class="linenos">1040</span></a><span class="sd">            Example::</span>
</span><span id="Mapper.resource-1041"><a href="#Mapper.resource-1041"><span class="linenos">1041</span></a>
</span><span id="Mapper.resource-1042"><a href="#Mapper.resource-1042"><span class="linenos">1042</span></a><span class="sd">                &gt;&gt;&gt; from routes.util import url_for</span>
</span><span id="Mapper.resource-1043"><a href="#Mapper.resource-1043"><span class="linenos">1043</span></a><span class="sd">                &gt;&gt;&gt; m = Mapper()</span>
</span><span id="Mapper.resource-1044"><a href="#Mapper.resource-1044"><span class="linenos">1044</span></a><span class="sd">                &gt;&gt;&gt; m.resource(&#39;location&#39;, &#39;locations&#39;,</span>
</span><span id="Mapper.resource-1045"><a href="#Mapper.resource-1045"><span class="linenos">1045</span></a><span class="sd">                ...            parent_resource=dict(member_name=&#39;region&#39;,</span>
</span><span id="Mapper.resource-1046"><a href="#Mapper.resource-1046"><span class="linenos">1046</span></a><span class="sd">                ...                                 collection_name=&#39;regions&#39;))</span>
</span><span id="Mapper.resource-1047"><a href="#Mapper.resource-1047"><span class="linenos">1047</span></a><span class="sd">                &gt;&gt;&gt; # path_prefix is &quot;regions/:region_id&quot;</span>
</span><span id="Mapper.resource-1048"><a href="#Mapper.resource-1048"><span class="linenos">1048</span></a><span class="sd">                &gt;&gt;&gt; # name prefix is &quot;region_&quot;</span>
</span><span id="Mapper.resource-1049"><a href="#Mapper.resource-1049"><span class="linenos">1049</span></a><span class="sd">                &gt;&gt;&gt; url_for(&#39;region_locations&#39;, region_id=13)</span>
</span><span id="Mapper.resource-1050"><a href="#Mapper.resource-1050"><span class="linenos">1050</span></a><span class="sd">                &#39;/regions/13/locations&#39;</span>
</span><span id="Mapper.resource-1051"><a href="#Mapper.resource-1051"><span class="linenos">1051</span></a><span class="sd">                &gt;&gt;&gt; url_for(&#39;region_new_location&#39;, region_id=13)</span>
</span><span id="Mapper.resource-1052"><a href="#Mapper.resource-1052"><span class="linenos">1052</span></a><span class="sd">                &#39;/regions/13/locations/new&#39;</span>
</span><span id="Mapper.resource-1053"><a href="#Mapper.resource-1053"><span class="linenos">1053</span></a><span class="sd">                &gt;&gt;&gt; url_for(&#39;region_location&#39;, region_id=13, id=60)</span>
</span><span id="Mapper.resource-1054"><a href="#Mapper.resource-1054"><span class="linenos">1054</span></a><span class="sd">                &#39;/regions/13/locations/60&#39;</span>
</span><span id="Mapper.resource-1055"><a href="#Mapper.resource-1055"><span class="linenos">1055</span></a><span class="sd">                &gt;&gt;&gt; url_for(&#39;region_edit_location&#39;, region_id=13, id=60)</span>
</span><span id="Mapper.resource-1056"><a href="#Mapper.resource-1056"><span class="linenos">1056</span></a><span class="sd">                &#39;/regions/13/locations/60/edit&#39;</span>
</span><span id="Mapper.resource-1057"><a href="#Mapper.resource-1057"><span class="linenos">1057</span></a>
</span><span id="Mapper.resource-1058"><a href="#Mapper.resource-1058"><span class="linenos">1058</span></a><span class="sd">            Overriding generated ``path_prefix``::</span>
</span><span id="Mapper.resource-1059"><a href="#Mapper.resource-1059"><span class="linenos">1059</span></a>
</span><span id="Mapper.resource-1060"><a href="#Mapper.resource-1060"><span class="linenos">1060</span></a><span class="sd">                &gt;&gt;&gt; m = Mapper()</span>
</span><span id="Mapper.resource-1061"><a href="#Mapper.resource-1061"><span class="linenos">1061</span></a><span class="sd">                &gt;&gt;&gt; m.resource(&#39;location&#39;, &#39;locations&#39;,</span>
</span><span id="Mapper.resource-1062"><a href="#Mapper.resource-1062"><span class="linenos">1062</span></a><span class="sd">                ...            parent_resource=dict(member_name=&#39;region&#39;,</span>
</span><span id="Mapper.resource-1063"><a href="#Mapper.resource-1063"><span class="linenos">1063</span></a><span class="sd">                ...                                 collection_name=&#39;regions&#39;),</span>
</span><span id="Mapper.resource-1064"><a href="#Mapper.resource-1064"><span class="linenos">1064</span></a><span class="sd">                ...            path_prefix=&#39;areas/:area_id&#39;)</span>
</span><span id="Mapper.resource-1065"><a href="#Mapper.resource-1065"><span class="linenos">1065</span></a><span class="sd">                &gt;&gt;&gt; # name prefix is &quot;region_&quot;</span>
</span><span id="Mapper.resource-1066"><a href="#Mapper.resource-1066"><span class="linenos">1066</span></a><span class="sd">                &gt;&gt;&gt; url_for(&#39;region_locations&#39;, area_id=51)</span>
</span><span id="Mapper.resource-1067"><a href="#Mapper.resource-1067"><span class="linenos">1067</span></a><span class="sd">                &#39;/areas/51/locations&#39;</span>
</span><span id="Mapper.resource-1068"><a href="#Mapper.resource-1068"><span class="linenos">1068</span></a>
</span><span id="Mapper.resource-1069"><a href="#Mapper.resource-1069"><span class="linenos">1069</span></a><span class="sd">            Overriding generated ``name_prefix``::</span>
</span><span id="Mapper.resource-1070"><a href="#Mapper.resource-1070"><span class="linenos">1070</span></a>
</span><span id="Mapper.resource-1071"><a href="#Mapper.resource-1071"><span class="linenos">1071</span></a><span class="sd">                &gt;&gt;&gt; m = Mapper()</span>
</span><span id="Mapper.resource-1072"><a href="#Mapper.resource-1072"><span class="linenos">1072</span></a><span class="sd">                &gt;&gt;&gt; m.resource(&#39;location&#39;, &#39;locations&#39;,</span>
</span><span id="Mapper.resource-1073"><a href="#Mapper.resource-1073"><span class="linenos">1073</span></a><span class="sd">                ...            parent_resource=dict(member_name=&#39;region&#39;,</span>
</span><span id="Mapper.resource-1074"><a href="#Mapper.resource-1074"><span class="linenos">1074</span></a><span class="sd">                ...                                 collection_name=&#39;regions&#39;),</span>
</span><span id="Mapper.resource-1075"><a href="#Mapper.resource-1075"><span class="linenos">1075</span></a><span class="sd">                ...            name_prefix=&#39;&#39;)</span>
</span><span id="Mapper.resource-1076"><a href="#Mapper.resource-1076"><span class="linenos">1076</span></a><span class="sd">                &gt;&gt;&gt; # path_prefix is &quot;regions/:region_id&quot;</span>
</span><span id="Mapper.resource-1077"><a href="#Mapper.resource-1077"><span class="linenos">1077</span></a><span class="sd">                &gt;&gt;&gt; url_for(&#39;locations&#39;, region_id=51)</span>
</span><span id="Mapper.resource-1078"><a href="#Mapper.resource-1078"><span class="linenos">1078</span></a><span class="sd">                &#39;/regions/51/locations&#39;</span>
</span><span id="Mapper.resource-1079"><a href="#Mapper.resource-1079"><span class="linenos">1079</span></a>
</span><span id="Mapper.resource-1080"><a href="#Mapper.resource-1080"><span class="linenos">1080</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Mapper.resource-1081"><a href="#Mapper.resource-1081"><span class="linenos">1081</span></a>        <span class="n">collection</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;collection&#39;</span><span class="p">,</span> <span class="p">{})</span>
</span><span id="Mapper.resource-1082"><a href="#Mapper.resource-1082"><span class="linenos">1082</span></a>        <span class="n">member</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;member&#39;</span><span class="p">,</span> <span class="p">{})</span>
</span><span id="Mapper.resource-1083"><a href="#Mapper.resource-1083"><span class="linenos">1083</span></a>        <span class="n">new</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;new&#39;</span><span class="p">,</span> <span class="p">{})</span>
</span><span id="Mapper.resource-1084"><a href="#Mapper.resource-1084"><span class="linenos">1084</span></a>        <span class="n">path_prefix</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;path_prefix&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="Mapper.resource-1085"><a href="#Mapper.resource-1085"><span class="linenos">1085</span></a>        <span class="n">name_prefix</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;name_prefix&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="Mapper.resource-1086"><a href="#Mapper.resource-1086"><span class="linenos">1086</span></a>        <span class="n">parent_resource</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;parent_resource&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="Mapper.resource-1087"><a href="#Mapper.resource-1087"><span class="linenos">1087</span></a>
</span><span id="Mapper.resource-1088"><a href="#Mapper.resource-1088"><span class="linenos">1088</span></a>        <span class="c1"># Generate ``path_prefix`` if ``path_prefix`` wasn&#39;t specified and</span>
</span><span id="Mapper.resource-1089"><a href="#Mapper.resource-1089"><span class="linenos">1089</span></a>        <span class="c1"># ``parent_resource`` was. Likewise for ``name_prefix``. Make sure</span>
</span><span id="Mapper.resource-1090"><a href="#Mapper.resource-1090"><span class="linenos">1090</span></a>        <span class="c1"># that ``path_prefix`` and ``name_prefix`` *always* take precedence if</span>
</span><span id="Mapper.resource-1091"><a href="#Mapper.resource-1091"><span class="linenos">1091</span></a>        <span class="c1"># they are specified--in particular, we need to be careful when they</span>
</span><span id="Mapper.resource-1092"><a href="#Mapper.resource-1092"><span class="linenos">1092</span></a>        <span class="c1"># are explicitly set to &quot;&quot;.</span>
</span><span id="Mapper.resource-1093"><a href="#Mapper.resource-1093"><span class="linenos">1093</span></a>        <span class="k">if</span> <span class="n">parent_resource</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Mapper.resource-1094"><a href="#Mapper.resource-1094"><span class="linenos">1094</span></a>            <span class="k">if</span> <span class="n">path_prefix</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Mapper.resource-1095"><a href="#Mapper.resource-1095"><span class="linenos">1095</span></a>                <span class="n">path_prefix</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">/:</span><span class="si">%s</span><span class="s1">_id&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">parent_resource</span><span class="p">[</span><span class="s1">&#39;collection_name&#39;</span><span class="p">],</span>
</span><span id="Mapper.resource-1096"><a href="#Mapper.resource-1096"><span class="linenos">1096</span></a>                                             <span class="n">parent_resource</span><span class="p">[</span><span class="s1">&#39;member_name&#39;</span><span class="p">])</span>
</span><span id="Mapper.resource-1097"><a href="#Mapper.resource-1097"><span class="linenos">1097</span></a>            <span class="k">if</span> <span class="n">name_prefix</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Mapper.resource-1098"><a href="#Mapper.resource-1098"><span class="linenos">1098</span></a>                <span class="n">name_prefix</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">_&#39;</span> <span class="o">%</span> <span class="n">parent_resource</span><span class="p">[</span><span class="s1">&#39;member_name&#39;</span><span class="p">]</span>
</span><span id="Mapper.resource-1099"><a href="#Mapper.resource-1099"><span class="linenos">1099</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Mapper.resource-1100"><a href="#Mapper.resource-1100"><span class="linenos">1100</span></a>            <span class="k">if</span> <span class="n">path_prefix</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Mapper.resource-1101"><a href="#Mapper.resource-1101"><span class="linenos">1101</span></a>                <span class="n">path_prefix</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
</span><span id="Mapper.resource-1102"><a href="#Mapper.resource-1102"><span class="linenos">1102</span></a>            <span class="k">if</span> <span class="n">name_prefix</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Mapper.resource-1103"><a href="#Mapper.resource-1103"><span class="linenos">1103</span></a>                <span class="n">name_prefix</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
</span><span id="Mapper.resource-1104"><a href="#Mapper.resource-1104"><span class="linenos">1104</span></a>
</span><span id="Mapper.resource-1105"><a href="#Mapper.resource-1105"><span class="linenos">1105</span></a>        <span class="c1"># Ensure the edit and new actions are in and GET</span>
</span><span id="Mapper.resource-1106"><a href="#Mapper.resource-1106"><span class="linenos">1106</span></a>        <span class="n">member</span><span class="p">[</span><span class="s1">&#39;edit&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;GET&#39;</span>
</span><span id="Mapper.resource-1107"><a href="#Mapper.resource-1107"><span class="linenos">1107</span></a>        <span class="n">new</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;new&#39;</span><span class="p">:</span> <span class="s1">&#39;GET&#39;</span><span class="p">})</span>
</span><span id="Mapper.resource-1108"><a href="#Mapper.resource-1108"><span class="linenos">1108</span></a>
</span><span id="Mapper.resource-1109"><a href="#Mapper.resource-1109"><span class="linenos">1109</span></a>        <span class="c1"># Make new dict&#39;s based off the old, except the old values become keys,</span>
</span><span id="Mapper.resource-1110"><a href="#Mapper.resource-1110"><span class="linenos">1110</span></a>        <span class="c1"># and the old keys become items in a list as the value</span>
</span><span id="Mapper.resource-1111"><a href="#Mapper.resource-1111"><span class="linenos">1111</span></a>        <span class="k">def</span><span class="w"> </span><span class="nf">swap</span><span class="p">(</span><span class="n">dct</span><span class="p">,</span> <span class="n">newdct</span><span class="p">):</span>
</span><span id="Mapper.resource-1112"><a href="#Mapper.resource-1112"><span class="linenos">1112</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;Swap the keys and values in the dict, and uppercase the values</span>
</span><span id="Mapper.resource-1113"><a href="#Mapper.resource-1113"><span class="linenos">1113</span></a><span class="sd">            from the dict during the swap.&quot;&quot;&quot;</span>
</span><span id="Mapper.resource-1114"><a href="#Mapper.resource-1114"><span class="linenos">1114</span></a>            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">six</span><span class="o">.</span><span class="n">iteritems</span><span class="p">(</span><span class="n">dct</span><span class="p">):</span>
</span><span id="Mapper.resource-1115"><a href="#Mapper.resource-1115"><span class="linenos">1115</span></a>                <span class="n">newdct</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">val</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span> <span class="p">[])</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
</span><span id="Mapper.resource-1116"><a href="#Mapper.resource-1116"><span class="linenos">1116</span></a>            <span class="k">return</span> <span class="n">newdct</span>
</span><span id="Mapper.resource-1117"><a href="#Mapper.resource-1117"><span class="linenos">1117</span></a>        <span class="n">collection_methods</span> <span class="o">=</span> <span class="n">swap</span><span class="p">(</span><span class="n">collection</span><span class="p">,</span> <span class="p">{})</span>
</span><span id="Mapper.resource-1118"><a href="#Mapper.resource-1118"><span class="linenos">1118</span></a>        <span class="n">member_methods</span> <span class="o">=</span> <span class="n">swap</span><span class="p">(</span><span class="n">member</span><span class="p">,</span> <span class="p">{})</span>
</span><span id="Mapper.resource-1119"><a href="#Mapper.resource-1119"><span class="linenos">1119</span></a>        <span class="n">new_methods</span> <span class="o">=</span> <span class="n">swap</span><span class="p">(</span><span class="n">new</span><span class="p">,</span> <span class="p">{})</span>
</span><span id="Mapper.resource-1120"><a href="#Mapper.resource-1120"><span class="linenos">1120</span></a>
</span><span id="Mapper.resource-1121"><a href="#Mapper.resource-1121"><span class="linenos">1121</span></a>        <span class="c1"># Insert create, update, and destroy methods</span>
</span><span id="Mapper.resource-1122"><a href="#Mapper.resource-1122"><span class="linenos">1122</span></a>        <span class="n">collection_methods</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;POST&#39;</span><span class="p">,</span> <span class="p">[])</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;create&#39;</span><span class="p">)</span>
</span><span id="Mapper.resource-1123"><a href="#Mapper.resource-1123"><span class="linenos">1123</span></a>        <span class="n">member_methods</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;PUT&#39;</span><span class="p">,</span> <span class="p">[])</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;update&#39;</span><span class="p">)</span>
</span><span id="Mapper.resource-1124"><a href="#Mapper.resource-1124"><span class="linenos">1124</span></a>        <span class="n">member_methods</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;DELETE&#39;</span><span class="p">,</span> <span class="p">[])</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;delete&#39;</span><span class="p">)</span>
</span><span id="Mapper.resource-1125"><a href="#Mapper.resource-1125"><span class="linenos">1125</span></a>
</span><span id="Mapper.resource-1126"><a href="#Mapper.resource-1126"><span class="linenos">1126</span></a>        <span class="c1"># If there&#39;s a path prefix option, use it with the controller</span>
</span><span id="Mapper.resource-1127"><a href="#Mapper.resource-1127"><span class="linenos">1127</span></a>        <span class="n">controller</span> <span class="o">=</span> <span class="n">strip_slashes</span><span class="p">(</span><span class="n">collection_name</span><span class="p">)</span>
</span><span id="Mapper.resource-1128"><a href="#Mapper.resource-1128"><span class="linenos">1128</span></a>        <span class="n">path_prefix</span> <span class="o">=</span> <span class="n">strip_slashes</span><span class="p">(</span><span class="n">path_prefix</span><span class="p">)</span>
</span><span id="Mapper.resource-1129"><a href="#Mapper.resource-1129"><span class="linenos">1129</span></a>        <span class="n">path_prefix</span> <span class="o">=</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="n">path_prefix</span>
</span><span id="Mapper.resource-1130"><a href="#Mapper.resource-1130"><span class="linenos">1130</span></a>        <span class="k">if</span> <span class="n">path_prefix</span> <span class="ow">and</span> <span class="n">path_prefix</span> <span class="o">!=</span> <span class="s1">&#39;/&#39;</span><span class="p">:</span>
</span><span id="Mapper.resource-1131"><a href="#Mapper.resource-1131"><span class="linenos">1131</span></a>            <span class="n">path</span> <span class="o">=</span> <span class="n">path_prefix</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="n">controller</span>
</span><span id="Mapper.resource-1132"><a href="#Mapper.resource-1132"><span class="linenos">1132</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Mapper.resource-1133"><a href="#Mapper.resource-1133"><span class="linenos">1133</span></a>            <span class="n">path</span> <span class="o">=</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="n">controller</span>
</span><span id="Mapper.resource-1134"><a href="#Mapper.resource-1134"><span class="linenos">1134</span></a>        <span class="n">collection_path</span> <span class="o">=</span> <span class="n">path</span>
</span><span id="Mapper.resource-1135"><a href="#Mapper.resource-1135"><span class="linenos">1135</span></a>        <span class="n">new_path</span> <span class="o">=</span> <span class="n">path</span> <span class="o">+</span> <span class="s2">&quot;/new&quot;</span>
</span><span id="Mapper.resource-1136"><a href="#Mapper.resource-1136"><span class="linenos">1136</span></a>        <span class="n">member_path</span> <span class="o">=</span> <span class="n">path</span> <span class="o">+</span> <span class="s2">&quot;/:(id)&quot;</span>
</span><span id="Mapper.resource-1137"><a href="#Mapper.resource-1137"><span class="linenos">1137</span></a>
</span><span id="Mapper.resource-1138"><a href="#Mapper.resource-1138"><span class="linenos">1138</span></a>        <span class="n">options</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="Mapper.resource-1139"><a href="#Mapper.resource-1139"><span class="linenos">1139</span></a>            <span class="s1">&#39;controller&#39;</span><span class="p">:</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;controller&#39;</span><span class="p">,</span> <span class="n">controller</span><span class="p">),</span>
</span><span id="Mapper.resource-1140"><a href="#Mapper.resource-1140"><span class="linenos">1140</span></a>            <span class="s1">&#39;_member_name&#39;</span><span class="p">:</span> <span class="n">member_name</span><span class="p">,</span>
</span><span id="Mapper.resource-1141"><a href="#Mapper.resource-1141"><span class="linenos">1141</span></a>            <span class="s1">&#39;_collection_name&#39;</span><span class="p">:</span> <span class="n">collection_name</span><span class="p">,</span>
</span><span id="Mapper.resource-1142"><a href="#Mapper.resource-1142"><span class="linenos">1142</span></a>            <span class="s1">&#39;_parent_resource&#39;</span><span class="p">:</span> <span class="n">parent_resource</span><span class="p">,</span>
</span><span id="Mapper.resource-1143"><a href="#Mapper.resource-1143"><span class="linenos">1143</span></a>            <span class="s1">&#39;_filter&#39;</span><span class="p">:</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;_filter&#39;</span><span class="p">)</span>
</span><span id="Mapper.resource-1144"><a href="#Mapper.resource-1144"><span class="linenos">1144</span></a>        <span class="p">}</span>
</span><span id="Mapper.resource-1145"><a href="#Mapper.resource-1145"><span class="linenos">1145</span></a>        <span class="k">if</span> <span class="s1">&#39;requirements&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
</span><span id="Mapper.resource-1146"><a href="#Mapper.resource-1146"><span class="linenos">1146</span></a>            <span class="n">options</span><span class="p">[</span><span class="s1">&#39;requirements&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;requirements&#39;</span><span class="p">]</span>
</span><span id="Mapper.resource-1147"><a href="#Mapper.resource-1147"><span class="linenos">1147</span></a>
</span><span id="Mapper.resource-1148"><a href="#Mapper.resource-1148"><span class="linenos">1148</span></a>        <span class="k">def</span><span class="w"> </span><span class="nf">requirements_for</span><span class="p">(</span><span class="n">meth</span><span class="p">):</span>
</span><span id="Mapper.resource-1149"><a href="#Mapper.resource-1149"><span class="linenos">1149</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;Returns a new dict to be used for all route creation as the</span>
</span><span id="Mapper.resource-1150"><a href="#Mapper.resource-1150"><span class="linenos">1150</span></a><span class="sd">            route options&quot;&quot;&quot;</span>
</span><span id="Mapper.resource-1151"><a href="#Mapper.resource-1151"><span class="linenos">1151</span></a>            <span class="n">opts</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Mapper.resource-1152"><a href="#Mapper.resource-1152"><span class="linenos">1152</span></a>            <span class="k">if</span> <span class="n">method</span> <span class="o">!=</span> <span class="s1">&#39;any&#39;</span><span class="p">:</span>
</span><span id="Mapper.resource-1153"><a href="#Mapper.resource-1153"><span class="linenos">1153</span></a>                <span class="n">opts</span><span class="p">[</span><span class="s1">&#39;conditions&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;method&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">meth</span><span class="o">.</span><span class="n">upper</span><span class="p">()]}</span>
</span><span id="Mapper.resource-1154"><a href="#Mapper.resource-1154"><span class="linenos">1154</span></a>            <span class="k">return</span> <span class="n">opts</span>
</span><span id="Mapper.resource-1155"><a href="#Mapper.resource-1155"><span class="linenos">1155</span></a>
</span><span id="Mapper.resource-1156"><a href="#Mapper.resource-1156"><span class="linenos">1156</span></a>        <span class="c1"># Add the routes for handling collection methods</span>
</span><span id="Mapper.resource-1157"><a href="#Mapper.resource-1157"><span class="linenos">1157</span></a>        <span class="k">for</span> <span class="n">method</span><span class="p">,</span> <span class="n">lst</span> <span class="ow">in</span> <span class="n">six</span><span class="o">.</span><span class="n">iteritems</span><span class="p">(</span><span class="n">collection_methods</span><span class="p">):</span>
</span><span id="Mapper.resource-1158"><a href="#Mapper.resource-1158"><span class="linenos">1158</span></a>            <span class="n">primary</span> <span class="o">=</span> <span class="p">(</span><span class="n">method</span> <span class="o">!=</span> <span class="s1">&#39;GET&#39;</span> <span class="ow">and</span> <span class="n">lst</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span> <span class="ow">or</span> <span class="kc">None</span>
</span><span id="Mapper.resource-1159"><a href="#Mapper.resource-1159"><span class="linenos">1159</span></a>            <span class="n">route_options</span> <span class="o">=</span> <span class="n">requirements_for</span><span class="p">(</span><span class="n">method</span><span class="p">)</span>
</span><span id="Mapper.resource-1160"><a href="#Mapper.resource-1160"><span class="linenos">1160</span></a>            <span class="k">for</span> <span class="n">action</span> <span class="ow">in</span> <span class="n">lst</span><span class="p">:</span>
</span><span id="Mapper.resource-1161"><a href="#Mapper.resource-1161"><span class="linenos">1161</span></a>                <span class="n">route_options</span><span class="p">[</span><span class="s1">&#39;action&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">action</span>
</span><span id="Mapper.resource-1162"><a href="#Mapper.resource-1162"><span class="linenos">1162</span></a>                <span class="n">route_name</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s%s</span><span class="s2">_</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">name_prefix</span><span class="p">,</span> <span class="n">action</span><span class="p">,</span> <span class="n">collection_name</span><span class="p">)</span>
</span><span id="Mapper.resource-1163"><a href="#Mapper.resource-1163"><span class="linenos">1163</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;formatted_&quot;</span> <span class="o">+</span> <span class="n">route_name</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">/</span><span class="si">%s</span><span class="s2">.:(format)&quot;</span> <span class="o">%</span>
</span><span id="Mapper.resource-1164"><a href="#Mapper.resource-1164"><span class="linenos">1164</span></a>                             <span class="p">(</span><span class="n">collection_path</span><span class="p">,</span> <span class="n">action</span><span class="p">),</span> <span class="o">**</span><span class="n">route_options</span><span class="p">)</span>
</span><span id="Mapper.resource-1165"><a href="#Mapper.resource-1165"><span class="linenos">1165</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">route_name</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">/</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">collection_path</span><span class="p">,</span> <span class="n">action</span><span class="p">),</span>
</span><span id="Mapper.resource-1166"><a href="#Mapper.resource-1166"><span class="linenos">1166</span></a>                             <span class="o">**</span><span class="n">route_options</span><span class="p">)</span>
</span><span id="Mapper.resource-1167"><a href="#Mapper.resource-1167"><span class="linenos">1167</span></a>            <span class="k">if</span> <span class="n">primary</span><span class="p">:</span>
</span><span id="Mapper.resource-1168"><a href="#Mapper.resource-1168"><span class="linenos">1168</span></a>                <span class="n">route_options</span><span class="p">[</span><span class="s1">&#39;action&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">primary</span>
</span><span id="Mapper.resource-1169"><a href="#Mapper.resource-1169"><span class="linenos">1169</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">.:(format)&quot;</span> <span class="o">%</span> <span class="n">collection_path</span><span class="p">,</span> <span class="o">**</span><span class="n">route_options</span><span class="p">)</span>
</span><span id="Mapper.resource-1170"><a href="#Mapper.resource-1170"><span class="linenos">1170</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">collection_path</span><span class="p">,</span> <span class="o">**</span><span class="n">route_options</span><span class="p">)</span>
</span><span id="Mapper.resource-1171"><a href="#Mapper.resource-1171"><span class="linenos">1171</span></a>
</span><span id="Mapper.resource-1172"><a href="#Mapper.resource-1172"><span class="linenos">1172</span></a>        <span class="c1"># Specifically add in the built-in &#39;index&#39; collection method and its</span>
</span><span id="Mapper.resource-1173"><a href="#Mapper.resource-1173"><span class="linenos">1173</span></a>        <span class="c1"># formatted version</span>
</span><span id="Mapper.resource-1174"><a href="#Mapper.resource-1174"><span class="linenos">1174</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;formatted_&quot;</span> <span class="o">+</span> <span class="n">name_prefix</span> <span class="o">+</span> <span class="n">collection_name</span><span class="p">,</span>
</span><span id="Mapper.resource-1175"><a href="#Mapper.resource-1175"><span class="linenos">1175</span></a>                     <span class="n">collection_path</span> <span class="o">+</span> <span class="s2">&quot;.:(format)&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;index&#39;</span><span class="p">,</span>
</span><span id="Mapper.resource-1176"><a href="#Mapper.resource-1176"><span class="linenos">1176</span></a>                     <span class="n">conditions</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;method&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">]},</span> <span class="o">**</span><span class="n">options</span><span class="p">)</span>
</span><span id="Mapper.resource-1177"><a href="#Mapper.resource-1177"><span class="linenos">1177</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">name_prefix</span> <span class="o">+</span> <span class="n">collection_name</span><span class="p">,</span> <span class="n">collection_path</span><span class="p">,</span>
</span><span id="Mapper.resource-1178"><a href="#Mapper.resource-1178"><span class="linenos">1178</span></a>                     <span class="n">action</span><span class="o">=</span><span class="s1">&#39;index&#39;</span><span class="p">,</span> <span class="n">conditions</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;method&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">]},</span> <span class="o">**</span><span class="n">options</span><span class="p">)</span>
</span><span id="Mapper.resource-1179"><a href="#Mapper.resource-1179"><span class="linenos">1179</span></a>
</span><span id="Mapper.resource-1180"><a href="#Mapper.resource-1180"><span class="linenos">1180</span></a>        <span class="c1"># Add the routes that deal with new resource methods</span>
</span><span id="Mapper.resource-1181"><a href="#Mapper.resource-1181"><span class="linenos">1181</span></a>        <span class="k">for</span> <span class="n">method</span><span class="p">,</span> <span class="n">lst</span> <span class="ow">in</span> <span class="n">six</span><span class="o">.</span><span class="n">iteritems</span><span class="p">(</span><span class="n">new_methods</span><span class="p">):</span>
</span><span id="Mapper.resource-1182"><a href="#Mapper.resource-1182"><span class="linenos">1182</span></a>            <span class="n">route_options</span> <span class="o">=</span> <span class="n">requirements_for</span><span class="p">(</span><span class="n">method</span><span class="p">)</span>
</span><span id="Mapper.resource-1183"><a href="#Mapper.resource-1183"><span class="linenos">1183</span></a>            <span class="k">for</span> <span class="n">action</span> <span class="ow">in</span> <span class="n">lst</span><span class="p">:</span>
</span><span id="Mapper.resource-1184"><a href="#Mapper.resource-1184"><span class="linenos">1184</span></a>                <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;new_&quot;</span> <span class="o">+</span> <span class="n">member_name</span>
</span><span id="Mapper.resource-1185"><a href="#Mapper.resource-1185"><span class="linenos">1185</span></a>                <span class="n">route_options</span><span class="p">[</span><span class="s1">&#39;action&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">action</span>
</span><span id="Mapper.resource-1186"><a href="#Mapper.resource-1186"><span class="linenos">1186</span></a>                <span class="k">if</span> <span class="n">action</span> <span class="o">==</span> <span class="s1">&#39;new&#39;</span><span class="p">:</span>
</span><span id="Mapper.resource-1187"><a href="#Mapper.resource-1187"><span class="linenos">1187</span></a>                    <span class="n">path</span> <span class="o">=</span> <span class="n">new_path</span>
</span><span id="Mapper.resource-1188"><a href="#Mapper.resource-1188"><span class="linenos">1188</span></a>                    <span class="n">formatted_path</span> <span class="o">=</span> <span class="n">new_path</span> <span class="o">+</span> <span class="s1">&#39;.:(format)&#39;</span>
</span><span id="Mapper.resource-1189"><a href="#Mapper.resource-1189"><span class="linenos">1189</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="Mapper.resource-1190"><a href="#Mapper.resource-1190"><span class="linenos">1190</span></a>                    <span class="n">path</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">/</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">new_path</span><span class="p">,</span> <span class="n">action</span><span class="p">)</span>
</span><span id="Mapper.resource-1191"><a href="#Mapper.resource-1191"><span class="linenos">1191</span></a>                    <span class="n">name</span> <span class="o">=</span> <span class="n">action</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">name</span>
</span><span id="Mapper.resource-1192"><a href="#Mapper.resource-1192"><span class="linenos">1192</span></a>                    <span class="n">formatted_path</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">/</span><span class="si">%s</span><span class="s2">.:(format)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">new_path</span><span class="p">,</span> <span class="n">action</span><span class="p">)</span>
</span><span id="Mapper.resource-1193"><a href="#Mapper.resource-1193"><span class="linenos">1193</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;formatted_&quot;</span> <span class="o">+</span> <span class="n">name_prefix</span> <span class="o">+</span> <span class="n">name</span><span class="p">,</span> <span class="n">formatted_path</span><span class="p">,</span>
</span><span id="Mapper.resource-1194"><a href="#Mapper.resource-1194"><span class="linenos">1194</span></a>                             <span class="o">**</span><span class="n">route_options</span><span class="p">)</span>
</span><span id="Mapper.resource-1195"><a href="#Mapper.resource-1195"><span class="linenos">1195</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">name_prefix</span> <span class="o">+</span> <span class="n">name</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="o">**</span><span class="n">route_options</span><span class="p">)</span>
</span><span id="Mapper.resource-1196"><a href="#Mapper.resource-1196"><span class="linenos">1196</span></a>
</span><span id="Mapper.resource-1197"><a href="#Mapper.resource-1197"><span class="linenos">1197</span></a>        <span class="n">requirements_regexp</span> <span class="o">=</span> <span class="s1">&#39;[^</span><span class="se">\\</span><span class="s1">/]+(?&lt;!</span><span class="se">\\\\</span><span class="s1">)&#39;</span>
</span><span id="Mapper.resource-1198"><a href="#Mapper.resource-1198"><span class="linenos">1198</span></a>
</span><span id="Mapper.resource-1199"><a href="#Mapper.resource-1199"><span class="linenos">1199</span></a>        <span class="c1"># Add the routes that deal with member methods of a resource</span>
</span><span id="Mapper.resource-1200"><a href="#Mapper.resource-1200"><span class="linenos">1200</span></a>        <span class="k">for</span> <span class="n">method</span><span class="p">,</span> <span class="n">lst</span> <span class="ow">in</span> <span class="n">six</span><span class="o">.</span><span class="n">iteritems</span><span class="p">(</span><span class="n">member_methods</span><span class="p">):</span>
</span><span id="Mapper.resource-1201"><a href="#Mapper.resource-1201"><span class="linenos">1201</span></a>            <span class="n">route_options</span> <span class="o">=</span> <span class="n">requirements_for</span><span class="p">(</span><span class="n">method</span><span class="p">)</span>
</span><span id="Mapper.resource-1202"><a href="#Mapper.resource-1202"><span class="linenos">1202</span></a>            <span class="n">route_options</span><span class="p">[</span><span class="s1">&#39;requirements&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="n">requirements_regexp</span><span class="p">}</span>
</span><span id="Mapper.resource-1203"><a href="#Mapper.resource-1203"><span class="linenos">1203</span></a>            <span class="k">if</span> <span class="n">method</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">,</span> <span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;any&#39;</span><span class="p">]:</span>
</span><span id="Mapper.resource-1204"><a href="#Mapper.resource-1204"><span class="linenos">1204</span></a>                <span class="n">primary</span> <span class="o">=</span> <span class="n">lst</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="Mapper.resource-1205"><a href="#Mapper.resource-1205"><span class="linenos">1205</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Mapper.resource-1206"><a href="#Mapper.resource-1206"><span class="linenos">1206</span></a>                <span class="n">primary</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Mapper.resource-1207"><a href="#Mapper.resource-1207"><span class="linenos">1207</span></a>            <span class="k">for</span> <span class="n">action</span> <span class="ow">in</span> <span class="n">lst</span><span class="p">:</span>
</span><span id="Mapper.resource-1208"><a href="#Mapper.resource-1208"><span class="linenos">1208</span></a>                <span class="n">route_options</span><span class="p">[</span><span class="s1">&#39;action&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">action</span>
</span><span id="Mapper.resource-1209"><a href="#Mapper.resource-1209"><span class="linenos">1209</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;formatted_</span><span class="si">%s%s</span><span class="s2">_</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">name_prefix</span><span class="p">,</span> <span class="n">action</span><span class="p">,</span>
</span><span id="Mapper.resource-1210"><a href="#Mapper.resource-1210"><span class="linenos">1210</span></a>                                                    <span class="n">member_name</span><span class="p">),</span>
</span><span id="Mapper.resource-1211"><a href="#Mapper.resource-1211"><span class="linenos">1211</span></a>                             <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">/</span><span class="si">%s</span><span class="s2">.:(format)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">member_path</span><span class="p">,</span> <span class="n">action</span><span class="p">),</span>
</span><span id="Mapper.resource-1212"><a href="#Mapper.resource-1212"><span class="linenos">1212</span></a>                             <span class="o">**</span><span class="n">route_options</span><span class="p">)</span>
</span><span id="Mapper.resource-1213"><a href="#Mapper.resource-1213"><span class="linenos">1213</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s%s</span><span class="s2">_</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">name_prefix</span><span class="p">,</span> <span class="n">action</span><span class="p">,</span> <span class="n">member_name</span><span class="p">),</span>
</span><span id="Mapper.resource-1214"><a href="#Mapper.resource-1214"><span class="linenos">1214</span></a>                             <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">/</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">member_path</span><span class="p">,</span> <span class="n">action</span><span class="p">),</span> <span class="o">**</span><span class="n">route_options</span><span class="p">)</span>
</span><span id="Mapper.resource-1215"><a href="#Mapper.resource-1215"><span class="linenos">1215</span></a>            <span class="k">if</span> <span class="n">primary</span><span class="p">:</span>
</span><span id="Mapper.resource-1216"><a href="#Mapper.resource-1216"><span class="linenos">1216</span></a>                <span class="n">route_options</span><span class="p">[</span><span class="s1">&#39;action&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">primary</span>
</span><span id="Mapper.resource-1217"><a href="#Mapper.resource-1217"><span class="linenos">1217</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">.:(format)&quot;</span> <span class="o">%</span> <span class="n">member_path</span><span class="p">,</span> <span class="o">**</span><span class="n">route_options</span><span class="p">)</span>
</span><span id="Mapper.resource-1218"><a href="#Mapper.resource-1218"><span class="linenos">1218</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">member_path</span><span class="p">,</span> <span class="o">**</span><span class="n">route_options</span><span class="p">)</span>
</span><span id="Mapper.resource-1219"><a href="#Mapper.resource-1219"><span class="linenos">1219</span></a>
</span><span id="Mapper.resource-1220"><a href="#Mapper.resource-1220"><span class="linenos">1220</span></a>        <span class="c1"># Specifically add the member &#39;show&#39; method</span>
</span><span id="Mapper.resource-1221"><a href="#Mapper.resource-1221"><span class="linenos">1221</span></a>        <span class="n">route_options</span> <span class="o">=</span> <span class="n">requirements_for</span><span class="p">(</span><span class="s1">&#39;GET&#39;</span><span class="p">)</span>
</span><span id="Mapper.resource-1222"><a href="#Mapper.resource-1222"><span class="linenos">1222</span></a>        <span class="n">route_options</span><span class="p">[</span><span class="s1">&#39;action&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;show&#39;</span>
</span><span id="Mapper.resource-1223"><a href="#Mapper.resource-1223"><span class="linenos">1223</span></a>        <span class="n">route_options</span><span class="p">[</span><span class="s1">&#39;requirements&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="n">requirements_regexp</span><span class="p">}</span>
</span><span id="Mapper.resource-1224"><a href="#Mapper.resource-1224"><span class="linenos">1224</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;formatted_&quot;</span> <span class="o">+</span> <span class="n">name_prefix</span> <span class="o">+</span> <span class="n">member_name</span><span class="p">,</span>
</span><span id="Mapper.resource-1225"><a href="#Mapper.resource-1225"><span class="linenos">1225</span></a>                     <span class="n">member_path</span> <span class="o">+</span> <span class="s2">&quot;.:(format)&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">route_options</span><span class="p">)</span>
</span><span id="Mapper.resource-1226"><a href="#Mapper.resource-1226"><span class="linenos">1226</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">name_prefix</span> <span class="o">+</span> <span class="n">member_name</span><span class="p">,</span> <span class="n">member_path</span><span class="p">,</span> <span class="o">**</span><span class="n">route_options</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Generate routes for a controller resource</p>

<p>The member_name name should be the appropriate singular version
of the resource given your locale and used with members of the
collection. The collection_name name will be used to refer to
the resource collection methods and should be a plural version
of the member_name argument. By default, the member_name name
will also be assumed to map to a controller you create.</p>

<p>The concept of a web resource maps somewhat directly to 'CRUD'
operations. The overlying things to keep in mind is that
mapping a resource is about handling creating, viewing, and
editing that resource.</p>

<p>All keyword arguments are optional.</p>

<p><code>controller</code>
    If specified in the keyword args, the controller will be
    the actual controller used, but the rest of the naming
    conventions used for the route names and URL paths are
    unchanged.</p>

<p><code><a href="#Mapper.collection">collection</a></code>
    Additional action mappings used to manipulate/view the
    entire set of resources provided by the controller.</p>

<pre><code>Example::

    map.resource('message', 'messages', collection={'rss':'GET'})
    # GET /message/rss (maps to the rss action)
    # also adds named route "rss_message"
</code></pre>

<p><code>member</code>
    Additional action mappings used to access an individual
    'member' of this controllers resources.</p>

<pre><code>Example::

    map.resource('message', 'messages', member={'mark':'POST'})
    # POST /message/1/mark (maps to the mark action)
    # also adds named route "mark_message"
</code></pre>

<p><code>new</code>
    Action mappings that involve dealing with a new member in
    the controller resources.</p>

<pre><code>Example::

    map.resource('message', 'messages', new={'preview':'POST'})
    # POST /message/new/preview (maps to the preview action)
    # also adds a url named "preview_new_message"
</code></pre>

<p><code>path_prefix</code>
    Prepends the URL path for the Route with the path_prefix
    given. This is most useful for cases where you want to mix
    resources or relations between resources.</p>

<p><code>name_prefix</code>
    Perpends the route names that are generated with the
    name_prefix given. Combined with the path_prefix option,
    it's easy to generate route names and paths that represent
    resources that are in relations.</p>

<pre><code>Example::

    map.resource('message', 'messages', controller='categories',
        path_prefix='/category/:category_id',
        name_prefix="category_")
    # GET /category/7/message/1
    # has named route "category_message"
</code></pre>

<p><code>requirements</code></p>

<p>A dictionary that restricts the matching of a
   variable. Can be used when matching variables with path_prefix.</p>

<p>Example::</p>

<pre><code>    map.resource('message', 'messages',
         path_prefix='{project_id}/',
         requirements={"project_id": R"\d+"})
    # POST /01234/message
    #    success, project_id is set to "01234"
    # POST /foo/message
    #    404 not found, won't be matched by this route
</code></pre>

<p><code>parent_resource</code>
    A <code>dict</code> containing information about the parent
    resource, for creating a nested resource. It should contain
    the <code>member_name</code> and <code>collection_name</code> of the parent
    resource. This <code>dict</code> will
    be available via the associated <code>Route</code> object which can
    be accessed during a request via
    <code>request.environ['routes.route']</code></p>

<pre><code>If ``parent_resource`` is supplied and ``path_prefix``
isn't, ``path_prefix`` will be generated from
``parent_resource`` as
"&lt;parent collection name&gt;/:&lt;parent member name&gt;_id".

If ``parent_resource`` is supplied and ``name_prefix``
isn't, ``name_prefix`` will be generated from
``parent_resource`` as  "&lt;parent member name&gt;_".

Example::

    &gt;&gt;&gt; from routes.util import url_for
    &gt;&gt;&gt; m = Mapper()
    &gt;&gt;&gt; m.resource('location', 'locations',
    ...            parent_resource=dict(member_name='region',
    ...                                 collection_name='regions'))
    &gt;&gt;&gt; # path_prefix is "regions/:region_id"
    &gt;&gt;&gt; # name prefix is "region_"
    &gt;&gt;&gt; url_for('region_locations', region_id=13)
    '/regions/13/locations'
    &gt;&gt;&gt; url_for('region_new_location', region_id=13)
    '/regions/13/locations/new'
    &gt;&gt;&gt; url_for('region_location', region_id=13, id=60)
    '/regions/13/locations/60'
    &gt;&gt;&gt; url_for('region_edit_location', region_id=13, id=60)
    '/regions/13/locations/60/edit'

Overriding generated ``path_prefix``::

    &gt;&gt;&gt; m = Mapper()
    &gt;&gt;&gt; m.resource('location', 'locations',
    ...            parent_resource=dict(member_name='region',
    ...                                 collection_name='regions'),
    ...            path_prefix='areas/:area_id')
    &gt;&gt;&gt; # name prefix is "region_"
    &gt;&gt;&gt; url_for('region_locations', area_id=51)
    '/areas/51/locations'

Overriding generated ``name_prefix``::

    &gt;&gt;&gt; m = Mapper()
    &gt;&gt;&gt; m.resource('location', 'locations',
    ...            parent_resource=dict(member_name='region',
    ...                                 collection_name='regions'),
    ...            name_prefix='')
    &gt;&gt;&gt; # path_prefix is "regions/:region_id"
    &gt;&gt;&gt; url_for('locations', region_id=51)
    '/regions/51/locations'
</code></pre>
</div>


                            </div>
                            <div id="Mapper.redirect" class="classattr">
                                        <input id="Mapper.redirect-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">redirect</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">match_path</span>, </span><span class="param"><span class="n">destination_path</span>, </span><span class="param"><span class="o">*</span><span class="n">args</span>, </span><span class="param"><span class="o">**</span><span class="n">kwargs</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Mapper.redirect-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Mapper.redirect"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Mapper.redirect-1228"><a href="#Mapper.redirect-1228"><span class="linenos">1228</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">redirect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">match_path</span><span class="p">,</span> <span class="n">destination_path</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="Mapper.redirect-1229"><a href="#Mapper.redirect-1229"><span class="linenos">1229</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Add a redirect route to the mapper</span>
</span><span id="Mapper.redirect-1230"><a href="#Mapper.redirect-1230"><span class="linenos">1230</span></a>
</span><span id="Mapper.redirect-1231"><a href="#Mapper.redirect-1231"><span class="linenos">1231</span></a><span class="sd">        Redirect routes bypass the wrapped WSGI application and instead</span>
</span><span id="Mapper.redirect-1232"><a href="#Mapper.redirect-1232"><span class="linenos">1232</span></a><span class="sd">        result in a redirect being issued by the RoutesMiddleware. As</span>
</span><span id="Mapper.redirect-1233"><a href="#Mapper.redirect-1233"><span class="linenos">1233</span></a><span class="sd">        such, this method is only meaningful when using</span>
</span><span id="Mapper.redirect-1234"><a href="#Mapper.redirect-1234"><span class="linenos">1234</span></a><span class="sd">        RoutesMiddleware.</span>
</span><span id="Mapper.redirect-1235"><a href="#Mapper.redirect-1235"><span class="linenos">1235</span></a>
</span><span id="Mapper.redirect-1236"><a href="#Mapper.redirect-1236"><span class="linenos">1236</span></a><span class="sd">        By default, a 302 Found status code is used, this can be</span>
</span><span id="Mapper.redirect-1237"><a href="#Mapper.redirect-1237"><span class="linenos">1237</span></a><span class="sd">        changed by providing a ``_redirect_code`` keyword argument</span>
</span><span id="Mapper.redirect-1238"><a href="#Mapper.redirect-1238"><span class="linenos">1238</span></a><span class="sd">        which will then be used instead. Note that the entire status</span>
</span><span id="Mapper.redirect-1239"><a href="#Mapper.redirect-1239"><span class="linenos">1239</span></a><span class="sd">        code string needs to be present.</span>
</span><span id="Mapper.redirect-1240"><a href="#Mapper.redirect-1240"><span class="linenos">1240</span></a>
</span><span id="Mapper.redirect-1241"><a href="#Mapper.redirect-1241"><span class="linenos">1241</span></a><span class="sd">        When using keyword arguments, all arguments that apply to</span>
</span><span id="Mapper.redirect-1242"><a href="#Mapper.redirect-1242"><span class="linenos">1242</span></a><span class="sd">        matching will be used for the match, while generation specific</span>
</span><span id="Mapper.redirect-1243"><a href="#Mapper.redirect-1243"><span class="linenos">1243</span></a><span class="sd">        options will be used during generation. Thus all options</span>
</span><span id="Mapper.redirect-1244"><a href="#Mapper.redirect-1244"><span class="linenos">1244</span></a><span class="sd">        normally available to connected Routes may be used with</span>
</span><span id="Mapper.redirect-1245"><a href="#Mapper.redirect-1245"><span class="linenos">1245</span></a><span class="sd">        redirect routes as well.</span>
</span><span id="Mapper.redirect-1246"><a href="#Mapper.redirect-1246"><span class="linenos">1246</span></a>
</span><span id="Mapper.redirect-1247"><a href="#Mapper.redirect-1247"><span class="linenos">1247</span></a><span class="sd">        Example::</span>
</span><span id="Mapper.redirect-1248"><a href="#Mapper.redirect-1248"><span class="linenos">1248</span></a>
</span><span id="Mapper.redirect-1249"><a href="#Mapper.redirect-1249"><span class="linenos">1249</span></a><span class="sd">            map = Mapper()</span>
</span><span id="Mapper.redirect-1250"><a href="#Mapper.redirect-1250"><span class="linenos">1250</span></a><span class="sd">            map.redirect(&#39;/legacyapp/archives/{url:.*}&#39;, &#39;/archives/{url}&#39;)</span>
</span><span id="Mapper.redirect-1251"><a href="#Mapper.redirect-1251"><span class="linenos">1251</span></a><span class="sd">            map.redirect(&#39;/home/index&#39;, &#39;/&#39;,</span>
</span><span id="Mapper.redirect-1252"><a href="#Mapper.redirect-1252"><span class="linenos">1252</span></a><span class="sd">                         _redirect_code=&#39;301 Moved Permanently&#39;)</span>
</span><span id="Mapper.redirect-1253"><a href="#Mapper.redirect-1253"><span class="linenos">1253</span></a>
</span><span id="Mapper.redirect-1254"><a href="#Mapper.redirect-1254"><span class="linenos">1254</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Mapper.redirect-1255"><a href="#Mapper.redirect-1255"><span class="linenos">1255</span></a>        <span class="n">both_args</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;_encoding&#39;</span><span class="p">,</span> <span class="s1">&#39;_explicit&#39;</span><span class="p">,</span> <span class="s1">&#39;_minimize&#39;</span><span class="p">]</span>
</span><span id="Mapper.redirect-1256"><a href="#Mapper.redirect-1256"><span class="linenos">1256</span></a>        <span class="n">gen_args</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;_filter&#39;</span><span class="p">]</span>
</span><span id="Mapper.redirect-1257"><a href="#Mapper.redirect-1257"><span class="linenos">1257</span></a>
</span><span id="Mapper.redirect-1258"><a href="#Mapper.redirect-1258"><span class="linenos">1258</span></a>        <span class="n">status_code</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;_redirect_code&#39;</span><span class="p">,</span> <span class="s1">&#39;302 Found&#39;</span><span class="p">)</span>
</span><span id="Mapper.redirect-1259"><a href="#Mapper.redirect-1259"><span class="linenos">1259</span></a>        <span class="n">gen_dict</span><span class="p">,</span> <span class="n">match_dict</span> <span class="o">=</span> <span class="p">{},</span> <span class="p">{}</span>
</span><span id="Mapper.redirect-1260"><a href="#Mapper.redirect-1260"><span class="linenos">1260</span></a>
</span><span id="Mapper.redirect-1261"><a href="#Mapper.redirect-1261"><span class="linenos">1261</span></a>        <span class="c1"># Create the dict of args for the generation route</span>
</span><span id="Mapper.redirect-1262"><a href="#Mapper.redirect-1262"><span class="linenos">1262</span></a>        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">both_args</span> <span class="o">+</span> <span class="n">gen_args</span><span class="p">:</span>
</span><span id="Mapper.redirect-1263"><a href="#Mapper.redirect-1263"><span class="linenos">1263</span></a>            <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
</span><span id="Mapper.redirect-1264"><a href="#Mapper.redirect-1264"><span class="linenos">1264</span></a>                <span class="n">gen_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
</span><span id="Mapper.redirect-1265"><a href="#Mapper.redirect-1265"><span class="linenos">1265</span></a>        <span class="n">gen_dict</span><span class="p">[</span><span class="s1">&#39;_static&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="Mapper.redirect-1266"><a href="#Mapper.redirect-1266"><span class="linenos">1266</span></a>
</span><span id="Mapper.redirect-1267"><a href="#Mapper.redirect-1267"><span class="linenos">1267</span></a>        <span class="c1"># Create the dict of args for the matching route</span>
</span><span id="Mapper.redirect-1268"><a href="#Mapper.redirect-1268"><span class="linenos">1268</span></a>        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
</span><span id="Mapper.redirect-1269"><a href="#Mapper.redirect-1269"><span class="linenos">1269</span></a>            <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">gen_args</span><span class="p">:</span>
</span><span id="Mapper.redirect-1270"><a href="#Mapper.redirect-1270"><span class="linenos">1270</span></a>                <span class="n">match_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
</span><span id="Mapper.redirect-1271"><a href="#Mapper.redirect-1271"><span class="linenos">1271</span></a>
</span><span id="Mapper.redirect-1272"><a href="#Mapper.redirect-1272"><span class="linenos">1272</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">match_path</span><span class="p">,</span> <span class="o">**</span><span class="n">match_dict</span><span class="p">)</span>
</span><span id="Mapper.redirect-1273"><a href="#Mapper.redirect-1273"><span class="linenos">1273</span></a>        <span class="n">match_route</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">matchlist</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="Mapper.redirect-1274"><a href="#Mapper.redirect-1274"><span class="linenos">1274</span></a>
</span><span id="Mapper.redirect-1275"><a href="#Mapper.redirect-1275"><span class="linenos">1275</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;_redirect_</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="nb">id</span><span class="p">(</span><span class="n">match_route</span><span class="p">),</span> <span class="n">destination_path</span><span class="p">,</span>
</span><span id="Mapper.redirect-1276"><a href="#Mapper.redirect-1276"><span class="linenos">1276</span></a>                     <span class="o">**</span><span class="n">gen_dict</span><span class="p">)</span>
</span><span id="Mapper.redirect-1277"><a href="#Mapper.redirect-1277"><span class="linenos">1277</span></a>        <span class="n">match_route</span><span class="o">.</span><span class="n">redirect</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="Mapper.redirect-1278"><a href="#Mapper.redirect-1278"><span class="linenos">1278</span></a>        <span class="n">match_route</span><span class="o">.</span><span class="n">redirect_status</span> <span class="o">=</span> <span class="n">status_code</span>
</span></pre></div>


            <div class="docstring"><p>Add a redirect route to the mapper</p>

<p>Redirect routes bypass the wrapped WSGI application and instead
result in a redirect being issued by the RoutesMiddleware. As
such, this method is only meaningful when using
RoutesMiddleware.</p>

<p>By default, a 302 Found status code is used, this can be
changed by providing a <code>_redirect_code</code> keyword argument
which will then be used instead. Note that the entire status
code string needs to be present.</p>

<p>When using keyword arguments, all arguments that apply to
matching will be used for the match, while generation specific
options will be used during generation. Thus all options
normally available to connected Routes may be used with
redirect routes as well.</p>

<p>Example::</p>

<pre><code>map = Mapper()
map.redirect('/legacyapp/archives/{url:.*}', '/archives/{url}')
map.redirect('/home/index', '/',
             _redirect_code='301 Moved Permanently')
</code></pre>
</div>


                            </div>
                </section>
                <section id="url_for">
                            <input id="url_for-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">url_for</span><span class="signature pdoc-code condensed">(<span class="param"><span class="o">*</span><span class="n">args</span>, </span><span class="param"><span class="o">**</span><span class="n">kargs</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="url_for-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#url_for"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="url_for-140"><a href="#url_for-140"><span class="linenos">140</span></a><span class="k">def</span><span class="w"> </span><span class="nf">url_for</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">):</span>
</span><span id="url_for-141"><a href="#url_for-141"><span class="linenos">141</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Generates a URL</span>
</span><span id="url_for-142"><a href="#url_for-142"><span class="linenos">142</span></a>
</span><span id="url_for-143"><a href="#url_for-143"><span class="linenos">143</span></a><span class="sd">    All keys given to url_for are sent to the Routes Mapper instance for</span>
</span><span id="url_for-144"><a href="#url_for-144"><span class="linenos">144</span></a><span class="sd">    generation except for::</span>
</span><span id="url_for-145"><a href="#url_for-145"><span class="linenos">145</span></a>
</span><span id="url_for-146"><a href="#url_for-146"><span class="linenos">146</span></a><span class="sd">        anchor          specified the anchor name to be appened to the path</span>
</span><span id="url_for-147"><a href="#url_for-147"><span class="linenos">147</span></a><span class="sd">        host            overrides the default (current) host if provided</span>
</span><span id="url_for-148"><a href="#url_for-148"><span class="linenos">148</span></a><span class="sd">        protocol        overrides the default (current) protocol if provided</span>
</span><span id="url_for-149"><a href="#url_for-149"><span class="linenos">149</span></a><span class="sd">        qualified       creates the URL with the host/port information as</span>
</span><span id="url_for-150"><a href="#url_for-150"><span class="linenos">150</span></a><span class="sd">                        needed</span>
</span><span id="url_for-151"><a href="#url_for-151"><span class="linenos">151</span></a>
</span><span id="url_for-152"><a href="#url_for-152"><span class="linenos">152</span></a><span class="sd">    The URL is generated based on the rest of the keys. When generating a new</span>
</span><span id="url_for-153"><a href="#url_for-153"><span class="linenos">153</span></a><span class="sd">    URL, values will be used from the current request&#39;s parameters (if</span>
</span><span id="url_for-154"><a href="#url_for-154"><span class="linenos">154</span></a><span class="sd">    present). The following rules are used to determine when and how to keep</span>
</span><span id="url_for-155"><a href="#url_for-155"><span class="linenos">155</span></a><span class="sd">    the current requests parameters:</span>
</span><span id="url_for-156"><a href="#url_for-156"><span class="linenos">156</span></a>
</span><span id="url_for-157"><a href="#url_for-157"><span class="linenos">157</span></a><span class="sd">    * If the controller is present and begins with &#39;/&#39;, no defaults are used</span>
</span><span id="url_for-158"><a href="#url_for-158"><span class="linenos">158</span></a><span class="sd">    * If the controller is changed, action is set to &#39;index&#39; unless otherwise</span>
</span><span id="url_for-159"><a href="#url_for-159"><span class="linenos">159</span></a><span class="sd">      specified</span>
</span><span id="url_for-160"><a href="#url_for-160"><span class="linenos">160</span></a>
</span><span id="url_for-161"><a href="#url_for-161"><span class="linenos">161</span></a><span class="sd">    For example, if the current request yielded a dict of</span>
</span><span id="url_for-162"><a href="#url_for-162"><span class="linenos">162</span></a><span class="sd">    {&#39;controller&#39;: &#39;blog&#39;, &#39;action&#39;: &#39;view&#39;, &#39;id&#39;: 2}, with the standard</span>
</span><span id="url_for-163"><a href="#url_for-163"><span class="linenos">163</span></a><span class="sd">    &#39;:controller/:action/:id&#39; route, you&#39;d get the following results::</span>
</span><span id="url_for-164"><a href="#url_for-164"><span class="linenos">164</span></a>
</span><span id="url_for-165"><a href="#url_for-165"><span class="linenos">165</span></a><span class="sd">        url_for(id=4)                    =&gt;  &#39;/blog/view/4&#39;,</span>
</span><span id="url_for-166"><a href="#url_for-166"><span class="linenos">166</span></a><span class="sd">        url_for(controller=&#39;/admin&#39;)     =&gt;  &#39;/admin&#39;,</span>
</span><span id="url_for-167"><a href="#url_for-167"><span class="linenos">167</span></a><span class="sd">        url_for(controller=&#39;admin&#39;)      =&gt;  &#39;/admin/view/2&#39;</span>
</span><span id="url_for-168"><a href="#url_for-168"><span class="linenos">168</span></a><span class="sd">        url_for(action=&#39;edit&#39;)           =&gt;  &#39;/blog/edit/2&#39;,</span>
</span><span id="url_for-169"><a href="#url_for-169"><span class="linenos">169</span></a><span class="sd">        url_for(action=&#39;list&#39;, id=None)  =&gt;  &#39;/blog/list&#39;</span>
</span><span id="url_for-170"><a href="#url_for-170"><span class="linenos">170</span></a>
</span><span id="url_for-171"><a href="#url_for-171"><span class="linenos">171</span></a><span class="sd">    **Static and Named Routes**</span>
</span><span id="url_for-172"><a href="#url_for-172"><span class="linenos">172</span></a>
</span><span id="url_for-173"><a href="#url_for-173"><span class="linenos">173</span></a><span class="sd">    If there is a string present as the first argument, a lookup is done</span>
</span><span id="url_for-174"><a href="#url_for-174"><span class="linenos">174</span></a><span class="sd">    against the named routes table to see if there&#39;s any matching routes. The</span>
</span><span id="url_for-175"><a href="#url_for-175"><span class="linenos">175</span></a><span class="sd">    keyword defaults used with static routes will be sent in as GET query</span>
</span><span id="url_for-176"><a href="#url_for-176"><span class="linenos">176</span></a><span class="sd">    arg&#39;s if a route matches.</span>
</span><span id="url_for-177"><a href="#url_for-177"><span class="linenos">177</span></a>
</span><span id="url_for-178"><a href="#url_for-178"><span class="linenos">178</span></a><span class="sd">    If no route by that name is found, the string is assumed to be a raw URL.</span>
</span><span id="url_for-179"><a href="#url_for-179"><span class="linenos">179</span></a><span class="sd">    Should the raw URL begin with ``/`` then appropriate SCRIPT_NAME data will</span>
</span><span id="url_for-180"><a href="#url_for-180"><span class="linenos">180</span></a><span class="sd">    be added if present, otherwise the string will be used as the url with</span>
</span><span id="url_for-181"><a href="#url_for-181"><span class="linenos">181</span></a><span class="sd">    keyword args becoming GET query args.</span>
</span><span id="url_for-182"><a href="#url_for-182"><span class="linenos">182</span></a>
</span><span id="url_for-183"><a href="#url_for-183"><span class="linenos">183</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="url_for-184"><a href="#url_for-184"><span class="linenos">184</span></a>    <span class="n">anchor</span> <span class="o">=</span> <span class="n">kargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;anchor&#39;</span><span class="p">)</span>
</span><span id="url_for-185"><a href="#url_for-185"><span class="linenos">185</span></a>    <span class="n">host</span> <span class="o">=</span> <span class="n">kargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;host&#39;</span><span class="p">)</span>
</span><span id="url_for-186"><a href="#url_for-186"><span class="linenos">186</span></a>    <span class="n">protocol</span> <span class="o">=</span> <span class="n">kargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;protocol&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="url_for-187"><a href="#url_for-187"><span class="linenos">187</span></a>    <span class="n">qualified</span> <span class="o">=</span> <span class="n">kargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;qualified&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="url_for-188"><a href="#url_for-188"><span class="linenos">188</span></a>
</span><span id="url_for-189"><a href="#url_for-189"><span class="linenos">189</span></a>    <span class="c1"># Remove special words from kargs, convert placeholders</span>
</span><span id="url_for-190"><a href="#url_for-190"><span class="linenos">190</span></a>    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;anchor&#39;</span><span class="p">,</span> <span class="s1">&#39;host&#39;</span><span class="p">]:</span>
</span><span id="url_for-191"><a href="#url_for-191"><span class="linenos">191</span></a>        <span class="k">if</span> <span class="n">kargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">):</span>
</span><span id="url_for-192"><a href="#url_for-192"><span class="linenos">192</span></a>            <span class="k">del</span> <span class="n">kargs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
</span><span id="url_for-193"><a href="#url_for-193"><span class="linenos">193</span></a>        <span class="k">if</span> <span class="n">key</span><span class="o">+</span><span class="s1">&#39;_&#39;</span> <span class="ow">in</span> <span class="n">kargs</span><span class="p">:</span>
</span><span id="url_for-194"><a href="#url_for-194"><span class="linenos">194</span></a>            <span class="n">kargs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">kargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">key</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="p">)</span>
</span><span id="url_for-195"><a href="#url_for-195"><span class="linenos">195</span></a>
</span><span id="url_for-196"><a href="#url_for-196"><span class="linenos">196</span></a>    <span class="k">if</span> <span class="s1">&#39;protocol_&#39;</span> <span class="ow">in</span> <span class="n">kargs</span><span class="p">:</span>
</span><span id="url_for-197"><a href="#url_for-197"><span class="linenos">197</span></a>        <span class="n">kargs</span><span class="p">[</span><span class="s1">&#39;protocol_&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">protocol</span>
</span><span id="url_for-198"><a href="#url_for-198"><span class="linenos">198</span></a>
</span><span id="url_for-199"><a href="#url_for-199"><span class="linenos">199</span></a>    <span class="n">config</span> <span class="o">=</span> <span class="n">request_config</span><span class="p">()</span>
</span><span id="url_for-200"><a href="#url_for-200"><span class="linenos">200</span></a>    <span class="n">route</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="url_for-201"><a href="#url_for-201"><span class="linenos">201</span></a>    <span class="n">static</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="url_for-202"><a href="#url_for-202"><span class="linenos">202</span></a>    <span class="n">encoding</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">encoding</span>
</span><span id="url_for-203"><a href="#url_for-203"><span class="linenos">203</span></a>    <span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
</span><span id="url_for-204"><a href="#url_for-204"><span class="linenos">204</span></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="url_for-205"><a href="#url_for-205"><span class="linenos">205</span></a>        <span class="n">route</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">_routenames</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="url_for-206"><a href="#url_for-206"><span class="linenos">206</span></a>
</span><span id="url_for-207"><a href="#url_for-207"><span class="linenos">207</span></a>        <span class="c1"># No named route found, assume the argument is a relative path</span>
</span><span id="url_for-208"><a href="#url_for-208"><span class="linenos">208</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">route</span><span class="p">:</span>
</span><span id="url_for-209"><a href="#url_for-209"><span class="linenos">209</span></a>            <span class="n">static</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="url_for-210"><a href="#url_for-210"><span class="linenos">210</span></a>            <span class="n">url</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="url_for-211"><a href="#url_for-211"><span class="linenos">211</span></a>
</span><span id="url_for-212"><a href="#url_for-212"><span class="linenos">212</span></a>        <span class="k">if</span> <span class="n">url</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="s1">&#39;environ&#39;</span><span class="p">)</span> \
</span><span id="url_for-213"><a href="#url_for-213"><span class="linenos">213</span></a>                <span class="ow">and</span> <span class="n">config</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;SCRIPT_NAME&#39;</span><span class="p">):</span>
</span><span id="url_for-214"><a href="#url_for-214"><span class="linenos">214</span></a>            <span class="n">url</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;SCRIPT_NAME&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="n">url</span>
</span><span id="url_for-215"><a href="#url_for-215"><span class="linenos">215</span></a>
</span><span id="url_for-216"><a href="#url_for-216"><span class="linenos">216</span></a>        <span class="k">if</span> <span class="n">static</span><span class="p">:</span>
</span><span id="url_for-217"><a href="#url_for-217"><span class="linenos">217</span></a>            <span class="k">if</span> <span class="n">kargs</span><span class="p">:</span>
</span><span id="url_for-218"><a href="#url_for-218"><span class="linenos">218</span></a>                <span class="n">url</span> <span class="o">+=</span> <span class="s1">&#39;?&#39;</span>
</span><span id="url_for-219"><a href="#url_for-219"><span class="linenos">219</span></a>                <span class="n">query_args</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="url_for-220"><a href="#url_for-220"><span class="linenos">220</span></a>                <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">six</span><span class="o">.</span><span class="n">iteritems</span><span class="p">(</span><span class="n">kargs</span><span class="p">):</span>
</span><span id="url_for-221"><a href="#url_for-221"><span class="linenos">221</span></a>                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
</span><span id="url_for-222"><a href="#url_for-222"><span class="linenos">222</span></a>                        <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">val</span><span class="p">:</span>
</span><span id="url_for-223"><a href="#url_for-223"><span class="linenos">223</span></a>                            <span class="n">query_args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">=</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
</span><span id="url_for-224"><a href="#url_for-224"><span class="linenos">224</span></a>                                <span class="n">urllib</span><span class="o">.</span><span class="n">parse</span><span class="o">.</span><span class="n">quote</span><span class="p">(</span><span class="n">six</span><span class="o">.</span><span class="n">text_type</span><span class="p">(</span><span class="n">key</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">encoding</span><span class="p">)),</span>
</span><span id="url_for-225"><a href="#url_for-225"><span class="linenos">225</span></a>                                <span class="n">urllib</span><span class="o">.</span><span class="n">parse</span><span class="o">.</span><span class="n">quote</span><span class="p">(</span><span class="n">six</span><span class="o">.</span><span class="n">text_type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">encoding</span><span class="p">))))</span>
</span><span id="url_for-226"><a href="#url_for-226"><span class="linenos">226</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="url_for-227"><a href="#url_for-227"><span class="linenos">227</span></a>                        <span class="n">query_args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">=</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
</span><span id="url_for-228"><a href="#url_for-228"><span class="linenos">228</span></a>                            <span class="n">urllib</span><span class="o">.</span><span class="n">parse</span><span class="o">.</span><span class="n">quote</span><span class="p">(</span><span class="n">six</span><span class="o">.</span><span class="n">text_type</span><span class="p">(</span><span class="n">key</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">encoding</span><span class="p">)),</span>
</span><span id="url_for-229"><a href="#url_for-229"><span class="linenos">229</span></a>                            <span class="n">urllib</span><span class="o">.</span><span class="n">parse</span><span class="o">.</span><span class="n">quote</span><span class="p">(</span><span class="n">six</span><span class="o">.</span><span class="n">text_type</span><span class="p">(</span><span class="n">val</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">encoding</span><span class="p">))))</span>
</span><span id="url_for-230"><a href="#url_for-230"><span class="linenos">230</span></a>                <span class="n">url</span> <span class="o">+=</span> <span class="s1">&#39;&amp;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">query_args</span><span class="p">)</span>
</span><span id="url_for-231"><a href="#url_for-231"><span class="linenos">231</span></a>    <span class="n">environ</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="s1">&#39;environ&#39;</span><span class="p">,</span> <span class="p">{})</span>
</span><span id="url_for-232"><a href="#url_for-232"><span class="linenos">232</span></a>    <span class="k">if</span> <span class="s1">&#39;wsgiorg.routing_args&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">environ</span><span class="p">:</span>
</span><span id="url_for-233"><a href="#url_for-233"><span class="linenos">233</span></a>        <span class="n">environ</span> <span class="o">=</span> <span class="n">environ</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="url_for-234"><a href="#url_for-234"><span class="linenos">234</span></a>        <span class="n">mapper_dict</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="s1">&#39;mapper_dict&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="url_for-235"><a href="#url_for-235"><span class="linenos">235</span></a>        <span class="k">if</span> <span class="n">mapper_dict</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="url_for-236"><a href="#url_for-236"><span class="linenos">236</span></a>            <span class="n">match_dict</span> <span class="o">=</span> <span class="n">mapper_dict</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="url_for-237"><a href="#url_for-237"><span class="linenos">237</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="url_for-238"><a href="#url_for-238"><span class="linenos">238</span></a>            <span class="n">match_dict</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="url_for-239"><a href="#url_for-239"><span class="linenos">239</span></a>        <span class="n">environ</span><span class="p">[</span><span class="s1">&#39;wsgiorg.routing_args&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">((),</span> <span class="n">match_dict</span><span class="p">)</span>
</span><span id="url_for-240"><a href="#url_for-240"><span class="linenos">240</span></a>
</span><span id="url_for-241"><a href="#url_for-241"><span class="linenos">241</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">static</span><span class="p">:</span>
</span><span id="url_for-242"><a href="#url_for-242"><span class="linenos">242</span></a>        <span class="n">route_args</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="url_for-243"><a href="#url_for-243"><span class="linenos">243</span></a>        <span class="k">if</span> <span class="n">route</span><span class="p">:</span>
</span><span id="url_for-244"><a href="#url_for-244"><span class="linenos">244</span></a>            <span class="k">if</span> <span class="n">config</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">hardcode_names</span><span class="p">:</span>
</span><span id="url_for-245"><a href="#url_for-245"><span class="linenos">245</span></a>                <span class="n">route_args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">route</span><span class="p">)</span>
</span><span id="url_for-246"><a href="#url_for-246"><span class="linenos">246</span></a>            <span class="n">newargs</span> <span class="o">=</span> <span class="n">route</span><span class="o">.</span><span class="n">defaults</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="url_for-247"><a href="#url_for-247"><span class="linenos">247</span></a>            <span class="n">newargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kargs</span><span class="p">)</span>
</span><span id="url_for-248"><a href="#url_for-248"><span class="linenos">248</span></a>
</span><span id="url_for-249"><a href="#url_for-249"><span class="linenos">249</span></a>            <span class="c1"># If this route has a filter, apply it</span>
</span><span id="url_for-250"><a href="#url_for-250"><span class="linenos">250</span></a>            <span class="k">if</span> <span class="n">route</span><span class="o">.</span><span class="n">filter</span><span class="p">:</span>
</span><span id="url_for-251"><a href="#url_for-251"><span class="linenos">251</span></a>                <span class="n">newargs</span> <span class="o">=</span> <span class="n">route</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">newargs</span><span class="p">)</span>
</span><span id="url_for-252"><a href="#url_for-252"><span class="linenos">252</span></a>
</span><span id="url_for-253"><a href="#url_for-253"><span class="linenos">253</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">route</span><span class="o">.</span><span class="n">static</span><span class="p">:</span>
</span><span id="url_for-254"><a href="#url_for-254"><span class="linenos">254</span></a>                <span class="c1"># Handle sub-domains</span>
</span><span id="url_for-255"><a href="#url_for-255"><span class="linenos">255</span></a>                <span class="n">newargs</span> <span class="o">=</span> <span class="n">_subdomain_check</span><span class="p">(</span><span class="n">newargs</span><span class="p">,</span> <span class="n">config</span><span class="o">.</span><span class="n">mapper</span><span class="p">,</span> <span class="n">environ</span><span class="p">)</span>
</span><span id="url_for-256"><a href="#url_for-256"><span class="linenos">256</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="url_for-257"><a href="#url_for-257"><span class="linenos">257</span></a>            <span class="n">newargs</span> <span class="o">=</span> <span class="n">_screenargs</span><span class="p">(</span><span class="n">kargs</span><span class="p">,</span> <span class="n">config</span><span class="o">.</span><span class="n">mapper</span><span class="p">,</span> <span class="n">environ</span><span class="p">)</span>
</span><span id="url_for-258"><a href="#url_for-258"><span class="linenos">258</span></a>        <span class="n">anchor</span> <span class="o">=</span> <span class="n">newargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;_anchor&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="n">anchor</span>
</span><span id="url_for-259"><a href="#url_for-259"><span class="linenos">259</span></a>        <span class="n">host</span> <span class="o">=</span> <span class="n">newargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;_host&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="n">host</span>
</span><span id="url_for-260"><a href="#url_for-260"><span class="linenos">260</span></a>        <span class="n">protocol</span> <span class="o">=</span> <span class="n">newargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;_protocol&#39;</span><span class="p">,</span> <span class="n">protocol</span><span class="p">)</span>
</span><span id="url_for-261"><a href="#url_for-261"><span class="linenos">261</span></a>        <span class="n">url</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="o">*</span><span class="n">route_args</span><span class="p">,</span> <span class="o">**</span><span class="n">newargs</span><span class="p">)</span>
</span><span id="url_for-262"><a href="#url_for-262"><span class="linenos">262</span></a>    <span class="k">if</span> <span class="n">anchor</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="url_for-263"><a href="#url_for-263"><span class="linenos">263</span></a>        <span class="n">url</span> <span class="o">+=</span> <span class="s1">&#39;#&#39;</span> <span class="o">+</span> <span class="n">_url_quote</span><span class="p">(</span><span class="n">anchor</span><span class="p">,</span> <span class="n">encoding</span><span class="p">)</span>
</span><span id="url_for-264"><a href="#url_for-264"><span class="linenos">264</span></a>    <span class="k">if</span> <span class="n">host</span> <span class="ow">or</span> <span class="p">(</span><span class="n">protocol</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="n">qualified</span><span class="p">:</span>
</span><span id="url_for-265"><a href="#url_for-265"><span class="linenos">265</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">host</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">qualified</span><span class="p">:</span>
</span><span id="url_for-266"><a href="#url_for-266"><span class="linenos">266</span></a>            <span class="c1"># Ensure we don&#39;t use a specific port, as changing the protocol</span>
</span><span id="url_for-267"><a href="#url_for-267"><span class="linenos">267</span></a>            <span class="c1"># means that we most likely need a new port</span>
</span><span id="url_for-268"><a href="#url_for-268"><span class="linenos">268</span></a>            <span class="n">host</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">host</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="url_for-269"><a href="#url_for-269"><span class="linenos">269</span></a>        <span class="k">elif</span> <span class="ow">not</span> <span class="n">host</span><span class="p">:</span>
</span><span id="url_for-270"><a href="#url_for-270"><span class="linenos">270</span></a>            <span class="n">host</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">host</span>
</span><span id="url_for-271"><a href="#url_for-271"><span class="linenos">271</span></a>        <span class="k">if</span> <span class="n">protocol</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="url_for-272"><a href="#url_for-272"><span class="linenos">272</span></a>            <span class="n">protocol</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">protocol</span>
</span><span id="url_for-273"><a href="#url_for-273"><span class="linenos">273</span></a>        <span class="k">if</span> <span class="n">protocol</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
</span><span id="url_for-274"><a href="#url_for-274"><span class="linenos">274</span></a>            <span class="n">protocol</span> <span class="o">+=</span> <span class="s1">&#39;:&#39;</span>
</span><span id="url_for-275"><a href="#url_for-275"><span class="linenos">275</span></a>        <span class="k">if</span> <span class="n">url</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="url_for-276"><a href="#url_for-276"><span class="linenos">276</span></a>            <span class="n">url</span> <span class="o">=</span> <span class="n">protocol</span> <span class="o">+</span> <span class="s1">&#39;//&#39;</span> <span class="o">+</span> <span class="n">host</span> <span class="o">+</span> <span class="n">url</span>
</span><span id="url_for-277"><a href="#url_for-277"><span class="linenos">277</span></a>
</span><span id="url_for-278"><a href="#url_for-278"><span class="linenos">278</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">ascii_characters</span><span class="p">(</span><span class="n">url</span><span class="p">)</span> <span class="ow">and</span> <span class="n">url</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="url_for-279"><a href="#url_for-279"><span class="linenos">279</span></a>        <span class="k">raise</span> <span class="n">GenerationException</span><span class="p">(</span><span class="s2">&quot;url_for can only return a string, got &quot;</span>
</span><span id="url_for-280"><a href="#url_for-280"><span class="linenos">280</span></a>                        <span class="s2">&quot;unicode instead: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">url</span><span class="p">)</span>
</span><span id="url_for-281"><a href="#url_for-281"><span class="linenos">281</span></a>    <span class="k">if</span> <span class="n">url</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="url_for-282"><a href="#url_for-282"><span class="linenos">282</span></a>        <span class="k">raise</span> <span class="n">GenerationException</span><span class="p">(</span>
</span><span id="url_for-283"><a href="#url_for-283"><span class="linenos">283</span></a>            <span class="s2">&quot;url_for could not generate URL. Called with args: </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> \
</span><span id="url_for-284"><a href="#url_for-284"><span class="linenos">284</span></a>            <span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">kargs</span><span class="p">))</span>
</span><span id="url_for-285"><a href="#url_for-285"><span class="linenos">285</span></a>    <span class="k">return</span> <span class="n">url</span>
</span></pre></div>


            <div class="docstring"><p>Generates a URL</p>

<p>All keys given to url_for are sent to the Routes Mapper instance for
generation except for::</p>

<pre><code>anchor          specified the anchor name to be appened to the path
host            overrides the default (current) host if provided
protocol        overrides the default (current) protocol if provided
qualified       creates the URL with the host/port information as
                needed
</code></pre>

<p>The URL is generated based on the rest of the keys. When generating a new
URL, values will be used from the current request's parameters (if
present). The following rules are used to determine when and how to keep
the current requests parameters:</p>

<ul>
<li>If the controller is present and begins with '/', no defaults are used</li>
<li>If the controller is changed, action is set to 'index' unless otherwise
specified</li>
</ul>

<p>For example, if the current request yielded a dict of
{'controller': 'blog', 'action': 'view', 'id': 2}, with the standard
':controller/:action/:id' route, you'd get the following results::</p>

<pre><code>url_for(id=4)                    =&gt;  '/blog/view/4',
url_for(controller='/admin')     =&gt;  '/admin',
url_for(controller='admin')      =&gt;  '/admin/view/2'
url_for(action='edit')           =&gt;  '/blog/edit/2',
url_for(action='list', id=None)  =&gt;  '/blog/list'
</code></pre>

<p><strong>Static and Named Routes</strong></p>

<p>If there is a string present as the first argument, a lookup is done
against the named routes table to see if there's any matching routes. The
keyword defaults used with static routes will be sent in as GET query
arg's if a route matches.</p>

<p>If no route by that name is found, the string is assumed to be a raw URL.
Should the raw URL begin with <code>/</code> then appropriate SCRIPT_NAME data will
be added if present, otherwise the string will be used as the url with
keyword args becoming GET query args.</p>
</div>


                </section>
                <section id="URLGenerator">
                            <input id="URLGenerator-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">URLGenerator</span>:

                <label class="view-source-button" for="URLGenerator-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#URLGenerator"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="URLGenerator-288"><a href="#URLGenerator-288"><span class="linenos">288</span></a><span class="k">class</span><span class="w"> </span><span class="nc">URLGenerator</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
</span><span id="URLGenerator-289"><a href="#URLGenerator-289"><span class="linenos">289</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;The URL Generator generates URL&#39;s</span>
</span><span id="URLGenerator-290"><a href="#URLGenerator-290"><span class="linenos">290</span></a>
</span><span id="URLGenerator-291"><a href="#URLGenerator-291"><span class="linenos">291</span></a><span class="sd">    It is automatically instantiated by the RoutesMiddleware and put</span>
</span><span id="URLGenerator-292"><a href="#URLGenerator-292"><span class="linenos">292</span></a><span class="sd">    into the ``wsgiorg.routing_args`` tuple accessible as::</span>
</span><span id="URLGenerator-293"><a href="#URLGenerator-293"><span class="linenos">293</span></a>
</span><span id="URLGenerator-294"><a href="#URLGenerator-294"><span class="linenos">294</span></a><span class="sd">        url = environ[&#39;wsgiorg.routing_args&#39;][0][0]</span>
</span><span id="URLGenerator-295"><a href="#URLGenerator-295"><span class="linenos">295</span></a>
</span><span id="URLGenerator-296"><a href="#URLGenerator-296"><span class="linenos">296</span></a><span class="sd">    Or via the ``routes.url`` key::</span>
</span><span id="URLGenerator-297"><a href="#URLGenerator-297"><span class="linenos">297</span></a>
</span><span id="URLGenerator-298"><a href="#URLGenerator-298"><span class="linenos">298</span></a><span class="sd">        url = environ[&#39;routes.url&#39;]</span>
</span><span id="URLGenerator-299"><a href="#URLGenerator-299"><span class="linenos">299</span></a>
</span><span id="URLGenerator-300"><a href="#URLGenerator-300"><span class="linenos">300</span></a><span class="sd">    The url object may be instantiated outside of a web context for use</span>
</span><span id="URLGenerator-301"><a href="#URLGenerator-301"><span class="linenos">301</span></a><span class="sd">    in testing, however sub_domain support and fully qualified URL&#39;s</span>
</span><span id="URLGenerator-302"><a href="#URLGenerator-302"><span class="linenos">302</span></a><span class="sd">    cannot be generated without supplying a dict that must contain the</span>
</span><span id="URLGenerator-303"><a href="#URLGenerator-303"><span class="linenos">303</span></a><span class="sd">    key ``HTTP_HOST``.</span>
</span><span id="URLGenerator-304"><a href="#URLGenerator-304"><span class="linenos">304</span></a>
</span><span id="URLGenerator-305"><a href="#URLGenerator-305"><span class="linenos">305</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="URLGenerator-306"><a href="#URLGenerator-306"><span class="linenos">306</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mapper</span><span class="p">,</span> <span class="n">environ</span><span class="p">):</span>
</span><span id="URLGenerator-307"><a href="#URLGenerator-307"><span class="linenos">307</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Instantiate the URLGenerator</span>
</span><span id="URLGenerator-308"><a href="#URLGenerator-308"><span class="linenos">308</span></a>
</span><span id="URLGenerator-309"><a href="#URLGenerator-309"><span class="linenos">309</span></a><span class="sd">        ``mapper``</span>
</span><span id="URLGenerator-310"><a href="#URLGenerator-310"><span class="linenos">310</span></a><span class="sd">            The mapper object to use when generating routes.</span>
</span><span id="URLGenerator-311"><a href="#URLGenerator-311"><span class="linenos">311</span></a><span class="sd">        ``environ``</span>
</span><span id="URLGenerator-312"><a href="#URLGenerator-312"><span class="linenos">312</span></a><span class="sd">            The environment dict used in WSGI, alternately, any dict</span>
</span><span id="URLGenerator-313"><a href="#URLGenerator-313"><span class="linenos">313</span></a><span class="sd">            that contains at least an ``HTTP_HOST`` value.</span>
</span><span id="URLGenerator-314"><a href="#URLGenerator-314"><span class="linenos">314</span></a>
</span><span id="URLGenerator-315"><a href="#URLGenerator-315"><span class="linenos">315</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="URLGenerator-316"><a href="#URLGenerator-316"><span class="linenos">316</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">mapper</span> <span class="o">=</span> <span class="n">mapper</span>
</span><span id="URLGenerator-317"><a href="#URLGenerator-317"><span class="linenos">317</span></a>        <span class="k">if</span> <span class="s1">&#39;SCRIPT_NAME&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">environ</span><span class="p">:</span>
</span><span id="URLGenerator-318"><a href="#URLGenerator-318"><span class="linenos">318</span></a>            <span class="n">environ</span><span class="p">[</span><span class="s1">&#39;SCRIPT_NAME&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
</span><span id="URLGenerator-319"><a href="#URLGenerator-319"><span class="linenos">319</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">environ</span> <span class="o">=</span> <span class="n">environ</span>
</span><span id="URLGenerator-320"><a href="#URLGenerator-320"><span class="linenos">320</span></a>
</span><span id="URLGenerator-321"><a href="#URLGenerator-321"><span class="linenos">321</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">):</span>
</span><span id="URLGenerator-322"><a href="#URLGenerator-322"><span class="linenos">322</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Generates a URL</span>
</span><span id="URLGenerator-323"><a href="#URLGenerator-323"><span class="linenos">323</span></a>
</span><span id="URLGenerator-324"><a href="#URLGenerator-324"><span class="linenos">324</span></a><span class="sd">        All keys given to url_for are sent to the Routes Mapper instance for</span>
</span><span id="URLGenerator-325"><a href="#URLGenerator-325"><span class="linenos">325</span></a><span class="sd">        generation except for::</span>
</span><span id="URLGenerator-326"><a href="#URLGenerator-326"><span class="linenos">326</span></a>
</span><span id="URLGenerator-327"><a href="#URLGenerator-327"><span class="linenos">327</span></a><span class="sd">            anchor          specified the anchor name to be appened to the path</span>
</span><span id="URLGenerator-328"><a href="#URLGenerator-328"><span class="linenos">328</span></a><span class="sd">            host            overrides the default (current) host if provided</span>
</span><span id="URLGenerator-329"><a href="#URLGenerator-329"><span class="linenos">329</span></a><span class="sd">            protocol        overrides the default (current) protocol if provided</span>
</span><span id="URLGenerator-330"><a href="#URLGenerator-330"><span class="linenos">330</span></a><span class="sd">            qualified       creates the URL with the host/port information as</span>
</span><span id="URLGenerator-331"><a href="#URLGenerator-331"><span class="linenos">331</span></a><span class="sd">                            needed</span>
</span><span id="URLGenerator-332"><a href="#URLGenerator-332"><span class="linenos">332</span></a>
</span><span id="URLGenerator-333"><a href="#URLGenerator-333"><span class="linenos">333</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="URLGenerator-334"><a href="#URLGenerator-334"><span class="linenos">334</span></a>        <span class="n">anchor</span> <span class="o">=</span> <span class="n">kargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;anchor&#39;</span><span class="p">)</span>
</span><span id="URLGenerator-335"><a href="#URLGenerator-335"><span class="linenos">335</span></a>        <span class="n">host</span> <span class="o">=</span> <span class="n">kargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;host&#39;</span><span class="p">)</span>
</span><span id="URLGenerator-336"><a href="#URLGenerator-336"><span class="linenos">336</span></a>        <span class="n">protocol</span> <span class="o">=</span> <span class="n">kargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;protocol&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="URLGenerator-337"><a href="#URLGenerator-337"><span class="linenos">337</span></a>        <span class="n">qualified</span> <span class="o">=</span> <span class="n">kargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;qualified&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="URLGenerator-338"><a href="#URLGenerator-338"><span class="linenos">338</span></a>
</span><span id="URLGenerator-339"><a href="#URLGenerator-339"><span class="linenos">339</span></a>        <span class="c1"># Remove special words from kargs, convert placeholders</span>
</span><span id="URLGenerator-340"><a href="#URLGenerator-340"><span class="linenos">340</span></a>        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;anchor&#39;</span><span class="p">,</span> <span class="s1">&#39;host&#39;</span><span class="p">]:</span>
</span><span id="URLGenerator-341"><a href="#URLGenerator-341"><span class="linenos">341</span></a>            <span class="k">if</span> <span class="n">kargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">):</span>
</span><span id="URLGenerator-342"><a href="#URLGenerator-342"><span class="linenos">342</span></a>                <span class="k">del</span> <span class="n">kargs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
</span><span id="URLGenerator-343"><a href="#URLGenerator-343"><span class="linenos">343</span></a>            <span class="k">if</span> <span class="n">key</span><span class="o">+</span><span class="s1">&#39;_&#39;</span> <span class="ow">in</span> <span class="n">kargs</span><span class="p">:</span>
</span><span id="URLGenerator-344"><a href="#URLGenerator-344"><span class="linenos">344</span></a>                <span class="n">kargs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">kargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">key</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="p">)</span>
</span><span id="URLGenerator-345"><a href="#URLGenerator-345"><span class="linenos">345</span></a>
</span><span id="URLGenerator-346"><a href="#URLGenerator-346"><span class="linenos">346</span></a>        <span class="k">if</span> <span class="s1">&#39;protocol_&#39;</span> <span class="ow">in</span> <span class="n">kargs</span><span class="p">:</span>
</span><span id="URLGenerator-347"><a href="#URLGenerator-347"><span class="linenos">347</span></a>            <span class="n">kargs</span><span class="p">[</span><span class="s1">&#39;protocol_&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">protocol</span>
</span><span id="URLGenerator-348"><a href="#URLGenerator-348"><span class="linenos">348</span></a>
</span><span id="URLGenerator-349"><a href="#URLGenerator-349"><span class="linenos">349</span></a>        <span class="n">route</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="URLGenerator-350"><a href="#URLGenerator-350"><span class="linenos">350</span></a>        <span class="n">use_current</span> <span class="o">=</span> <span class="s1">&#39;_use_current&#39;</span> <span class="ow">in</span> <span class="n">kargs</span> <span class="ow">and</span> <span class="n">kargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;_use_current&#39;</span><span class="p">)</span>
</span><span id="URLGenerator-351"><a href="#URLGenerator-351"><span class="linenos">351</span></a>
</span><span id="URLGenerator-352"><a href="#URLGenerator-352"><span class="linenos">352</span></a>        <span class="n">static</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="URLGenerator-353"><a href="#URLGenerator-353"><span class="linenos">353</span></a>        <span class="n">encoding</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">encoding</span>
</span><span id="URLGenerator-354"><a href="#URLGenerator-354"><span class="linenos">354</span></a>        <span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
</span><span id="URLGenerator-355"><a href="#URLGenerator-355"><span class="linenos">355</span></a>
</span><span id="URLGenerator-356"><a href="#URLGenerator-356"><span class="linenos">356</span></a>        <span class="n">more_args</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="URLGenerator-357"><a href="#URLGenerator-357"><span class="linenos">357</span></a>        <span class="k">if</span> <span class="n">more_args</span><span class="p">:</span>
</span><span id="URLGenerator-358"><a href="#URLGenerator-358"><span class="linenos">358</span></a>            <span class="n">route</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">_routenames</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="URLGenerator-359"><a href="#URLGenerator-359"><span class="linenos">359</span></a>
</span><span id="URLGenerator-360"><a href="#URLGenerator-360"><span class="linenos">360</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">route</span> <span class="ow">and</span> <span class="n">more_args</span><span class="p">:</span>
</span><span id="URLGenerator-361"><a href="#URLGenerator-361"><span class="linenos">361</span></a>            <span class="n">static</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="URLGenerator-362"><a href="#URLGenerator-362"><span class="linenos">362</span></a>            <span class="n">url</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="URLGenerator-363"><a href="#URLGenerator-363"><span class="linenos">363</span></a>            <span class="k">if</span> <span class="n">url</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;SCRIPT_NAME&#39;</span><span class="p">):</span>
</span><span id="URLGenerator-364"><a href="#URLGenerator-364"><span class="linenos">364</span></a>                <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;SCRIPT_NAME&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="n">url</span>
</span><span id="URLGenerator-365"><a href="#URLGenerator-365"><span class="linenos">365</span></a>
</span><span id="URLGenerator-366"><a href="#URLGenerator-366"><span class="linenos">366</span></a>            <span class="k">if</span> <span class="n">static</span><span class="p">:</span>
</span><span id="URLGenerator-367"><a href="#URLGenerator-367"><span class="linenos">367</span></a>                <span class="k">if</span> <span class="n">kargs</span><span class="p">:</span>
</span><span id="URLGenerator-368"><a href="#URLGenerator-368"><span class="linenos">368</span></a>                    <span class="n">url</span> <span class="o">+=</span> <span class="s1">&#39;?&#39;</span>
</span><span id="URLGenerator-369"><a href="#URLGenerator-369"><span class="linenos">369</span></a>                    <span class="n">query_args</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="URLGenerator-370"><a href="#URLGenerator-370"><span class="linenos">370</span></a>                    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">six</span><span class="o">.</span><span class="n">iteritems</span><span class="p">(</span><span class="n">kargs</span><span class="p">):</span>
</span><span id="URLGenerator-371"><a href="#URLGenerator-371"><span class="linenos">371</span></a>                        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
</span><span id="URLGenerator-372"><a href="#URLGenerator-372"><span class="linenos">372</span></a>                            <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">val</span><span class="p">:</span>
</span><span id="URLGenerator-373"><a href="#URLGenerator-373"><span class="linenos">373</span></a>                                <span class="n">query_args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">=</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
</span><span id="URLGenerator-374"><a href="#URLGenerator-374"><span class="linenos">374</span></a>                                    <span class="n">urllib</span><span class="o">.</span><span class="n">parse</span><span class="o">.</span><span class="n">quote</span><span class="p">(</span><span class="n">six</span><span class="o">.</span><span class="n">text_type</span><span class="p">(</span><span class="n">key</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">encoding</span><span class="p">)),</span>
</span><span id="URLGenerator-375"><a href="#URLGenerator-375"><span class="linenos">375</span></a>                                    <span class="n">urllib</span><span class="o">.</span><span class="n">parse</span><span class="o">.</span><span class="n">quote</span><span class="p">(</span><span class="n">six</span><span class="o">.</span><span class="n">text_type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">encoding</span><span class="p">))))</span>
</span><span id="URLGenerator-376"><a href="#URLGenerator-376"><span class="linenos">376</span></a>                        <span class="k">else</span><span class="p">:</span>
</span><span id="URLGenerator-377"><a href="#URLGenerator-377"><span class="linenos">377</span></a>                            <span class="n">query_args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">=</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
</span><span id="URLGenerator-378"><a href="#URLGenerator-378"><span class="linenos">378</span></a>                                <span class="n">urllib</span><span class="o">.</span><span class="n">parse</span><span class="o">.</span><span class="n">quote</span><span class="p">(</span><span class="n">six</span><span class="o">.</span><span class="n">text_type</span><span class="p">(</span><span class="n">key</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">encoding</span><span class="p">)),</span>
</span><span id="URLGenerator-379"><a href="#URLGenerator-379"><span class="linenos">379</span></a>                                <span class="n">urllib</span><span class="o">.</span><span class="n">parse</span><span class="o">.</span><span class="n">quote</span><span class="p">(</span><span class="n">six</span><span class="o">.</span><span class="n">text_type</span><span class="p">(</span><span class="n">val</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">encoding</span><span class="p">))))</span>
</span><span id="URLGenerator-380"><a href="#URLGenerator-380"><span class="linenos">380</span></a>                    <span class="n">url</span> <span class="o">+=</span> <span class="s1">&#39;&amp;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">query_args</span><span class="p">)</span>
</span><span id="URLGenerator-381"><a href="#URLGenerator-381"><span class="linenos">381</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">static</span><span class="p">:</span>
</span><span id="URLGenerator-382"><a href="#URLGenerator-382"><span class="linenos">382</span></a>            <span class="n">route_args</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="URLGenerator-383"><a href="#URLGenerator-383"><span class="linenos">383</span></a>            <span class="k">if</span> <span class="n">route</span><span class="p">:</span>
</span><span id="URLGenerator-384"><a href="#URLGenerator-384"><span class="linenos">384</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">hardcode_names</span><span class="p">:</span>
</span><span id="URLGenerator-385"><a href="#URLGenerator-385"><span class="linenos">385</span></a>                    <span class="n">route_args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">route</span><span class="p">)</span>
</span><span id="URLGenerator-386"><a href="#URLGenerator-386"><span class="linenos">386</span></a>                <span class="n">newargs</span> <span class="o">=</span> <span class="n">route</span><span class="o">.</span><span class="n">defaults</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="URLGenerator-387"><a href="#URLGenerator-387"><span class="linenos">387</span></a>                <span class="n">newargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kargs</span><span class="p">)</span>
</span><span id="URLGenerator-388"><a href="#URLGenerator-388"><span class="linenos">388</span></a>
</span><span id="URLGenerator-389"><a href="#URLGenerator-389"><span class="linenos">389</span></a>                <span class="c1"># If this route has a filter, apply it</span>
</span><span id="URLGenerator-390"><a href="#URLGenerator-390"><span class="linenos">390</span></a>                <span class="k">if</span> <span class="n">route</span><span class="o">.</span><span class="n">filter</span><span class="p">:</span>
</span><span id="URLGenerator-391"><a href="#URLGenerator-391"><span class="linenos">391</span></a>                    <span class="n">newargs</span> <span class="o">=</span> <span class="n">route</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">newargs</span><span class="p">)</span>
</span><span id="URLGenerator-392"><a href="#URLGenerator-392"><span class="linenos">392</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">route</span><span class="o">.</span><span class="n">static</span> <span class="ow">or</span> <span class="p">(</span><span class="n">route</span><span class="o">.</span><span class="n">static</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">route</span><span class="o">.</span><span class="n">external</span><span class="p">):</span>
</span><span id="URLGenerator-393"><a href="#URLGenerator-393"><span class="linenos">393</span></a>                    <span class="c1"># Handle sub-domains, retain sub_domain if there is one</span>
</span><span id="URLGenerator-394"><a href="#URLGenerator-394"><span class="linenos">394</span></a>                    <span class="n">sub</span> <span class="o">=</span> <span class="n">newargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;sub_domain&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="URLGenerator-395"><a href="#URLGenerator-395"><span class="linenos">395</span></a>                    <span class="n">newargs</span> <span class="o">=</span> <span class="n">_subdomain_check</span><span class="p">(</span><span class="n">newargs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapper</span><span class="p">,</span>
</span><span id="URLGenerator-396"><a href="#URLGenerator-396"><span class="linenos">396</span></a>                                               <span class="bp">self</span><span class="o">.</span><span class="n">environ</span><span class="p">)</span>
</span><span id="URLGenerator-397"><a href="#URLGenerator-397"><span class="linenos">397</span></a>                    <span class="c1"># If the route requires a sub-domain, and we have it, restore</span>
</span><span id="URLGenerator-398"><a href="#URLGenerator-398"><span class="linenos">398</span></a>                    <span class="c1"># it</span>
</span><span id="URLGenerator-399"><a href="#URLGenerator-399"><span class="linenos">399</span></a>                    <span class="k">if</span> <span class="s1">&#39;sub_domain&#39;</span> <span class="ow">in</span> <span class="n">route</span><span class="o">.</span><span class="n">defaults</span><span class="p">:</span>
</span><span id="URLGenerator-400"><a href="#URLGenerator-400"><span class="linenos">400</span></a>                        <span class="n">newargs</span><span class="p">[</span><span class="s1">&#39;sub_domain&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sub</span>
</span><span id="URLGenerator-401"><a href="#URLGenerator-401"><span class="linenos">401</span></a>
</span><span id="URLGenerator-402"><a href="#URLGenerator-402"><span class="linenos">402</span></a>            <span class="k">elif</span> <span class="n">use_current</span><span class="p">:</span>
</span><span id="URLGenerator-403"><a href="#URLGenerator-403"><span class="linenos">403</span></a>                <span class="n">newargs</span> <span class="o">=</span> <span class="n">_screenargs</span><span class="p">(</span><span class="n">kargs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapper</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">environ</span><span class="p">,</span> <span class="n">force_explicit</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="URLGenerator-404"><a href="#URLGenerator-404"><span class="linenos">404</span></a>            <span class="k">elif</span> <span class="s1">&#39;sub_domain&#39;</span> <span class="ow">in</span> <span class="n">kargs</span><span class="p">:</span>
</span><span id="URLGenerator-405"><a href="#URLGenerator-405"><span class="linenos">405</span></a>                <span class="n">newargs</span> <span class="o">=</span> <span class="n">_subdomain_check</span><span class="p">(</span><span class="n">kargs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapper</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">environ</span><span class="p">)</span>
</span><span id="URLGenerator-406"><a href="#URLGenerator-406"><span class="linenos">406</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="URLGenerator-407"><a href="#URLGenerator-407"><span class="linenos">407</span></a>                <span class="n">newargs</span> <span class="o">=</span> <span class="n">kargs</span>
</span><span id="URLGenerator-408"><a href="#URLGenerator-408"><span class="linenos">408</span></a>
</span><span id="URLGenerator-409"><a href="#URLGenerator-409"><span class="linenos">409</span></a>            <span class="n">anchor</span> <span class="o">=</span> <span class="n">anchor</span> <span class="ow">or</span> <span class="n">newargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;_anchor&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="URLGenerator-410"><a href="#URLGenerator-410"><span class="linenos">410</span></a>            <span class="n">host</span> <span class="o">=</span> <span class="n">host</span> <span class="ow">or</span> <span class="n">newargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;_host&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="URLGenerator-411"><a href="#URLGenerator-411"><span class="linenos">411</span></a>            <span class="k">if</span> <span class="n">protocol</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="URLGenerator-412"><a href="#URLGenerator-412"><span class="linenos">412</span></a>                <span class="n">protocol</span> <span class="o">=</span> <span class="n">newargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;_protocol&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="URLGenerator-413"><a href="#URLGenerator-413"><span class="linenos">413</span></a>            <span class="n">newargs</span><span class="p">[</span><span class="s1">&#39;_environ&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">environ</span>
</span><span id="URLGenerator-414"><a href="#URLGenerator-414"><span class="linenos">414</span></a>            <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="o">*</span><span class="n">route_args</span><span class="p">,</span> <span class="o">**</span><span class="n">newargs</span><span class="p">)</span>
</span><span id="URLGenerator-415"><a href="#URLGenerator-415"><span class="linenos">415</span></a>        <span class="k">if</span> <span class="n">anchor</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="URLGenerator-416"><a href="#URLGenerator-416"><span class="linenos">416</span></a>            <span class="n">url</span> <span class="o">+=</span> <span class="s1">&#39;#&#39;</span> <span class="o">+</span> <span class="n">_url_quote</span><span class="p">(</span><span class="n">anchor</span><span class="p">,</span> <span class="n">encoding</span><span class="p">)</span>
</span><span id="URLGenerator-417"><a href="#URLGenerator-417"><span class="linenos">417</span></a>        <span class="k">if</span> <span class="n">host</span> <span class="ow">or</span> <span class="p">(</span><span class="n">protocol</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="n">qualified</span><span class="p">:</span>
</span><span id="URLGenerator-418"><a href="#URLGenerator-418"><span class="linenos">418</span></a>            <span class="k">if</span> <span class="s1">&#39;routes.cached_hostinfo&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">environ</span><span class="p">:</span>
</span><span id="URLGenerator-419"><a href="#URLGenerator-419"><span class="linenos">419</span></a>                <span class="n">cache_hostinfo</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">environ</span><span class="p">)</span>
</span><span id="URLGenerator-420"><a href="#URLGenerator-420"><span class="linenos">420</span></a>            <span class="n">hostinfo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;routes.cached_hostinfo&#39;</span><span class="p">]</span>
</span><span id="URLGenerator-421"><a href="#URLGenerator-421"><span class="linenos">421</span></a>
</span><span id="URLGenerator-422"><a href="#URLGenerator-422"><span class="linenos">422</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">host</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">qualified</span><span class="p">:</span>
</span><span id="URLGenerator-423"><a href="#URLGenerator-423"><span class="linenos">423</span></a>                <span class="c1"># Ensure we don&#39;t use a specific port, as changing the protocol</span>
</span><span id="URLGenerator-424"><a href="#URLGenerator-424"><span class="linenos">424</span></a>                <span class="c1"># means that we most likely need a new port</span>
</span><span id="URLGenerator-425"><a href="#URLGenerator-425"><span class="linenos">425</span></a>                <span class="n">host</span> <span class="o">=</span> <span class="n">hostinfo</span><span class="p">[</span><span class="s1">&#39;host&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="URLGenerator-426"><a href="#URLGenerator-426"><span class="linenos">426</span></a>            <span class="k">elif</span> <span class="ow">not</span> <span class="n">host</span><span class="p">:</span>
</span><span id="URLGenerator-427"><a href="#URLGenerator-427"><span class="linenos">427</span></a>                <span class="n">host</span> <span class="o">=</span> <span class="n">hostinfo</span><span class="p">[</span><span class="s1">&#39;host&#39;</span><span class="p">]</span>
</span><span id="URLGenerator-428"><a href="#URLGenerator-428"><span class="linenos">428</span></a>            <span class="k">if</span> <span class="n">protocol</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="URLGenerator-429"><a href="#URLGenerator-429"><span class="linenos">429</span></a>                <span class="n">protocol</span> <span class="o">=</span> <span class="n">hostinfo</span><span class="p">[</span><span class="s1">&#39;protocol&#39;</span><span class="p">]</span>
</span><span id="URLGenerator-430"><a href="#URLGenerator-430"><span class="linenos">430</span></a>            <span class="k">if</span> <span class="n">protocol</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
</span><span id="URLGenerator-431"><a href="#URLGenerator-431"><span class="linenos">431</span></a>                <span class="n">protocol</span> <span class="o">+=</span> <span class="s1">&#39;:&#39;</span>
</span><span id="URLGenerator-432"><a href="#URLGenerator-432"><span class="linenos">432</span></a>            <span class="k">if</span> <span class="n">url</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="URLGenerator-433"><a href="#URLGenerator-433"><span class="linenos">433</span></a>                <span class="k">if</span> <span class="n">host</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;/&#39;</span><span class="p">:</span>
</span><span id="URLGenerator-434"><a href="#URLGenerator-434"><span class="linenos">434</span></a>                    <span class="n">host</span> <span class="o">+=</span> <span class="s1">&#39;/&#39;</span>
</span><span id="URLGenerator-435"><a href="#URLGenerator-435"><span class="linenos">435</span></a>                <span class="n">url</span> <span class="o">=</span> <span class="n">protocol</span> <span class="o">+</span> <span class="s1">&#39;//&#39;</span> <span class="o">+</span> <span class="n">host</span> <span class="o">+</span> <span class="n">url</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
</span><span id="URLGenerator-436"><a href="#URLGenerator-436"><span class="linenos">436</span></a>
</span><span id="URLGenerator-437"><a href="#URLGenerator-437"><span class="linenos">437</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">ascii_characters</span><span class="p">(</span><span class="n">url</span><span class="p">)</span> <span class="ow">and</span> <span class="n">url</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="URLGenerator-438"><a href="#URLGenerator-438"><span class="linenos">438</span></a>            <span class="k">raise</span> <span class="n">GenerationException</span><span class="p">(</span><span class="s2">&quot;Can only return a string, got &quot;</span>
</span><span id="URLGenerator-439"><a href="#URLGenerator-439"><span class="linenos">439</span></a>                            <span class="s2">&quot;unicode instead: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">url</span><span class="p">)</span>
</span><span id="URLGenerator-440"><a href="#URLGenerator-440"><span class="linenos">440</span></a>        <span class="k">if</span> <span class="n">url</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="URLGenerator-441"><a href="#URLGenerator-441"><span class="linenos">441</span></a>            <span class="k">raise</span> <span class="n">GenerationException</span><span class="p">(</span>
</span><span id="URLGenerator-442"><a href="#URLGenerator-442"><span class="linenos">442</span></a>                <span class="s2">&quot;Could not generate URL. Called with args: </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> \
</span><span id="URLGenerator-443"><a href="#URLGenerator-443"><span class="linenos">443</span></a>                <span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">kargs</span><span class="p">))</span>
</span><span id="URLGenerator-444"><a href="#URLGenerator-444"><span class="linenos">444</span></a>        <span class="k">return</span> <span class="n">url</span>
</span><span id="URLGenerator-445"><a href="#URLGenerator-445"><span class="linenos">445</span></a>
</span><span id="URLGenerator-446"><a href="#URLGenerator-446"><span class="linenos">446</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">current</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="URLGenerator-447"><a href="#URLGenerator-447"><span class="linenos">447</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate a route that includes params used on the current</span>
</span><span id="URLGenerator-448"><a href="#URLGenerator-448"><span class="linenos">448</span></a><span class="sd">        request</span>
</span><span id="URLGenerator-449"><a href="#URLGenerator-449"><span class="linenos">449</span></a>
</span><span id="URLGenerator-450"><a href="#URLGenerator-450"><span class="linenos">450</span></a><span class="sd">        The arguments for this method are identical to ``__call__``</span>
</span><span id="URLGenerator-451"><a href="#URLGenerator-451"><span class="linenos">451</span></a><span class="sd">        except that arguments set to None will remove existing route</span>
</span><span id="URLGenerator-452"><a href="#URLGenerator-452"><span class="linenos">452</span></a><span class="sd">        matches of the same name from the set of arguments used to</span>
</span><span id="URLGenerator-453"><a href="#URLGenerator-453"><span class="linenos">453</span></a><span class="sd">        construct a URL.</span>
</span><span id="URLGenerator-454"><a href="#URLGenerator-454"><span class="linenos">454</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="URLGenerator-455"><a href="#URLGenerator-455"><span class="linenos">455</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="p">(</span><span class="n">_use_current</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>The URL Generator generates URL's</p>

<p>It is automatically instantiated by the RoutesMiddleware and put
into the <code>wsgiorg.routing_args</code> tuple accessible as::</p>

<pre><code>url = environ['wsgiorg.routing_args'][0][0]
</code></pre>

<p>Or via the <code>routes.url</code> key::</p>

<pre><code>url = environ['routes.url']
</code></pre>

<p>The url object may be instantiated outside of a web context for use
in testing, however sub_domain support and fully qualified URL's
cannot be generated without supplying a dict that must contain the
key <code>HTTP_HOST</code>.</p>
</div>


                            <div id="URLGenerator.__init__" class="classattr">
                                        <input id="URLGenerator.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">URLGenerator</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">mapper</span>, </span><span class="param"><span class="n">environ</span></span>)</span>

                <label class="view-source-button" for="URLGenerator.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#URLGenerator.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="URLGenerator.__init__-306"><a href="#URLGenerator.__init__-306"><span class="linenos">306</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mapper</span><span class="p">,</span> <span class="n">environ</span><span class="p">):</span>
</span><span id="URLGenerator.__init__-307"><a href="#URLGenerator.__init__-307"><span class="linenos">307</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Instantiate the URLGenerator</span>
</span><span id="URLGenerator.__init__-308"><a href="#URLGenerator.__init__-308"><span class="linenos">308</span></a>
</span><span id="URLGenerator.__init__-309"><a href="#URLGenerator.__init__-309"><span class="linenos">309</span></a><span class="sd">        ``mapper``</span>
</span><span id="URLGenerator.__init__-310"><a href="#URLGenerator.__init__-310"><span class="linenos">310</span></a><span class="sd">            The mapper object to use when generating routes.</span>
</span><span id="URLGenerator.__init__-311"><a href="#URLGenerator.__init__-311"><span class="linenos">311</span></a><span class="sd">        ``environ``</span>
</span><span id="URLGenerator.__init__-312"><a href="#URLGenerator.__init__-312"><span class="linenos">312</span></a><span class="sd">            The environment dict used in WSGI, alternately, any dict</span>
</span><span id="URLGenerator.__init__-313"><a href="#URLGenerator.__init__-313"><span class="linenos">313</span></a><span class="sd">            that contains at least an ``HTTP_HOST`` value.</span>
</span><span id="URLGenerator.__init__-314"><a href="#URLGenerator.__init__-314"><span class="linenos">314</span></a>
</span><span id="URLGenerator.__init__-315"><a href="#URLGenerator.__init__-315"><span class="linenos">315</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="URLGenerator.__init__-316"><a href="#URLGenerator.__init__-316"><span class="linenos">316</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">mapper</span> <span class="o">=</span> <span class="n">mapper</span>
</span><span id="URLGenerator.__init__-317"><a href="#URLGenerator.__init__-317"><span class="linenos">317</span></a>        <span class="k">if</span> <span class="s1">&#39;SCRIPT_NAME&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">environ</span><span class="p">:</span>
</span><span id="URLGenerator.__init__-318"><a href="#URLGenerator.__init__-318"><span class="linenos">318</span></a>            <span class="n">environ</span><span class="p">[</span><span class="s1">&#39;SCRIPT_NAME&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
</span><span id="URLGenerator.__init__-319"><a href="#URLGenerator.__init__-319"><span class="linenos">319</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">environ</span> <span class="o">=</span> <span class="n">environ</span>
</span></pre></div>


            <div class="docstring"><p>Instantiate the URLGenerator</p>

<p><code><a href="#URLGenerator.mapper">mapper</a></code>
    The mapper object to use when generating routes.
<code><a href="#URLGenerator.environ">environ</a></code>
    The environment dict used in WSGI, alternately, any dict
    that contains at least an <code>HTTP_HOST</code> value.</p>
</div>


                            </div>
                            <div id="URLGenerator.mapper" class="classattr">
                                <div class="attr variable">
            <span class="name">mapper</span>

        
    </div>
    <a class="headerlink" href="#URLGenerator.mapper"></a>
    
    

                            </div>
                            <div id="URLGenerator.environ" class="classattr">
                                <div class="attr variable">
            <span class="name">environ</span>

        
    </div>
    <a class="headerlink" href="#URLGenerator.environ"></a>
    
    

                            </div>
                            <div id="URLGenerator.current" class="classattr">
                                        <input id="URLGenerator.current-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">current</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="o">*</span><span class="n">args</span>, </span><span class="param"><span class="o">**</span><span class="n">kwargs</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="URLGenerator.current-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#URLGenerator.current"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="URLGenerator.current-446"><a href="#URLGenerator.current-446"><span class="linenos">446</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">current</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="URLGenerator.current-447"><a href="#URLGenerator.current-447"><span class="linenos">447</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate a route that includes params used on the current</span>
</span><span id="URLGenerator.current-448"><a href="#URLGenerator.current-448"><span class="linenos">448</span></a><span class="sd">        request</span>
</span><span id="URLGenerator.current-449"><a href="#URLGenerator.current-449"><span class="linenos">449</span></a>
</span><span id="URLGenerator.current-450"><a href="#URLGenerator.current-450"><span class="linenos">450</span></a><span class="sd">        The arguments for this method are identical to ``__call__``</span>
</span><span id="URLGenerator.current-451"><a href="#URLGenerator.current-451"><span class="linenos">451</span></a><span class="sd">        except that arguments set to None will remove existing route</span>
</span><span id="URLGenerator.current-452"><a href="#URLGenerator.current-452"><span class="linenos">452</span></a><span class="sd">        matches of the same name from the set of arguments used to</span>
</span><span id="URLGenerator.current-453"><a href="#URLGenerator.current-453"><span class="linenos">453</span></a><span class="sd">        construct a URL.</span>
</span><span id="URLGenerator.current-454"><a href="#URLGenerator.current-454"><span class="linenos">454</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="URLGenerator.current-455"><a href="#URLGenerator.current-455"><span class="linenos">455</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="p">(</span><span class="n">_use_current</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Generate a route that includes params used on the current
request</p>

<p>The arguments for this method are identical to <code>__call__</code>
except that arguments set to None will remove existing route
matches of the same name from the set of arguments used to
construct a URL.</p>
</div>


                            </div>
                </section>
                <section id="redirect_to">
                            <input id="redirect_to-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">redirect_to</span><span class="signature pdoc-code condensed">(<span class="param"><span class="o">*</span><span class="n">args</span>, </span><span class="param"><span class="o">**</span><span class="n">kargs</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="redirect_to-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#redirect_to"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="redirect_to-458"><a href="#redirect_to-458"><span class="linenos">458</span></a><span class="k">def</span><span class="w"> </span><span class="nf">redirect_to</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">):</span>
</span><span id="redirect_to-459"><a href="#redirect_to-459"><span class="linenos">459</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Issues a redirect based on the arguments.</span>
</span><span id="redirect_to-460"><a href="#redirect_to-460"><span class="linenos">460</span></a>
</span><span id="redirect_to-461"><a href="#redirect_to-461"><span class="linenos">461</span></a><span class="sd">    Redirect&#39;s *should* occur as a &quot;302 Moved&quot; header, however the web</span>
</span><span id="redirect_to-462"><a href="#redirect_to-462"><span class="linenos">462</span></a><span class="sd">    framework may utilize a different method.</span>
</span><span id="redirect_to-463"><a href="#redirect_to-463"><span class="linenos">463</span></a>
</span><span id="redirect_to-464"><a href="#redirect_to-464"><span class="linenos">464</span></a><span class="sd">    All arguments are passed to url_for to retrieve the appropriate URL, then</span>
</span><span id="redirect_to-465"><a href="#redirect_to-465"><span class="linenos">465</span></a><span class="sd">    the resulting URL it sent to the redirect function as the URL.</span>
</span><span id="redirect_to-466"><a href="#redirect_to-466"><span class="linenos">466</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="redirect_to-467"><a href="#redirect_to-467"><span class="linenos">467</span></a>    <span class="n">target</span> <span class="o">=</span> <span class="n">url_for</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">)</span>
</span><span id="redirect_to-468"><a href="#redirect_to-468"><span class="linenos">468</span></a>    <span class="n">config</span> <span class="o">=</span> <span class="n">request_config</span><span class="p">()</span>
</span><span id="redirect_to-469"><a href="#redirect_to-469"><span class="linenos">469</span></a>    <span class="k">return</span> <span class="n">config</span><span class="o">.</span><span class="n">redirect</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Issues a redirect based on the arguments.</p>

<p>Redirect's <em>should</em> occur as a "302 Moved" header, however the web
framework may utilize a different method.</p>

<p>All arguments are passed to url_for to retrieve the appropriate URL, then
the resulting URL it sent to the redirect function as the URL.</p>
</div>


                </section>
                <section id="request_config">
                            <input id="request_config-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">request_config</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">original</span><span class="o">=</span><span class="kc">False</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="request_config-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#request_config"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="request_config-80"><a href="#request_config-80"><span class="linenos"> 80</span></a><span class="k">def</span><span class="w"> </span><span class="nf">request_config</span><span class="p">(</span><span class="n">original</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="request_config-81"><a href="#request_config-81"><span class="linenos"> 81</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="request_config-82"><a href="#request_config-82"><span class="linenos"> 82</span></a><span class="sd">    Returns the Routes RequestConfig object.</span>
</span><span id="request_config-83"><a href="#request_config-83"><span class="linenos"> 83</span></a>
</span><span id="request_config-84"><a href="#request_config-84"><span class="linenos"> 84</span></a><span class="sd">    To get the Routes RequestConfig:</span>
</span><span id="request_config-85"><a href="#request_config-85"><span class="linenos"> 85</span></a>
</span><span id="request_config-86"><a href="#request_config-86"><span class="linenos"> 86</span></a><span class="sd">    &gt;&gt;&gt; from routes import *</span>
</span><span id="request_config-87"><a href="#request_config-87"><span class="linenos"> 87</span></a><span class="sd">    &gt;&gt;&gt; config = request_config()</span>
</span><span id="request_config-88"><a href="#request_config-88"><span class="linenos"> 88</span></a>
</span><span id="request_config-89"><a href="#request_config-89"><span class="linenos"> 89</span></a><span class="sd">    The following attributes must be set on the config object every request:</span>
</span><span id="request_config-90"><a href="#request_config-90"><span class="linenos"> 90</span></a>
</span><span id="request_config-91"><a href="#request_config-91"><span class="linenos"> 91</span></a><span class="sd">    mapper</span>
</span><span id="request_config-92"><a href="#request_config-92"><span class="linenos"> 92</span></a><span class="sd">        mapper should be a Mapper instance thats ready for use</span>
</span><span id="request_config-93"><a href="#request_config-93"><span class="linenos"> 93</span></a><span class="sd">    host</span>
</span><span id="request_config-94"><a href="#request_config-94"><span class="linenos"> 94</span></a><span class="sd">        host is the hostname of the webapp</span>
</span><span id="request_config-95"><a href="#request_config-95"><span class="linenos"> 95</span></a><span class="sd">    protocol</span>
</span><span id="request_config-96"><a href="#request_config-96"><span class="linenos"> 96</span></a><span class="sd">        protocol is the protocol of the current request</span>
</span><span id="request_config-97"><a href="#request_config-97"><span class="linenos"> 97</span></a><span class="sd">    mapper_dict</span>
</span><span id="request_config-98"><a href="#request_config-98"><span class="linenos"> 98</span></a><span class="sd">        mapper_dict should be the dict returned by mapper.match()</span>
</span><span id="request_config-99"><a href="#request_config-99"><span class="linenos"> 99</span></a><span class="sd">    redirect</span>
</span><span id="request_config-100"><a href="#request_config-100"><span class="linenos">100</span></a><span class="sd">        redirect should be a function that issues a redirect,</span>
</span><span id="request_config-101"><a href="#request_config-101"><span class="linenos">101</span></a><span class="sd">        and takes a url as the sole argument</span>
</span><span id="request_config-102"><a href="#request_config-102"><span class="linenos">102</span></a><span class="sd">    prefix (optional)</span>
</span><span id="request_config-103"><a href="#request_config-103"><span class="linenos">103</span></a><span class="sd">        Set if the application is moved under a URL prefix. Prefix</span>
</span><span id="request_config-104"><a href="#request_config-104"><span class="linenos">104</span></a><span class="sd">        will be stripped before matching, and prepended on generation</span>
</span><span id="request_config-105"><a href="#request_config-105"><span class="linenos">105</span></a><span class="sd">    environ (optional)</span>
</span><span id="request_config-106"><a href="#request_config-106"><span class="linenos">106</span></a><span class="sd">        Set to the WSGI environ for automatic prefix support if the</span>
</span><span id="request_config-107"><a href="#request_config-107"><span class="linenos">107</span></a><span class="sd">        webapp is underneath a &#39;SCRIPT_NAME&#39;</span>
</span><span id="request_config-108"><a href="#request_config-108"><span class="linenos">108</span></a>
</span><span id="request_config-109"><a href="#request_config-109"><span class="linenos">109</span></a><span class="sd">        Setting the environ will use information in environ to try and</span>
</span><span id="request_config-110"><a href="#request_config-110"><span class="linenos">110</span></a><span class="sd">        populate the host/protocol/mapper_dict options if you&#39;ve already</span>
</span><span id="request_config-111"><a href="#request_config-111"><span class="linenos">111</span></a><span class="sd">        set a mapper.</span>
</span><span id="request_config-112"><a href="#request_config-112"><span class="linenos">112</span></a>
</span><span id="request_config-113"><a href="#request_config-113"><span class="linenos">113</span></a><span class="sd">    **Using your own requst local**</span>
</span><span id="request_config-114"><a href="#request_config-114"><span class="linenos">114</span></a>
</span><span id="request_config-115"><a href="#request_config-115"><span class="linenos">115</span></a><span class="sd">    If you have your own request local object that you&#39;d like to use instead</span>
</span><span id="request_config-116"><a href="#request_config-116"><span class="linenos">116</span></a><span class="sd">    of the default thread local provided by Routes, you can configure Routes</span>
</span><span id="request_config-117"><a href="#request_config-117"><span class="linenos">117</span></a><span class="sd">    to use it::</span>
</span><span id="request_config-118"><a href="#request_config-118"><span class="linenos">118</span></a>
</span><span id="request_config-119"><a href="#request_config-119"><span class="linenos">119</span></a><span class="sd">        from routes import request_config()</span>
</span><span id="request_config-120"><a href="#request_config-120"><span class="linenos">120</span></a><span class="sd">        config = request_config()</span>
</span><span id="request_config-121"><a href="#request_config-121"><span class="linenos">121</span></a><span class="sd">        if hasattr(config, &#39;using_request_local&#39;):</span>
</span><span id="request_config-122"><a href="#request_config-122"><span class="linenos">122</span></a><span class="sd">            config.request_local = YourLocalCallable</span>
</span><span id="request_config-123"><a href="#request_config-123"><span class="linenos">123</span></a><span class="sd">            config = request_config()</span>
</span><span id="request_config-124"><a href="#request_config-124"><span class="linenos">124</span></a>
</span><span id="request_config-125"><a href="#request_config-125"><span class="linenos">125</span></a><span class="sd">    Once you have configured request_config, its advisable you retrieve it</span>
</span><span id="request_config-126"><a href="#request_config-126"><span class="linenos">126</span></a><span class="sd">    again to get the object you wanted. The variable you assign to</span>
</span><span id="request_config-127"><a href="#request_config-127"><span class="linenos">127</span></a><span class="sd">    request_local is assumed to be a callable that will get the local config</span>
</span><span id="request_config-128"><a href="#request_config-128"><span class="linenos">128</span></a><span class="sd">    object you wish.</span>
</span><span id="request_config-129"><a href="#request_config-129"><span class="linenos">129</span></a>
</span><span id="request_config-130"><a href="#request_config-130"><span class="linenos">130</span></a><span class="sd">    This example tests for the presence of the &#39;using_request_local&#39; attribute</span>
</span><span id="request_config-131"><a href="#request_config-131"><span class="linenos">131</span></a><span class="sd">    which will be present if you haven&#39;t assigned it yet. This way you can</span>
</span><span id="request_config-132"><a href="#request_config-132"><span class="linenos">132</span></a><span class="sd">    avoid repeat assignments of the request specific callable.</span>
</span><span id="request_config-133"><a href="#request_config-133"><span class="linenos">133</span></a>
</span><span id="request_config-134"><a href="#request_config-134"><span class="linenos">134</span></a><span class="sd">    Should you want the original object, perhaps to change the callable its</span>
</span><span id="request_config-135"><a href="#request_config-135"><span class="linenos">135</span></a><span class="sd">    using or stop this behavior, call request_config(original=True).</span>
</span><span id="request_config-136"><a href="#request_config-136"><span class="linenos">136</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="request_config-137"><a href="#request_config-137"><span class="linenos">137</span></a>    <span class="n">obj</span> <span class="o">=</span> <span class="n">_RequestConfig</span><span class="p">()</span>
</span><span id="request_config-138"><a href="#request_config-138"><span class="linenos">138</span></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="request_config-139"><a href="#request_config-139"><span class="linenos">139</span></a>        <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">request_local</span> <span class="ow">and</span> <span class="n">original</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
</span><span id="request_config-140"><a href="#request_config-140"><span class="linenos">140</span></a>            <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="s1">&#39;request_local&#39;</span><span class="p">)()</span>
</span><span id="request_config-141"><a href="#request_config-141"><span class="linenos">141</span></a>    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
</span><span id="request_config-142"><a href="#request_config-142"><span class="linenos">142</span></a>        <span class="n">obj</span><span class="o">.</span><span class="n">request_local</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="request_config-143"><a href="#request_config-143"><span class="linenos">143</span></a>        <span class="n">obj</span><span class="o">.</span><span class="n">using_request_local</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="request_config-144"><a href="#request_config-144"><span class="linenos">144</span></a>    <span class="k">return</span> <span class="n">_RequestConfig</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Returns the Routes RequestConfig object.</p>

<p>To get the Routes RequestConfig:</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">routes</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">config</span> <span class="o">=</span> <span class="n">request_config</span><span class="p">()</span>
</code></pre>
</div>

<p>The following attributes must be set on the config object every request:</p>

<p>mapper
    mapper should be a Mapper instance thats ready for use
host
    host is the hostname of the webapp
protocol
    protocol is the protocol of the current request
mapper_dict
    mapper_dict should be the dict returned by mapper.match()
redirect
    redirect should be a function that issues a redirect,
    and takes a url as the sole argument
prefix (optional)
    Set if the application is moved under a URL prefix. Prefix
    will be stripped before matching, and prepended on generation
environ (optional)
    Set to the WSGI environ for automatic prefix support if the
    webapp is underneath a 'SCRIPT_NAME'</p>

<pre><code>Setting the environ will use information in environ to try and
populate the host/protocol/mapper_dict options if you've already
set a mapper.
</code></pre>

<p><strong>Using your own requst local</strong></p>

<p>If you have your own request local object that you'd like to use instead
of the default thread local provided by Routes, you can configure Routes
to use it::</p>

<pre><code>from routes import request_config()
config = request_config()
if hasattr(config, 'using_request_local'):
    config.request_local = YourLocalCallable
    config = request_config()
</code></pre>

<p>Once you have configured request_config, its advisable you retrieve it
again to get the object you wanted. The variable you assign to
request_local is assumed to be a callable that will get the local config
object you wish.</p>

<p>This example tests for the presence of the 'using_request_local' attribute
which will be present if you haven't assigned it yet. This way you can
avoid repeat assignments of the request specific callable.</p>

<p>Should you want the original object, perhaps to change the callable its
using or stop this behavior, call request_config(original=True).</p>
</div>


                </section>
    </main>
</body>
</html>